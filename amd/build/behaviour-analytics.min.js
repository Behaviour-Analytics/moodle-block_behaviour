/*! moodle-block_behaviour v0.7.1 06-11-2020 */
!function(a){"function"==typeof define&&define.amd?define([],a):window.behaviourAnalytics=a()}(function(){return function(a){function b(a){rb=a.logs,sb=a.users,tb=a.mods,ub=a.panelwidth,vb=a.legendwidth,wb=a.name,xb=a.iframeurl,Uc=a.version36,Vc=a.showstudentnames,yb=a.positioning,zb=a.positioning,Ab=a.nodecoords,Bb=a.links,Db=a.courseid,Eb=a.userid,Cb=a.scale,Fb=a.graphs,Gb=a.alllinks,Hb=a.scales,Ib=a.changes,Jb=a.names,Kb=a.allmods,Lb=a.setnames,Mb=Eb,Nb=a.lastchange,Ob=a.comments,Rb=a.strings,nb=a.coordsscript,ob=a.clustersscript,pb=a.commentsscript,qb=a.manualscript,Sb=a.sesskey,dd=a.gotallnodes,mc=a.replaying,kd=a.debugcentroids,ld=a.centroids,hd=a.isresearcher,gd=Eb,Tb=window.dataDrivenDocs,Vb=window.noUiSlider;var b=window.mersenneTwister;Wb=new b(259),Ac=0,zc=c(),Xc=Date.now()+3e3,cd=1e3,Ub=Tb.transition().duration(cd).ease(Tb.easeLinear),uc=120,Wc=1,fc=1e-4,cc=1,_c=J,Hc=!1,Ic=220,Kc=.15,Jc=Tb.curveCatmullRomClosed,jd=!0,xc={},bd={},Bc={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown",data:"coral",chat:"maroon",choice:"grey",feedback:"lime",glossary:"navy",survey:"tan",wiki:"teal",workshop:"silver",scorm:"tomato",imscp:"lightpink",folder:"peru"},Cc=["blue","red","orange","green","yellow","brown","purple","magenta","cyan"],kc=yb?0:36,ub=yb?0:ub,Yb=window.innerWidth-uc-vb-150,Zb=window.innerHeight-kc-90,ad=Math.min(Yb,Zb)<500?6:8,Pb={},sb.forEach(function(a){Pb[a.id]=a.realId}),d(),e(),mc?_(a.replaydata,a.manualdata):yb?h():j()}function c(){return["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"]}function d(){tb.forEach(function(a){for(;!Bc[a.entype];){var b=zc[Math.floor(Wb.random()*zc.length)],c=!0;for(var d in Bc)Bc[d]==b&&(c=!1);Bc[a.entype]=c?b:void 0}})}function e(){gc={nodes:[],links:[],edges:{},maxSession:0},f(),g()}function f(){var a,b,c,d=gc,e={};tb.forEach(function(f){a=!0,b=void 0,c=void 0,Ab[f.id]?(a=1==Ab[f.id].visible&&1==Ab["g"+f.sect].visible,1!=Ab[f.id].visible||a||(Ab[f.id].visible=0),b=Ab[f.id].xcoord,c=Ab[f.id].ycoord):Ab["g"+f.sect]&&(a=1==Ab["g"+f.sect].visible&&Eb==Mb),d.nodes[d.nodes.length]={id:f.id,name:f.name,group:f.sect,type:f.type,entype:f.entype,colour:Bc[f.entype],visible:a,xcoord:b,ycoord:c},e[f.sect]||(Ab["g"+f.sect]&&(a=1==Ab["g"+f.sect].visible,b=Ab["g"+f.sect].xcoord,c=Ab["g"+f.sect].ycoord),e[f.sect]={id:"g"+f.sect,name:Rb.section+" "+f.sect,group:f.sect,type:"grouping",colour:Bc.grouping,visible:a,xcoord:b,ycoord:c},d.nodes[d.nodes.length]=e[f.sect]),d.links[d.links.length]={source:"g"+f.sect,target:f.id,weight:cc,colour:Bc.originalLinks}}),b=c=void 0,Ab.root&&(b=Ab.root.xcoord,c=Ab.root.ycoord);var f={id:"root",name:wb,group:-1,type:"grouping",colour:Bc.grouping,visible:!0,xcoord:b,ycoord:c};if(Object.keys(e).length>1)for(var g in e)d.links[d.links.length]={source:"root",target:e[g].id,weight:cc,colour:Bc.originalLinks};else d.nodes=d.nodes.filter(function(a){return"g0"!=a.id}),d.links.forEach(function(a){"g0"==a.source&&(a.source="root")});if(d.nodes[d.nodes.length]=f,Object.keys(Bb).length>0){var h,i,j;for(var k in Bb)j=k.split("_"),h=j[0],i=j[1],d.links[d.links.length]={source:h,target:i,weight:5*Bb[k],colour:Bc.originalLinks};if(!zb)for(var l in d.nodes)isNaN(d.nodes[l].id)&&(d.nodes[l].visible=!1)}}function g(){var a,b=gc,c=0,d=0;id={};for(var e=0;e<rb.length;e++)a={source:rb[e].moduleId,target:rb[e].moduleId,weight:cc,user:rb[e].userId,colour:""},b.edges[rb[e].userId]||(b.edges[rb[e].userId]=[],id[rb[e].userId]=[],b.maxSession=b.maxSession<c?c:b.maxSession,c=0,d=0),Ab[rb[e].moduleId]&&1==Ab[rb[e].moduleId].visible&&(id[rb[e].userId][d++]=rb[e].moduleId),e+1<rb.length&&rb[e].userId==rb[e+1].userId?(a.target=rb[e+1].moduleId,b.edges[rb[e].userId][c++]=a):0==b.edges[rb[e].userId].length&&(b.edges[rb[e].userId][c++]=a);b.maxSession=b.maxSession<c?c:b.maxSession,sb.forEach(function(a){b.edges[a.id]||(b.edges[a.id]=[])})}function h(){Dc=!1,dc=.01,ec=.01,Yc=K,Zc=L,$c=M,dd&&Object.keys(Ab).length>0&&(cc=0),Fb&&Hb&&y(),k(.6),D(),i(),setTimeout(function(){$b.force("charge",null).force("x",null).force("y",null)},500)}function i(){var a=document.getElementById("student-menu"),b=document.createElement("input");b.id="weight-slider",b.type="range",b.min="-0.2",b.max="2",b.step="0.2",b.value="0.6",b.style.width="130px",b.addEventListener("change",function(){bc.strength(this.value),document.getElementById("weights-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(b);var c=document.createTextNode(Rb.linksweight);a.appendChild(c),c=document.createElement("label"),c.id="weights-output",c.innerHTML="&nbsp;= "+b.value,a.appendChild(c)}function j(){Dc=!0,yb=!0,dc=0,Yc=null,Zc=null,$c=null,dd&&0!=Object.keys(Ab).length?(N(),k(0),P()):(k(.6),setTimeout(function(){N(),P()},500)),bc=null}function k(a){Xb=Tb.select("#graph").append("svg").attr("width",Yb).attr("height",Zb),bc=Tb.forceLink(gc.links).id(function(a){return a.id}).strength(a),$b=Tb.forceSimulation(gc.nodes).force("link",bc).force("charge",Tb.forceManyBody().strength(-80)).force("collide",Tb.forceCollide().radius(12)).force("center",Tb.forceCenter(Yb/2,Zb/2)).force("x",Tb.forceX()).force("y",Tb.forceY()),l(gc.nodes,_c,Yc,Zc,$c),m(gc.links),Xb.on("click",function(){Tb.selectAll("#rctext").remove(),Tb.selectAll("#rcrect").remove(),(Dc||yb)&&_b.on("mouseover",n).on("mouseout",q),mc&&_b.on("mouseover",null).on("mouseout",null)}),dd&&yb&&Object.keys(Ab).length>0?$b.on("tick",s):$b.on("tick",t);for(var b=0;b<80;b++)$b.tick();yb&&setTimeout(function(){$b.stop(),$b.on("tick",t),u(),0!=Object.keys(Ab).length&&dd||(v(),gc.edges={},g(),dd=!0,cc=Dc?1:0)},500),Dc&&!dd&&setTimeout(function(){gc.nodes=[],gc.links=[],f()},600)}function l(a,b,c,d,e){_b=Xb.selectAll(".node").data(a).enter().append("circle").attr("class","node").attr("r",ad).on("mouseover",n).on("mouseout",q).on("contextmenu",b).call(Tb.drag().on("start",c).on("drag",d).on("end",e))}function m(a){ac=Xb.selectAll(".link").data(a).enter().append("line").attr("class","link").style("stroke",function(a){return a.colour}).style("stroke-width",function(a){return 2*a.weight+"px"})}function n(a,b){if(!(Qc||(_b.on("mouseover",null),b||(Tb.selectAll(".text").remove(),Tb.selectAll("rect").remove()),Date.now()-Xc<150))){var c=[0],d=!1,e=!1,f=!1,g=150,h=304,i=154,j=a.type+": "+a.name;Rc&&(h=0,i=0);var k=Xb.append("text").attr("class","text").attr("id","t-"+a.id).attr("y",a.y+32).attr("dy",".40em").style("pointer-events","none").text(j).call(o,g,a.x-(g+6)/2+8,c),l=16*c[0]+16;l+a.y>=Zb-i&&(k.attr("y",Zb-l-(Zb-a.y)).text(j).call(o,g,a.x-(g+6)/2+8,c),d=!0),a.x<=h/2?(k.text(j).call(o,g,a.x+8,c),f=!0):a.x>=Yb-h/2&&(k.text(j).call(o,g,a.x-(g+6)+8,c),e=!0);var m;m=f?a.x:e?a.x-(g+6):a.x-(g+6)/2;var n=Xb.append("rect").attr("id","r-"+a.id).attr("x",m).attr("y",d?Zb-l-16-(Zb-a.y):a.y+16).attr("width",g+16).attr("height",l).style("stroke","black").style("fill","yellow");k.raise(),isNaN(a.id)||(Rc&&(h=400,i=300),p(a,l,g,h,i,d,f,e,parseInt(n.attr("x")),parseInt(n.attr("y"))))}}function o(a,b,c,d){var e=0;a.each(function(){var a,d=Tb.select(this),f=d.text().split(/\s+/).reverse(),g=[],h=d.attr("y"),i=parseFloat(d.attr("dy")),j=d.text(null).append("tspan").attr("x",c).attr("y",h).attr("dy",i+"em");for(a=f.pop();a;)g.push(a),j.text(g.join(" ")),j.node().getComputedTextLength()>b&&(g.pop(),j.text(g.join(" ")),g=[a],j=d.append("tspan").attr("x",c).attr("y",h).attr("dy",1.1*++e+i+"em").text(a)),a=f.pop()}),d[0]=++e}function p(a,b,c,d,e,f,g,h,i,j){var k=document.createElement("iframe");k.id="preview",k.style.position="absolute",k.style.width=d+"px",k.style.height=e+"px";var l=document.getElementsByTagName("svg")[0].getBoundingClientRect(),m=document.body.getBoundingClientRect();m.x>0&&(m.x=0),k.style.left=Sc?window.innerWidth-10-d+"px":Rc?"10px":g?i+l.x+"px":h?i+l.x+c-d+18+"px":i+l.x-d/2+c/2+"px";var n=Uc?0:50;if(k.style.top=Rc?l.y-m.y+Zb/2+"px":f?n+j+l.y-m.y-e+"px":n+j+l.y+b-m.y+"px","lti"!=a.entype&&"unknown"!=a.type){var o=document.createElement("div");o.id="bgrnd",o.style.position="absolute",o.style.width=parseInt(k.style.width)+24+"px",o.style.height=parseInt(k.style.height)+24+"px",o.style.left=parseInt(k.style.left)-12+"px",o.style.top=parseInt(k.style.top)-12+"px",o.addEventListener("mouseout",function(a){var b=this.getBoundingClientRect();a.x>b.x&&a.x<b.x+b.width&&a.y>b.y&&a.y<b.y+b.height||(Tc=!1,setTimeout(r,750))}),o.addEventListener("mouseover",function(){Tc=!0}),k.src=xb+"/mod/"+a.entype+"/view.php?id="+a.id,document.body.appendChild(o),document.body.appendChild(k)}}function q(a){Qc||"lightgrey"==a.colour||(_b.on("mouseout",null),ac.on("mouseout",null),setTimeout(r,750))}function r(){if(!Tc&&(Tb.selectAll(".text").remove(),Tb.selectAll("rect").remove(),Tb.selectAll("#preview").remove(),Tb.selectAll("#bgrnd").remove(),_b.on("mouseover",n).on("mouseout",q),Rc)){ac.on("mouseover",La).on("mouseout",q);for(var a=0;a<Nc.length;a++)Tb.select("#cluster1-"+a).on("mouseover",Ja.bind(this,a,!1)),Tb.select("#cluster2-"+a).on("mouseover",Ja.bind(this,a,!1))}}function s(){var a=Yb/2,b=Zb/2,c=Cb;void 0===bd.originalx?(bd.originalx=a,bd.originaly=b):(a=bd.originalx,b=bd.originaly);for(var d,e,f=0;f<gc.nodes.length;f++)d=gc.nodes[f].xcoord*c+a,e=gc.nodes[f].ycoord*c+b,(d<0||d>Yb||e<0||e>Zb)&&(c*=.9,--f);Cb=c,bd.distance=c,ac.attr("x1",function(d){var e=gc.nodes.filter(function(a){var b="string"==typeof d.source?d.source:d.source.id;return a.id==b})[0];return Tb.select(this).attr("y1",e.ycoord*c+b),e.xcoord*c+a}).attr("x2",function(d){var e=gc.nodes.filter(function(a){var b="string"==typeof d.target?d.target:d.target.id;return a.id==b})[0];return Tb.select(this).attr("y2",e.ycoord*c+b),e.xcoord*c+a}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}),_b.attr("cx",function(b){return b.x=b.xcoord*c+a,b.x}).attr("cy",function(a){return a.y=a.ycoord*c+b,a.y}).style("display",function(a){return a.visible?"block":"none"}).style("fill",function(a){return a.colour}).raise()}function t(){var a=ad;ac.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).style("stroke-width",function(a){return 2*a.weight+"px"}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}),_b.attr("cx",function(b){return b.x=Math.max(a,Math.min(Yb-a,b.x)),b.x}).attr("cy",function(b){return b.y=Math.max(a,Math.min(Zb-a,b.y)),b.y}).style("fill",function(a){return a.colour}).style("display",function(a){return a.visible?"block":"none"}).raise(),Tb.selectAll("rect").raise(),Tb.selectAll("text").raise()}function u(){if(Jb){Tb.select("#time").remove(),0==Nb&&(Nb=Date.now());var a=new Date;a.setTime(Nb);var b=a.getMinutes();b<10&&(b="0"+b),Xb.append("text").attr("id","time").attr("y",Zb-16).attr("dy",".40em").attr("x",6).style("pointer-events","none").text(Jb[Mb]+" "+a.getHours()+":"+b+" "+a.toDateString())}}function v(){var a=w();if(Fb&&Hb){var b={};for(var c in a)"scale"!=c&&"module"!=c&&(b[c]=a[c]);Fb[Eb]=b,Hb[Eb]=a.scale}a.time=Date.now(),Nb=a.time,Ib&&(Ib[Eb]=a.time),x(nb,a)}function w(){var a,b,c,d,e={},f=0,g=Yb/2,h=Zb/2;return gc.nodes.forEach(function(e){a=e.x-g,b=e.y-h,(c=Math.sqrt(a*a+b*b))>f&&(f=c,d=e)}),e.scale=f,e.module=d.id,Cb=f,gc.nodes.forEach(function(a){e[a.id]={xcoord:""+(a.x-g)/f,ycoord:""+(a.y-h)/f,visible:a.visible?1:0},a.xcoord||(a.xcoord=(a.x-g)/f,a.ycoord=(a.y-h)/f)}),Ab=e,e}function x(a,b){var c=new XMLHttpRequest;c.open("POST",a),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4==this.readyState&&this.status},c.send("cid="+Db+"&data="+JSON.stringify(b)+"&sesskey="+Sb)}function y(){var a=document.getElementById("student-menu"),b=document.createElement("button");b.innerHTML=Rb.copy,b.addEventListener("click",z),a.appendChild(b);var c=b.getBoundingClientRect().height,d=document.createElement("button");d.innerHTML=Rb.print,d.addEventListener("click",A),a.appendChild(d),yc=document.createElement("select"),yc.size=3,yc.id="teacher-select",yc.style.minWidth="40px";var e=Zb-c-20;yc.style.height=e+"px",yc.addEventListener("change",B);for(var f in Hb){var g=document.createElement("option");g.value=f,g.text=f,Eb==f&&(g.selected=!0),yc.appendChild(g)}a.appendChild(yc)}function z(){var a=new Image,b=new XMLSerializer,c=b.serializeToString(Xb.node());a.src="data:image/svg+xml;base64,"+window.btoa(c),document.body.appendChild(a);var d=document.createRange();d.setStartBefore(a),d.setEndAfter(a),d.selectNode(a),window.getSelection().addRange(d),document.execCommand("Copy"),document.body.removeChild(a)}function A(){var a=new XMLSerializer,b=a.serializeToString(Xb.node()),c=window.open();c.document.write('<img src="data:image/svg+xml;base64,'+window.btoa(b)+'"/>'),c.print(),c.close()}function B(){for(var a,b=document.getElementById("teacher-select"),c=0;c<b.options.length;c++)if(b.options[c].selected){a=b.options[c].value;break}a==Eb?(Yc=K,Zc=L,$c=M,_c=J):(Yc=null,Zc=null,$c=null,_c=null),Ab=Fb[a],Bb=Gb[a],Cb=Hb[a],Nb=Ib[a],tb=Kb[a],wb=Lb[a],Mb=a,Xb.remove(),xc={},d(),Tb.selectAll("#legendUL").remove(),D(),cc=1,e(),cc=0;var f=document.getElementById("weights-output").innerHTML;f=parseFloat(f.split(" ")[1]),k(f);for(var g in xc)Ab[g]&&(xc[g].checked=1==Ab[g].visible),Eb==a?(xc[g].removeEventListener("change",C),xc[g].addEventListener("change",H)):(xc[g].removeEventListener("change",H),xc[g].addEventListener("change",C))}function C(){this.checked=!this.checked}function D(){var a,b=500;wc=document.getElementById("legend"),wc.style="width: "+vb+"px; height: "+Zb+"px; min-width: "+vb+"px; max-width: "+b+"px;";var c=function(a){var b=wc.offsetLeft+28;a.x>=b&&a.x<=b+6?wc.style.cursor="col-resize":wc.style.cursor="auto"},d=function(c){var d=a-c.x;a=c.x;var e=parseInt(wc.style.width)+d;e>b?e=b:e<vb&&(e=vb),wc.style.width=e+"px"};wc.addEventListener("mousemove",c),wc.addEventListener("mousedown",function(b){a=b.x,"col-resize"==wc.style.cursor&&wc.addEventListener("mousemove",d)}),document.addEventListener("mouseup",function(){wc.removeEventListener("mousemove",d)}),E(wc)}function E(a){var b=document.createElement("ul");b.id="legendUL";var c=document.createElement("span");c.className="no-select-text",c.innerHTML=wb;var d=document.createElement("li");d.appendChild(c);var e=document.createElement("ul");d.appendChild(e),b.appendChild(d);var f,g,h,i=-1;tb.sort(function(a,b){return a.sect-b.sect}),tb.forEach(function(a){i!=a.sect&&(g=document.createElement("ul"),g.className="nested",h=document.createElement("span"),h.className="caret",h.addEventListener("click",F),f=document.createElement("li"),f.appendChild(h),G("g"+a.sect,Rb.section+" "+a.sect,Bc.grouping,a.sect,"grouping",f),f.appendChild(g),e.appendChild(f),i=a.sect),f=document.createElement("li"),f.className="indented",G(a.id,a.name,Bc[a.entype],a.sect,a.type,f),g.appendChild(f)}),a.appendChild(b)}function F(){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("caret-down")}function G(a,b,c,d,e,f){var g=document.createElement("input");g.type="checkbox",Ab[a]?g.checked=0!=Ab[a].visible:Ab["g"+d]?g.checked=1==Ab["g"+d].visible&&Eb==Mb:g.checked=!0,g.id=a,g.group=d,g.nodeT=e,g.addEventListener("change",H),xc[g.id]=g;var h=document.createElement("label");h.style.color=c,h.className="no-select-text";var i="grouping"==e?b:e+"_"+b;h.appendChild(document.createTextNode(i)),f.appendChild(g),f.appendChild(h)}function H(){var a=this.id,b=this.checked,c=this.nodeT,d=this.group;gc.nodes.forEach(function(e){e.id==a?(e.visible=b,xc[e.id].checked=b):"grouping"==c&&e.group==d?(e.visible=b,xc[e.id].checked=b):b&&"grouping"==e.type&&e.group==d&&(e.visible=b,xc[e.id].checked=b)}),I(),Q()}function I(){parseFloat(document.getElementById("weight-slider").value)<0&&(bc.strength(0),document.getElementById("weights-output").innerHTML="&nbsp;= 0",document.getElementById("weight-slider").value=0)}function J(a){if(Tb.selectAll(".text").remove(),Tb.selectAll("rect").remove(),Tb.selectAll("#preview").remove(),Tb.selectAll("#bgrnd").remove(),Tb.event.preventDefault(),"root"!=a.id){var b=a;_b.on("mouseover",null).on("mouseout",null);var c=Xb.append("rect"),d=Xb.append("text").attr("class","text").attr("id","rctext").attr("x",a.x+10).attr("y",a.y+12).attr("dy",".40em").style("pointer-events","none").text(Rb.hide);a.y+20>=Zb&&d.attr("y",Zb-(Zb-a.y)-10).text(Rb.hide),c.attr("id","rcrect").attr("x",a.x).attr("y",a.y+20<=Zb?a.y:Zb-(Zb-a.y)-20).attr("width",60).attr("height",24).style("stroke","black").style("fill","lightgrey"),c.on("mouseover",function(){Tb.event.target.style="fill: grey;"}),c.on("mouseout",function(){Tb.event.target.style="fill: lightgrey;"}),c.on("click",function(){Tb.selectAll("#rctext").remove(),Tb.selectAll("#rcrect").remove(),_b.on("mouseover",n).on("mouseout",q),b.visible=!1,xc[b.id].checked=!1,"grouping"==b.type&&gc.nodes.forEach(function(a){a.group==b.group&&(a.visible=!1,xc[a.id].checked=!1)}),I(),Q()})}}function K(a){Tb.event.active||$b.alphaTarget(ec).restart(),a.fx=a.x,a.fy=a.y}function L(a){Tb.selectAll("rect").remove(),Tb.selectAll(".text").remove(),Tb.selectAll("#preview").remove(),Tb.selectAll("#bgrnd").remove(),a.fx=Tb.event.x,a.fy=Tb.event.y}function M(a){Tb.event.active||(yb?($b.stop(),v(),u()):$b.alphaTarget(fc)),a.fx=null,a.fy=null,Xc=Date.now()}function N(){var a=document.getElementById("student-menu");lc=document.createElement("button"),lc.innerHTML=Rb.cluster,lc.addEventListener("click",$),a.appendChild(lc);var b=lc.getBoundingClientRect().height;hc=document.createElement("select"),hc.multiple=!0,hc.id="student-select";var c=Zb-b-12;hc.style="height: "+c+"px;",hc.addEventListener("change",function(){for(var a=document.getElementById("student-select"),b="box-shadow: 0 0 0 0 white inset;",c=0;c<a.options.length;c++){var d="box-shadow: 0 0 10px 100px "+a.options[c].colour+" inset;";a.options[c].style=a.options[c].selected?d:b}rb.length>0&&R(!0)}),1==Vc?sb.sort(function(a,b){var c=a.firstname+" "+a.lastname,d=b.firstname+" "+b.lastname;return c>d?1:c<d?-1:0}):sb.sort(function(a,b){return a.id-b.id}),sb.forEach(function(a){O(a,hc)}),a.appendChild(hc)}function O(a,b){var c=document.createElement("option");c.value=a.id,c.text=1==Vc?a.firstname+" "+a.lastname:a.id,c.colour=zc[Ac++],Ac>=zc.length&&(Ac=0),gc.edges[a.id].forEach(function(a){a.colour=c.colour}),b.appendChild(c)}function P(){ic=document.getElementById("slider"),jc=[0,gc.maxSession];var a;a=gc.maxSession<500?10:gc.maxSession<1e3?20:gc.maxSession<5e3?100:gc.maxSession<1e4?200:500,Vb.create(ic,{start:[0,gc.maxSession],range:{min:[0],max:[gc.maxSession]},step:1,connect:!0,pips:{mode:"steps",stepped:!0,density:100,filter:function(b){return 0==b||b==gc.maxSession?1:b%a==0?2:0}}}),setTimeout(function(){ic.noUiSlider.on("update",function(a,b){jc[b]=parseInt(a[b]),hc.dispatchEvent(new Event("change"))})},1e3)}function Q(){ac.remove(),_b.remove(),Tb.selectAll(".hull").remove();var a=S(J);T(a),V(a),$b.alphaTarget(dc).restart(),yb&&setTimeout(function(){$b.stop(),v(),u()},100)}function R(a){ac.remove(),_b.remove(),Tb.selectAll(".hull").remove(),yb=!1;var b=S(null);T(b),a&&V(b),yb=!0,$b.on("tick",s),$b.restart(),setTimeout($b.stop,100)}function S(a){var b=[],c={};return gc.nodes.forEach(function(a){null===a.fx&&(a.fx=a.x,a.fy=a.y),a.visible?b[b.length]=a:c[a.id]=1}),$b.nodes(b),l(b,a,Yc,Zc,$c),c}function T(a){var b,c,d,e,f,g=[];for(f in gc.links)d=gc.links[f],"string"==typeof d.source?(b=d.source,c=d.target):(b=d.source.id,c=d.target.id),a[b]||a[c]||(g[g.length]=d);var h=yb?[]:document.getElementById("student-select").options;for(f=0;f<h.length;f++)if(h[f].selected){var i,j,k={};for(j=jc[0];j<=jc[1]&&gc.edges[h[f].value].length>j;j++)e=gc.edges[h[f].value][j],"string"==typeof e.source?(i=e.source+"_"+e.target,b=e.source,c=e.target):(i=e.source.id+"_"+e.target.id,b=e.source.id,c=e.target.id),k[i]?k[i]++:k[i]=1,a[b]||a[c]||(g[g.length]=e);for(j=jc[0];j<=jc[1]&&gc.edges[h[f].value].length>j;j++)e=gc.edges[h[f].value][j],i="string"==typeof e.source?e.source+"_"+e.target:e.source.id+"_"+e.target.id,e.weight=k[i]}$b.force("link").links(g),m(g)}function U(a){return gc.nodes.find(function(b){return b.id==a})}function V(a){if(!yb){Tb.selectAll(".hull").remove();for(var b=document.getElementById("student-select").options,c={},d=0;d<b.length;d++)if(b[d].selected){var e,f,g,h,i,j,k;c[b[d].value]={};for(var l=jc[0];l<=jc[1]&&gc.edges[b[d].value].length>l;l++){var m=gc.edges[b[d].value][l];if("string"==typeof m.source){j=m.source,k=m.target;var n=U(j);e=n.x,f=n.y,n=U(k),g=n.x,h=n.y}else j=m.source.id,k=m.target.id,e=m.source.x,f=m.source.y,g=m.target.x,h=m.target.y;a[j]||a[k]||(i=m.colour,c[b[d].value][j]={x:e,y:f,colour:i},c[b[d].value][k]={x:g,y:h,colour:i})}}for(var o in c)Y(c[o],o,!1,!1);Dc&&(jd?X(b):W(b))}}function W(a){if(Lc={},0!=Object.keys(id).length)for(var b=0;b<a.length;b++)if(a[b].selected){var c=a[b].value;if(id[c].length<=jc[0])continue;var d=jc[0],e=id[c].length>jc[1]+1?jc[1]:id[c].length,f=parseInt(d/2+e/2),g=id[c][f],h=parseFloat(Ab[g].xcoord),i=parseFloat(Ab[g].ycoord);Lc[c]={x:h*Cb+bd.originalx,y:i*Cb+bd.originaly,colour:a[b].colour}}}function X(a){if(Lc={},0!=Object.keys(id).length)for(var b=0;b<a.length;b++)if(a[b].selected){var c=a[b].value;if(id[c].length<=jc[0])continue;for(var d,e=jc[0],f=id[c].length>jc[1]+1?jc[1]:id[c].length,g=0,h=0,i=0,j=e;j<f;j++)d=id[c][j],g+=parseFloat(Ab[d].xcoord),h+=parseFloat(Ab[d].ycoord),i++;Lc[c]={x:g/i*Cb+bd.originalx,y:h/i*Cb+bd.originaly,colour:a[b].colour}}}function Y(a,b,c,d){if(0!=Object.keys(a).length){var e,f,g,h=[],i=20;g=Dc?"hull":c?"manual-hull":"cluster-hull";for(var j in a)h[h.length]=[a[j].x,a[j].y],e=a[j].colour;if(1==h.length)f=function(a){var b=[a[0][0],a[0][1]-i],c=[a[0][0],a[0][1]+i];return"M "+b+" A "+[i,i,"0,0,0",c].join(",")+" A "+[i,i,"0,0,0",b].join(",")};else{if(2!=h.length){var k=Tb.concaveHull().padding(15);Hc||k.distance(Ic);var l=h.length>4?k(h):[h];return f=Tb.line().curve(Jc),void Xb.selectAll("#hull-"+b).data(l).enter().append("path").attr("id","hull-"+b).attr("class",g).style("stroke",e).style("stroke-opacity",d?0:1).style("fill",e).style("fill-opacity",d?0:Kc).attr("d",f)}var m=function(a,b){return[b[0]-a[0],b[1]-a[1]]},n=function(a,b){return[b*a[0],b*a[1]]},o=function(a,b){return[a[0]+b[0],a[1]+b[1]]},p=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return n(a,1/b)},q=function(a,b){return n(p(a),b)},r=function(a,b){void 0!==b&&(a=m(a,b));var c=[-a[1],a[0]];return p(c)};f=function(a){var b=m(a[0],a[1]),c=q(b,i),d=o(a[0],n(c,-1)),e=o(a[1],c),f=1.2*i,g=q(r(b),f),h=n(g,-1),j=o(d,h),k=o(e,h),l=o(d,g);return"M "+d+" C "+[j,k,e].join(",")+" S "+[l,d].join(",")+" Z"}}Xb.append("path").attr("id","hull-"+b).attr("class",g).style("stroke",e).style("stroke-opacity",d?0:1).style("fill",e).style("fill-opacity",d?0:Kc).attr("d",f(h))}}function Z(){clearInterval(Gc),Gc=void 0,Mc=null,va(),Tb.selectAll(".clustering-centroid").remove(),Tb.selectAll(".cluster-hull").remove(),Tb.selectAll(".centroid").remove(),Tb.selectAll(".server-centroid").remove(),sc.style.display="none",document.getElementById("anim-controls").style.display="none",document.getElementById("log-panel").style.display="none",document.getElementById("student-menu").style.width=lc.style.width,Dc=!0,Rc=!1,ic.style.display="block",hc.style.display="block",_b.style("display","block"),_b.style("opacity",1),ac.style("display","block"),ac.style("opacity",1),R(!0),_b.on("mouseover",n).on("mouseout",q),lc.innerHTML=Rb.cluster,lc.removeEventListener("click",Z),lc.addEventListener("click",$)}function $(){Dc=!1,ic.style.display="none",hc.style.display="none",Tb.selectAll(".hull").remove(),Tb.selectAll(".text").remove(),Tb.selectAll("rect").remove(),document.getElementById("student-menu").style.width=uc+"px",lc.innerHTML=Rb.graph,lc.removeEventListener("click",$),lc.addEventListener("click",Z),$b.stop(),_b.on("mouseover",null).on("mouseout",null).on("contextmenu",null).call(Tb.drag().on("start",null).on("drag",null).on("end",null)),bd.clusterId=Date.now(),Ob={},Fc=0,Ec=!1,tc=1,Gc=void 0;var a='<p id="cluster-text">'+Rb.numclusters+"</p>";setTimeout(function(){if(sc)document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("cluster-text").innerHTML=a,document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("anim-controls").style.display="block",document.getElementById("log-panel").style.display="block",sc.removeAttribute("disabled"),sc.noUiSlider.set(1),sc.style.display="block";else{var b=Ba();Ta(a,b),cb()}db()},cd/2)}function _(a,b){yb=!0,Ab={0:0,1:1,2:2},Zb=window.innerHeight-190,ta(),cb(),aa(a,b)}function aa(a,b){var c=document.getElementById("student-menu");nc=document.createElement("select"),nc.size=3,nc.id="replay-select",nc.style="height: "+(Zb-12)+"px;",nc.addEventListener("change",ba.bind(this,a,b));for(var d in a){var e=0;for(var f in a[d]){var g=0;e++;for(var h in a[d][f])if(!isNaN(h)&&a[d][f][h][1]){var i=document.createElement("option");i.value=d+"_"+f+"_"+h,i.text=d.split("-")[0]+"_"+e+"_"+ ++g,nc.appendChild(i)}}}c.appendChild(nc)}function ba(a,b){var c=qa(a,b),f=c.members;Xb&&(Xb.remove(),wa(),va(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"),hc&&document.body.removeChild(hc),Mc=null,d(),e(),jc=[0,gc.maxSession];for(var g=0;g<gc.nodes.length;g++)void 0===gc.nodes[g].xcoord&&(gc.nodes[g].visible=!1);ra(f),k(0),R(!1),_b.on("mouseover",null).on("mouseout",null),Pc=!0,setTimeout(function(){sa(Lc,!1),db(),$b.on("tick",s);for(var a in Lc)Tb.select("#centroid-"+a).call(Tb.drag().on("start",ca.bind(this,a)).on("drag",da.bind(this,a)).on("end",ea.bind(this,a,b,c)))},500)}function ca(a){ia(a)&&(fd=Date.now(),Xb.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+a).attr("points",eb(Tb.event.x,Tb.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Lc[a].colour).style("opacity",.5))}function da(a){Tb.select("#dragged-"+a).attr("points",eb(Tb.event.x,Tb.event.y))}function ea(a,b,c){if(Tb.selectAll(".dragged-centroid").remove(),ia(a)){if(Date.now()-fd<300)return void mb(Pb[a],a,!1);ed||ka();var d=ja();if(0==Object.keys(md[d]).length)for(var e=0;e<oc[d].length;e++)for(var f in oc[d][e].members){var g=Qb[oc[d][e].members[f].id];md[d][g]=e}var h=ib(Tb.event);for(var i in md)i<=d&&(md[i][a]=h);la(d,b,c),ed=!0,ga(d),fa(d)}}function fa(a){for(var b={clusterCoords:[],members:[]},c=0;c<nd.length;c++){var d=nd[c]?nd[c]:Nc[c];b.clusterCoords[c]=Ra(d),b.clusterCoords[c].num=c;for(var e in md[a])md[a][e]==c&&(b.members[b.members.length]={id:Pb[e],num:c})}b.iteration=a,b.clusterId=bd.clusterId,b.coordsid=Nb,x(qb,b)}function ga(a){if(!(a>=0)&&md[a]&&0!=Object.keys(md[a]).length){var b,c=ha(a),d=Rb.manualcluster+"<br>";for(b=0;b<nd.length;b++)if(nd[b]){var e=nd[b].x-Yb/2,f=nd[b].y-Zb/2,g=Math.sqrt(e*e+f*f),h=Nc[b].colour;d+=Rb.disttocluster+' <span style="color:'+h+'">'+h+"</span>: "+Math.round(g)+"<br>"+Rb.cluster+" "+h+" "+Rb.members+": [";for(var i in md[a])md[a][i]==b&&(d+=i+", ");-1!=d.indexOf(",",d.length-3)&&(d=d.slice(0,-2)),d+="]<br>",hd&&(d+=Rb.precision+": "+c[b].precision.toFixed(4)+"<br>",d+=Rb.recall+": "+c[b].recall.toFixed(4)+"<br>",d+=Rb.f1+": "+c[b].f1.toFixed(4)+"<br>",d+=Rb.fhalf+": "+c[b].fhalf.toFixed(4)+"<br>",d+=Rb.f2+": "+c[b].f2.toFixed(4)+"<br>")}var j=vc.innerHTML.split("<br><br>"),k=j[0].split("<br>");for(vc.innerHTML="",b=0;b<k.length&&!k[b].startsWith(Rb.manualcluster);b++)vc.innerHTML+=k[b]+"<br>";for(hd&&(b=c.length-1,d+=Rb.totalmeasures+"<br>",d+=Rb.precision+": "+c[b].precision.toFixed(4)+"<br>",d+=Rb.recall+": "+c[b].recall.toFixed(4)+"<br>",d+=Rb.f1+": "+c[b].f1.toFixed(4)+"<br>",d+=Rb.fhalf+": "+c[b].fhalf.toFixed(4)+"<br>",d+=Rb.f2+": "+c[b].f2.toFixed(4)+"<br>"),vc.innerHTML+=d+"<br>",b=1;b<j.length;b++)vc.innerHTML+=j[b]+"<br><br>"}}function ha(a){var b,c,d,e=0,f=0,g=0,h=[];for(d=0;d<Nc.length;d++){for(var i in Mc)Mc[i].ci==d&&md[a][i]==Mc[i].ci?e++:Mc[i].ci==d&&md[a][i]!=Mc[i].ci?f++:md[a][i]==d&&md[a][i]!=Mc[i].ci&&g++;b=e/(e+f),c=e/(e+g),h[d]={tp:e,fp:f,fn:g,precision:b,recall:c,f1:b+c==0?0:2*b*c/(b+c),fhalf:b+c==0?0:1.25*b*c/(.25*b+c),f2:b+c==0?0:5*b*c/(4*b+c)},e=0,f=0,g=0}for(d=0;d<h.length;d++)e+=h[d].tp,f+=h[d].fp,g+=h[d].fn;return b=e/(e+f),c=e/(e+g),h[h.length]={tp:e,fp:f,fn:g,precision:b,recall:c,f1:b+c==0?0:2*b*c/(b+c),fhalf:b+c==0?0:1.25*b*c/(.25*b+c),f2:b+c==0?0:5*b*c/(4*b+c)},h}function ia(a){if(document.getElementById("replayer").innerHTML!=Rb.convergence)return!1;if(gd!=Eb)return!1;var b,c=Mc[a].ci,d=0;for(b in Mc)Mc[b].ci==c&&d++;var e=ja(),f=0;if(md[e]){c=md[e][a];for(b in md[e])md[e][b]==c&&f++}return!(1==d&&f<=1)&&1!=f}function ja(){var a=vc.innerHTML.split("<br>");return a[2]&&a[2].startsWith(Rb.iteration)?parseInt(a[2].split(" ")[1]):null}function ka(){for(var a in oc)if(!(a>=0)){md[a]={};for(var b=0;b<oc[a].length;b++)for(var c in oc[a][b].members){var d=Qb[oc[a][b].members[c].id];md[a][d]=b}}}function la(a,b,c){var d,e,f=[],g=[];for(d=0;d<oc[a].length;d++){f[d]={},g[d]=[];for(e in md[a])if(md[a][e]==d){var h=Mc[e].x,i=Mc[e].y;f[d][h+"_"+i]={x:h,y:i,colour:Nc[d].colour},g[d][g[d].length]=[h,i]}}var j=document.getElementsByClassName("manual-centroid").length,k=0==j;for(Tb.selectAll(".manual-hull").remove(),d=0;d<f.length;d++)Y(f[d],-1*(d+1),!0,k),nd[d]=Oa(g[d]);if(b)for(b[c.did]||(b[c.did]={}),b[c.did][c.gid]||(b[c.did][c.gid]={}),b[c.did][c.gid][c.cid]||(b[c.did][c.gid][c.cid]={}),b[c.did][c.gid][c.cid][a]||(b[c.did][c.gid][c.cid][a]=[]),d=0;d<nd.length;d++)if(nd[d]){var l=[];for(e in md[a])md[a][e]==d&&(l[l.length]={id:Pb[e],num:d});b[c.did][c.gid][c.cid][a][d]={centroidx:nd[d].x,centroidy:nd[d].y,members:l}}k?na():oa(),Xb.selectAll(".centroid").raise(),Xb.selectAll(".clustering-centroid").raise(),Xb.selectAll(".manual-centroid").raise()}function ma(){Tb.event.stopPropagation()}function na(){Tb.selectAll(".manual-centroid").remove();for(var a,b,c=14,d=0;d<nd.length;d++){if(!nd[d])return;a=nd[d].x,b=nd[d].y,Xb.append("line").attr("class","manual-centroid").attr("id","manual1-"+d).attr("x1",a-c).attr("y1",b-c).attr("x2",a+c).attr("y2",b+c).style("stroke",Nc[d].colour).style("stroke-width","5px").style("opacity",0).on("click",ma).on("click.centroidClick",mb.bind(this,-1*(d+1),d,!0)).on("mouseover",Ja.bind(this,d,!0)),Xb.append("line").attr("class","manual-centroid").attr("id","manual2-"+d).attr("x1",a+c).attr("y1",b-c).attr("x2",a-c).attr("y2",b+c).style("stroke",Nc[d].colour).style("stroke-width","5px").style("opacity",0).on("click",ma).on("click.centroidClick",mb.bind(this,-1*(d+1),d,!0)).on("mouseover",Ja.bind(this,d,!0))}Tb.selectAll(".manual-centroid").transition().duration(cd).style("opacity",.5),Tb.selectAll(".manual-hull").transition().duration(cd).style("stroke-opacity",1).style("fill-opacity",Kc)}function oa(){for(var a,b,c=14,d=0;d<nd.length;d++){if(!nd[d])return void Tb.selectAll(".manual-centroid").remove();a=nd[d].x,b=nd[d].y,Tb.select("#manual1-"+d).transition().duration(cd).attr("x1",a-c).attr("y1",b-c).attr("x2",a+c).attr("y2",b+c).style("display","block"),Tb.select("#manual2-"+d).transition().duration(cd).attr("x1",a+c).attr("y1",b-c).attr("x2",a-c).attr("y2",b+c).style("display","block")}}function pa(a){if(!a||a>0)return Xb.selectAll(".manual-centroid").remove(),void Xb.selectAll(".manual-hull").remove();ed&&la(a,null,null)}function qa(a,b){var c,d,e=document.getElementById("replay-select");for(d=0;d<e.options.length;d++)if(e.options[d].selected){c=e.options[d].value.split("_");break}var f=c[0],g=c[1],h=c[2];gd=f.split("-")[0],bd.clusterId=h,Nb=a[f][g].last,Ab=a[f][g].nodes,Bb=a[f][g].links,Cb=a[f][g].scale,tb=a[f][g].mods,oc=a[f][g][h],rb=a[f][g].logs,sb=a[f][g].users,Ob=a[f][g][h].comments,Qb={},Pb={},sb.forEach(function(a){Pb[a.id]=a.realId,Qb[a.realId]=a.id}),Fc=0,tc=1,qc=0,rc=0;for(var i in oc)isNaN(i)||(i>=0?qc++:rc--);nd=[],md={},ed=!1;var j,k,l=b[f][g][h];if(l)for(ed=!0,d=-1;d>=rc;d--){l[d]&&!l[d-1]&&(l[d-1]=l[d]),md[d]={};for(j in l[d])for(k in l[d][j].members){var m=l[d][j].members[k].id;md[d][Qb[m]]=j}}Nc=[],Lc={};var n={},o=0;for(j in oc[1]){if(d=Nc.length,Nc[d]={x:0,y:0},o<Cc.length)Nc[d].colour=Cc[o++];else{for(var p;!p;)p=zc[Math.floor(Wb.random()*zc.length)],p=Cc.includes(p)?void 0:p;Nc[d].colour=p}for(k in oc[1][j].members){var q=Qb[oc[1][j].members[k].id];Lc[q]={x:oc[1][j].members[k].x,y:oc[1][j].members[k].y},n[q]=!0}}return{members:n,did:f,gid:g,cid:h}}function ra(a){hc=document.createElement("select"),hc.multiple=!0,hc.id="student-select",hc.style.display="none",Ac=0,sb.forEach(function(a){O(a,hc)});for(var b,c=0;c<hc.options.length;c++)b=hc.options[c].value,a[b]?hc.options[c].selected=!0:hc.options[c].selected=!1,Lc[b]&&(Lc[b].colour=hc.options[c].colour);document.body.appendChild(hc)}function sa(a,b){for(var c in a)a[c].x*=bd.distance,a[c].x+=bd.originalx,a[c].y*=bd.distance,a[c].y+=bd.originaly,b&&(a[c].x-=bd.centre.x,a[c].x*=bd.scale,a[c].x+=Yb/2,a[c].y-=bd.centre.y,a[c].y*=bd.scale,a[c].y+=Zb/2)}function ta(){var a=document.getElementById("slider"),b=document.createElement("p");b.innerHTML="&nbsp",b.id="replayer",b.style.marginTop="-20px",a.appendChild(b);var c=document.createElement("p");c.innerHTML="&nbsp",c.id="replaydragdrop",c.style.marginTop="-12px",a.appendChild(c);var d=document.createElement("button");d.id="replay-stop",d.innerHTML="&#9606",d.addEventListener("click",ua),a.appendChild(d);var e=document.createElement("button");e.id="replay-pause",e.innerHTML="&#9654",e.value="play",e.addEventListener("click",xa),a.appendChild(e);var f=document.createElement("button");f.id="replay-back",f.innerHTML="&#9614&#9664",f.addEventListener("click",za),a.appendChild(f);var g=document.createElement("button");g.id="replay-forward",g.innerHTML="&#9654&nbsp&nbsp&#9614",g.addEventListener("click",ya.bind(this,!0)),a.appendChild(g)}function ua(){Xb&&setTimeout(function(){Xb.remove(),va(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"},500),oc=void 0,Mc=null,wa();for(var a=document.getElementById("replay-select"),b=0;b<a.options.length;b++)a.options[b].selected&&(a.options[b].selected=!1)}function va(){vc.readOnly=!1,vc.innerHTML="",setTimeout(function(){vc.readOnly=!0},300)}function wa(){var a=document.getElementById("replay-pause");a.innerHTML="&#9654",a.value="play",clearInterval(Gc),Gc=void 0}function xa(){if(oc){var a=document.getElementById("replay-pause");"play"==a.value?(a.innerHTML="&#9613&#9613",a.value="pause",ya(!1),Gc=setInterval(ya.bind(this,!1),1200)):wa()}}function ya(a){if(oc){a&&wa(),Fc++;var b=Fc-1;return Fc>qc&&oc[-1]&&(b=qc-Fc+1,!oc[b-1])?(Fc--,void wa()):b>qc?(Fc--,void wa()):void(1==Fc?(tc=2,Ec=!0,Pc=!1,Xa()):2==Fc?(Ya(),Aa(b-1,!1,!0)):Aa(b-1,!1,!1))}}function za(){if(oc&&pc&&!(Fc-1<0)){wa(),Fc--;var a=Fc-1;Fc>qc&&(a=qc-Fc+1),0==Fc?(tc=1,Wa(),Ec=!1,vc.innerHTML=vc.innerHTML.slice(vc.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):1==Fc?(Mc=null,Xa(),vc.innerHTML=vc.innerHTML.slice(vc.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):(Mc=null,Aa(a-1,!0,2==Fc))}}function Aa(a,b,c){var d,e=[],f={},g={};for(d=0;d<oc[a].length;d++,g={}){Xb.selectAll("#hull-"+d).remove(),Nc[d].x=oc[a][d].centroidx,Nc[d].y=oc[a][d].centroidy;for(var h in oc[a][d].members){var i=oc[a][d].members[h].x,j=oc[a][d].members[h].y,k=Qb[oc[a][d].members[h].id];Lc[k].x=i,Lc[k].y=j,g[i+"_"+j]={x:i,y:j,colour:Nc[d].colour},f[k]=d}e[d]=g}if(sa(Nc,!0),c)Ha();else{for(sa(Lc,!1),d=0;d<e.length;d++)sa(e[d],!0),Y(e[d],d,!1,!1);Sa(cd)}if(Za(pc[2],pc[0],pc[1],cd),Xb.selectAll(".centroid").raise(),Xb.selectAll(".clustering-centroid").raise(),pa(a),b)vc.innerHTML=vc.innerHTML.slice(vc.innerHTML.indexOf("<br><br>")+8);else{for(var l in f)Mc[l].ci=f[l];Pa(a),ga(a)}if(a<0)if(document.getElementById("replayer").innerHTML=Rb.convergence,document.getElementById("replayer").style.color="green",hd){var m=document.getElementById("replay-select").options;for(d=0;d<m.length;d++)if(m[d].selected){var n=m[d].value.split("-")[0];n==Eb&&(document.getElementById("replaydragdrop").innerHTML=Rb.dragon);break}}else document.getElementById("replaydragdrop").innerHTML=Rb.dragon;else document.getElementById("replayer").innerHTML=Rb.iteration+" "+a,document.getElementById("replayer").style.color="black",document.getElementById("replaydragdrop").innerHTML=Rb.dragoff}function Ba(){var a=document.getElementById("anim-controls");a.appendChild(document.createTextNode(Rb.runkmeans));var b=document.createElement("p");b.innerHTML="&nbsp",b.id="clustering",a.appendChild(b);var c=document.createElement("p");c.innerHTML="&nbsp",c.id="dragdrop",c.style.marginTop="-12px",a.appendChild(c);var d=document.createElement("button");d.id="play-pause",d.style.marginLeft="5px",d.style.marginRight="5px",d.innerHTML="&#9654",d.addEventListener("click",Ea),d.disabled=!0;var e=document.createElement("button");e.id="play-step",e.style.marginLeft="5px",e.innerHTML="&#9654&nbsp&nbsp&#9614",e.addEventListener("click",Da.bind(this,d)),e.disabled=!0,a.appendChild(e),a.appendChild(d);var f=document.createElement("button");return f.id="stop",f.style.marginTop="5px",f.style.marginLeft="5px",f.innerHTML=Rb.reset,f.addEventListener("click",Ca),a.appendChild(f),a}function Ca(){Ec=!1,Fc=0,clearInterval(Gc),Gc=void 0,bd.clusterId=Date.now(),sc.removeAttribute("disabled"),3==tc?(sc.noUiSlider.set(2),setTimeout(function(){sc.noUiSlider.set(1),tc=1},cd)):(sc.noUiSlider.set(1),tc=1),document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("num-clusters")&&(document.getElementById("num-clusters").readOnly=!1,document.getElementById("num-clusters").value=""),Tb.selectAll(".clustering-centroid").transition(Ub).style.display="none",Tb.selectAll(".cluster-hull").transition(Ub).style.display="none",setTimeout(function(){Tb.selectAll(".clustering-centroid").remove(),Tb.selectAll(".cluster-hull").remove(),va()},cd);for(var a in Mc)Mc[a].ci=void 0}function Da(a){3==tc&&(Gc?(clearInterval(Gc),Gc=void 0,a.innerHTML="&#9654",sc.removeAttribute("disabled")):Fa())}function Ea(){3==tc&&(Gc?(clearInterval(Gc),Gc=void 0,this.innerHTML="&#9654",sc.removeAttribute("disabled")):(Gc=setInterval(Fa,1e3),this.innerHTML="&#9613&#9613",sc.setAttribute("disabled",!0)))}function Fa(){if(0==Fc){Ec=!0;var a=document.getElementById("num-clusters"),b=parseInt(a.value);(isNaN(b)||b<2)&&(b=3);var c={};for(var d in Lc)c[Lc[d].x+"_"+Lc[d].y]=1;for(;b>Object.keys(c).length;)b--;a.value=b,a.readOnly=!0,Nc=[],Oc=null;var e,f;for(e=0,f=0;e<b;e++)if(f<Cc.length)Nc[e]=Ga(null,Cc[f++]);else{for(var g;!g;)g=zc[Math.floor(Wb.random()*zc.length)],g=Cc.includes(g)?void 0:g;Nc[e]=Ga(null,g)}Ha(),document.getElementById("clustering").innerHTML=Rb.randcentroids,document.getElementById("dragdrop").innerHTML=Rb.dragoff,document.getElementById("clustering").style.color="black";var h=Pa(Fc);bd.iteration=Fc,Qa(h)}else Ma(Fc),Sa(cd);Fc++,document.getElementById("clustering").innerHTML==Rb.convergence&&(clearInterval(Gc),Gc=void 0,sc.removeAttribute("disabled"),document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0)}function Ga(a,b){var c,d,e,f,g=100,h=Yb-g,i=g,j=Zb-g,k=g,l=0;if(a)for(;l<100;)c=Math.floor(Math.random()*(h-i)+i),d=Math.floor(Math.random()*(j-k)+k),e=c-a.x,f=d-a.y,l=Math.sqrt(e*e+f*f);else c=Math.floor(Math.random()*(h-i)+i),d=Math.floor(Math.random()*(j-k)+k);return{x:c,y:d,colour:b}}function Ha(){Tb.selectAll(".clustering-centroid").remove();var a,b,c,d=14;for(a=0;a<Nc.length;a++)b=Nc[a].x,c=Nc[a].y,Xb.append("line").attr("class","clustering-centroid").attr("id","cluster1-"+a).attr("x1",b-d).attr("y1",c-d).attr("x2",b+d).attr("y2",c+d).style("stroke",Nc[a].colour).style("stroke-width","5px").on("click",ma).on("click.centroidClick",mb.bind(this,-1*(a+1),a,!0)).on("mouseover",Ja.bind(this,a,!1)),Xb.append("line").attr("class","clustering-centroid").attr("id","cluster2-"+a).attr("x1",b+d).attr("y1",c-d).attr("x2",b-d).attr("y2",c+d).style("stroke",Nc[a].colour).style("stroke-width","5px").on("click",ma).on("click.centroidClick",mb.bind(this,-1*(a+1),a,!0)).on("mouseover",Ja.bind(this,a,!1))}function Ia(a,b,c){var d,e,f,g,h,i,j={};for(d in a)for(i=jc[0];i<gc.edges[d].length&&i<=jc[1];i++)e=gc.edges[d][i],"string"==typeof e.source?(f=parseInt(e.source),g=parseInt(e.target)):(f=e.source.id,g=e.target.id),b[f]||b[g]||(h=f+"_"+g,f>g&&(h=g+"_"+f),j[h]?j[h][d]?j[h][d]++:j[h][d]=1:(j[h]={},j[h][d]=1));var k,l,m=[];for(k in j)if(Object.keys(j[k]).length==c){var n=Number.MAX_SAFE_INTEGER;for(l in j[k])n>j[k][l]&&(n=j[k][l]);var o=k.split("_");m[m.length]={source:o[0],target:o[1],weight:n,colour:"black"}}for(i=0;i<gc.links.length;i++)m[m.length]=gc.links[i];return m}function Ja(a,b){ac.remove(),Pc=!0,Qc=!1,Rc=!0,Xb.on("click",Ka);var c,d={};if(b){var e=ja();for(c in md[e])md[e][c]==a&&(d[c]=c)}else for(c in Mc)Mc[c].ci==a&&(d[c]=c);var f,g=Object.keys(d).length,h={};for(f=0;f<gc.nodes.length;f++)gc.nodes[f].visible||(h[gc.nodes[f].id]=1);var i=Ia(d,h,g);_b.style("display","block").style("opacity",1).on("mouseover",n).on("mouseout",q),$b.force("link").links(i),m(i),ac.on("mouseover",La).on("mouseout",q),$b.restart(),setTimeout(function(){$b.stop(),ac.lower(),Tb.selectAll(".cluster-hull").lower()},10)}function Ka(){Pc=!1,Qc=!0,Rc=!1,ac.remove(),_b.style("display","none").on("mouseover",null).on("mouseout",null),Xb.on("click",null)}function La(a){"black"==a.colour&&(ac.on("mouseover",null),_b.on("mouseover",null).on("mouseout",null),Tb.selectAll(".clustering-centroid").on("mouseover",null),n(a.source),Sc=!0,n(a.target,!0),Sc=!1)}function Ma(a){if(document.getElementById("clustering").innerHTML!=Rb.convergence){if(0==Object.keys(Mc).length)return void(document.getElementById("clustering").innerHTML=Rb.convergence);var b,c,d,e,f=Rb.iteration+": "+a;for(b in Mc)Mc[b].ci=ib(Mc[b]);var g=[];for(c=0;c<Nc.length;c++)g[c]=Na(c);Oc=Nc,Nc=g;var h=!1;if(Oc){var i=0;for(c=0;c<Nc.length;c++)d=Oc[c].x-Nc[c].x,e=Oc[c].y-Nc[c].y,i+=Math.sqrt(d*d+e*e);i<=Wc&&(f=Rb.convergence,document.getElementById("clustering").style.color="green",h=!0)}document.getElementById("clustering").innerHTML=f,document.getElementById("dragdrop").innerHTML=a>0&&!h?Rb.dragon:Rb.dragoff;var j=Pa(a);bd.iteration=h?-1:a,Qa(j)}}function Na(a){var b,c=[],d={};for(b in Mc)Mc[b].ci==a&&(c[c.length]=[Mc[b].x,Mc[b].y],d[Mc[b].x+"_"+Mc[b].y]={x:Mc[b].x,y:Mc[b].y,colour:Nc[a].colour});if(Xb.selectAll("#hull-"+a).remove(),Y(d,a,!1,!1),Xb.selectAll(".centroid").raise(),Xb.selectAll(".clustering-centroid").raise(),0==Object.keys(d).length)return Ga(Nc[a],Nc[a].colour);var e=Oa(c);return e.colour=Nc[a].colour,e}function Oa(a){if(0==a.length)return null;var b,c=0,d=0;for(b=0;b<a.length;b++)c+=a[b][0],d+=a[b][1];return{x:c/a.length,y:d/a.length}}function Pa(a){var b=Rb.numstudents+": "+Object.keys(Mc).length+"<br>"+Rb.numofclusters+": "+Nc.length+"<br>"+Rb.iteration+": "+a+"<br>";document.getElementById("clustering")&&document.getElementById("clustering").innerHTML==Rb.convergence&&(b+='<span style="color:green">'+Rb.convergence+"</span><br>");var c,d,e,f,g,h,i=[];for(c=0;c<Nc.length;c++){d=Nc[c].x-Yb/2,e=Nc[c].y-Zb/2,f=Math.sqrt(d*d+e*e),h=Nc[c].colour,b+=Rb.disttocluster+' <span style="color:'+h+'">'+h+"</span>: "+Math.round(f,2)+"<br>"+Rb.cluster+" "+h+" "+Rb.members+": [",i[c]=[];for(g in Mc)Mc[g].ci==c&&(b+=g+", ",i[c][i[c].length]=g);-1!=b.indexOf(",",b.length-3)&&(b=b.slice(0,-2)),b+="]<br>"}return b+="<br>",vc.innerHTML=b+vc.innerHTML,i}function Qa(a){var b,c,d,e={clusterCoords:[]};for(b=0;b<a.length;b++)for(e.clusterCoords[b]=Ra(Nc[b]),e.clusterCoords[b].num=b,c=0;c<a[b].length;c++)d=Ra(Mc[a[b][c]]),a[b][c]={id:Pb[a[b][c]],num:b,x:d.x,y:d.y};e.members=a,e.iteration=bd.iteration,e.clusterId=bd.clusterId,e.coordsid=Nb,e.usegeometric=jd?1:0,(0!=jc[0]||jc[1]!=gc.maxSession)&&e.iteration<0&&(e.iteration=Fc),x(ob,e)}function Ra(a){var b=(a.x-Yb/2)/bd.scale+bd.centre.x,c=(a.y-Zb/2)/bd.scale+bd.centre.y;return b=(b-bd.originalx)/bd.distance,c=(c-bd.originaly)/bd.distance,{x:b,y:c}}function Sa(a){var b,c,d,e=14;for(b=0;b<Nc.length;b++)c=Nc[b].x,d=Nc[b].y,Tb.select("#cluster1-"+b).transition().duration(a).attr("x1",c-e).attr("y1",d-e).attr("x2",c+e).attr("y2",d+e),Tb.select("#cluster2-"+b).transition().duration(a).attr("x1",c+e).attr("y1",d-e).attr("x2",c-e).attr("y2",d+e)}function Ta(a,b){sc=document.getElementById("cluster-slider"),Vb.create(sc,{start:[1],handles:1,range:{min:1,max:3},step:1,orientation:"vertical",direction:"rtl",pips:{mode:"steps",stepped:!0,density:100,filter:function(){return 1},format:{to:function(b){switch(b){case 1:return Rb.showcentroids;case 2:return Rb.removegraph;case 3:return a;default:return""}},from:function(){return""}}}}),sc.noUiSlider.on("update",Va),sc.style="margin-top: 20px;";var c=lc.getBoundingClientRect().height,d=b.getBoundingClientRect().height;sc.style.height=Zb-c-d-120+"px";var e=document.createElement("input");e.type="radio",e.name="centroid-type",e.value="geometric",e.style="margin-top: 40px",e.checked=!0,e.addEventListener("click",Ua);var f=document.createElement("label");f.appendChild(e),f.appendChild(document.createTextNode(Rb.geometrics)),sc.appendChild(f),0==Object.keys(Bb).length&&(e=document.createElement("input"),e.type="radio",e.name="centroid-type",e.value="decomposed",e.addEventListener("click",Ua),f=document.createElement("label"),f.appendChild(e),f.appendChild(document.createTextNode(Rb.decomposed)),sc.appendChild(f))}function Ua(){jd="geometric"==this.value,Xb.selectAll(".centroid").remove();var a,b=[],c=0;for(a in Lc)b[c++]={value:a,selected:!0,colour:Lc[a].colour};jd?X(b):W(b),$()}function Va(a,b){var c,d;switch(parseInt(a[b])){case 1:if(3==tc){sc.noUiSlider.set(2);break}if(tc=1,Wa(),!Ec){c=document.getElementsByName("centroid-type");for(d in c)c[d].disabled=!1}break;case 2:tc=2,Xa(),c=document.getElementsByName("centroid-type");for(d in c)c[d].disabled=!0;document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("dragdrop").innerHTML==Rb.dragon&&(document.getElementById("dragdrop").innerHTML="--");break;case 3:if(1==tc){sc.noUiSlider.set(2);break}if(tc=3,Ya(),!Ec){var e='<input type="text" placeholder="'+Rb.numclusters+'" id="num-clusters" size="8" pattern="[0-9]{1,2}">';document.getElementById("cluster-text").innerHTML=e}document.getElementById("play-pause").disabled=!1,document.getElementById("play-step").disabled=!1,document.getElementById("clustering").innerHTML==Rb.convergence&&(document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0),"--"==document.getElementById("dragdrop").innerHTML&&(document.getElementById("dragdrop").innerHTML=Rb.dragon)}}function Wa(){R(!1),_b.on("mouseover",null).on("mouseout",null),Za(1,0,0,cd),setTimeout(function(){Tb.selectAll(".centroid").raise()},100)}function Xa(){_b.transition(Ub).style("opacity",0),ac.transition(Ub).style("opacity",0),Tb.selectAll(".clustering-centroid").transition(Ub).style("opacity",0),Tb.selectAll(".cluster-hull").transition(Ub).style("opacity",0),setTimeout(function(){_b.style("display","none"),ac.style("display","none"),Tb.selectAll(".clustering-centroid").style("display","none"),Tb.selectAll(".cluster-hull").style("display","none")},cd),!Ec&&document.getElementById("cluster-text")&&(document.getElementById("cluster-text").innerHTML=Rb.numclusters);var a=$a();null!==a&&(bd.scale=a[2],pc=a,setTimeout(function(){Za(a[2],a[0],a[1],cd)},cd/2))}function Ya(){Tb.selectAll(".clustering-centroid").transition(Ub).style("display","block").style("opacity",1),Tb.selectAll(".cluster-hull").transition(Ub).style("display","block").style("opacity",1),Tb.selectAll(".clustering-centroid").raise()}function Za(a,b,c,d){var e,f,g,h,i,j,k=14,l=Yb/2,m=Zb/2;if(!Mc){Mc={};for(j in Lc)Mc[j]={x:0,y:0}}bd.centre={x:b,y:c};for(j in Lc)e=Lc[j].x,f=Lc[j].y,g=(e-b)*a,h=(f-c)*a,1==a&&0==b&&0==c?(e=b+g,f=c+h):(e=l+g,f=m+h),Mc[j].x=e,Mc[j].y=f,i=e+","+(f-k)+" "+(e+k)+","+(f+k)+" "+(e-k)+","+(f+k),Tb.select("#centroid-"+j).transition().duration(d).attr("points",i);var n=function(a,b){return a*=bd.distance,a+=bd.originalx,b*=bd.distance,b+=bd.originaly,a-=bd.centre.x,a*=bd.scale,a+=Yb/2,b-=bd.centre.y,b*=bd.scale,b+=Zb/2,{x:a,y:b}};for(j in ld){var o=n(ld[j].x,ld[j].y);e=o.x,f=o.y,Tb.select("#server-centroid-"+j).transition().duration(d).attr("cx",e).attr("cy",f)}}function $a(){var a,b=[];if(mc)return _a();for(a in Lc)b[b.length]=[Lc[a].x,Lc[a].y];var c=ab(b);if(null===c)return null;var d,e,f,g,h=[c.x,c.y],i=0,j=0;for(a in Lc)d=Math.abs(Lc[a].x-h[0]),e=Math.abs(Lc[a].y-h[1]),d>i&&(i=d,f=a),e>j&&(j=e,g=a);if(void 0===g&&void 0===f)return h[2]=1,h;var k=Lc[f].x-h[0]+Yb/2,l=Lc[f].y-h[1]+Zb/2,m=bb(k,l,Yb/2,Zb/2);k=Lc[g].x-h[0]+Yb/2,l=Lc[g].y-h[1]+Zb/2;var n=bb(k,l,Yb/2,Zb/2);return h[2]=m<n?m:n,h[2]*=.9,h}function _a(){var a,b=[],c=0,d=0;for(a in oc)if(!(a>=0&&1!=a))for(var e in oc[a])for(var f in oc[a][e].members)c=oc[a][e].members[f].x,c=c*Cb+bd.originalx,d=oc[a][e].members[f].y,d=d*Cb+bd.originaly,b[b.length]=[c,d];var g=ab(b);if(null===g)return null;var h,i,j,k,l,m=[g.x,g.y],n=0,o=0;for(l=0;l<b.length;l++)h=Math.abs(b[l][0]-m[0]),i=Math.abs(b[l][1]-m[1]),h>n&&(n=h,j=l),i>o&&(o=i,k=l);if(void 0===k&&void 0===j)return m[2]=1,m;var p=b[j][0]-m[0]+Yb/2,q=b[j][1]-m[1]+Zb/2,r=bb(p,q,Yb/2,Zb/2);p=b[k][0]-m[0]+Yb/2,q=b[k][1]-m[1]+Zb/2;var s=bb(p,q,Yb/2,Zb/2);return m[2]=r<s?r:s,m[2]*=.9,m}function ab(a){if(0==a.length)return null;if(1==a.length)return{x:a[0][0],y:a[0][1]};var b,c,d,e=0,f=0,g=Yb,h=Zb;for(b=0;b<a.length;b++)c=a[b][0],d=a[b][1],c>e&&(e=c),c<g&&(g=c),d>f&&(f=d),d<h&&(h=d);return{x:(e+g)/2,y:(f+h)/2}}function bb(a,b,c,d){var e=a-c,f=b-d,g=e>0?Yb:0,h=f>0?Zb:0,i=(g-Yb/2)/e,j=(h-Zb/2)/f;return isFinite(i)&&isFinite(j)&&i<=j?i:isFinite(i)&&!isFinite(j)?i:isFinite(j)?j:1}function cb(){var a=document.getElementById("log-panel");a.style.width=vb+"px";var b=document.createElement("button");b.innerHTML=Rb.copy,b.addEventListener("click",function(){window.getSelection().selectAllChildren(vc),document.execCommand("copy")}),Uc?b.style.marginLeft="10px":(b.style.position="absolute",b.style.right=vb-40+"px"),a.appendChild(b);var c=document.createElement("button");c.innerHTML=Rb.print,c.addEventListener("click",function(){var a=window.open();a.document.write("<html><head></head><body>"),a.document.write(vc.innerHTML),a.document.write("</body></html>"),a.print(),a.close()}),Uc?c.style.marginLeft="10px":(c.style.position="absolute",c.style.right=vb-100+"px"),a.appendChild(c),vc=document.createElement("div"),vc.readOnly=!0,vc.style.overflow="scroll",vc.style.width="200px",vc.style.height=Zb+"px",vc.style.resize="none",vc.style.border="2px solid black",Uc||(vc.style.position="absolute",vc.style.right="6px",vc.style.top="60px"),a.appendChild(vc)}function db(){var a;for(a in Lc)Xb.append("polygon").attr("class","centroid").attr("id","centroid-"+a).attr("points",eb(Lc[a].x,Lc[a].y)).style("stroke","black").style("stroke-width","3px").style("fill",Lc[a].colour).call(Tb.drag().on("start",fb.bind(this,a)).on("drag",gb.bind(this,a)).on("end",hb.bind(this,a))).on("mouseout",kb).on("mouseover",lb.bind(this,a)).on("click",ma).on("click.centroidClick",mb.bind(this,Pb[a],a,!1));if(kd)for(a in ld){var b=ld[a].x*bd.distance+bd.originalx,c=ld[a].y*bd.distance+bd.originaly;Xb.append("circle").attr("class","server-centroid").attr("id","server-centroid-"+a).attr("r",5).attr("cx",b).attr("cy",c).style("fill","black")}}function eb(a,b){var c=14;return a+","+(b-c)+" "+(a+c)+","+(b+c)+" "+(a-c)+","+(b+c)}function fb(a){jb()&&(fd=Date.now(),Xb.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+a).attr("points",eb(Tb.event.x,Tb.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Lc[a].colour).style("opacity",.5))}function gb(a){jb()&&Tb.select("#dragged-"+a).attr("points",eb(Tb.event.x,Tb.event.y))}function hb(a){if(Tb.selectAll(".dragged-centroid").remove(),jb()){if(Date.now()-fd<300)return void mb(Pb[a],a,!1);Mc[a].ci=ib(Tb.event);for(var b=[],c=0;c<Nc.length;c++)b[c]=Na(c);Oc=Nc,Nc=b,Sa(cd);var d=Rb.iteration+": "+Fc;document.getElementById("clustering").innerHTML=d,document.getElementById("dragdrop").innerHTML=Rb.dragon;var e=Pa(Fc);bd.iteration=Fc++,Qa(e)}}function ib(a){for(var b,c,d,e=Number.MAX_SAFE_INTEGER,f=-1,g=0;g<Nc.length;g++)c=a.x-Nc[g].x,d=a.y-Nc[g].y,(b=Math.sqrt(c*c+d*d))<e&&(e=b,f=g);return f}function jb(){if(!Nc||!document.getElementById("clustering"))return!1;if(document.getElementById("clustering").innerHTML==Rb.convergence)return!1;for(var a in Mc)if(void 0===Mc[a].ci)return!1;return 3==tc}function kb(){Pc||(Tb.selectAll(".text").remove(),Tb.selectAll("rect").remove(),Ec&&(mc||3==tc)&&null!==ja()&&(_b.style("display","none").style("opacity",0),ac.remove()))}function lb(a){if(!Pc){Tb.selectAll(".text").remove(),Tb.selectAll("rect").remove();var b=Xb.append("rect"),c=[0],d=1==tc?Lc:Mc,e=a;sb.forEach(function(b){b.id==a&&(e=1==Vc?b.firstname+" "+b.lastname:b.id)});var f=1==Vc?70:30,g=Xb.append("text").attr("class","text").attr("id","t-"+a).attr("y",d[a].y+32).attr("dy",".40em").style("pointer-events","none").text(e).call(o,f,d[a].x-(f+6)/2+8,c),h=18*c[0]+16;if(h+d[a].y+10>=Zb&&g.attr("y",Zb-h-(Zb-d[a].y)).text(e).call(o,f,d[a].x-(f+6)/2+8,c),b.attr("id","r-"+a).attr("x",d[a].x-(f+6)/2).attr("y",h+d[a].y+10<=Zb?d[a].y+16:Zb-h-16-(Zb-d[a].y)).attr("width",f+16).attr("height",h).style("stroke","black").style("fill","yellow"),Ec&&(mc||3==tc)&&null!==ja()){ac.remove();var i,j={};for(i=0;i<gc.nodes.length;i++)gc.nodes[i].visible||(j[gc.nodes[i].id]=1);var k,l,n,p,q={};for(i=jc[0];i<gc.edges[a].length&&i<=jc[1];i++)k=gc.edges[a][i],"string"==typeof k.source?(l=parseInt(k.source),n=parseInt(k.target)):(l=k.source.id,n=k.target.id),j[l]||j[n]||(p=l+"_"+n,q[p]?q[p]++:q[p]=1);var r,s=[],t=gc.edges[a][0].colour;for(k in q)r=k.split("_"),s[s.length]={source:r[0],target:r[1],weight:q[k],colour:t};for(i=0;i<gc.links.length;i++)s[s.length]=gc.links[i];$b.force("link").links(s),m(s),_b.style("display","block").style("opacity",1),$b.restart(),setTimeout(function(){$b.stop(),_b.lower(),ac.lower()},1)}}}function mb(a,b,c){if(Ec&&!document.getElementById("textbox-"+a)&&null!==ja()&&(mc||!Ec||3==tc)){var d=document.createElement("textarea");d.id="textbox-"+a,d.style.resize="both",d.style.position="absolute",Ob[a]&&(d.value=Ob[a]),gd!=Eb&&(d.readOnly=!0),document.body.appendChild(d);var e,f=d.getBoundingClientRect(),g=document.getElementsByTagName("svg")[0].getBoundingClientRect(),h=c?Nc[b].x:Mc[b].x;e=h+f.width/2>=Yb?h+g.x-f.width:h-f.width/2<=0?h+g.x:h+g.x-f.width/2,d.style.left=e+"px";var i=c?Nc[b].y:Mc[b].y,j=i+190>=Zb?i+140:i+290;c&&(j=i+165>=Zb?i+165:i+265),d.style.top=j+"px";var k=document.createElement("button");k.innerHTML=gd==Eb?Rb.save:Rb.close,k.id=a,k.style.position="absolute",k.style.left=e+"px",k.style.top=j+f.height+"px",document.body.appendChild(k),d.focus(),d.addEventListener("click",function(){this.parentNode.appendChild(this),k.parentNode.appendChild(k),this.focus()});var l=!1;d.addEventListener("mousedown",function(){l=!0}),d.addEventListener("mouseup",function(){l=!1}),d.addEventListener("mousemove",function(){l&&(f=this.getBoundingClientRect(),k.style.left=e+"px",k.style.top=j+f.height+"px")}),k.addEventListener("click",function(){if(gd==Eb){var b={coordsid:Nb,clusterid:bd.clusterId,studentid:a,remark:d.value};""!=d.value&&d.value!=Ob[a]&&(Ob[a]=d.value,x(pb,b))}document.body.removeChild(d),document.body.removeChild(k)})}}var nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md={},nd=[];b(a)}});