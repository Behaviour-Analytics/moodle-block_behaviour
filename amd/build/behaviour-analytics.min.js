/*! moodle-block_behaviour v0.7.5 27-01-2021 */
!function(a){"function"==typeof define&&define.amd?define([],a):window.behaviourAnalytics=a()}(function(){return function(a){function b(a){vb=a.logs,wb=a.users,xb=a.groups,yb=a.members,Ab=a.mods,Bb=a.panelwidth,Cb=a.legendwidth,Db=a.name,Eb=a.iframeurl,_c=a.version36,ad=a.showstudentnames,Fb=a.positioning,Gb=a.positioning,Hb=a.nodecoords,Ib=a.links,Kb=a.courseid,Lb=a.userid,Jb=a.scale,Mb=a.graphs,Nb=a.alllinks,Ob=a.scales,Pb=a.changes,Qb=a.names,Rb=a.allmods,Sb=a.setnames,Tb=Lb,Ub=a.lastchange,Vb=a.comments,Yb=a.strings,qb=a.coordsscript,rb=a.clustersscript,sb=a.commentsscript,tb=a.manualscript,ub=a.deletescript,Zb=a.sesskey,kd=a.gotallnodes,tc=a.replaying,rd=a.debugcentroids,sd=a.centroids,od=a.isresearcher,nd=Lb,$b=window.dataDrivenDocs,ac=window.noUiSlider;var b=window.mersenneTwister;bc=new b(259),Hc=0,Gc=c(),cd=Date.now()+3e3,jd=1e3,_b=$b.transition().duration(jd).ease($b.easeLinear),Bc=120,bd=1,mc=1e-4,jc=1,gd=J,Oc=!1,Pc=220,Rc=.15,Qc=$b.curveCatmullRomClosed,qd=!0,Ec={},id={},Ic={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown",data:"coral",chat:"maroon",choice:"grey",feedback:"lime",glossary:"navy",survey:"tan",wiki:"teal",workshop:"silver",scorm:"tomato",imscp:"lightpink",folder:"peru"},Jc=["blue","red","orange","green","yellow","brown","purple","magenta","cyan"],rc=Fb?0:36,Bb=Fb?0:Bb,dc=window.innerWidth-Bc-Cb-150,ec=window.innerHeight-rc-90,hd=Math.min(dc,ec)<500?6:8,Wb={},wb.forEach(function(a){Wb[a.id]=a.realId}),d(),e(),tc?ba(a.replaydata,a.manualdata):Fb?h():j()}function c(){return["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"]}function d(){Ab.forEach(function(a){for(;!Ic[a.entype];){var b=Gc[Math.floor(bc.random()*Gc.length)],c=!0;for(var d in Ic)Ic[d]==b&&(c=!1);Ic[a.entype]=c?b:void 0}})}function e(){nc={nodes:[],links:[],edges:{},maxSession:0},f(),g()}function f(){var a,b,c,d=nc,e={};Ab.forEach(function(f){a=!0,b=void 0,c=void 0,Hb[f.id]?(a=1==Hb[f.id].visible&&1==Hb["g"+f.sect].visible,1!=Hb[f.id].visible||a||(Hb[f.id].visible=0),b=Hb[f.id].xcoord,c=Hb[f.id].ycoord):Hb["g"+f.sect]&&(a=1==Hb["g"+f.sect].visible&&Lb==Tb),d.nodes[d.nodes.length]={id:f.id,name:f.name,group:f.sect,type:f.type,entype:f.entype,colour:Ic[f.entype],visible:a,xcoord:b,ycoord:c},e[f.sect]||(Hb["g"+f.sect]&&(a=1==Hb["g"+f.sect].visible,b=Hb["g"+f.sect].xcoord,c=Hb["g"+f.sect].ycoord),e[f.sect]={id:"g"+f.sect,name:Yb.section+" "+f.sect,group:f.sect,type:"grouping",colour:Ic.grouping,visible:a,xcoord:b,ycoord:c},d.nodes[d.nodes.length]=e[f.sect]),d.links[d.links.length]={source:"g"+f.sect,target:f.id,weight:jc,colour:Ic.originalLinks}}),b=c=void 0,Hb.root&&(b=Hb.root.xcoord,c=Hb.root.ycoord);var f={id:"root",name:Db,group:-1,type:"grouping",colour:Ic.grouping,visible:!0,xcoord:b,ycoord:c};for(var g in e)d.links[d.links.length]={source:"root",target:e[g].id,weight:jc,colour:Ic.originalLinks};if(d.nodes[d.nodes.length]=f,Object.keys(Ib).length>0){var h,i,j;for(var k in Ib)j=k.split("_"),h=j[0],i=j[1],d.links[d.links.length]={source:h,target:i,weight:5*Ib[k],colour:Ic.originalLinks};if(!Gb)for(var l in d.nodes)isNaN(d.nodes[l].id)&&(d.nodes[l].visible=!1)}}function g(){var a,b=nc,c=0,d=0;pd={};for(var e=0;e<vb.length;e++)a={source:vb[e].moduleId,target:vb[e].moduleId,weight:jc,user:vb[e].userId,colour:""},b.edges[vb[e].userId]||(b.edges[vb[e].userId]=[],pd[vb[e].userId]=[],b.maxSession=b.maxSession<c?c:b.maxSession,c=0,d=0),Hb[vb[e].moduleId]&&1==Hb[vb[e].moduleId].visible&&(pd[vb[e].userId][d++]=vb[e].moduleId),e+1<vb.length&&vb[e].userId==vb[e+1].userId?(a.target=vb[e+1].moduleId,b.edges[vb[e].userId][c++]=a):0==b.edges[vb[e].userId].length&&(b.edges[vb[e].userId][c++]=a);b.maxSession=b.maxSession<c?c:b.maxSession,wb.forEach(function(a){b.edges[a.id]||(b.edges[a.id]=[])})}function h(){Kc=!1,kc=.01,lc=.01,dd=K,ed=L,fd=M,kd&&Object.keys(Hb).length>0&&(jc=0),Mb&&Ob&&y(),k(.6),D(),i(),setTimeout(function(){fc.force("charge",null).force("x",null).force("y",null)},500)}function i(){var a=document.getElementById("student-menu"),b=document.createElement("input");b.id="weight-slider",b.type="range",b.min="-0.2",b.max="2",b.step="0.2",b.value="0.6",b.style.width="130px",b.addEventListener("change",function(){ic.strength(this.value),document.getElementById("weights-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(b);var c=document.createTextNode(Yb.linksweight);a.appendChild(c),c=document.createElement("label"),c.id="weights-output",c.innerHTML="&nbsp;= "+b.value,a.appendChild(c)}function j(){if(Kc=!0,Fb=!0,kc=0,dd=null,ed=null,fd=null,kd&&0!=Object.keys(Hb).length){var a=N();Q(),O(a),k(0),R()}else k(.6),setTimeout(function(){var a=N();Q(),O(a),R()},500);ic=null}function k(a){cc=$b.select("#graph").append("svg").attr("width",dc).attr("height",ec),ic=$b.forceLink(nc.links).id(function(a){return a.id}).strength(a),fc=$b.forceSimulation(nc.nodes).force("link",ic).force("charge",$b.forceManyBody().strength(-80)).force("collide",$b.forceCollide().radius(12)).force("center",$b.forceCenter(dc/2,ec/2)).force("x",$b.forceX()).force("y",$b.forceY()),l(nc.nodes,gd,dd,ed,fd),m(nc.links),cc.on("click",function(){$b.selectAll("#rctext").remove(),$b.selectAll("#rcrect").remove(),(Kc||Fb)&&gc.on("mouseover",n).on("mouseout",q),tc&&gc.on("mouseover",null).on("mouseout",null)}),kd&&Fb&&Object.keys(Hb).length>0?fc.on("tick",s):fc.on("tick",t);for(var b=0;b<80;b++)fc.tick();Fb&&setTimeout(function(){fc.stop(),fc.on("tick",t),u(),0!=Object.keys(Hb).length&&kd||(v(),nc.edges={},g(),kd=!0,jc=Kc?1:0)},500),Kc&&!kd&&setTimeout(function(){nc.nodes=[],nc.links=[],f()},600)}function l(a,b,c,d,e){gc=cc.selectAll(".node").data(a).enter().append("circle").attr("class","node").attr("r",hd).on("mouseover",n).on("mouseout",q).on("contextmenu",b).call($b.drag().on("start",c).on("drag",d).on("end",e))}function m(a){hc=cc.selectAll(".link").data(a).enter().append("line").attr("class","link").style("stroke",function(a){return a.colour}).style("stroke-width",function(a){return 2*a.weight+"px"})}function n(a,b){if(!(Xc||(gc.on("mouseover",null),b||($b.selectAll(".text").remove(),$b.selectAll("rect").remove()),Date.now()-cd<150))){var c=[0],d=!1,e=!1,f=!1,g=150,h=304,i=154,j=a.type+": "+a.name;Yc&&(h=0,i=0);var k=cc.append("text").attr("class","text").attr("id","t-"+a.id).attr("y",a.y+32).attr("dy",".40em").style("pointer-events","none").text(j).call(o,g,a.x-(g+6)/2+8,c),l=16*c[0]+16;l+a.y>=ec-i&&(k.attr("y",ec-l-(ec-a.y)).text(j).call(o,g,a.x-(g+6)/2+8,c),d=!0),a.x<=h/2?(k.text(j).call(o,g,a.x+8,c),f=!0):a.x>=dc-h/2&&(k.text(j).call(o,g,a.x-(g+6)+8,c),e=!0);var m;m=f?a.x:e?a.x-(g+6):a.x-(g+6)/2;var n=cc.append("rect").attr("id","r-"+a.id).attr("x",m).attr("y",d?ec-l-16-(ec-a.y):a.y+16).attr("width",g+16).attr("height",l).style("stroke","black").style("fill","yellow");k.raise(),isNaN(a.id)||(Yc&&(h=400,i=300),p(a,l,g,h,i,d,f,e,parseInt(n.attr("x")),parseInt(n.attr("y"))))}}function o(a,b,c,d){var e=0;a.each(function(){var a,d=$b.select(this),f=d.text().split(/\s+/).reverse(),g=[],h=d.attr("y"),i=parseFloat(d.attr("dy")),j=d.text(null).append("tspan").attr("x",c).attr("y",h).attr("dy",i+"em");for(a=f.pop();a;)g.push(a),j.text(g.join(" ")),j.node().getComputedTextLength()>b&&(g.pop(),j.text(g.join(" ")),g=[a],j=d.append("tspan").attr("x",c).attr("y",h).attr("dy",1.1*++e+i+"em").text(a)),a=f.pop()}),d[0]=++e}function p(a,b,c,d,e,f,g,h,i,j){var k=document.createElement("iframe");k.id="preview",k.style.position="absolute",k.style.width=d+"px",k.style.height=e+"px";var l=document.getElementsByTagName("svg")[0].getBoundingClientRect(),m=document.body.getBoundingClientRect();m.x>0&&(m.x=0),k.style.left=Zc?window.innerWidth-10-d+"px":Yc?"10px":g?i+l.x+"px":h?i+l.x+c-d+18+"px":i+l.x-d/2+c/2+"px";var n=_c?0:50;if(k.style.top=Yc?l.y-m.y+ec/2+"px":f?n+j+l.y-m.y-e+"px":n+j+l.y+b-m.y+"px","lti"!=a.entype&&"unknown"!=a.type){var o=document.createElement("div");o.id="bgrnd",o.style.position="absolute",o.style.width=parseInt(k.style.width)+24+"px",o.style.height=parseInt(k.style.height)+24+"px",o.style.left=parseInt(k.style.left)-12+"px",o.style.top=parseInt(k.style.top)-12+"px",o.addEventListener("mouseout",function(a){var b=this.getBoundingClientRect();a.x>b.x&&a.x<b.x+b.width&&a.y>b.y&&a.y<b.y+b.height||($c=!1,setTimeout(r,750))}),o.addEventListener("mouseover",function(){$c=!0}),k.src=Eb+"/mod/"+a.entype+"/view.php?id="+a.id,document.body.appendChild(o),document.body.appendChild(k)}}function q(a){Xc||"lightgrey"==a.colour||(gc.on("mouseout",null),hc.on("mouseout",null),setTimeout(r,750))}function r(){if(!$c&&($b.selectAll(".text").remove(),$b.selectAll("rect").remove(),$b.selectAll("#preview").remove(),$b.selectAll("#bgrnd").remove(),gc.on("mouseover",n).on("mouseout",q),Yc)){hc.on("mouseover",Oa).on("mouseout",q);for(var a=0;a<Uc.length;a++)$b.select("#cluster1-"+a).on("mouseover",Ma.bind(this,a,!1)),$b.select("#cluster2-"+a).on("mouseover",Ma.bind(this,a,!1))}}function s(){var a=dc/2,b=ec/2,c=Jb;void 0===id.originalx?(id.originalx=a,id.originaly=b):(a=id.originalx,b=id.originaly);for(var d,e,f=0;f<nc.nodes.length;f++)d=nc.nodes[f].xcoord*c+a,e=nc.nodes[f].ycoord*c+b,(d<0||d>dc||e<0||e>ec)&&(c*=.9,--f);Jb=c,id.distance=c,hc.attr("x1",function(d){var e=nc.nodes.filter(function(a){var b="string"==typeof d.source?d.source:d.source.id;return a.id==b})[0];return $b.select(this).attr("y1",e.ycoord*c+b),e.xcoord*c+a}).attr("x2",function(d){var e=nc.nodes.filter(function(a){var b="string"==typeof d.target?d.target:d.target.id;return a.id==b})[0];return $b.select(this).attr("y2",e.ycoord*c+b),e.xcoord*c+a}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}),gc.attr("cx",function(b){return b.x=b.xcoord*c+a,b.x}).attr("cy",function(a){return a.y=a.ycoord*c+b,a.y}).style("display",function(a){return a.visible?"block":"none"}).style("fill",function(a){return a.colour}).raise()}function t(){var a=hd;hc.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).style("stroke-width",function(a){return 2*a.weight+"px"}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}),gc.attr("cx",function(b){return b.x=Math.max(a,Math.min(dc-a,b.x)),b.x}).attr("cy",function(b){return b.y=Math.max(a,Math.min(ec-a,b.y)),b.y}).style("fill",function(a){return a.colour}).style("display",function(a){return a.visible?"block":"none"}).raise(),$b.selectAll("rect").raise(),$b.selectAll("text").raise()}function u(){if(Qb){$b.select("#time").remove(),0==Ub&&(Ub=Date.now());var a=new Date;a.setTime(Ub);var b=a.getMinutes();b<10&&(b="0"+b),cc.append("text").attr("id","time").attr("y",ec-16).attr("dy",".40em").attr("x",6).style("pointer-events","none").text(Qb[Tb]+" "+a.getHours()+":"+b+" "+a.toDateString())}}function v(){var a=w();if(Mb&&Ob){var b={};for(var c in a)"scale"!=c&&"module"!=c&&(b[c]=a[c]);Mb[Lb]=b,Ob[Lb]=a.scale}a.time=Date.now(),Ub=a.time,Pb&&(Pb[Lb]=a.time),x(qb,a)}function w(){var a,b,c,d,e={},f=0,g=dc/2,h=ec/2;return nc.nodes.forEach(function(e){a=e.x-g,b=e.y-h,(c=Math.sqrt(a*a+b*b))>f&&(f=c,d=e)}),e.scale=f,e.module=d.id,Jb=f,nc.nodes.forEach(function(a){e[a.id]={xcoord:""+(a.x-g)/f,ycoord:""+(a.y-h)/f,visible:a.visible?1:0},a.xcoord||(a.xcoord=(a.x-g)/f,a.ycoord=(a.y-h)/f)}),Hb=e,e}function x(a,b){var c=new XMLHttpRequest;c.open("POST",a),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4==this.readyState&&this.status},c.send("cid="+Kb+"&data="+JSON.stringify(b)+"&sesskey="+Zb)}function y(){var a=document.getElementById("student-menu"),b=document.createElement("button");b.innerHTML=Yb.copy,b.addEventListener("click",z),a.appendChild(b);var c=b.getBoundingClientRect().height,d=document.createElement("button");d.innerHTML=Yb.print,d.addEventListener("click",A),a.appendChild(d),Fc=document.createElement("select"),Fc.size=3,Fc.id="teacher-select",Fc.style.minWidth="40px";var e=ec-c-20;Fc.style.height=e+"px",Fc.addEventListener("change",B);for(var f in Ob){var g=document.createElement("option");g.value=f,g.text=f,Lb==f&&(g.selected=!0),Fc.appendChild(g)}a.appendChild(Fc)}function z(){var a=new Image,b=new XMLSerializer,c=b.serializeToString(cc.node());a.src="data:image/svg+xml;base64,"+window.btoa(c),document.body.appendChild(a);var d=document.createRange();d.setStartBefore(a),d.setEndAfter(a),d.selectNode(a),window.getSelection().addRange(d),document.execCommand("Copy"),document.body.removeChild(a)}function A(){var a=new XMLSerializer,b=a.serializeToString(cc.node()),c=window.open();c.document.write('<img src="data:image/svg+xml;base64,'+window.btoa(b)+'"/>'),c.print(),c.close()}function B(){for(var a,b=document.getElementById("teacher-select"),c=0;c<b.options.length;c++)if(b.options[c].selected){a=b.options[c].value;break}a==Lb?(dd=K,ed=L,fd=M,gd=J):(dd=null,ed=null,fd=null,gd=null),Hb=Mb[a],Ib=Nb[a],Jb=Ob[a],Ub=Pb[a],Ab=Rb[a],Db=Sb[a],Tb=a,cc.remove(),Ec={},d(),$b.selectAll("#legendUL").remove(),D(),jc=1,e(),jc=0;var f=document.getElementById("weights-output").innerHTML;f=parseFloat(f.split(" ")[1]),k(f);for(var g in Ec)Hb[g]&&(Ec[g].checked=1==Hb[g].visible),Lb==a?(Ec[g].removeEventListener("change",C),Ec[g].addEventListener("change",H)):(Ec[g].removeEventListener("change",H),Ec[g].addEventListener("change",C))}function C(){this.checked=!this.checked}function D(){var a,b=500;Dc=document.getElementById("legend"),Dc.style="width: "+Cb+"px; height: "+ec+"px; min-width: "+Cb+"px; max-width: "+b+"px;";var c=function(a){var b=Dc.offsetLeft+28;a.x>=b&&a.x<=b+6?Dc.style.cursor="col-resize":Dc.style.cursor="auto"},d=function(c){var d=a-c.x;a=c.x;var e=parseInt(Dc.style.width)+d;e>b?e=b:e<Cb&&(e=Cb),Dc.style.width=e+"px"};Dc.addEventListener("mousemove",c),Dc.addEventListener("mousedown",function(b){a=b.x,"col-resize"==Dc.style.cursor&&Dc.addEventListener("mousemove",d)}),document.addEventListener("mouseup",function(){Dc.removeEventListener("mousemove",d)}),E(Dc)}function E(a){var b=document.createElement("ul");b.id="legendUL";var c=document.createElement("span");c.className="no-select-text",c.innerHTML=Db;var d=document.createElement("li");d.appendChild(c);var e=document.createElement("ul");d.appendChild(e),b.appendChild(d);var f,g,h,i=-1;Ab.sort(function(a,b){return a.sect-b.sect}),Ab.forEach(function(a){i!=a.sect&&(g=document.createElement("ul"),g.className="nested",h=document.createElement("span"),h.className="caret",h.addEventListener("click",F),f=document.createElement("li"),f.appendChild(h),G("g"+a.sect,Yb.section+" "+a.sect,Ic.grouping,a.sect,"grouping",f),f.appendChild(g),e.appendChild(f),i=a.sect),f=document.createElement("li"),f.className="indented",G(a.id,a.name,Ic[a.entype],a.sect,a.type,f),g.appendChild(f)}),a.appendChild(b)}function F(){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("caret-down")}function G(a,b,c,d,e,f){var g=document.createElement("input");g.type="checkbox",Hb[a]?g.checked=0!=Hb[a].visible:Hb["g"+d]?g.checked=1==Hb["g"+d].visible&&Lb==Tb:g.checked=!0,g.id=a,g.group=d,g.nodeT=e,g.addEventListener("change",H),Ec[g.id]=g;var h=document.createElement("label");h.style.color=c,h.className="no-select-text";var i="grouping"==e?b:e+"_"+b;h.appendChild(document.createTextNode(i)),f.appendChild(g),f.appendChild(h)}function H(){var a=this.id,b=this.checked,c=this.nodeT,d=this.group;nc.nodes.forEach(function(e){e.id==a?(e.visible=b,Ec[e.id].checked=b):"grouping"==c&&e.group==d?(e.visible=b,Ec[e.id].checked=b):b&&"grouping"==e.type&&e.group==d&&(e.visible=b,Ec[e.id].checked=b)}),I(),S()}function I(){parseFloat(document.getElementById("weight-slider").value)<0&&(ic.strength(0),document.getElementById("weights-output").innerHTML="&nbsp;= 0",document.getElementById("weight-slider").value=0)}function J(a){if($b.selectAll(".text").remove(),$b.selectAll("rect").remove(),$b.selectAll("#preview").remove(),$b.selectAll("#bgrnd").remove(),$b.event.preventDefault(),"root"!=a.id){var b=a;gc.on("mouseover",null).on("mouseout",null);var c=cc.append("rect"),d=cc.append("text").attr("class","text").attr("id","rctext").attr("x",a.x+10).attr("y",a.y+12).attr("dy",".40em").style("pointer-events","none").text(Yb.hide);a.y+20>=ec&&d.attr("y",ec-(ec-a.y)-10).text(Yb.hide),c.attr("id","rcrect").attr("x",a.x).attr("y",a.y+20<=ec?a.y:ec-(ec-a.y)-20).attr("width",60).attr("height",24).style("stroke","black").style("fill","lightgrey"),c.on("mouseover",function(){$b.event.target.style="fill: grey;"}),c.on("mouseout",function(){$b.event.target.style="fill: lightgrey;"}),c.on("click",function(){$b.selectAll("#rctext").remove(),$b.selectAll("#rcrect").remove(),gc.on("mouseover",n).on("mouseout",q),b.visible=!1,Ec[b.id].checked=!1,"grouping"==b.type&&nc.nodes.forEach(function(a){a.group==b.group&&(a.visible=!1,Ec[a.id].checked=!1)}),I(),S()})}}function K(a){$b.event.active||fc.alphaTarget(lc).restart(),a.fx=a.x,a.fy=a.y}function L(a){$b.selectAll("rect").remove(),$b.selectAll(".text").remove(),$b.selectAll("#preview").remove(),$b.selectAll("#bgrnd").remove(),a.fx=$b.event.x,a.fy=$b.event.y}function M(a){$b.event.active||(Fb?(fc.stop(),v(),u()):fc.alphaTarget(mc)),a.fx=null,a.fy=null,cd=Date.now()}function N(){var a=document.getElementById("student-menu");return sc=document.createElement("button"),sc.innerHTML=Yb.cluster,sc.addEventListener("click",aa),a.appendChild(sc),sc.getBoundingClientRect().height}function O(a){var b=document.getElementById("student-menu");oc=document.createElement("select"),oc.multiple=!0,oc.id="student-select";var c=xb.length>0?ec-a-120:ec-a-12;oc.style="height: "+c+"px;",oc.addEventListener("change",function(){for(var a=document.getElementById("student-select"),b="box-shadow: 0 0 0 0 white inset;",c=0;c<a.options.length;c++){var d="box-shadow: 0 0 10px 100px "+a.options[c].colour+" inset;";a.options[c].style=a.options[c].selected?d:b}vb.length>0&&T(!0)}),1==ad?wb.sort(function(a,b){var c=a.firstname+" "+a.lastname,d=b.firstname+" "+b.lastname;return c>d?1:c<d?-1:0}):wb.sort(function(a,b){return a.id-b.id}),wb.forEach(function(a){P(a,oc)}),b.appendChild(oc)}function P(a,b){var c=document.createElement("option");c.value=a.id,c.text=1==ad?a.firstname+" "+a.lastname:a.id,c.colour=Gc[Hc++],Hc>=Gc.length&&(Hc=0),nc.edges[a.id].forEach(function(a){a.colour=c.colour}),b.appendChild(c)}function Q(){if(0!=xb.length){var a=document.getElementById("student-menu");zb=document.createElement("select"),zb.multiple=!0,zb.id="group-select",zb.style="height: 120px;",zb.addEventListener("change",function(){$b.selectAll(".link").remove(),$b.selectAll(".hull").remove(),m(nc.links),fc.on("tick",s),fc.restart(),setTimeout(fc.stop,100),oc.options.length=0;for(var a=0;a<zb.options.length;a++)if(zb.options[a].selected)for(var b=0;b<wb.length;b++)yb[wb[b].realId]==zb.options[a].value&&P(wb[b],oc)});var b;for(var c in xb)b=document.createElement("option"),b.value=c,b.text=xb[c],zb.appendChild(b);a.appendChild(zb)}}function R(){pc=document.getElementById("slider"),qc=[0,nc.maxSession];var a;a=nc.maxSession<500?10:nc.maxSession<1e3?20:nc.maxSession<5e3?100:nc.maxSession<1e4?200:500,ac.create(pc,{start:[0,nc.maxSession],range:{min:[0],max:[nc.maxSession]},step:1,connect:!0,pips:{mode:"steps",stepped:!0,density:100,filter:function(b){return 0==b||b==nc.maxSession?1:b%a==0?2:0}}}),setTimeout(function(){pc.noUiSlider.on("update",function(a,b){qc[b]=parseInt(a[b]),oc.dispatchEvent(new Event("change"))})},1e3)}function S(){hc.remove(),gc.remove(),$b.selectAll(".hull").remove();var a=U(J);V(a),X(a),fc.alphaTarget(kc).restart(),Fb&&setTimeout(function(){fc.stop(),v(),u()},100)}function T(a){hc.remove(),gc.remove(),$b.selectAll(".hull").remove(),Fb=!1;var b=U(null);V(b),a&&X(b),Fb=!0,fc.on("tick",s),fc.restart(),setTimeout(fc.stop,100)}function U(a){var b=[],c={};return nc.nodes.forEach(function(a){null===a.fx&&(a.fx=a.x,a.fy=a.y),a.visible?b[b.length]=a:c[a.id]=1}),fc.nodes(b),l(b,a,dd,ed,fd),c}function V(a){var b,c,d,e,f,g=[];for(f in nc.links)d=nc.links[f],"string"==typeof d.source?(b=d.source,c=d.target):(b=d.source.id,c=d.target.id),a[b]||a[c]||(g[g.length]=d);var h=Fb?[]:document.getElementById("student-select").options;for(f=0;f<h.length;f++)if(h[f].selected){var i,j,k={};for(j=qc[0];j<=qc[1]&&nc.edges[h[f].value].length>j;j++)e=nc.edges[h[f].value][j],"string"==typeof e.source?(i=e.source+"_"+e.target,b=e.source,c=e.target):(i=e.source.id+"_"+e.target.id,b=e.source.id,c=e.target.id),k[i]?k[i]++:k[i]=1,a[b]||a[c]||(g[g.length]=e);for(j=qc[0];j<=qc[1]&&nc.edges[h[f].value].length>j;j++)e=nc.edges[h[f].value][j],i="string"==typeof e.source?e.source+"_"+e.target:e.source.id+"_"+e.target.id,e.weight=k[i]}fc.force("link").links(g),m(g)}function W(a){return nc.nodes.find(function(b){return b.id==a})}function X(a){if(!Fb){$b.selectAll(".hull").remove();for(var b=document.getElementById("student-select").options,c={},d=0;d<b.length;d++)if(b[d].selected){var e,f,g,h,i,j,k;c[b[d].value]={};for(var l=qc[0];l<=qc[1]&&nc.edges[b[d].value].length>l;l++){var m=nc.edges[b[d].value][l];if("string"==typeof m.source){j=m.source,k=m.target;var n=W(j);e=n.x,f=n.y,n=W(k),g=n.x,h=n.y}else j=m.source.id,k=m.target.id,e=m.source.x,f=m.source.y,g=m.target.x,h=m.target.y;a[j]||a[k]||(i=m.colour,c[b[d].value][j]={x:e,y:f,colour:i},c[b[d].value][k]={x:g,y:h,colour:i})}}for(var o in c)$(c[o],o,!1,!1);Kc&&(qd?Z(b):Y(b))}}function Y(a){if(Sc={},0!=Object.keys(pd).length)for(var b=0;b<a.length;b++)if(a[b].selected){var c=a[b].value;if(pd[c].length<=qc[0])continue;var d=qc[0],e=pd[c].length>qc[1]+1?qc[1]:pd[c].length,f=parseInt(d/2+e/2),g=pd[c][f],h=parseFloat(Hb[g].xcoord),i=parseFloat(Hb[g].ycoord);Sc[c]={x:h*Jb+id.originalx,y:i*Jb+id.originaly,colour:a[b].colour}}}function Z(a){if(Sc={},0!=Object.keys(pd).length)for(var b=0;b<a.length;b++)if(a[b].selected){var c=a[b].value;if(pd[c].length<=qc[0])continue;for(var d,e=qc[0],f=pd[c].length>qc[1]+1?qc[1]:pd[c].length,g=0,h=0,i=0,j=e;j<f;j++)d=pd[c][j],g+=parseFloat(Hb[d].xcoord),h+=parseFloat(Hb[d].ycoord),i++;Sc[c]={x:g/i*Jb+id.originalx,y:h/i*Jb+id.originaly,colour:a[b].colour}}}function $(a,b,c,d){if(0!=Object.keys(a).length){var e,f,g,h=[],i=20;g=Kc?"hull":c?"manual-hull":"cluster-hull";for(var j in a)h[h.length]=[a[j].x,a[j].y],e=a[j].colour;if(1==h.length)f=function(a){var b=[a[0][0],a[0][1]-i],c=[a[0][0],a[0][1]+i];return"M "+b+" A "+[i,i,"0,0,0",c].join(",")+" A "+[i,i,"0,0,0",b].join(",")};else{if(2!=h.length){var k=$b.concaveHull().padding(15);Oc||k.distance(Pc);var l=h.length>4?k(h):[h];return f=$b.line().curve(Qc),void cc.selectAll("#hull-"+b).data(l).enter().append("path").attr("id","hull-"+b).attr("class",g).style("stroke",e).style("stroke-opacity",d?0:1).style("fill",e).style("fill-opacity",d?0:Rc).attr("d",f)}var m=function(a,b){return[b[0]-a[0],b[1]-a[1]]},n=function(a,b){return[b*a[0],b*a[1]]},o=function(a,b){return[a[0]+b[0],a[1]+b[1]]},p=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return n(a,1/b)},q=function(a,b){return n(p(a),b)},r=function(a,b){void 0!==b&&(a=m(a,b));var c=[-a[1],a[0]];return p(c)};f=function(a){var b=m(a[0],a[1]),c=q(b,i),d=o(a[0],n(c,-1)),e=o(a[1],c),f=1.2*i,g=q(r(b),f),h=n(g,-1),j=o(d,h),k=o(e,h),l=o(d,g);return"M "+d+" C "+[j,k,e].join(",")+" S "+[l,d].join(",")+" Z"}}cc.append("path").attr("id","hull-"+b).attr("class",g).style("stroke",e).style("stroke-opacity",d?0:1).style("fill",e).style("fill-opacity",d?0:Rc).attr("d",f(h))}}function _(){clearInterval(Nc),Nc=void 0,Tc=null,ya(),$b.selectAll(".clustering-centroid").remove(),$b.selectAll(".cluster-hull").remove(),$b.selectAll(".centroid").remove(),$b.selectAll(".server-centroid").remove(),zc.style.display="none",document.getElementById("anim-controls").style.display="none",document.getElementById("log-panel").style.display="none",document.getElementById("student-menu").style.width=sc.style.width,Kc=!0,Yc=!1,pc.style.display="block",oc.style.display="block",zb.style.display="block",gc.style("display","block"),gc.style("opacity",1),hc.style("display","block"),hc.style("opacity",1),T(!0),gc.on("mouseover",n).on("mouseout",q),sc.innerHTML=Yb.cluster,sc.removeEventListener("click",_),sc.addEventListener("click",aa)}function aa(){Kc=!1,pc.style.display="none",oc.style.display="none",zb.style.display="none",$b.selectAll(".hull").remove(),$b.selectAll(".text").remove(),$b.selectAll("rect").remove(),document.getElementById("student-menu").style.width=Bc+"px",sc.innerHTML=Yb.graph,sc.removeEventListener("click",aa),sc.addEventListener("click",_),fc.stop(),gc.on("mouseover",null).on("mouseout",null).on("contextmenu",null).call($b.drag().on("start",null).on("drag",null).on("end",null)),id.clusterId=Date.now(),Vb={},Mc=0,Lc=!1,Ac=1,Nc=void 0;var a='<p id="cluster-text">'+Yb.numclusters+"</p>";setTimeout(function(){if(zc)document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("cluster-text").innerHTML=a,document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("anim-controls").style.display="block",document.getElementById("log-panel").style.display="block",zc.removeAttribute("disabled"),zc.noUiSlider.set(1),zc.style.display="block";else{var b=Ea();Wa(a,b),fb()}gb()},jd/2)}function ba(a,b){Fb=!0,Hb={0:0,1:1,2:2},ec=window.innerHeight-190,va(),fb(),ca(a,b)}function ca(a,b){var c=document.getElementById("student-menu");uc=document.createElement("select"),uc.size=3,uc.id="replay-select",uc.style="height: "+(ec-12)+"px;",uc.addEventListener("change",da.bind(this,a,b));for(var d in a){var e=0;for(var f in a[d]){var g=0;e++;for(var h in a[d][f])if(!isNaN(h)&&a[d][f][h][1]){var i=document.createElement("option");i.value=d+"_"+f+"_"+h,i.text=d.split("-")[0]+"_"+e+"_"+ ++g,uc.appendChild(i)}}}c.appendChild(uc)}function da(a,b){var c=sa(a,b),f=c.members;cc&&(cc.remove(),za(),ya(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"),oc&&document.body.removeChild(oc),Tc=null,d(),e(),qc=[0,nc.maxSession];for(var g=0;g<nc.nodes.length;g++)void 0===nc.nodes[g].xcoord&&(nc.nodes[g].visible=!1);ta(f),k(0),T(!1),gc.on("mouseover",null).on("mouseout",null),Wc=!0,setTimeout(function(){ua(Sc,!1),gb(),fc.on("tick",s);for(var a in Sc)$b.select("#centroid-"+a).call($b.drag().on("start",ea.bind(this,a)).on("drag",fa.bind(this,a)).on("end",ga.bind(this,a,b,c)))},500)}function ea(a){ka(a)&&(md=Date.now(),cc.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+a).attr("points",hb($b.event.x,$b.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Sc[a].colour).style("opacity",.5))}function fa(a){$b.select("#dragged-"+a).attr("points",hb($b.event.x,$b.event.y))}function ga(a,b,c){if($b.selectAll(".dragged-centroid").remove(),ka(a)){if(Date.now()-md<300)return void pb(Wb[a],a,!1);ld||ma();var d=la();if(0==Object.keys(td[d]).length)for(var e=0;e<vc[d].length;e++)for(var f in vc[d][e].members){var g=Xb[vc[d][e].members[f].id];td[d][g]=e}var h=lb($b.event);for(var i in td)i<=d&&(td[i][a]=h);na(d,b,c),ld=!0,ia(d),ha(d)}}function ha(a){for(var b={clusterCoords:[],members:[]},c=0;c<ud.length;c++){var d=ud[c]?ud[c]:Uc[c];b.clusterCoords[c]=Ua(d),b.clusterCoords[c].num=c;for(var e in td[a])td[a][e]==c&&(b.members[b.members.length]={id:Wb[e],num:c})}b.iteration=a,b.clusterId=id.clusterId,b.coordsid=Ub,x(tb,b)}function ia(a){if(!(a>=0)&&td[a]&&0!=Object.keys(td[a]).length){var b,c=ja(a),d=Yb.manualcluster+"<br>";for(b=0;b<ud.length;b++)if(ud[b]){var e=ud[b].x-dc/2,f=ud[b].y-ec/2,g=Math.sqrt(e*e+f*f),h=Uc[b].colour;d+=Yb.disttocluster+' <span style="color:'+h+'">'+h+"</span>: "+Math.round(g)+"<br>"+Yb.cluster+" "+h+" "+Yb.members+": [";for(var i in td[a])td[a][i]==b&&(d+=i+", ");-1!=d.indexOf(",",d.length-3)&&(d=d.slice(0,-2)),d+="]<br>",od&&(d+=Yb.precision+": "+c[b].precision.toFixed(4)+"<br>",d+=Yb.recall+": "+c[b].recall.toFixed(4)+"<br>",d+=Yb.f1+": "+c[b].f1.toFixed(4)+"<br>",d+=Yb.fhalf+": "+c[b].fhalf.toFixed(4)+"<br>",d+=Yb.f2+": "+c[b].f2.toFixed(4)+"<br>")}var j=Cc.innerHTML.split("<br><br>"),k=j[0].split("<br>");for(Cc.innerHTML="",b=0;b<k.length&&!k[b].startsWith(Yb.manualcluster);b++)Cc.innerHTML+=k[b]+"<br>";for(od&&(b=c.length-1,d+=Yb.totalmeasures+"<br>",d+=Yb.precision+": "+c[b].precision.toFixed(4)+"<br>",d+=Yb.recall+": "+c[b].recall.toFixed(4)+"<br>",d+=Yb.f1+": "+c[b].f1.toFixed(4)+"<br>",d+=Yb.fhalf+": "+c[b].fhalf.toFixed(4)+"<br>",d+=Yb.f2+": "+c[b].f2.toFixed(4)+"<br>"),Cc.innerHTML+=d+"<br>",b=1;b<j.length;b++)Cc.innerHTML+=j[b]+"<br><br>"}}function ja(a){var b,c,d,e=0,f=0,g=0,h=[];for(d=0;d<Uc.length;d++){for(var i in Tc)Tc[i].ci==d&&td[a][i]==Tc[i].ci?e++:Tc[i].ci==d&&td[a][i]!=Tc[i].ci?f++:td[a][i]==d&&td[a][i]!=Tc[i].ci&&g++;b=e/(e+f),c=e/(e+g),h[d]={tp:e,fp:f,fn:g,precision:b,recall:c,f1:b+c==0?0:2*b*c/(b+c),fhalf:b+c==0?0:1.25*b*c/(.25*b+c),f2:b+c==0?0:5*b*c/(4*b+c)},e=0,f=0,g=0}for(d=0;d<h.length;d++)e+=h[d].tp,f+=h[d].fp,g+=h[d].fn;return b=e/(e+f),c=e/(e+g),h[h.length]={tp:e,fp:f,fn:g,precision:b,recall:c,f1:b+c==0?0:2*b*c/(b+c),fhalf:b+c==0?0:1.25*b*c/(.25*b+c),f2:b+c==0?0:5*b*c/(4*b+c)},h}function ka(a){if(document.getElementById("replayer").innerHTML!=Yb.convergence)return!1;if(nd!=Lb)return!1;var b,c=Tc[a].ci,d=0;for(b in Tc)Tc[b].ci==c&&d++;var e=la(),f=0;if(td[e]){c=td[e][a];for(b in td[e])td[e][b]==c&&f++}return!(1==d&&f<=1)&&1!=f}function la(){var a=Cc.innerHTML.split("<br>");return a[2]&&a[2].startsWith(Yb.iteration)?parseInt(a[2].split(" ")[1]):null}function ma(){for(var a in vc)if(!(a>=0)){td[a]={};for(var b=0;b<vc[a].length;b++)for(var c in vc[a][b].members){var d=Xb[vc[a][b].members[c].id];td[a][d]=b}}}function na(a,b,c){var d,e,f=[],g=[];for(d=0;d<vc[a].length;d++){f[d]={},g[d]=[];for(e in td[a])if(td[a][e]==d){var h=Tc[e].x,i=Tc[e].y;f[d][h+"_"+i]={x:h,y:i,colour:Uc[d].colour},g[d][g[d].length]=[h,i]}}var j=document.getElementsByClassName("manual-centroid").length,k=0==j;for($b.selectAll(".manual-hull").remove(),d=0;d<f.length;d++)$(f[d],-1*(d+1),!0,k),ud[d]=Ra(g[d]);if(b)for(b[c.did]||(b[c.did]={}),b[c.did][c.gid]||(b[c.did][c.gid]={}),b[c.did][c.gid][c.cid]||(b[c.did][c.gid][c.cid]={}),b[c.did][c.gid][c.cid][a]||(b[c.did][c.gid][c.cid][a]=[]),d=0;d<ud.length;d++)if(ud[d]){var l=[];for(e in td[a])td[a][e]==d&&(l[l.length]={id:Wb[e],num:d});b[c.did][c.gid][c.cid][a][d]={centroidx:ud[d].x,centroidy:ud[d].y,members:l}}k?pa():qa(),cc.selectAll(".centroid").raise(),cc.selectAll(".clustering-centroid").raise(),cc.selectAll(".manual-centroid").raise()}function oa(){$b.event.stopPropagation()}function pa(){$b.selectAll(".manual-centroid").remove();for(var a,b,c=14,d=0;d<ud.length;d++){if(!ud[d])return;a=ud[d].x,b=ud[d].y,cc.append("line").attr("class","manual-centroid").attr("id","manual1-"+d).attr("x1",a-c).attr("y1",b-c).attr("x2",a+c).attr("y2",b+c).style("stroke",Uc[d].colour).style("stroke-width","5px").style("opacity",0).on("click",oa).on("click.centroidClick",pb.bind(this,-1*(d+1),d,!0)).on("mouseover",Ma.bind(this,d,!0)),cc.append("line").attr("class","manual-centroid").attr("id","manual2-"+d).attr("x1",a+c).attr("y1",b-c).attr("x2",a-c).attr("y2",b+c).style("stroke",Uc[d].colour).style("stroke-width","5px").style("opacity",0).on("click",oa).on("click.centroidClick",pb.bind(this,-1*(d+1),d,!0)).on("mouseover",Ma.bind(this,d,!0))}$b.selectAll(".manual-centroid").transition().duration(jd).style("opacity",.5),$b.selectAll(".manual-hull").transition().duration(jd).style("stroke-opacity",1).style("fill-opacity",Rc)}function qa(){for(var a,b,c=14,d=0;d<ud.length;d++){if(!ud[d])return void $b.selectAll(".manual-centroid").remove();a=ud[d].x,b=ud[d].y,$b.select("#manual1-"+d).transition().duration(jd).attr("x1",a-c).attr("y1",b-c).attr("x2",a+c).attr("y2",b+c).style("display","block"),$b.select("#manual2-"+d).transition().duration(jd).attr("x1",a+c).attr("y1",b-c).attr("x2",a-c).attr("y2",b+c).style("display","block")}}function ra(a){if(!a||a>0)return cc.selectAll(".manual-centroid").remove(),void cc.selectAll(".manual-hull").remove();ld&&na(a,null,null)}function sa(a,b){var c,d,e=document.getElementById("replay-select");for(d=0;d<e.options.length;d++)if(e.options[d].selected){c=e.options[d].value.split("_");break}var f=c[0],g=c[1],h=c[2];nd=f.split("-")[0],id.clusterId=h,Ub=a[f][g].last,Hb=a[f][g].nodes,Ib=a[f][g].links,Jb=a[f][g].scale,Ab=a[f][g].mods,vc=a[f][g][h],vb=a[f][g].logs,wb=a[f][g].users,Vb=a[f][g][h].comments,Xb={},Wb={},wb.forEach(function(a){Wb[a.id]=a.realId,Xb[a.realId]=a.id}),Mc=0,Ac=1,xc=0,yc=0;for(var i in vc)isNaN(i)||(i>=0?xc++:yc--);ud=[],td={},ld=!1;var j,k,l=b[f][g][h];if(l)for(ld=!0,d=-1;d>=yc;d--){l[d]&&!l[d-1]&&(l[d-1]=l[d]),td[d]={};for(j in l[d])for(k in l[d][j].members){var m=l[d][j].members[k].id;td[d][Xb[m]]=j}}Uc=[],Sc={};var n={},o=0;for(j in vc[1]){if(d=Uc.length,Uc[d]={x:0,y:0},o<Jc.length)Uc[d].colour=Jc[o++];else{for(var p;!p;)p=Gc[Math.floor(bc.random()*Gc.length)],p=Jc.includes(p)?void 0:p;Uc[d].colour=p}for(k in vc[1][j].members){var q=Xb[vc[1][j].members[k].id];Sc[q]={x:vc[1][j].members[k].x,y:vc[1][j].members[k].y},n[q]=!0}}return{members:n,did:f,gid:g,cid:h}}function ta(a){oc=document.createElement("select"),oc.multiple=!0,oc.id="student-select",oc.style.display="none",Hc=0,wb.forEach(function(a){P(a,oc)});for(var b,c=0;c<oc.options.length;c++)b=oc.options[c].value,a[b]?oc.options[c].selected=!0:oc.options[c].selected=!1,Sc[b]&&(Sc[b].colour=oc.options[c].colour);document.body.appendChild(oc)}function ua(a,b){for(var c in a)a[c].x*=id.distance,a[c].x+=id.originalx,a[c].y*=id.distance,a[c].y+=id.originaly,b&&(a[c].x-=id.centre.x,a[c].x*=id.scale,a[c].x+=dc/2,a[c].y-=id.centre.y,a[c].y*=id.scale,a[c].y+=ec/2)}function va(){var a=document.getElementById("slider"),b=document.createElement("p");b.innerHTML="&nbsp",b.id="replayer",b.style.marginTop="-20px",a.appendChild(b);var c=document.createElement("p");c.innerHTML="&nbsp",c.id="replaydragdrop",c.style.marginTop="-12px",a.appendChild(c);var d=document.createElement("button");d.id="replay-stop",d.innerHTML="&#9606",d.addEventListener("click",xa),a.appendChild(d);var e=document.createElement("button");e.id="replay-pause",e.innerHTML="&#9654",e.value="play",e.addEventListener("click",Aa),a.appendChild(e);var f=document.createElement("button");f.id="replay-back",f.innerHTML="&#9614&#9664",f.addEventListener("click",Ca),a.appendChild(f);var g=document.createElement("button");g.id="replay-forward",g.style.marginRight="80px",g.innerHTML="&#9654&nbsp&nbsp&#9614",g.addEventListener("click",Ba.bind(this,!0)),a.appendChild(g);var h=document.createElement("button");h.id="delete-button",h.innerHTML=Yb.delbutton,h.addEventListener("click",wa),a.appendChild(h)}function wa(){if(confirm(Yb.delconfirm)){var a=document.getElementById("replay-select");if(a.selectedIndex>-1){var b=a.options[a.selectedIndex].value;b.length>0&&(x(ub,b.replace("-","_")),a.options[a.selectedIndex]=null,xa())}}}function xa(){cc&&setTimeout(function(){cc.remove(),ya(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"},500),vc=void 0,Tc=null,za();var a=document.getElementById("replay-select");a.selectedIndex>-1&&(a.options[a.selectedIndex].selected=!1)}function ya(){Cc.readOnly=!1,Cc.innerHTML="",setTimeout(function(){Cc.readOnly=!0},300)}function za(){var a=document.getElementById("replay-pause");a.innerHTML="&#9654",a.value="play",clearInterval(Nc),Nc=void 0}function Aa(){if(vc){var a=document.getElementById("replay-pause");"play"==a.value?(a.innerHTML="&#9613&#9613",a.value="pause",Ba(!1),Nc=setInterval(Ba.bind(this,!1),1200)):za()}}function Ba(a){if(vc){a&&za(),Mc++;var b=Mc-1;return Mc>xc&&vc[-1]&&(b=xc-Mc+1,!vc[b-1])?(Mc--,void za()):b>xc?(Mc--,void za()):void(1==Mc?(Ac=2,Lc=!0,Wc=!1,$a()):2==Mc?(_a(),Da(b-1,!1,!0)):Da(b-1,!1,!1))}}function Ca(){if(vc&&wc&&!(Mc-1<0)){za(),Mc--;var a=Mc-1;Mc>xc&&(a=xc-Mc+1),0==Mc?(Ac=1,Za(),Lc=!1,Cc.innerHTML=Cc.innerHTML.slice(Cc.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):1==Mc?(Tc=null,$a(),Cc.innerHTML=Cc.innerHTML.slice(Cc.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):(Tc=null,Da(a-1,!0,2==Mc))}}function Da(a,b,c){var d,e=[],f={},g={};for(d=0;d<vc[a].length;d++,g={}){cc.selectAll("#hull-"+d).remove(),Uc[d].x=vc[a][d].centroidx,Uc[d].y=vc[a][d].centroidy;for(var h in vc[a][d].members){var i=vc[a][d].members[h].x,j=vc[a][d].members[h].y,k=Xb[vc[a][d].members[h].id];Sc[k].x=i,Sc[k].y=j,g[i+"_"+j]={x:i,y:j,colour:Uc[d].colour},f[k]=d}e[d]=g}if(ua(Uc,!0),c)Ka();else{for(ua(Sc,!1),d=0;d<e.length;d++)ua(e[d],!0),$(e[d],d,!1,!1);Va(jd)}if(ab(wc[2],wc[0],wc[1],jd),cc.selectAll(".centroid").raise(),cc.selectAll(".clustering-centroid").raise(),ra(a),b)Cc.innerHTML=Cc.innerHTML.slice(Cc.innerHTML.indexOf("<br><br>")+8);else{for(var l in f)Tc[l].ci=f[l];Sa(a),ia(a)}if(a<0)if(document.getElementById("replayer").innerHTML=Yb.convergence,document.getElementById("replayer").style.color="green",od){var m=document.getElementById("replay-select").options;for(d=0;d<m.length;d++)if(m[d].selected){var n=m[d].value.split("-")[0];n==Lb&&(document.getElementById("replaydragdrop").innerHTML=Yb.dragon);break}}else document.getElementById("replaydragdrop").innerHTML=Yb.dragon;else document.getElementById("replayer").innerHTML=Yb.iteration+" "+a,document.getElementById("replayer").style.color="black",document.getElementById("replaydragdrop").innerHTML=Yb.dragoff}function Ea(){var a=document.getElementById("anim-controls");a.appendChild(document.createTextNode(Yb.runkmeans));var b=document.createElement("p");b.innerHTML="&nbsp",b.id="clustering",a.appendChild(b);var c=document.createElement("p");c.innerHTML="&nbsp",c.id="dragdrop",c.style.marginTop="-12px",a.appendChild(c);var d=document.createElement("button");d.id="play-pause",d.style.marginLeft="5px",d.style.marginRight="5px",d.innerHTML="&#9654",d.addEventListener("click",Ha),d.disabled=!0;var e=document.createElement("button");e.id="play-step",e.style.marginLeft="5px",e.innerHTML="&#9654&nbsp&nbsp&#9614",e.addEventListener("click",Ga.bind(this,d)),e.disabled=!0,a.appendChild(e),a.appendChild(d);var f=document.createElement("button");return f.id="stop",f.style.marginTop="5px",f.style.marginLeft="5px",f.innerHTML=Yb.reset,f.addEventListener("click",Fa),a.appendChild(f),a}function Fa(){Lc=!1,Mc=0,clearInterval(Nc),Nc=void 0,id.clusterId=Date.now(),zc.removeAttribute("disabled"),3==Ac?(zc.noUiSlider.set(2),setTimeout(function(){zc.noUiSlider.set(1),Ac=1},jd)):(zc.noUiSlider.set(1),Ac=1),document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("num-clusters")&&(document.getElementById("num-clusters").readOnly=!1,document.getElementById("num-clusters").value=""),$b.selectAll(".clustering-centroid").transition(_b).style.display="none",$b.selectAll(".cluster-hull").transition(_b).style.display="none",setTimeout(function(){$b.selectAll(".clustering-centroid").remove(),$b.selectAll(".cluster-hull").remove(),ya()},jd);for(var a in Tc)Tc[a].ci=void 0}function Ga(a){3==Ac&&(Nc?(clearInterval(Nc),Nc=void 0,a.innerHTML="&#9654",zc.removeAttribute("disabled")):Ia())}function Ha(){3==Ac&&(Nc?(clearInterval(Nc),Nc=void 0,this.innerHTML="&#9654",zc.removeAttribute("disabled")):(Nc=setInterval(Ia,1e3),this.innerHTML="&#9613&#9613",zc.setAttribute("disabled",!0)))}function Ia(){if(0==Mc){Lc=!0;var a=document.getElementById("num-clusters"),b=parseInt(a.value);(isNaN(b)||b<2)&&(b=3);var c={};for(var d in Sc)c[Sc[d].x+"_"+Sc[d].y]=1;for(;b>Object.keys(c).length;)b--;a.value=b,a.readOnly=!0,Uc=[],Vc=null;var e,f;for(e=0,f=0;e<b;e++)if(f<Jc.length)Uc[e]=Ja(null,Jc[f++]);else{for(var g;!g;)g=Gc[Math.floor(bc.random()*Gc.length)],g=Jc.includes(g)?void 0:g;Uc[e]=Ja(null,g)}Ka(),document.getElementById("clustering").innerHTML=Yb.randcentroids,document.getElementById("dragdrop").innerHTML=Yb.dragoff,document.getElementById("clustering").style.color="black";var h=Sa(Mc);id.iteration=Mc,Ta(h)}else Pa(Mc),Va(jd);Mc++,document.getElementById("clustering").innerHTML==Yb.convergence&&(clearInterval(Nc),Nc=void 0,zc.removeAttribute("disabled"),document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0)}function Ja(a,b){var c,d,e,f,g=100,h=dc-g,i=g,j=ec-g,k=g,l=0;if(a)for(;l<100;)c=Math.floor(Math.random()*(h-i)+i),d=Math.floor(Math.random()*(j-k)+k),e=c-a.x,f=d-a.y,l=Math.sqrt(e*e+f*f);else c=Math.floor(Math.random()*(h-i)+i),d=Math.floor(Math.random()*(j-k)+k);return{x:c,y:d,colour:b}}function Ka(){$b.selectAll(".clustering-centroid").remove();var a,b,c,d=14;for(a=0;a<Uc.length;a++)b=Uc[a].x,c=Uc[a].y,cc.append("line").attr("class","clustering-centroid").attr("id","cluster1-"+a).attr("x1",b-d).attr("y1",c-d).attr("x2",b+d).attr("y2",c+d).style("stroke",Uc[a].colour).style("stroke-width","5px").on("click",oa).on("click.centroidClick",pb.bind(this,-1*(a+1),a,!0)).on("mouseover",Ma.bind(this,a,!1)),cc.append("line").attr("class","clustering-centroid").attr("id","cluster2-"+a).attr("x1",b+d).attr("y1",c-d).attr("x2",b-d).attr("y2",c+d).style("stroke",Uc[a].colour).style("stroke-width","5px").on("click",oa).on("click.centroidClick",pb.bind(this,-1*(a+1),a,!0)).on("mouseover",Ma.bind(this,a,!1))}function La(a,b,c){var d,e,f,g,h,i,j={};for(d in a)for(i=qc[0];i<nc.edges[d].length&&i<=qc[1];i++)e=nc.edges[d][i],"string"==typeof e.source?(f=parseInt(e.source),g=parseInt(e.target)):(f=e.source.id,g=e.target.id),b[f]||b[g]||(h=f+"_"+g,f>g&&(h=g+"_"+f),j[h]?j[h][d]?j[h][d]++:j[h][d]=1:(j[h]={},j[h][d]=1));var k,l,m=[];for(k in j)if(Object.keys(j[k]).length==c){var n=Number.MAX_SAFE_INTEGER;for(l in j[k])n>j[k][l]&&(n=j[k][l]);var o=k.split("_");m[m.length]={source:o[0],target:o[1],weight:n,colour:"black"}}for(i=0;i<nc.links.length;i++)m[m.length]=nc.links[i];return m}function Ma(a,b){hc.remove(),Wc=!0,Xc=!1,Yc=!0,cc.on("click",Na);var c,d={};if(b){var e=la();for(c in td[e])td[e][c]==a&&(d[c]=c)}else for(c in Tc)Tc[c].ci==a&&(d[c]=c);var f,g=Object.keys(d).length,h={};for(f=0;f<nc.nodes.length;f++)nc.nodes[f].visible||(h[nc.nodes[f].id]=1);var i=La(d,h,g);gc.style("display","block").style("opacity",1).on("mouseover",n).on("mouseout",q),fc.force("link").links(i),m(i),hc.on("mouseover",Oa).on("mouseout",q),fc.restart(),setTimeout(function(){fc.stop(),hc.lower(),$b.selectAll(".cluster-hull").lower()},10)}function Na(){Wc=!1,Xc=!0,Yc=!1,hc.remove(),gc.style("display","none").on("mouseover",null).on("mouseout",null),cc.on("click",null)}function Oa(a){"black"==a.colour&&(hc.on("mouseover",null),gc.on("mouseover",null).on("mouseout",null),$b.selectAll(".clustering-centroid").on("mouseover",null),n(a.source),Zc=!0,n(a.target,!0),Zc=!1)}function Pa(a){if(document.getElementById("clustering").innerHTML!=Yb.convergence){if(0==Object.keys(Tc).length)return void(document.getElementById("clustering").innerHTML=Yb.convergence);var b,c,d,e,f=Yb.iteration+": "+a;for(b in Tc)Tc[b].ci=lb(Tc[b]);var g=[];for(c=0;c<Uc.length;c++)g[c]=Qa(c);Vc=Uc,Uc=g;var h=!1;if(Vc){var i=0;for(c=0;c<Uc.length;c++)d=Vc[c].x-Uc[c].x,e=Vc[c].y-Uc[c].y,i+=Math.sqrt(d*d+e*e);i<=bd&&(f=Yb.convergence,document.getElementById("clustering").style.color="green",h=!0)}document.getElementById("clustering").innerHTML=f,document.getElementById("dragdrop").innerHTML=a>0&&!h?Yb.dragon:Yb.dragoff;var j=Sa(a);id.iteration=h?-1:a,Ta(j)}}function Qa(a){var b,c=[],d={};for(b in Tc)Tc[b].ci==a&&(c[c.length]=[Tc[b].x,Tc[b].y],d[Tc[b].x+"_"+Tc[b].y]={x:Tc[b].x,y:Tc[b].y,colour:Uc[a].colour});if(cc.selectAll("#hull-"+a).remove(),$(d,a,!1,!1),cc.selectAll(".centroid").raise(),cc.selectAll(".clustering-centroid").raise(),0==Object.keys(d).length)return Ja(Uc[a],Uc[a].colour);var e=Ra(c);return e.colour=Uc[a].colour,e}function Ra(a){if(0==a.length)return null;var b,c=0,d=0;for(b=0;b<a.length;b++)c+=a[b][0],d+=a[b][1];return{x:c/a.length,y:d/a.length}}function Sa(a){var b=Yb.numstudents+": "+Object.keys(Tc).length+"<br>"+Yb.numofclusters+": "+Uc.length+"<br>"+Yb.iteration+": "+a+"<br>";document.getElementById("clustering")&&document.getElementById("clustering").innerHTML==Yb.convergence&&(b+='<span style="color:green">'+Yb.convergence+"</span><br>");var c,d,e,f,g,h,i=[];for(c=0;c<Uc.length;c++){d=Uc[c].x-dc/2,e=Uc[c].y-ec/2,f=Math.sqrt(d*d+e*e),h=Uc[c].colour,b+=Yb.disttocluster+' <span style="color:'+h+'">'+h+"</span>: "+Math.round(f,2)+"<br>"+Yb.cluster+" "+h+" "+Yb.members+": [",i[c]=[];for(g in Tc)Tc[g].ci==c&&(b+=g+", ",i[c][i[c].length]=g);-1!=b.indexOf(",",b.length-3)&&(b=b.slice(0,-2)),b+="]<br>"}return b+="<br>",Cc.innerHTML=b+Cc.innerHTML,i}function Ta(a){var b,c,d,e={clusterCoords:[]};for(b=0;b<a.length;b++)for(e.clusterCoords[b]=Ua(Uc[b]),e.clusterCoords[b].num=b,c=0;c<a[b].length;c++)d=Ua(Tc[a[b][c]]),a[b][c]={id:Wb[a[b][c]],num:b,x:d.x,y:d.y};e.members=a,e.iteration=id.iteration,e.clusterId=id.clusterId,e.coordsid=Ub,e.usegeometric=qd?1:0,(0!=qc[0]||qc[1]!=nc.maxSession)&&e.iteration<0&&(e.iteration=Mc),x(rb,e)}function Ua(a){var b=(a.x-dc/2)/id.scale+id.centre.x,c=(a.y-ec/2)/id.scale+id.centre.y;return b=(b-id.originalx)/id.distance,c=(c-id.originaly)/id.distance,{x:b,y:c}}function Va(a){var b,c,d,e=14;for(b=0;b<Uc.length;b++)c=Uc[b].x,d=Uc[b].y,$b.select("#cluster1-"+b).transition().duration(a).attr("x1",c-e).attr("y1",d-e).attr("x2",c+e).attr("y2",d+e),$b.select("#cluster2-"+b).transition().duration(a).attr("x1",c+e).attr("y1",d-e).attr("x2",c-e).attr("y2",d+e)}function Wa(a,b){zc=document.getElementById("cluster-slider"),ac.create(zc,{start:[1],handles:1,range:{min:1,max:3},step:1,orientation:"vertical",direction:"rtl",pips:{mode:"steps",stepped:!0,density:100,filter:function(){return 1},format:{to:function(b){switch(b){case 1:return Yb.showcentroids;case 2:return Yb.removegraph;case 3:return a;default:return""}},from:function(){return""}}}}),zc.noUiSlider.on("update",Ya),zc.style="margin-top: 20px;";var c=sc.getBoundingClientRect().height,d=b.getBoundingClientRect().height;zc.style.height=ec-c-d-120+"px";var e=document.createElement("input");e.type="radio",e.name="centroid-type",e.value="geometric",e.style="margin-top: 40px",e.checked=!0,e.addEventListener("click",Xa);var f=document.createElement("label");f.appendChild(e),f.appendChild(document.createTextNode(Yb.geometrics)),zc.appendChild(f),0==Object.keys(Ib).length&&(e=document.createElement("input"),e.type="radio",e.name="centroid-type",e.value="decomposed",e.addEventListener("click",Xa),f=document.createElement("label"),f.appendChild(e),f.appendChild(document.createTextNode(Yb.decomposed)),zc.appendChild(f))}function Xa(){qd="geometric"==this.value,cc.selectAll(".centroid").remove();var a,b=[],c=0;for(a in Sc)b[c++]={value:a,selected:!0,colour:Sc[a].colour};qd?Z(b):Y(b),aa()}function Ya(a,b){var c,d;switch(parseInt(a[b])){case 1:if(3==Ac){zc.noUiSlider.set(2);break}if(Ac=1,Za(),!Lc){c=document.getElementsByName("centroid-type");for(d in c)c[d].disabled=!1}break;case 2:Ac=2,$a(),c=document.getElementsByName("centroid-type");for(d in c)c[d].disabled=!0;document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("dragdrop").innerHTML==Yb.dragon&&(document.getElementById("dragdrop").innerHTML="--");break;case 3:if(1==Ac){zc.noUiSlider.set(2);break}if(Ac=3,_a(),!Lc){var e='<input type="text" placeholder="'+Yb.numclusters+'" id="num-clusters" size="8" pattern="[0-9]{1,2}">';document.getElementById("cluster-text").innerHTML=e}document.getElementById("play-pause").disabled=!1,document.getElementById("play-step").disabled=!1,document.getElementById("clustering").innerHTML==Yb.convergence&&(document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0),"--"==document.getElementById("dragdrop").innerHTML&&(document.getElementById("dragdrop").innerHTML=Yb.dragon)}}function Za(){T(!1),gc.on("mouseover",null).on("mouseout",null),ab(1,0,0,jd),setTimeout(function(){$b.selectAll(".centroid").raise()},100)}function $a(){gc.transition(_b).style("opacity",0),hc.transition(_b).style("opacity",0),$b.selectAll(".clustering-centroid").transition(_b).style("opacity",0),$b.selectAll(".cluster-hull").transition(_b).style("opacity",0),setTimeout(function(){gc.style("display","none"),hc.style("display","none"),$b.selectAll(".clustering-centroid").style("display","none"),$b.selectAll(".cluster-hull").style("display","none")},jd),!Lc&&document.getElementById("cluster-text")&&(document.getElementById("cluster-text").innerHTML=Yb.numclusters);var a=bb();null!==a&&(id.scale=a[2],wc=a,setTimeout(function(){ab(a[2],a[0],a[1],jd)},jd/2))}function _a(){$b.selectAll(".clustering-centroid").transition(_b).style("display","block").style("opacity",1),$b.selectAll(".cluster-hull").transition(_b).style("display","block").style("opacity",1),$b.selectAll(".clustering-centroid").raise()}function ab(a,b,c,d){var e,f,g,h,i,j,k=14,l=dc/2,m=ec/2;if(!Tc){Tc={};for(j in Sc)Tc[j]={x:0,y:0}}id.centre={x:b,y:c};for(j in Sc)e=Sc[j].x,f=Sc[j].y,g=(e-b)*a,h=(f-c)*a,1==a&&0==b&&0==c?(e=b+g,f=c+h):(e=l+g,f=m+h),Tc[j].x=e,Tc[j].y=f,i=e+","+(f-k)+" "+(e+k)+","+(f+k)+" "+(e-k)+","+(f+k),$b.select("#centroid-"+j).transition().duration(d).attr("points",i);var n=function(a,b){return a*=id.distance,a+=id.originalx,b*=id.distance,b+=id.originaly,a-=id.centre.x,a*=id.scale,a+=dc/2,b-=id.centre.y,b*=id.scale,b+=ec/2,{x:a,y:b}};for(j in sd){var o=n(sd[j].x,sd[j].y);e=o.x,f=o.y,$b.select("#server-centroid-"+j).transition().duration(d).attr("cx",e).attr("cy",f)}}function bb(){var a,b=[];if(tc)return cb();for(a in Sc)b[b.length]=[Sc[a].x,Sc[a].y];var c=db(b);if(null===c)return null;var d,e,f,g,h=[c.x,c.y],i=0,j=0;for(a in Sc)d=Math.abs(Sc[a].x-h[0]),e=Math.abs(Sc[a].y-h[1]),d>i&&(i=d,f=a),e>j&&(j=e,g=a);if(void 0===g&&void 0===f)return h[2]=1,h;var k=Sc[f].x-h[0]+dc/2,l=Sc[f].y-h[1]+ec/2,m=eb(k,l,dc/2,ec/2);k=Sc[g].x-h[0]+dc/2,l=Sc[g].y-h[1]+ec/2;var n=eb(k,l,dc/2,ec/2);return h[2]=m<n?m:n,h[2]*=.9,h}function cb(){var a,b=[],c=0,d=0;for(a in vc)if(!(a>=0&&1!=a))for(var e in vc[a])for(var f in vc[a][e].members)c=vc[a][e].members[f].x,c=c*Jb+id.originalx,d=vc[a][e].members[f].y,d=d*Jb+id.originaly,b[b.length]=[c,d];var g=db(b);if(null===g)return null;var h,i,j,k,l,m=[g.x,g.y],n=0,o=0;for(l=0;l<b.length;l++)h=Math.abs(b[l][0]-m[0]),i=Math.abs(b[l][1]-m[1]),h>n&&(n=h,j=l),i>o&&(o=i,k=l);if(void 0===k&&void 0===j)return m[2]=1,m;var p=b[j][0]-m[0]+dc/2,q=b[j][1]-m[1]+ec/2,r=eb(p,q,dc/2,ec/2);p=b[k][0]-m[0]+dc/2,q=b[k][1]-m[1]+ec/2;var s=eb(p,q,dc/2,ec/2);return m[2]=r<s?r:s,m[2]*=.9,m}function db(a){if(0==a.length)return null;if(1==a.length)return{x:a[0][0],y:a[0][1]};var b,c,d,e=0,f=0,g=dc,h=ec;for(b=0;b<a.length;b++)c=a[b][0],d=a[b][1],c>e&&(e=c),c<g&&(g=c),d>f&&(f=d),d<h&&(h=d);return{x:(e+g)/2,y:(f+h)/2}}function eb(a,b,c,d){var e=a-c,f=b-d,g=e>0?dc:0,h=f>0?ec:0,i=(g-dc/2)/e,j=(h-ec/2)/f;return isFinite(i)&&isFinite(j)&&i<=j?i:isFinite(i)&&!isFinite(j)?i:isFinite(j)?j:1}function fb(){var a=document.getElementById("log-panel");a.style.width=Cb+"px";var b=document.createElement("button");b.innerHTML=Yb.copy,b.addEventListener("click",function(){window.getSelection().selectAllChildren(Cc),document.execCommand("copy")}),_c?b.style.marginLeft="10px":(b.style.position="absolute",b.style.right=Cb-40+"px"),a.appendChild(b);var c=document.createElement("button");c.innerHTML=Yb.print,c.addEventListener("click",function(){var a=window.open();a.document.write("<html><head></head><body>"),a.document.write(Cc.innerHTML),a.document.write("</body></html>"),a.print(),a.close()}),_c?c.style.marginLeft="10px":(c.style.position="absolute",c.style.right=Cb-100+"px"),a.appendChild(c),Cc=document.createElement("div"),Cc.readOnly=!0,Cc.style.overflow="scroll",Cc.style.width="200px",Cc.style.height=ec+"px",Cc.style.resize="none",Cc.style.border="2px solid black",_c||(Cc.style.position="absolute",Cc.style.right="6px",Cc.style.top="60px"),a.appendChild(Cc)}function gb(){var a;for(a in Sc)cc.append("polygon").attr("class","centroid").attr("id","centroid-"+a).attr("points",hb(Sc[a].x,Sc[a].y)).style("stroke","black").style("stroke-width","3px").style("fill",Sc[a].colour).call($b.drag().on("start",ib.bind(this,a)).on("drag",jb.bind(this,a)).on("end",kb.bind(this,a))).on("mouseout",nb).on("mouseover",ob.bind(this,a)).on("click",oa).on("click.centroidClick",pb.bind(this,Wb[a],a,!1));if(rd)for(a in sd){var b=sd[a].x*id.distance+id.originalx,c=sd[a].y*id.distance+id.originaly;cc.append("circle").attr("class","server-centroid").attr("id","server-centroid-"+a).attr("r",5).attr("cx",b).attr("cy",c).style("fill","black")}}function hb(a,b){var c=14;return a+","+(b-c)+" "+(a+c)+","+(b+c)+" "+(a-c)+","+(b+c)}function ib(a){mb()&&(md=Date.now(),cc.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+a).attr("points",hb($b.event.x,$b.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Sc[a].colour).style("opacity",.5))}function jb(a){mb()&&$b.select("#dragged-"+a).attr("points",hb($b.event.x,$b.event.y))}function kb(a){if($b.selectAll(".dragged-centroid").remove(),mb()){if(Date.now()-md<300)return void pb(Wb[a],a,!1);Tc[a].ci=lb($b.event);for(var b=[],c=0;c<Uc.length;c++)b[c]=Qa(c);Vc=Uc,Uc=b,Va(jd);var d=Yb.iteration+": "+Mc;document.getElementById("clustering").innerHTML=d,document.getElementById("dragdrop").innerHTML=Yb.dragon;var e=Sa(Mc);id.iteration=Mc++,Ta(e)}}function lb(a){for(var b,c,d,e=Number.MAX_SAFE_INTEGER,f=-1,g=0;g<Uc.length;g++)c=a.x-Uc[g].x,d=a.y-Uc[g].y,(b=Math.sqrt(c*c+d*d))<e&&(e=b,f=g);return f}function mb(){if(!Uc||!document.getElementById("clustering"))return!1;if(document.getElementById("clustering").innerHTML==Yb.convergence)return!1;for(var a in Tc)if(void 0===Tc[a].ci)return!1;return 3==Ac}function nb(){Wc||($b.selectAll(".text").remove(),$b.selectAll("rect").remove(),Lc&&(tc||3==Ac)&&null!==la()&&(gc.style("display","none").style("opacity",0),hc.remove()))}function ob(a){if(!Wc){$b.selectAll(".text").remove(),$b.selectAll("rect").remove();var b=cc.append("rect"),c=[0],d=1==Ac?Sc:Tc,e=a;wb.forEach(function(b){b.id==a&&(e=1==ad?b.firstname+" "+b.lastname:b.id)});var f=1==ad?70:30,g=cc.append("text").attr("class","text").attr("id","t-"+a).attr("y",d[a].y+32).attr("dy",".40em").style("pointer-events","none").text(e).call(o,f,d[a].x-(f+6)/2+8,c),h=18*c[0]+16;if(h+d[a].y+10>=ec&&g.attr("y",ec-h-(ec-d[a].y)).text(e).call(o,f,d[a].x-(f+6)/2+8,c),b.attr("id","r-"+a).attr("x",d[a].x-(f+6)/2).attr("y",h+d[a].y+10<=ec?d[a].y+16:ec-h-16-(ec-d[a].y)).attr("width",f+16).attr("height",h).style("stroke","black").style("fill","yellow"),Lc&&(tc||3==Ac)&&null!==la()){hc.remove();var i,j={};for(i=0;i<nc.nodes.length;i++)nc.nodes[i].visible||(j[nc.nodes[i].id]=1);var k,l,n,p,q={};for(i=qc[0];i<nc.edges[a].length&&i<=qc[1];i++)k=nc.edges[a][i],"string"==typeof k.source?(l=parseInt(k.source),n=parseInt(k.target)):(l=k.source.id,n=k.target.id),j[l]||j[n]||(p=l+"_"+n,q[p]?q[p]++:q[p]=1);var r,s=[],t=nc.edges[a][0].colour;for(k in q)r=k.split("_"),s[s.length]={source:r[0],target:r[1],weight:q[k],colour:t};for(i=0;i<nc.links.length;i++)s[s.length]=nc.links[i];fc.force("link").links(s),m(s),gc.style("display","block").style("opacity",1),fc.restart(),setTimeout(function(){fc.stop(),gc.lower(),hc.lower()},1)}}}function pb(a,b,c){if(Lc&&!document.getElementById("textbox-"+a)&&null!==la()&&(tc||!Lc||3==Ac)){var d=document.createElement("textarea");d.id="textbox-"+a,d.style.resize="both",d.style.position="absolute",Vb[a]&&(d.value=Vb[a]),nd!=Lb&&(d.readOnly=!0),document.body.appendChild(d);var e,f=d.getBoundingClientRect(),g=document.getElementsByTagName("svg")[0].getBoundingClientRect(),h=c?Uc[b].x:Tc[b].x;e=h+f.width/2>=dc?h+g.x-f.width:h-f.width/2<=0?h+g.x:h+g.x-f.width/2,d.style.left=e+"px";var i=c?Uc[b].y:Tc[b].y,j=i+190>=ec?i+140:i+290;c&&(j=i+165>=ec?i+165:i+265),d.style.top=j+"px";var k=document.createElement("button");k.innerHTML=nd==Lb?Yb.save:Yb.close,k.id=a,k.style.position="absolute",k.style.left=e+"px",k.style.top=j+f.height+"px",document.body.appendChild(k),d.focus(),d.addEventListener("click",function(){this.parentNode.appendChild(this),k.parentNode.appendChild(k),this.focus()});var l=!1;d.addEventListener("mousedown",function(){l=!0}),d.addEventListener("mouseup",function(){l=!1}),d.addEventListener("mousemove",function(){l&&(f=this.getBoundingClientRect(),k.style.left=e+"px",k.style.top=j+f.height+"px")}),k.addEventListener("click",function(){if(nd==Lb){var b={coordsid:Ub,clusterid:id.clusterId,studentid:a,remark:d.value};""!=d.value&&d.value!=Vb[a]&&(Vb[a]=d.value,x(sb,b))}document.body.removeChild(d),document.body.removeChild(k)})}}var qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,sd,td={},ud=[];b(a)}});