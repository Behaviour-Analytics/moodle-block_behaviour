/*! moodle-block_behaviour v0.6.2 22-09-2020 */
!function(a){"function"==typeof define&&define.amd?define([],a):window.behaviourAnalytics=a()}(function(){return function(a){function b(a){qb=a.logs,rb=a.users,sb=a.mods,tb=a.panelwidth,ub=a.legendwidth,vb=a.name,wb=a.iframeurl,Qc=a.version36,xb=a.positioning,yb=a.nodecoords,Ab=a.courseid,Bb=a.userid,zb=a.scale,Cb=a.graphs,Db=a.scales,Eb=a.changes,Fb=a.names,Gb=a.allmods,Hb=a.setnames,Ib=Bb,Jb=a.lastchange,Kb=a.comments,Nb=a.strings,mb=a.coordsscript,nb=a.clustersscript,ob=a.commentsscript,pb=a.manualscript,Ob=a.sesskey,$c=a.gotallnodes,ic=a.replaying,fd=a.debugcentroids,gd=a.centroids,cd=a.isresearcher,bd=Bb,Pb=window.dataDrivenDocs,Rb=window.noUiSlider;var b=window.mersenneTwister;Sb=new b(259),wc=0,vc=c(),Sc=Date.now()+3e3,Zc=1e3,Qb=Pb.transition().duration(Zc).ease(Pb.easeLinear),qc=120,Rc=1,bc=1e-4,$b=1,Wc=J,Dc=!1,Ec=220,Gc=.15,Fc=Pb.curveCatmullRomClosed,tc={},Yc={},xc={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown",data:"coral",chat:"maroon",choice:"grey",feedback:"lime",glossary:"navy",survey:"tan",wiki:"teal",workshop:"silver",scorm:"tomato",imscp:"lightpink",folder:"peru"},yc=["blue","red","orange","green","yellow","brown","purple","magenta","cyan"],gc=xb?0:36,tb=xb?0:tb,Ub=window.innerWidth-qc-ub-150,Vb=window.innerHeight-gc-90,Xc=Math.min(Ub,Vb)<500?6:8,Lb={},rb.forEach(function(a){Lb[a.id]=a.realId}),d(),e(),ic?_(a.replaydata,a.manualdata):xb?h():j()}function c(){return["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"]}function d(){sb.forEach(function(a){for(;!xc[a.entype];){var b=vc[Math.floor(Sb.random()*vc.length)],c=!0;for(var d in xc)xc[d]==b&&(c=!1);xc[a.entype]=c?b:void 0}})}function e(){cc={nodes:[],links:[],edges:{},maxSession:0},f(),g()}function f(){var a,b,c,d=cc,e={};sb.forEach(function(f){a=!0,b=void 0,c=void 0,yb[f.id]?(a=1==yb[f.id].visible&&1==yb["g"+f.sect].visible,1!=yb[f.id].visible||a||(yb[f.id].visible=0),b=yb[f.id].xcoord,c=yb[f.id].ycoord):yb["g"+f.sect]&&(a=1==yb["g"+f.sect].visible&&Bb==Ib),d.nodes[d.nodes.length]={id:f.id,name:f.name,group:f.sect,type:f.type,entype:f.entype,colour:xc[f.entype],visible:a,xcoord:b,ycoord:c},e[f.sect]||(yb["g"+f.sect]&&(a=1==yb["g"+f.sect].visible,b=yb["g"+f.sect].xcoord,c=yb["g"+f.sect].ycoord),e[f.sect]={id:"g"+f.sect,name:Nb.section+" "+f.sect,group:f.sect,type:"grouping",colour:xc.grouping,visible:a,xcoord:b,ycoord:c},d.nodes[d.nodes.length]=e[f.sect]),d.links[d.links.length]={source:"g"+f.sect,target:f.id,weight:$b,colour:xc.originalLinks}}),b=c=void 0,yb.root&&(b=yb.root.xcoord,c=yb.root.ycoord);var f={id:"root",name:vb,group:-1,type:"grouping",colour:xc.grouping,visible:!0,xcoord:b,ycoord:c};if(Object.keys(e).length>1)for(var g in e)d.links[d.links.length]={source:"root",target:e[g].id,weight:$b,colour:xc.originalLinks};else d.nodes=d.nodes.filter(function(a){return"g0"!=a.id}),d.links.forEach(function(a){"g0"==a.source&&(a.source="root")});d.nodes[d.nodes.length]=f}function g(){var a,b=cc,c=0,d=0;dd={};for(var e=0;e<qb.length;e++)a={source:qb[e].moduleId,target:qb[e].moduleId,weight:$b,user:qb[e].userId,colour:""},b.edges[qb[e].userId]||(b.edges[qb[e].userId]=[],dd[qb[e].userId]=[],b.maxSession=b.maxSession<c?c:b.maxSession,c=0,d=0),yb[qb[e].moduleId]&&1==yb[qb[e].moduleId].visible&&(dd[qb[e].userId][d++]=qb[e].moduleId),e+1<qb.length&&qb[e].userId==qb[e+1].userId?(a.target=qb[e+1].moduleId,b.edges[qb[e].userId][c++]=a):0==b.edges[qb[e].userId].length&&(b.edges[qb[e].userId][c++]=a);b.maxSession=b.maxSession<c?c:b.maxSession,rb.forEach(function(a){b.edges[a.id]||(b.edges[a.id]=[])})}function h(){zc=!1,_b=.01,ac=.01,Tc=K,Uc=L,Vc=M,$c&&Object.keys(yb).length>0&&($b=0),Cb&&Db&&y(),k(.6),D(),i(),setTimeout(function(){Wb.force("charge",null).force("x",null).force("y",null)},500)}function i(){var a=document.getElementById("student-menu"),b=document.createElement("input");b.id="weight-slider",b.type="range",b.min="-0.2",b.max="2",b.step="0.2",b.value="0.6",b.style.width="130px",b.addEventListener("change",function(){Zb.strength(this.value),document.getElementById("weights-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(b);var c=document.createTextNode(Nb.linksweight);a.appendChild(c),c=document.createElement("label"),c.id="weights-output",c.innerHTML="&nbsp;= "+b.value,a.appendChild(c)}function j(){zc=!0,xb=!0,_b=0,Tc=null,Uc=null,Vc=null,$c&&0!=Object.keys(yb).length?(N(),k(0),P()):(k(.6),setTimeout(function(){N(),P()},500)),Zb=null}function k(a){Tb=Pb.select("#graph").append("svg").attr("width",Ub).attr("height",Vb),Zb=Pb.forceLink(cc.links).id(function(a){return a.id}).strength(a),Wb=Pb.forceSimulation(cc.nodes).force("link",Zb).force("charge",Pb.forceManyBody().strength(-80)).force("collide",Pb.forceCollide().radius(12)).force("center",Pb.forceCenter(Ub/2,Vb/2)).force("x",Pb.forceX()).force("y",Pb.forceY()),l(cc.nodes,Wc,Tc,Uc,Vc),m(cc.links),Tb.on("click",function(){Pb.selectAll("#rctext").remove(),Pb.selectAll("#rcrect").remove(),(zc||xb)&&Xb.on("mouseover",n).on("mouseout",q),ic&&Xb.on("mouseover",null).on("mouseout",null)}),$c&&xb&&Object.keys(yb).length>0?Wb.on("tick",s):Wb.on("tick",t);for(var b=0;b<80;b++)Wb.tick();xb&&setTimeout(function(){Wb.stop(),Wb.on("tick",t),u(),0!=Object.keys(yb).length&&$c||(v(),cc.edges={},g(),$c=!0,$b=zc?1:0)},500),zc&&!$c&&setTimeout(function(){cc.nodes=[],cc.links=[],f()},600)}function l(a,b,c,d,e){Xb=Tb.selectAll(".node").data(a).enter().append("circle").attr("class","node").attr("r",Xc).on("mouseover",n).on("mouseout",q).on("contextmenu",b).call(Pb.drag().on("start",c).on("drag",d).on("end",e))}function m(a){Yb=Tb.selectAll(".link").data(a).enter().append("line").attr("class","link").style("stroke",function(a){return a.colour}).style("stroke-width",function(a){return 2*a.weight+"px"})}function n(a,b){if(!(Mc||(Xb.on("mouseover",null),b||(Pb.selectAll(".text").remove(),Pb.selectAll("rect").remove()),Date.now()-Sc<150))){var c=[0],d=!1,e=!1,f=!1,g=150,h=304,i=154,j=a.type+": "+a.name;Nc&&(h=0,i=0);var k=Tb.append("text").attr("class","text").attr("id","t-"+a.id).attr("y",a.y+32).attr("dy",".40em").style("pointer-events","none").text(j).call(o,g,a.x-(g+6)/2+8,c),l=16*c[0]+16;l+a.y>=Vb-i&&(k.attr("y",Vb-l-(Vb-a.y)).text(j).call(o,g,a.x-(g+6)/2+8,c),d=!0),a.x<=h/2?(k.text(j).call(o,g,a.x+8,c),f=!0):a.x>=Ub-h/2&&(k.text(j).call(o,g,a.x-(g+6)+8,c),e=!0);var m;m=f?a.x:e?a.x-(g+6):a.x-(g+6)/2;var n=Tb.append("rect").attr("id","r-"+a.id).attr("x",m).attr("y",d?Vb-l-16-(Vb-a.y):a.y+16).attr("width",g+16).attr("height",l).style("stroke","black").style("fill","yellow");k.raise(),isNaN(a.id)||(Nc&&(h=400,i=300),p(a,l,g,h,i,d,f,e,parseInt(n.attr("x")),parseInt(n.attr("y"))))}}function o(a,b,c,d){var e=0;a.each(function(){var a,d=Pb.select(this),f=d.text().split(/\s+/).reverse(),g=[],h=d.attr("y"),i=parseFloat(d.attr("dy")),j=d.text(null).append("tspan").attr("x",c).attr("y",h).attr("dy",i+"em");for(a=f.pop();a;)g.push(a),j.text(g.join(" ")),j.node().getComputedTextLength()>b&&(g.pop(),j.text(g.join(" ")),g=[a],j=d.append("tspan").attr("x",c).attr("y",h).attr("dy",1.1*++e+i+"em").text(a)),a=f.pop()}),d[0]=++e}function p(a,b,c,d,e,f,g,h,i,j){var k=document.createElement("iframe");k.id="preview",k.style.position="absolute",k.style.width=d+"px",k.style.height=e+"px";var l=document.getElementsByTagName("svg")[0].getBoundingClientRect(),m=document.body.getBoundingClientRect();m.x>0&&(m.x=0),k.style.left=Oc?window.innerWidth-10-d+"px":Nc?"10px":g?i+l.x+"px":h?i+l.x+c-d+18+"px":i+l.x-d/2+c/2+"px";var n=Qc?0:50;if(k.style.top=Nc?l.y-m.y+Vb/2+"px":f?n+j+l.y-m.y-e+"px":n+j+l.y+b-m.y+"px","lti"!=a.entype){var o=document.createElement("div");o.id="bgrnd",o.style.position="absolute",o.style.width=parseInt(k.style.width)+24+"px",o.style.height=parseInt(k.style.height)+24+"px",o.style.left=parseInt(k.style.left)-12+"px",o.style.top=parseInt(k.style.top)-12+"px",o.addEventListener("mouseout",function(a){var b=this.getBoundingClientRect();a.x>b.x&&a.x<b.x+b.width&&a.y>b.y&&a.y<b.y+b.height||(Pc=!1,setTimeout(r,750))}),o.addEventListener("mouseover",function(){Pc=!0}),k.src=wb+"/mod/"+a.entype+"/view.php?id="+a.id,document.body.appendChild(o),document.body.appendChild(k)}}function q(a){Mc||"lightgrey"==a.colour||(Xb.on("mouseout",null),Yb.on("mouseout",null),setTimeout(r,750))}function r(){if(!Pc&&(Pb.selectAll(".text").remove(),Pb.selectAll("rect").remove(),Pb.selectAll("#preview").remove(),Pb.selectAll("#bgrnd").remove(),Xb.on("mouseover",n).on("mouseout",q),Nc)){Yb.on("mouseover",La).on("mouseout",q);for(var a=0;a<Jc.length;a++)Pb.select("#cluster1-"+a).on("mouseover",Ja.bind(this,a,!1)),Pb.select("#cluster2-"+a).on("mouseover",Ja.bind(this,a,!1))}}function s(){var a=Ub/2,b=Vb/2,c=zb;void 0===Yc.originalx?(Yc.originalx=a,Yc.originaly=b):(a=Yc.originalx,b=Yc.originaly);for(var d,e,f=0;f<cc.nodes.length;f++)d=cc.nodes[f].xcoord*c+a,e=cc.nodes[f].ycoord*c+b,(d<0||d>Ub||e<0||e>Vb)&&(c*=.9,--f);zb=c,Yc.distance=c,Yb.attr("x1",function(d){var e=cc.nodes.filter(function(a){var b="string"==typeof d.source?d.source:d.source.id;return a.id==b})[0];return Pb.select(this).attr("y1",e.ycoord*c+b),e.xcoord*c+a}).attr("x2",function(d){var e=cc.nodes.filter(function(a){var b="string"==typeof d.target?d.target:d.target.id;return a.id==b})[0];return Pb.select(this).attr("y2",e.ycoord*c+b),e.xcoord*c+a}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}),Xb.attr("cx",function(b){return b.x=b.xcoord*c+a,b.x}).attr("cy",function(a){return a.y=a.ycoord*c+b,a.y}).style("display",function(a){return a.visible?"block":"none"}).style("fill",function(a){return a.colour}).raise()}function t(){var a=Xc;Yb.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).style("stroke-width",function(a){return 2*a.weight+"px"}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}),Xb.attr("cx",function(b){return b.x=Math.max(a,Math.min(Ub-a,b.x)),b.x}).attr("cy",function(b){return b.y=Math.max(a,Math.min(Vb-a,b.y)),b.y}).style("fill",function(a){return a.colour}).style("display",function(a){return a.visible?"block":"none"}).raise(),Pb.selectAll("rect").raise(),Pb.selectAll("text").raise()}function u(){if(Fb){Pb.select("#time").remove(),0==Jb&&(Jb=Date.now());var a=new Date;a.setTime(Jb);var b=a.getMinutes();b<10&&(b="0"+b),Tb.append("text").attr("id","time").attr("y",Vb-16).attr("dy",".40em").attr("x",6).style("pointer-events","none").text(Fb[Ib]+" "+a.getHours()+":"+b+" "+a.toDateString())}}function v(){var a=w();if(Cb&&Db){var b={};for(var c in a)"scale"!=c&&"module"!=c&&(b[c]=a[c]);Cb[Bb]=b,Db[Bb]=a.scale}a.time=Date.now(),Jb=a.time,Eb&&(Eb[Bb]=a.time),x(mb,a)}function w(){var a,b,c,d,e={},f=0,g=Ub/2,h=Vb/2;return cc.nodes.forEach(function(e){a=e.x-g,b=e.y-h,(c=Math.sqrt(a*a+b*b))>f&&(f=c,d=e)}),e.scale=f,e.module=d.id,zb=f,cc.nodes.forEach(function(a){e[a.id]={xcoord:""+(a.x-g)/f,ycoord:""+(a.y-h)/f,visible:a.visible?1:0},a.xcoord||(a.xcoord=(a.x-g)/f,a.ycoord=(a.y-h)/f)}),yb=e,e}function x(a,b){var c=new XMLHttpRequest;c.open("POST",a),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4==this.readyState&&this.status},c.send("cid="+Ab+"&data="+JSON.stringify(b)+"&sesskey="+Ob)}function y(){var a=document.getElementById("student-menu"),b=document.createElement("button");b.innerHTML=Nb.copy,b.addEventListener("click",z),a.appendChild(b);var c=b.getBoundingClientRect().height,d=document.createElement("button");d.innerHTML=Nb.print,d.addEventListener("click",A),a.appendChild(d),uc=document.createElement("select"),uc.size=3,uc.id="teacher-select",uc.style.minWidth="40px";var e=Vb-c-20;uc.style.height=e+"px",uc.addEventListener("change",B);for(var f in Db){var g=document.createElement("option");g.value=f,g.text=f,Bb==f&&(g.selected=!0),uc.appendChild(g)}a.appendChild(uc)}function z(){var a=new Image,b=new XMLSerializer,c=b.serializeToString(Tb.node());a.src="data:image/svg+xml;base64,"+window.btoa(c),document.body.appendChild(a);var d=document.createRange();d.setStartBefore(a),d.setEndAfter(a),d.selectNode(a),window.getSelection().addRange(d),document.execCommand("Copy"),document.body.removeChild(a)}function A(){var a=new XMLSerializer,b=a.serializeToString(Tb.node()),c=window.open();c.document.write('<img src="data:image/svg+xml;base64,'+window.btoa(b)+'"/>'),c.print(),c.close()}function B(){for(var a,b=document.getElementById("teacher-select"),c=0;c<b.options.length;c++)if(b.options[c].selected){a=b.options[c].value;break}a==Bb?(Tc=K,Uc=L,Vc=M,Wc=J):(Tc=null,Uc=null,Vc=null,Wc=null),yb=Cb[a],zb=Db[a],Jb=Eb[a],sb=Gb[a],vb=Hb[a],Ib=a,Tb.remove(),tc={},d(),Pb.selectAll("#legendUL").remove(),D(),$b=1,e(),$b=0;var f=document.getElementById("weights-output").innerHTML;f=parseFloat(f.split(" ")[1]),k(f);for(var g in tc)yb[g]&&(tc[g].checked=1==yb[g].visible),Bb==a?(tc[g].removeEventListener("change",C),tc[g].addEventListener("change",H)):(tc[g].removeEventListener("change",H),tc[g].addEventListener("change",C))}function C(){this.checked=!this.checked}function D(){var a,b=500;sc=document.getElementById("legend"),sc.style="width: "+ub+"px; height: "+Vb+"px; min-width: "+ub+"px; max-width: "+b+"px;";var c=function(a){var b=sc.offsetLeft+28;a.x>=b&&a.x<=b+6?sc.style.cursor="col-resize":sc.style.cursor="auto"},d=function(c){var d=a-c.x;a=c.x;var e=parseInt(sc.style.width)+d;e>b?e=b:e<ub&&(e=ub),sc.style.width=e+"px"};sc.addEventListener("mousemove",c),sc.addEventListener("mousedown",function(b){a=b.x,"col-resize"==sc.style.cursor&&sc.addEventListener("mousemove",d)}),document.addEventListener("mouseup",function(){sc.removeEventListener("mousemove",d)}),E(sc)}function E(a){var b=document.createElement("ul");b.id="legendUL";var c=document.createElement("span");c.className="no-select-text",c.innerHTML=vb;var d=document.createElement("li");d.appendChild(c);var e=document.createElement("ul");d.appendChild(e),b.appendChild(d);var f,g,h,i=-1;sb.sort(function(a,b){return a.sect-b.sect}),sb.forEach(function(a){i!=a.sect&&(g=document.createElement("ul"),g.className="nested",h=document.createElement("span"),h.className="caret",h.addEventListener("click",F),f=document.createElement("li"),f.appendChild(h),G("g"+a.sect,Nb.section+" "+a.sect,xc.grouping,a.sect,"grouping",f),f.appendChild(g),e.appendChild(f),i=a.sect),f=document.createElement("li"),f.className="indented",G(a.id,a.name,xc[a.entype],a.sect,a.type,f),g.appendChild(f)}),a.appendChild(b)}function F(){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("caret-down")}function G(a,b,c,d,e,f){var g=document.createElement("input");g.type="checkbox",yb[a]?g.checked=0!=yb[a].visible:yb["g"+d]?g.checked=1==yb["g"+d].visible&&Bb==Ib:g.checked=!0,g.id=a,g.group=d,g.nodeT=e,g.addEventListener("change",H),tc[g.id]=g;var h=document.createElement("label");h.style.color=c,h.className="no-select-text";var i="grouping"==e?b:e+"_"+b;h.appendChild(document.createTextNode(i)),f.appendChild(g),f.appendChild(h)}function H(){var a=this.id,b=this.checked,c=this.nodeT,d=this.group;cc.nodes.forEach(function(e){e.id==a?(e.visible=b,tc[e.id].checked=b):"grouping"==c&&e.group==d?(e.visible=b,tc[e.id].checked=b):b&&"grouping"==e.type&&e.group==d&&(e.visible=b,tc[e.id].checked=b)}),I(),Q()}function I(){parseFloat(document.getElementById("weight-slider").value)<0&&(Zb.strength(0),document.getElementById("weights-output").innerHTML="&nbsp;= 0",document.getElementById("weight-slider").value=0)}function J(a){if(Pb.selectAll(".text").remove(),Pb.selectAll("rect").remove(),Pb.selectAll("#preview").remove(),Pb.selectAll("#bgrnd").remove(),Pb.event.preventDefault(),"root"!=a.id){var b=a;Xb.on("mouseover",null).on("mouseout",null);var c=Tb.append("rect"),d=Tb.append("text").attr("class","text").attr("id","rctext").attr("x",a.x+10).attr("y",a.y+12).attr("dy",".40em").style("pointer-events","none").text(Nb.hide);a.y+20>=Vb&&d.attr("y",Vb-(Vb-a.y)-10).text(Nb.hide),c.attr("id","rcrect").attr("x",a.x).attr("y",a.y+20<=Vb?a.y:Vb-(Vb-a.y)-20).attr("width",60).attr("height",24).style("stroke","black").style("fill","lightgrey"),c.on("mouseover",function(){Pb.event.target.style="fill: grey;"}),c.on("mouseout",function(){Pb.event.target.style="fill: lightgrey;"}),c.on("click",function(){Pb.selectAll("#rctext").remove(),Pb.selectAll("#rcrect").remove(),Xb.on("mouseover",n).on("mouseout",q),b.visible=!1,tc[b.id].checked=!1,"grouping"==b.type&&cc.nodes.forEach(function(a){a.group==b.group&&(a.visible=!1,tc[a.id].checked=!1)}),I(),Q()})}}function K(a){Pb.event.active||Wb.alphaTarget(ac).restart(),a.fx=a.x,a.fy=a.y}function L(a){Pb.selectAll("rect").remove(),Pb.selectAll(".text").remove(),Pb.selectAll("#preview").remove(),Pb.selectAll("#bgrnd").remove(),a.fx=Pb.event.x,a.fy=Pb.event.y}function M(a){Pb.event.active||(xb?(Wb.stop(),v(),u()):Wb.alphaTarget(bc)),a.fx=null,a.fy=null,Sc=Date.now()}function N(){var a=document.getElementById("student-menu");hc=document.createElement("button"),hc.innerHTML=Nb.cluster,hc.addEventListener("click",$),a.appendChild(hc);var b=hc.getBoundingClientRect().height;dc=document.createElement("select"),dc.multiple=!0,dc.id="student-select";var c=Vb-b-12;dc.style="height: "+c+"px;",dc.addEventListener("change",function(){for(var a=document.getElementById("student-select"),b="box-shadow: 0 0 0 0 white inset;",c=0;c<a.options.length;c++){var d="box-shadow: 0 0 10px 100px "+a.options[c].colour+" inset;";a.options[c].style=a.options[c].selected?d:b}qb.length>0&&R(!0)}),rb.sort(function(a,b){return a.id-b.id}),rb.forEach(function(a){O(a,dc)}),a.appendChild(dc)}function O(a,b){var c=document.createElement("option");c.value=a.id,c.text=a.id,c.colour=vc[wc++],wc>=vc.length&&(wc=0),cc.edges[a.id].forEach(function(a){a.colour=c.colour}),b.appendChild(c)}function P(){ec=document.getElementById("slider"),fc=[0,cc.maxSession];var a;a=cc.maxSession<500?10:cc.maxSession<1e3?20:cc.maxSession<5e3?100:cc.maxSession<1e4?200:500,Rb.create(ec,{start:[0,cc.maxSession],range:{min:[0],max:[cc.maxSession]},step:1,connect:!0,pips:{mode:"steps",stepped:!0,density:100,filter:function(b){return 0==b||b==cc.maxSession?1:b%a==0?2:0}}}),setTimeout(function(){ec.noUiSlider.on("update",function(a,b){fc[b]=parseInt(a[b]),dc.dispatchEvent(new Event("change"))})},1e3)}function Q(){Yb.remove(),Xb.remove(),Pb.selectAll(".hull").remove();var a=S(J);T(a),V(a),Wb.alphaTarget(_b).restart(),xb&&setTimeout(function(){Wb.stop(),v(),u()},100)}function R(a){Yb.remove(),Xb.remove(),Pb.selectAll(".hull").remove(),xb=!1;var b=S(null);T(b),a&&V(b),xb=!0,Wb.on("tick",s),Wb.restart(),setTimeout(Wb.stop,100)}function S(a){var b=[],c={};return cc.nodes.forEach(function(a){null===a.fx&&(a.fx=a.x,a.fy=a.y),a.visible?b[b.length]=a:c[a.id]=1}),Wb.nodes(b),l(b,a,Tc,Uc,Vc),c}function T(a){var b,c,d,e,f,g=[];for(f in cc.links)d=cc.links[f],"string"==typeof d.source?(b=d.source,c=d.target):(b=d.source.id,c=d.target.id),a[b]||a[c]||(g[g.length]=d);var h=xb?[]:document.getElementById("student-select").options;for(f=0;f<h.length;f++)if(h[f].selected){var i,j,k={};for(j=fc[0];j<=fc[1]&&cc.edges[h[f].value].length>j;j++)e=cc.edges[h[f].value][j],"string"==typeof e.source?(i=e.source+"_"+e.target,b=e.source,c=e.target):(i=e.source.id+"_"+e.target.id,b=e.source.id,c=e.target.id),k[i]?k[i]++:k[i]=1,a[b]||a[c]||(g[g.length]=e);for(j=fc[0];j<=fc[1]&&cc.edges[h[f].value].length>j;j++)e=cc.edges[h[f].value][j],i="string"==typeof e.source?e.source+"_"+e.target:e.source.id+"_"+e.target.id,e.weight=k[i]}Wb.force("link").links(g),m(g)}function U(a){return cc.nodes.find(function(b){return b.id==a})}function V(a){if(!xb){Pb.selectAll(".hull").remove();for(var b=document.getElementById("student-select").options,c={},d=0;d<b.length;d++)if(b[d].selected){var e,f,g,h,i,j,k;c[b[d].value]={};for(var l=fc[0];l<=fc[1]&&cc.edges[b[d].value].length>l;l++){var m=cc.edges[b[d].value][l];if("string"==typeof m.source){j=m.source,k=m.target;var n=U(j);e=n.x,f=n.y,n=U(k),g=n.x,h=n.y}else j=m.source.id,k=m.target.id,e=m.source.x,f=m.source.y,g=m.target.x,h=m.target.y;a[j]||a[k]||(i=m.colour,c[b[d].value][j]={x:e,y:f,colour:i},c[b[d].value][k]={x:g,y:h,colour:i})}}for(var o in c)Y(c[o],o,!1,!1);zc&&(b=document.getElementById("student-select").options,ed?X(b):W(b))}}function W(a){Hc={};for(var b=0;b<a.length;b++)if(a[b].selected){var c=a[b].value;if(dd[c].length<=fc[0])continue;var d=fc[0],e=dd[c].length>fc[1]+1?fc[1]:dd[c].length,f=parseInt(d/2+e/2),g=dd[c][f],h=parseFloat(yb[g].xcoord),i=parseFloat(yb[g].ycoord);Hc[c]={x:h*zb+Yc.originalx,y:i*zb+Yc.originaly,colour:a[b].colour}}}function X(a){Hc={};for(var b=0;b<a.length;b++)if(a[b].selected){var c=a[b].value;if(dd[c].length<=fc[0])continue;for(var d,e=fc[0],f=dd[c].length>fc[1]+1?fc[1]:dd[c].length,g=0,h=0,i=0,j=e;j<f;j++)d=dd[c][j],g+=parseFloat(yb[d].xcoord),h+=parseFloat(yb[d].ycoord),i++;Hc[c]={x:g/i*zb+Yc.originalx,y:h/i*zb+Yc.originaly,colour:a[b].colour}}}function Y(a,b,c,d){if(0!=Object.keys(a).length){var e,f,g,h=[],i=20;g=zc?"hull":c?"manual-hull":"cluster-hull";for(var j in a)h[h.length]=[a[j].x,a[j].y],e=a[j].colour;if(1==h.length)f=function(a){var b=[a[0][0],a[0][1]-i],c=[a[0][0],a[0][1]+i];return"M "+b+" A "+[i,i,"0,0,0",c].join(",")+" A "+[i,i,"0,0,0",b].join(",")};else{if(2!=h.length){var k=Pb.concaveHull().padding(15);Dc||k.distance(Ec);var l=h.length>4?k(h):[h];return f=Pb.line().curve(Fc),void Tb.selectAll("#hull-"+b).data(l).enter().append("path").attr("id","hull-"+b).attr("class",g).style("stroke",e).style("stroke-opacity",d?0:1).style("fill",e).style("fill-opacity",d?0:Gc).attr("d",f)}var m=function(a,b){return[b[0]-a[0],b[1]-a[1]]},n=function(a,b){return[b*a[0],b*a[1]]},o=function(a,b){return[a[0]+b[0],a[1]+b[1]]},p=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return n(a,1/b)},q=function(a,b){return n(p(a),b)},r=function(a,b){void 0!==b&&(a=m(a,b));var c=[-a[1],a[0]];return p(c)};f=function(a){var b=m(a[0],a[1]),c=q(b,i),d=o(a[0],n(c,-1)),e=o(a[1],c),f=1.2*i,g=q(r(b),f),h=n(g,-1),j=o(d,h),k=o(e,h),l=o(d,g);return"M "+d+" C "+[j,k,e].join(",")+" S "+[l,d].join(",")+" Z"}}Tb.append("path").attr("id","hull-"+b).attr("class",g).style("stroke",e).style("stroke-opacity",d?0:1).style("fill",e).style("fill-opacity",d?0:Gc).attr("d",f(h))}}function Z(){clearInterval(Cc),Cc=void 0,va(),Pb.selectAll(".clustering-centroid").remove(),Pb.selectAll(".cluster-hull").remove(),Pb.selectAll(".centroid").remove(),Pb.selectAll(".server-centroid").remove(),oc.style.display="none",document.getElementById("anim-controls").style.display="none",document.getElementById("log-panel").style.display="none",document.getElementById("student-menu").style.width=hc.style.width,zc=!0,Nc=!1,ec.style.display="block",dc.style.display="block",Xb.style("display","block"),Xb.style("opacity",1),Yb.style("display","block"),Yb.style("opacity",1),R(!0),Xb.on("mouseover",n).on("mouseout",q),hc.innerHTML=Nb.cluster,hc.removeEventListener("click",Z),hc.addEventListener("click",$)}function $(){zc=!1,ec.style.display="none",dc.style.display="none",Pb.selectAll(".hull").remove(),Pb.selectAll(".text").remove(),Pb.selectAll("rect").remove(),document.getElementById("student-menu").style.width=qc+"px",hc.innerHTML=Nb.graph,hc.removeEventListener("click",$),hc.addEventListener("click",Z),Wb.stop(),Xb.on("mouseover",null).on("mouseout",null).on("contextmenu",null).call(Pb.drag().on("start",null).on("drag",null).on("end",null)),Yc.clusterId=Date.now(),Kb={},Bc=0,Ac=!1,pc=1,Cc=void 0;var a='<p id="cluster-text">'+Nb.numclusters+"</p>";setTimeout(function(){if(oc)document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("cluster-text").innerHTML=a,document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("anim-controls").style.display="block",document.getElementById("log-panel").style.display="block",oc.noUiSlider.set(1),oc.style.display="block";else{var b=Ba();Ta(a,b),bb()}cb()},Zc/2)}function _(a,b){xb=!0,yb={0:0,1:1,2:2},Vb=window.innerHeight-190,ta(),bb(),aa(a,b)}function aa(a,b){var c=document.getElementById("student-menu");jc=document.createElement("select"),jc.size=3,jc.id="replay-select",jc.style="height: "+(Vb-12)+"px;",jc.addEventListener("change",ba.bind(this,a,b));for(var d in a){var e=0;for(var f in a[d]){var g=0;e++;for(var h in a[d][f])if(!isNaN(h)&&a[d][f][h][1]){var i=document.createElement("option");i.value=d+"_"+f+"_"+h,i.text=d.split("-")[0]+"_"+e+"_"+ ++g,jc.appendChild(i)}}}c.appendChild(jc)}function ba(a,b){var c=qa(a,b),f=c.members;Tb&&(Tb.remove(),wa(),va(),document.getElementById("replayer").innerHTML="&nbsp;"),dc&&document.body.removeChild(dc),d(),e(),fc=[0,cc.maxSession];for(var g=0;g<cc.nodes.length;g++)void 0===cc.nodes[g].xcoord&&(cc.nodes[g].visible=!1);ra(f),k(0),R(!1),Xb.on("mouseover",null).on("mouseout",null),Lc=!0,setTimeout(function(){sa(Hc,!1),cb(),Wb.on("tick",s);for(var a in Hc)Pb.select("#centroid-"+a).call(Pb.drag().on("start",ca.bind(this,a)).on("drag",da.bind(this,a)).on("end",ea.bind(this,a,b,c)))},500)}function ca(a){ia(a)&&(ad=Date.now(),Tb.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+a).attr("points",db(Pb.event.x,Pb.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Hc[a].colour).style("opacity",.5))}function da(a){Pb.select("#dragged-"+a).attr("points",db(Pb.event.x,Pb.event.y))}function ea(a,b,c){if(Pb.selectAll(".dragged-centroid").remove(),ia(a)){if(Date.now()-ad<300)return void lb(Lb[a],a,!1);_c||ka();var d=ja();if(0==Object.keys(hd[d]).length)for(var e=0;e<kc[d].length;e++)for(var f in kc[d][e].members){var g=Mb[kc[d][e].members[f].id];hd[d][g]=e}var h=hb(Pb.event);for(var i in hd)i<=d&&(hd[i][a]=h);la(d,b,c),_c=!0,ga(d),fa(d)}}function fa(a){for(var b={clusterCoords:[],members:[]},c=0;c<id.length;c++){var d=id[c]?id[c]:Jc[c];b.clusterCoords[c]=Ra(d),b.clusterCoords[c].num=c;for(var e in hd[a])hd[a][e]==c&&(b.members[b.members.length]={id:Lb[e],num:c})}b.iteration=a,b.clusterId=Yc.clusterId,b.coordsid=Jb,x(pb,b)}function ga(a){if(!(a>=0)&&hd[a]&&0!=Object.keys(hd[a]).length){var b,c=ha(a),d=Nb.manualcluster+"\n";for(b=0;b<id.length;b++)if(id[b]){var e=id[b].x-Ub/2,f=id[b].y-Vb/2,g=Math.sqrt(e*e+f*f);d+=Nb.disttocluster+" "+b+": "+Math.round(g)+"\n"+Nb.cluster+" "+b+" "+Nb.members+": [";for(var h in hd[a])hd[a][h]==b&&(d+=h+", ");-1!=d.indexOf(",",d.length-3)&&(d=d.slice(0,-2)),d+="]\n",cd&&(d+=Nb.precision+": "+c[b].precision.toFixed(4)+"\n",d+=Nb.recall+": "+c[b].recall.toFixed(4)+"\n",d+=Nb.f1+": "+c[b].f1.toFixed(4)+"\n",d+=Nb.fhalf+": "+c[b].fhalf.toFixed(4)+"\n",d+=Nb.f2+": "+c[b].f2.toFixed(4)+"\n")}var i=rc.value.split("\n\n"),j=i[0].split("\n");for(rc.value="",b=0;b<j.length&&!j[b].startsWith(Nb.manualcluster);b++)rc.value+=j[b]+"\n";for(cd&&(b=c.length-1,d+=Nb.totalmeasures+"\n",d+=Nb.precision+": "+c[b].precision.toFixed(4)+"\n",d+=Nb.recall+": "+c[b].recall.toFixed(4)+"\n",d+=Nb.f1+": "+c[b].f1.toFixed(4)+"\n",d+=Nb.fhalf+": "+c[b].fhalf.toFixed(4)+"\n",d+=Nb.f2+": "+c[b].f2.toFixed(4)+"\n"),rc.value+=d+"\n",b=1;b<i.length;b++)rc.value+=i[b]+"\n\n"}}function ha(a){var b,c,d,e=0,f=0,g=0,h=[];for(d=0;d<Jc.length;d++){for(var i in Ic)Ic[i].ci==d&&hd[a][i]==Ic[i].ci?e++:Ic[i].ci==d&&hd[a][i]!=Ic[i].ci?f++:hd[a][i]==d&&hd[a][i]!=Ic[i].ci&&g++;b=e/(e+f),c=e/(e+g),h[d]={tp:e,fp:f,fn:g,precision:b,recall:c,f1:b+c==0?0:2*b*c/(b+c),fhalf:b+c==0?0:1.25*b*c/(.25*b+c),f2:b+c==0?0:5*b*c/(4*b+c)},e=0,f=0,g=0}for(d=0;d<h.length;d++)e+=h[d].tp,f+=h[d].fp,g+=h[d].fn;return b=e/(e+f),c=e/(e+g),h[h.length]={tp:e,fp:f,fn:g,precision:b,recall:c,f1:b+c==0?0:2*b*c/(b+c),fhalf:b+c==0?0:1.25*b*c/(.25*b+c),f2:b+c==0?0:5*b*c/(4*b+c)},h}function ia(a){if(document.getElementById("replayer").innerHTML!=Nb.convergence)return!1;if(bd!=Bb)return!1;var b,c=Ic[a].ci,d=0;for(b in Ic)Ic[b].ci==c&&d++;var e=ja(),f=0;if(hd[e]){c=hd[e][a];for(b in hd[e])hd[e][b]==c&&f++}return!(1==d&&f<=1)&&1!=f}function ja(){var a=rc.value.split("\n");return a[2]&&a[2].startsWith(Nb.iteration)?parseInt(a[2].split(" ")[1]):null}function ka(){for(var a in kc)if(!(a>=0)){hd[a]={};for(var b=0;b<kc[a].length;b++)for(var c in kc[a][b].members){var d=Mb[kc[a][b].members[c].id];hd[a][d]=b}}}function la(a,b,c){var d,e,f=[],g=[];for(d=0;d<kc[a].length;d++){f[d]={},g[d]=[];for(e in hd[a])if(hd[a][e]==d){var h=Ic[e].x,i=Ic[e].y;f[d][h+"_"+i]={x:h,y:i,colour:Jc[d].colour},g[d][g[d].length]=[h,i]}}var j=document.getElementsByClassName("manual-centroid").length,k=0==j;for(Pb.selectAll(".manual-hull").remove(),d=0;d<f.length;d++)Y(f[d],-1*(d+1),!0,k),id[d]=Oa(g[d]);if(b)for(b[c.did]||(b[c.did]={}),b[c.did][c.gid]||(b[c.did][c.gid]={}),b[c.did][c.gid][c.cid]||(b[c.did][c.gid][c.cid]={}),b[c.did][c.gid][c.cid][a]||(b[c.did][c.gid][c.cid][a]=[]),d=0;d<id.length;d++)if(id[d]){var l=[];for(e in hd[a])hd[a][e]==d&&(l[l.length]={id:Lb[e],num:d});b[c.did][c.gid][c.cid][a][d]={centroidx:id[d].x,centroidy:id[d].y,members:l}}k?na():oa(),Tb.selectAll(".centroid").raise(),Tb.selectAll(".clustering-centroid").raise(),Tb.selectAll(".manual-centroid").raise()}function ma(){Pb.event.stopPropagation()}function na(){Pb.selectAll(".manual-centroid").remove();for(var a,b,c=14,d=0;d<id.length;d++){if(!id[d])return;a=id[d].x,b=id[d].y,Tb.append("line").attr("class","manual-centroid").attr("id","manual1-"+d).attr("x1",a-c).attr("y1",b-c).attr("x2",a+c).attr("y2",b+c).style("stroke",Jc[d].colour).style("stroke-width","5px").style("opacity",0).on("click",ma).on("click.centroidClick",lb.bind(this,-1*(d+1),d,!0)).on("mouseover",Ja.bind(this,d,!0)),Tb.append("line").attr("class","manual-centroid").attr("id","manual2-"+d).attr("x1",a+c).attr("y1",b-c).attr("x2",a-c).attr("y2",b+c).style("stroke",Jc[d].colour).style("stroke-width","5px").style("opacity",0).on("click",ma).on("click.centroidClick",lb.bind(this,-1*(d+1),d,!0)).on("mouseover",Ja.bind(this,d,!0))}Pb.selectAll(".manual-centroid").transition().duration(Zc).style("opacity",.5),Pb.selectAll(".manual-hull").transition().duration(Zc).style("stroke-opacity",1).style("fill-opacity",Gc)}function oa(){for(var a,b,c=14,d=0;d<id.length;d++){if(!id[d])return void Pb.selectAll(".manual-centroid").remove();a=id[d].x,b=id[d].y,Pb.select("#manual1-"+d).transition().duration(Zc).attr("x1",a-c).attr("y1",b-c).attr("x2",a+c).attr("y2",b+c).style("display","block"),Pb.select("#manual2-"+d).transition().duration(Zc).attr("x1",a+c).attr("y1",b-c).attr("x2",a-c).attr("y2",b+c).style("display","block")}}function pa(a){if(!a||a>0)return Tb.selectAll(".manual-centroid").remove(),void Tb.selectAll(".manual-hull").remove();_c&&la(a,null,null)}function qa(a,b){var c,d,e=document.getElementById("replay-select");for(d=0;d<e.options.length;d++)if(e.options[d].selected){c=e.options[d].value.split("_");break}var f=c[0],g=c[1],h=c[2];bd=f.split("-")[0],Yc.clusterId=h,Jb=a[f][g].last,yb=a[f][g].nodes,zb=a[f][g].scale,sb=a[f][g].mods,kc=a[f][g][h],qb=a[f][g].logs,rb=a[f][g].users,Kb=a[f][g][h].comments,Mb={},Lb={},rb.forEach(function(a){Lb[a.id]=a.realId,Mb[a.realId]=a.id}),Bc=0,pc=1,mc=0,nc=0;for(var i in kc)isNaN(i)||(i>=0?mc++:nc--);id=[],hd={},_c=!1;var j,k,l=b[f][g][h];if(l)for(_c=!0,d=-1;d>=nc;d--){l[d]&&!l[d-1]&&(l[d-1]=l[d]),hd[d]={};for(j in l[d])for(k in l[d][j].members){var m=l[d][j].members[k].id;hd[d][Mb[m]]=j}}Jc=[],Hc={};var n={},o=0;for(j in kc[1]){if(d=Jc.length,Jc[d]={x:0,y:0},o<yc.length)Jc[d].colour=yc[o++];else{for(var p;!p;)p=vc[Math.floor(Sb.random()*vc.length)],p=yc.includes(p)?void 0:p;Jc[d].colour=p}for(k in kc[1][j].members){var q=Mb[kc[1][j].members[k].id];Hc[q]={x:kc[1][j].members[k].x,y:kc[1][j].members[k].y},n[q]=!0}}return{members:n,did:f,gid:g,cid:h}}function ra(a){dc=document.createElement("select"),dc.multiple=!0,dc.id="student-select",dc.style.display="none",wc=0,rb.forEach(function(a){O(a,dc)});for(var b,c=0;c<dc.options.length;c++)b=dc.options[c].value,a[b]?dc.options[c].selected=!0:dc.options[c].selected=!1,Hc[b]&&(Hc[b].colour=dc.options[c].colour);document.body.appendChild(dc)}function sa(a,b){for(var c in a)a[c].x*=Yc.distance,a[c].x+=Yc.originalx,a[c].y*=Yc.distance,a[c].y+=Yc.originaly,b&&(a[c].x-=Yc.centre.x,a[c].x*=Yc.scale,a[c].x+=Ub/2,a[c].y-=Yc.centre.y,a[c].y*=Yc.scale,a[c].y+=Vb/2)}function ta(){var a=document.getElementById("slider"),b=document.createElement("p");b.innerHTML="&nbsp",b.id="replayer",a.appendChild(b);var c=document.createElement("button");c.id="replay-stop",c.innerHTML="&#9606",c.addEventListener("click",ua),a.appendChild(c);var d=document.createElement("button");d.id="replay-pause",d.innerHTML="&#9654",d.value="play",d.addEventListener("click",xa),a.appendChild(d);var e=document.createElement("button");e.id="replay-back",e.innerHTML="&#9614&#9664",e.addEventListener("click",za),a.appendChild(e);var f=document.createElement("button");f.id="replay-forward",f.innerHTML="&#9654&nbsp&nbsp&#9614",f.addEventListener("click",ya.bind(this,!0)),a.appendChild(f)}function ua(){Tb&&setTimeout(function(){Tb.remove(),va(),document.getElementById("replayer").innerHTML="&nbsp;"},500),kc=void 0,wa();for(var a=document.getElementById("replay-select"),b=0;b<a.options.length;b++)a.options[b].selected&&(a.options[b].selected=!1)}function va(){rc.readOnly=!1,rc.value="",setTimeout(function(){rc.readOnly=!0},300)}function wa(){var a=document.getElementById("replay-pause");a.innerHTML="&#9654",a.value="play",clearInterval(Cc),Cc=void 0}function xa(){if(kc){var a=document.getElementById("replay-pause");"play"==a.value?(a.innerHTML="&#9613&#9613",a.value="pause",ya(!1),Cc=setInterval(ya.bind(this,!1),1200)):wa()}}function ya(a){if(kc){a&&wa(),Bc++;var b=Bc-1;return Bc>mc&&kc[-1]&&(b=mc-Bc+1,!kc[b-1])?(Bc--,void wa()):b>mc?(Bc--,void wa()):void(1==Bc?(pc=2,Ac=!0,Lc=!1,Wa()):2==Bc?(Xa(),Aa(b-1,!1,!0)):Aa(b-1,!1,!1))}}function za(){if(kc&&lc&&!(Bc-1<0)){wa(),Bc--;var a=Bc-1;Bc>mc&&(a=mc-Bc+1),0==Bc?(pc=1,Va(),Ac=!1,rc.value=rc.value.slice(rc.value.indexOf("\n\n")+2),document.getElementById("replayer").innerHTML="&nbsp;"):1==Bc?(Wa(),rc.value=rc.value.slice(rc.value.indexOf("\n\n")+2),document.getElementById("replayer").innerHTML="&nbsp;"):Aa(a-1,!0,2==Bc)}}function Aa(a,b,c){var d,e=[],f={},g={};for(d=0;d<kc[a].length;d++,g={}){Tb.selectAll("#hull-"+d).remove(),Jc[d].x=kc[a][d].centroidx,Jc[d].y=kc[a][d].centroidy;for(var h in kc[a][d].members){var i=kc[a][d].members[h].x,j=kc[a][d].members[h].y,k=Mb[kc[a][d].members[h].id];Hc[k].x=i,Hc[k].y=j,g[i+"_"+j]={x:i,y:j,colour:Jc[d].colour},f[k]=d}e[d]=g}if(sa(Jc,!0),c)Ha();else{for(sa(Hc,!1),d=0;d<e.length;d++)sa(e[d],!0),Y(e[d],d,!1,!1);Sa(Zc)}if(Ya(lc[2],lc[0],lc[1],Zc),Tb.selectAll(".centroid").raise(),Tb.selectAll(".clustering-centroid").raise(),pa(a),b)rc.value=rc.value.slice(rc.value.indexOf("\n\n")+2);else{for(var l in f)Ic[l].ci=f[l];Pa(a),ga(a)}document.getElementById("replayer").innerHTML=a<0?Nb.convergence:Nb.iteration+" "+a}function Ba(){var a=document.getElementById("anim-controls");a.appendChild(document.createTextNode(Nb.runkmeans));var b=document.createElement("p");b.innerHTML="&nbsp",b.id="clustering",a.appendChild(b);var c=document.createElement("button");c.id="stop",c.innerHTML="&#9606",c.addEventListener("click",Ca),a.appendChild(c);var d=document.createElement("button");d.id="play-pause",d.innerHTML="&#9654",d.addEventListener("click",Ea),d.disabled=!0;var e=document.createElement("button");return e.id="play-step",e.innerHTML="&#9654&#9614",e.addEventListener("click",Da.bind(this,d)),e.disabled=!0,a.appendChild(e),a.appendChild(d),a}function Ca(){Ac=!1,Bc=0,clearInterval(Cc),Cc=void 0,Yc.clusterId=Date.now(),oc.removeAttribute("disabled"),3==pc?(oc.noUiSlider.set(2),setTimeout(function(){oc.noUiSlider.set(1),pc=1},Zc)):(oc.noUiSlider.set(1),pc=1),document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("num-clusters")&&(document.getElementById("num-clusters").readOnly=!1,document.getElementById("num-clusters").value=""),Pb.selectAll(".clustering-centroid").transition(Qb).style.display="none",Pb.selectAll(".cluster-hull").transition(Qb).style.display="none",setTimeout(function(){Pb.selectAll(".clustering-centroid").remove(),Pb.selectAll(".cluster-hull").remove(),va()},Zc);for(var a in Ic)Ic[a].ci=void 0}function Da(a){3==pc&&(Cc?(clearInterval(Cc),Cc=void 0,a.innerHTML="&#9654"):Fa())}function Ea(){3==pc&&(Cc?(clearInterval(Cc),Cc=void 0,this.innerHTML="&#9654",oc.removeAttribute("disabled")):(Cc=setInterval(Fa,1e3),this.innerHTML="&#9613&#9613",oc.setAttribute("disabled",!0)))}function Fa(){if(0==Bc){Ac=!0;var a=document.getElementById("num-clusters"),b=parseInt(a.value);(isNaN(b)||b<2)&&(b=3);var c={};for(var d in Hc)c[Hc[d].x+"_"+Hc[d].y]=1;for(;b>Object.keys(c).length;)b--;a.value=b,a.readOnly=!0,Jc=[],Kc=null;var e,f;for(e=0,f=0;e<b;e++)if(f<yc.length)Jc[e]=Ga(null,yc[f++]);else{for(var g;!g;)g=vc[Math.floor(Sb.random()*vc.length)],g=yc.includes(g)?void 0:g;Jc[e]=Ga(null,g)}Ha(),document.getElementById("clustering").innerHTML=Nb.randcentroids;var h=Pa(Bc);Yc.iteration=Bc,Qa(h)}else Ma(Bc),Sa(Zc);Bc++,document.getElementById("clustering").innerHTML==Nb.convergence&&(clearInterval(Cc),Cc=void 0,oc.removeAttribute("disabled"),document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0)}function Ga(a,b){var c,d,e,f,g=100,h=Ub-g,i=g,j=Vb-g,k=g,l=0;if(a)for(;l<100;)c=Math.floor(Math.random()*(h-i)+i),d=Math.floor(Math.random()*(j-k)+k),e=c-a.x,f=d-a.y,l=Math.sqrt(e*e+f*f);else c=Math.floor(Math.random()*(h-i)+i),d=Math.floor(Math.random()*(j-k)+k);return{x:c,y:d,colour:b}}function Ha(){Pb.selectAll(".clustering-centroid").remove();var a,b,c,d=14;for(a=0;a<Jc.length;a++)b=Jc[a].x,c=Jc[a].y,Tb.append("line").attr("class","clustering-centroid").attr("id","cluster1-"+a).attr("x1",b-d).attr("y1",c-d).attr("x2",b+d).attr("y2",c+d).style("stroke",Jc[a].colour).style("stroke-width","5px").on("click",ma).on("click.centroidClick",lb.bind(this,-1*(a+1),a,!0)).on("mouseover",Ja.bind(this,a,!1)),Tb.append("line").attr("class","clustering-centroid").attr("id","cluster2-"+a).attr("x1",b+d).attr("y1",c-d).attr("x2",b-d).attr("y2",c+d).style("stroke",Jc[a].colour).style("stroke-width","5px").on("click",ma).on("click.centroidClick",lb.bind(this,-1*(a+1),a,!0)).on("mouseover",Ja.bind(this,a,!1))}function Ia(a,b,c){var d,e,f,g,h,i,j={};for(d in a)for(i=fc[0];i<cc.edges[d].length&&i<=fc[1];i++)e=cc.edges[d][i],"string"==typeof e.source?(f=parseInt(e.source),g=parseInt(e.target)):(f=e.source.id,g=e.target.id),b[f]||b[g]||(h=f+"_"+g,f>g&&(h=g+"_"+f),j[h]?j[h][d]?j[h][d]++:j[h][d]=1:(j[h]={},j[h][d]=1));var k,l,m=[];for(k in j)if(Object.keys(j[k]).length==c){var n=Number.MAX_SAFE_INTEGER;for(l in j[k])n>j[k][l]&&(n=j[k][l]);var o=k.split("_");m[m.length]={source:o[0],target:o[1],weight:n,colour:"black"}}for(i=0;i<cc.links.length;i++)m[m.length]=cc.links[i];return m}function Ja(a,b){Yb.remove(),Lc=!0,Mc=!1,Nc=!0,Tb.on("click",Ka);var c,d={};if(b){var e=ja();for(c in hd[e])hd[e][c]==a&&(d[c]=c)}else for(c in Ic)Ic[c].ci==a&&(d[c]=c);var f,g=Object.keys(d).length,h={};for(f=0;f<cc.nodes.length;f++)cc.nodes[f].visible||(h[cc.nodes[f].id]=1);var i=Ia(d,h,g);Xb.style("display","block").style("opacity",1).on("mouseover",n).on("mouseout",q),Wb.force("link").links(i),m(i),Yb.on("mouseover",La).on("mouseout",q),Wb.restart(),setTimeout(function(){Wb.stop(),Yb.lower(),Pb.selectAll(".cluster-hull").lower()},10)}function Ka(){Lc=!1,Mc=!0,Nc=!1,Yb.remove(),Xb.style("display","none").on("mouseover",null).on("mouseout",null),Tb.on("click",null)}function La(a){"black"==a.colour&&(Yb.on("mouseover",null),Xb.on("mouseover",null).on("mouseout",null),Pb.selectAll(".clustering-centroid").on("mouseover",null),n(a.source),Oc=!0,n(a.target,!0),Oc=!1)}function Ma(a){if(document.getElementById("clustering").innerHTML!=Nb.convergence){if(0==Object.keys(Ic).length)return void(document.getElementById("clustering").innerHTML=Nb.convergence);var b,c,d,e,f=Nb.iteration+": "+a;for(b in Ic)Ic[b].ci=hb(Ic[b]);var g=[];for(c=0;c<Jc.length;c++)g[c]=Na(c);Kc=Jc,Jc=g;var h=!1;if(Kc){var i=0;for(c=0;c<Jc.length;c++)d=Kc[c].x-Jc[c].x,e=Kc[c].y-Jc[c].y,i+=Math.sqrt(d*d+e*e);i<=Rc&&(f=Nb.convergence,h=!0)}document.getElementById("clustering").innerHTML=f;var j=Pa(a);Yc.iteration=h?-1:a,Qa(j)}}function Na(a){var b,c=[],d={};for(b in Ic)Ic[b].ci==a&&(c[c.length]=[Ic[b].x,Ic[b].y],d[Ic[b].x+"_"+Ic[b].y]={x:Ic[b].x,y:Ic[b].y,colour:Jc[a].colour});if(Tb.selectAll("#hull-"+a).remove(),Y(d,a,!1,!1),Tb.selectAll(".centroid").raise(),Tb.selectAll(".clustering-centroid").raise(),0==Object.keys(d).length)return Ga(Jc[a],Jc[a].colour);var e=Oa(c);return e.colour=Jc[a].colour,e}function Oa(a){if(0==a.length)return null;var b,c=0,d=0;for(b=0;b<a.length;b++)c+=a[b][0],d+=a[b][1];return{x:c/a.length,y:d/a.length}}function Pa(a){var b,c,d,e,f,g=Nb.numstudents+": "+Object.keys(Ic).length+"\n"+Nb.numofclusters+": "+Jc.length+"\n"+Nb.iteration+": "+a+"\n",h=[];for(b=0;b<Jc.length;b++){c=Jc[b].x-Ub/2,d=Jc[b].y-Vb/2,e=Math.sqrt(c*c+d*d),g+=Nb.disttocluster+" "+b+": "+Math.round(e,2)+"\n"+Nb.cluster+" "+b+" "+Nb.members+": [",h[b]=[];for(f in Ic)Ic[f].ci==b&&(g+=f+", ",h[b][h[b].length]=f);-1!=g.indexOf(",",g.length-3)&&(g=g.slice(0,-2)),g+="]\n"}return g+="\n",rc.value=g+rc.value,h}function Qa(a){var b,c,d,e={clusterCoords:[]};for(b=0;b<a.length;b++)for(e.clusterCoords[b]=Ra(Jc[b]),e.clusterCoords[b].num=b,c=0;c<a[b].length;c++)d=Ra(Ic[a[b][c]]),a[b][c]={id:Lb[a[b][c]],num:b,x:d.x,y:d.y};e.members=a,e.iteration=Yc.iteration,e.clusterId=Yc.clusterId,e.coordsid=Jb,e.usegeometric=ed?1:0,(0!=fc[0]||fc[1]!=cc.maxSession)&&e.iteration<0&&(e.iteration=Bc),x(nb,e)}function Ra(a){var b=(a.x-Ub/2)/Yc.scale+Yc.centre.x,c=(a.y-Vb/2)/Yc.scale+Yc.centre.y;return b=(b-Yc.originalx)/Yc.distance,c=(c-Yc.originaly)/Yc.distance,{x:b,y:c}}function Sa(a){var b,c,d,e=14;for(b=0;b<Jc.length;b++)c=Jc[b].x,d=Jc[b].y,Pb.select("#cluster1-"+b).transition().duration(a).attr("x1",c-e).attr("y1",d-e).attr("x2",c+e).attr("y2",d+e),Pb.select("#cluster2-"+b).transition().duration(a).attr("x1",c+e).attr("y1",d-e).attr("x2",c-e).attr("y2",d+e)}function Ta(a,b){oc=document.getElementById("cluster-slider"),Rb.create(oc,{start:[1],handles:1,range:{min:1,max:3},step:1,orientation:"vertical",direction:"rtl",pips:{mode:"steps",stepped:!0,density:100,filter:function(){return 1},format:{to:function(b){switch(b){case 1:return Nb.showcentroids;case 2:return Nb.removegraph;case 3:return a;default:return""}},from:function(){return""}}}}),oc.noUiSlider.on("update",Ua),oc.style="margin-top: 20px;";var c=hc.getBoundingClientRect().height,d=b.getBoundingClientRect().height;oc.style.height=Vb-c-d-120+"px";var e=document.createElement("input");e.id="centroid-checkbox",e.type="checkbox",e.style="margin-top: 30px",e.addEventListener("click",function(){if(1!=pc||Ac)return void(this.checked=!this.checked);ed=this.checked,Tb.selectAll(".centroid").remove();var a,b=[],c=0;for(a in Hc)b[c++]={value:a,selected:!0,colour:Hc[a].colour};ed?X(b):W(b),$()}),oc.appendChild(e);var f=document.createElement("label");f.appendChild(document.createTextNode(Nb.geometrics)),oc.appendChild(f)}function Ua(a,b){switch(parseInt(a[b])){case 1:if(3==pc){oc.noUiSlider.set(2);break}pc=1,Va(),Ac||(document.getElementById("centroid-checkbox").disabled=!1);break;case 2:pc=2,Wa(),document.getElementById("centroid-checkbox").disabled=!0,document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0;break;case 3:if(1==pc){oc.noUiSlider.set(2);break}if(pc=3,Xa(),!Ac){var c='<input type="text" placeholder="'+Nb.numclusters+'" id="num-clusters" size="8" pattern="[0-9]{1,2}">';document.getElementById("cluster-text").innerHTML=c}document.getElementById("play-pause").disabled=!1,document.getElementById("play-step").disabled=!1,document.getElementById("clustering").innerHTML==Nb.convergence&&(document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0)}}function Va(){R(!1),Xb.on("mouseover",null).on("mouseout",null),Ya(1,0,0,Zc),setTimeout(function(){Pb.selectAll(".centroid").raise()},100)}function Wa(){Xb.transition(Qb).style("opacity",0),Yb.transition(Qb).style("opacity",0),Pb.selectAll(".clustering-centroid").transition(Qb).style("opacity",0),Pb.selectAll(".cluster-hull").transition(Qb).style("opacity",0),setTimeout(function(){Xb.style("display","none"),Yb.style("display","none"),Pb.selectAll(".clustering-centroid").style("display","none"),Pb.selectAll(".cluster-hull").style("display","none")},Zc),!Ac&&document.getElementById("cluster-text")&&(document.getElementById("cluster-text").innerHTML=Nb.numclusters);var a=Za();null!==a&&(Yc.scale=a[2],lc=a,setTimeout(function(){Ya(a[2],a[0],a[1],Zc)},Zc/2))}function Xa(){Pb.selectAll(".clustering-centroid").transition(Qb).style("display","block").style("opacity",1),Pb.selectAll(".cluster-hull").transition(Qb).style("display","block").style("opacity",1)}function Ya(a,b,c,d){var e,f,g,h,i,j,k=14,l=Ub/2,m=Vb/2;Ic={};for(j in Hc)Ic[j]={x:0,y:0};Yc.centre={x:b,y:c};for(j in Hc)e=Hc[j].x,f=Hc[j].y,g=(e-b)*a,h=(f-c)*a,1==a&&0==b&&0==c?(e=b+g,f=c+h):(e=l+g,f=m+h),Ic[j].x=e,Ic[j].y=f,i=e+","+(f-k)+" "+(e+k)+","+(f+k)+" "+(e-k)+","+(f+k),Pb.select("#centroid-"+j).transition().duration(d).attr("points",i);var n=function(a,b){return a*=Yc.distance,a+=Yc.originalx,b*=Yc.distance,b+=Yc.originaly,a-=Yc.centre.x,a*=Yc.scale,a+=Ub/2,b-=Yc.centre.y,b*=Yc.scale,b+=Vb/2,{x:a,y:b}};for(j in gd){var o=n(gd[j].x,gd[j].y);e=o.x,f=o.y,Pb.select("#server-centroid-"+j).transition().duration(d).attr("cx",e).attr("cy",f)}}function Za(){var a,b=[];if(ic)return $a();for(a in Hc)b[b.length]=[Hc[a].x,Hc[a].y];var c=_a(b);if(null===c)return null;var d,e,f,g,h=[c.x,c.y],i=0,j=0;for(a in Hc)d=Math.abs(Hc[a].x-h[0]),e=Math.abs(Hc[a].y-h[1]),d>i&&(i=d,f=a),e>j&&(j=e,g=a);if(void 0===g&&void 0===f)return h[2]=1,h;var k=Hc[f].x-h[0]+Ub/2,l=Hc[f].y-h[1]+Vb/2,m=ab(k,l,Ub/2,Vb/2);k=Hc[g].x-h[0]+Ub/2,l=Hc[g].y-h[1]+Vb/2;var n=ab(k,l,Ub/2,Vb/2);return h[2]=m<n?m:n,h[2]*=.9,h}function $a(){var a,b=[],c=0,d=0;for(a in kc)if(!(a>=0&&1!=a))for(var e in kc[a])for(var f in kc[a][e].members)c=kc[a][e].members[f].x,c=c*zb+Yc.originalx,d=kc[a][e].members[f].y,d=d*zb+Yc.originaly,b[b.length]=[c,d];var g=_a(b);if(null===g)return null;var h,i,j,k,l,m=[g.x,g.y],n=0,o=0;for(l=0;l<b.length;l++)h=Math.abs(b[l][0]-m[0]),i=Math.abs(b[l][1]-m[1]),h>n&&(n=h,j=l),i>o&&(o=i,k=l);if(void 0===k&&void 0===j)return m[2]=1,m;var p=b[j][0]-m[0]+Ub/2,q=b[j][1]-m[1]+Vb/2,r=ab(p,q,Ub/2,Vb/2);p=b[k][0]-m[0]+Ub/2,q=b[k][1]-m[1]+Vb/2;var s=ab(p,q,Ub/2,Vb/2);return m[2]=r<s?r:s,m[2]*=.9,m}function _a(a){if(0==a.length)return null;if(1==a.length)return{x:a[0][0],y:a[0][1]};var b,c,d,e=0,f=0,g=Ub,h=Vb;for(b=0;b<a.length;b++)c=a[b][0],d=a[b][1],c>e&&(e=c),c<g&&(g=c),d>f&&(f=d),d<h&&(h=d);return{x:(e+g)/2,y:(f+h)/2}}function ab(a,b,c,d){var e=a-c,f=b-d,g=e>0?Ub:0,h=f>0?Vb:0,i=(g-Ub/2)/e,j=(h-Vb/2)/f;return isFinite(i)&&isFinite(j)&&i<=j?i:isFinite(i)&&!isFinite(j)?i:isFinite(j)?j:1}function bb(){var a=document.getElementById("log-panel");a.style.width=ub+"px";var b=document.createElement("button");b.innerHTML=Nb.copy,b.addEventListener("click",function(){rc.select(),document.execCommand("copy")}),Qc?b.style.marginLeft="10px":(b.style.position="absolute",b.style.right=ub-40+"px"),a.appendChild(b);var c=document.createElement("button");c.innerHTML=Nb.print,c.addEventListener("click",function(){var a=window.open(),b=rc.value.replace(/\n/g,"<br>");a.document.write("<html><head></head><body>"),a.document.write(b),a.document.write("</body></html>"),a.print(),a.close()}),Qc?c.style.marginLeft="10px":(c.style.position="absolute",c.style.right=ub-100+"px"),a.appendChild(c),rc=document.createElement("textarea"),rc.readOnly=!0,rc.rows=24,-1!=navigator.userAgent.indexOf("Chrome")?rc.cols=28:rc.cols=20,rc.style.resize="none",rc.style.border="2px solid black",Qc||(rc.style.position="absolute",rc.style.right="6px",rc.style.top="60px"),a.appendChild(rc)}function cb(){var a;for(a in Hc)Tb.append("polygon").attr("class","centroid").attr("id","centroid-"+a).attr("points",db(Hc[a].x,Hc[a].y)).style("stroke","black").style("stroke-width","3px").style("fill",Hc[a].colour).call(Pb.drag().on("start",eb.bind(this,a)).on("drag",fb.bind(this,a)).on("end",gb.bind(this,a))).on("mouseout",jb).on("mouseover",kb.bind(this,a)).on("click",ma).on("click.centroidClick",lb.bind(this,Lb[a],a,!1));if(fd)for(a in gd){var b=gd[a].x*Yc.distance+Yc.originalx,c=gd[a].y*Yc.distance+Yc.originaly;Tb.append("circle").attr("class","server-centroid").attr("id","server-centroid-"+a).attr("r",5).attr("cx",b).attr("cy",c).style("fill","black")}}function db(a,b){var c=14;return a+","+(b-c)+" "+(a+c)+","+(b+c)+" "+(a-c)+","+(b+c)}function eb(a){ib()&&(ad=Date.now(),Tb.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+a).attr("points",db(Pb.event.x,Pb.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Hc[a].colour).style("opacity",.5))}function fb(a){ib()&&Pb.select("#dragged-"+a).attr("points",db(Pb.event.x,Pb.event.y))}function gb(a){if(Pb.selectAll(".dragged-centroid").remove(),ib()){if(Date.now()-ad<300)return void lb(Lb[a],a,!1);Ic[a].ci=hb(Pb.event);for(var b=[],c=0;c<Jc.length;c++)b[c]=Na(c);Kc=Jc,Jc=b,Sa(Zc);var d=Nb.iteration+": "+Bc;document.getElementById("clustering").innerHTML=d;var e=Pa(Bc);Yc.iteration=Bc++,Qa(e)}}function hb(a){for(var b,c,d,e=Number.MAX_SAFE_INTEGER,f=-1,g=0;g<Jc.length;g++)c=a.x-Jc[g].x,d=a.y-Jc[g].y,(b=Math.sqrt(c*c+d*d))<e&&(e=b,f=g);return f}function ib(){if(!Jc||!document.getElementById("clustering"))return!1;if(document.getElementById("clustering").innerHTML==Nb.convergence)return!1;for(var a in Ic)if(void 0===Ic[a].ci)return!1;return 3==pc}function jb(){Lc||(Pb.selectAll(".text").remove(),Pb.selectAll("rect").remove(),Ac&&(Xb.style("display","none").style("opacity",0),Yb.remove()))}function kb(a){if(!Lc){Pb.selectAll(".text").remove(),Pb.selectAll("rect").remove();var b=Tb.append("rect"),c=[0],d=1==pc?Hc:Ic,e=Tb.append("text").attr("class","text").attr("id","t-"+a).attr("y",d[a].y+32).attr("dy",".40em").style("pointer-events","none").text(a).call(o,30,d[a].x-18+8,c),f=18*c[0]+16;if(f+d[a].y+10>=Vb&&e.attr("y",Vb-f-(Vb-d[a].y)).text(a).call(o,30,d[a].x-18+8,c),b.attr("id","r-"+a).attr("x",d[a].x-18).attr("y",f+d[a].y+10<=Vb?d[a].y+16:Vb-f-16-(Vb-d[a].y)).attr("width",46).attr("height",f).style("stroke","black").style("fill","yellow"),Ac){Yb.remove();var g,h={};for(g=0;g<cc.nodes.length;g++)cc.nodes[g].visible||(h[cc.nodes[g].id]=1);var i,j,k,l,n={};for(g=fc[0];g<cc.edges[a].length&&g<=fc[1];g++)i=cc.edges[a][g],"string"==typeof i.source?(j=parseInt(i.source),k=parseInt(i.target)):(j=i.source.id,k=i.target.id),h[j]||h[k]||(l=j+"_"+k,n[l]?n[l]++:n[l]=1);var p,q=[],r=cc.edges[a][0].colour;for(i in n)p=i.split("_"),q[q.length]={source:p[0],target:p[1],weight:n[i],colour:r};for(g=0;g<cc.links.length;g++)q[q.length]=cc.links[g];Wb.force("link").links(q),m(q),Xb.style("display","block").style("opacity",1),Wb.restart(),setTimeout(function(){Wb.stop(),Xb.lower(),Yb.lower()},1)}}}function lb(a,b,c){if(Ac&&!document.getElementById("textbox-"+a)&&null!==ja()){var d=document.createElement("textarea");d.id="textbox-"+a,d.style.resize="both",d.style.position="absolute",Kb[a]&&(d.value=Kb[a]),bd!=Bb&&(d.readOnly=!0),document.body.appendChild(d);var e,f=d.getBoundingClientRect(),g=document.getElementsByTagName("svg")[0].getBoundingClientRect(),h=c?Jc[b].x:Ic[b].x;e=h+f.width/2>=Ub?h+g.x-f.width:h-f.width/2<=0?h+g.x:h+g.x-f.width/2,d.style.left=e+"px";var i=c?Jc[b].y:Ic[b].y,j=i+190>=Vb?i+140:i+290;c&&(j=i+165>=Vb?i+165:i+265),d.style.top=j+"px";var k=document.createElement("button");k.innerHTML=bd==Bb?Nb.save:Nb.close,k.id=a,k.style.position="absolute",k.style.left=e+"px",k.style.top=j+f.height+"px",document.body.appendChild(k),d.focus(),d.addEventListener("click",function(){this.parentNode.appendChild(this),k.parentNode.appendChild(k),this.focus()});var l=!1;d.addEventListener("mousedown",function(){l=!0}),d.addEventListener("mouseup",function(){l=!1}),d.addEventListener("mousemove",function(){l&&(f=this.getBoundingClientRect(),k.style.left=e+"px",k.style.top=j+f.height+"px")}),k.addEventListener("click",function(){if(bd==Bb){var b={coordsid:Jb,clusterid:Yc.clusterId,studentid:a,remark:d.value};""!=d.value&&d.value!=Kb[a]&&(Kb[a]=d.value,x(ob,b))}document.body.removeChild(d),document.body.removeChild(k)})}}var mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd,hd={},id=[];b(a)}});