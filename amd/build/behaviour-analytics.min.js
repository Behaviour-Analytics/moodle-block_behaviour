(function(e){if("function"==typeof define&&define.amd){define ("block_behaviour/behaviour-analytics",[],e)}else{window.behaviourAnalytics=e()}})(function(){return function behaviourAnalytics(e){var vt,kt,Et,ft,It,Lt,Bt,Tt,wt,Mt,Ht,Ct,At,St,Nt,_t,Rt,qt,Kt,jt,Ft,Ot,Ut,zt,Wt,Dt,Xt,Gt,Pt,Yt,Zt,Jt,Qt,Vt,$t,en,tn,nn,ln,rn,sn,dn,on,an,cn,yn,un,pn,gn,mn,hn,xn,bn,vn,kn,En,fn,In,Ln,Bn,Tn,wn,Mn,Hn,Cn,An,Sn,Nn,_n,Rn,qn,Kn,jn,Fn,On,Un,zn,Wn,Dn,Xn,Gn,Pn,Yn,Zn,Jn,Qn,Vn,$n,el,tl,nl,ll,il,rl,sl,dl,ol,al,cl,yl,ul,pl,gl,ml,hl={},xl=[],bl,vl,kl,El,fl,Il,Ll,Bl;function t(e){Lt=e.logs;Bt=e.users;Tt=e.groups;wt=e.members;Ht=e.mods;Ct=e.panelwidth;At=e.legendwidth;St=e.name;Nt=e.iframeurl;il=e.version36;rl=e.showstudentnames;_t=e.positioning;Rt=e.positioning;qt=e.nodecoords;Kt=e.links;Ft=e.courseid;Ot=e.userid;jt=e.scale;Ut=e.graphs;zt=e.alllinks;Wt=e.scales;Dt=e.changes;Xt=e.names;Gt=e.allmods;Pt=e.setnames;Yt=Ot;Zt=e.lastchange;Jt=e.comments;$t=e.strings;vt=e.coordsscript;kt=e.clustersscript;Et=e.commentsscript;ft=e.manualscript;It=e.deletescript;en=e.sesskey;ml=e.gotallnodes;Ln=e.replaying;Ll=e.debugcentroids;Bl=e.centroids;El=e.isresearcher;kl=Ot;tn=e.replaydata;nn=window.dataDrivenDocs;rn=window.noUiSlider;var t=window.mersenneTwister;sn=new t(259);jn=0;Kn=n();dl=Date.now()+3e3;gl=1e3;ln=nn.transition().duration(gl).ease(nn.easeLinear);Sn=120;sl=1;xn=1e-4;gn=1;yl=K;Xn=!1;Gn=220;Yn=.15;Pn=nn.curveCatmullRomClosed;Il=!0;Rn={};pl={};Fn={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown",data:"coral",chat:"maroon",choice:"grey",feedback:"lime",glossary:"navy",survey:"tan",wiki:"teal",workshop:"silver",scorm:"tomato",imscp:"lightpink",folder:"peru"};On=["blue","red","orange","green","yellow","brown","purple","magenta","cyan"];fn=_t?0:36;Ct=_t?0:Ct;on=window.innerWidth-Sn-At-150;an=window.innerHeight-fn-90;ul=450>Math.min(on,an)?6:8;Qt={};Bt.forEach(function(e){Qt[e.id]=e.realId});l();s();if(Ln){le(e.manualdata)}else if(_t){a()}else{y()}}function n(){return["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"]}function l(){Ht.forEach(function(e){while(!Fn[e.entype]){var t=Kn[Math.floor(sn.random()*Kn.length)],n=!0;for(var l in Fn){if(Fn[l]==t){n=!1}}Fn[e.entype]=n?t:void 0}})}function s(){bn={nodes:[],links:[],edges:{},maxSession:0};d();o()}function d(){var e=bn,t={},i,s,d;Ht.forEach(function(n){i=!0;s=void 0;d=void 0;if(qt[n.id]){i=1==qt[n.id].visible&&1==qt["g"+n.sect].visible?!0:!1;if(1==qt[n.id].visible&&!i){qt[n.id].visible=0}s=qt[n.id].xcoord;d=qt[n.id].ycoord}else if(qt["g"+n.sect]){i=1==qt["g"+n.sect].visible&&Ot==Yt?!0:!1}e.nodes[e.nodes.length]={id:n.id,name:n.name,group:n.sect,type:n.type,entype:n.entype,colour:Fn[n.entype],visible:i,xcoord:s,ycoord:d};if(!t[n.sect]){if(qt["g"+n.sect]){i=1==qt["g"+n.sect].visible?!0:!1;s=qt["g"+n.sect].xcoord;d=qt["g"+n.sect].ycoord}t[n.sect]={id:"g"+n.sect,name:$t.section+" "+n.sect,group:n.sect,type:"grouping",colour:Fn.grouping,visible:i,xcoord:s,ycoord:d};e.nodes[e.nodes.length]=t[n.sect]}e.links[e.links.length]={source:"g"+n.sect,target:n.id,weight:gn,colour:Fn.originalLinks}});s=d=void 0;if(qt.root){s=qt.root.xcoord;d=qt.root.ycoord}var a={id:"root",name:St,group:-1,type:"grouping",colour:Fn.grouping,visible:!0,xcoord:s,ycoord:d};for(var r in t){e.links[e.links.length]={source:"root",target:t[r].id,weight:gn,colour:Fn.originalLinks}}e.nodes[e.nodes.length]=a;if(0<Object.keys(Kt).length){var o,c,y;for(var u in Kt){y=u.split("_");o=y[0];c=y[1];e.links[e.links.length]={source:o,target:c,weight:5*Kt[u],colour:Fn.originalLinks}}if(!Rt){for(var l in e.nodes){if(isNaN(e.nodes[l].id)){e.nodes[l].visible=!1}}}}}function o(){var e=bn,t=0,l=0,r;fl={};for(var s=0;s<Lt.length;s++){r={source:Lt[s].moduleId,target:Lt[s].moduleId,weight:gn,user:Lt[s].userId,colour:""};if(!e.edges[Lt[s].userId]){e.edges[Lt[s].userId]=[];fl[Lt[s].userId]=[];e.maxSession=e.maxSession<t?t:e.maxSession;t=0;l=0}if(qt[Lt[s].moduleId]&&1==qt[Lt[s].moduleId].visible){fl[Lt[s].userId][l++]=Lt[s].moduleId}if(s+1<Lt.length&&Lt[s].userId==Lt[s+1].userId){r.target=Lt[s+1].moduleId;e.edges[Lt[s].userId][t++]=r}else if(0==e.edges[Lt[s].userId].length){e.edges[Lt[s].userId][t++]=r}}e.maxSession=e.maxSession<t?t:e.maxSession;Bt.forEach(function(t){if(!e.edges[t.id]){e.edges[t.id]=[]}})}function a(){Un=!1;mn=.01;hn=.01;ol=j;al=F;cl=O;if(ml&&0<Object.keys(qt).length){gn=0}if(Ut&&Wt){T()}u(.6);A();c();setTimeout(function(){cn.force("charge",null).force("x",null).force("y",null)},500)}function c(){var e=document.getElementById("student-menu"),t=document.createElement("input");t.id="weight-slider";t.type="range";t.min="-0.2";t.max="2";t.step="0.2";t.value="0.6";t.style.width="130px";t.addEventListener("change",function(){pn.strength(this.value);document.getElementById("weights-output").innerHTML="&nbsp;= "+this.value});e.appendChild(t);var n=document.createTextNode($t.linksweight);e.appendChild(n);n=document.createElement("label");n.id="weights-output";n.innerHTML="&nbsp;= "+t.value;e.appendChild(n)}function y(){Un=!0;_t=!0;mn=0;ol=null;al=null;cl=null;if(!ml||0==Object.keys(qt).length){u(.6);setTimeout(function(){var e=U();D();z(e);X()},500)}else{var e=U();D();z(e);u(0);X()}pn=null}function u(e){dn=nn.select("#graph").append("svg").attr("width",on).attr("height",an);pn=nn.forceLink(bn.links).id(function(e){return e.id}).strength(e);cn=nn.forceSimulation(bn.nodes).force("link",pn).force("charge",nn.forceManyBody().strength(-80)).force("collide",nn.forceCollide().radius(12)).force("center",nn.forceCenter(on/2,an/2)).force("x",nn.forceX()).force("y",nn.forceY());p(bn.nodes,yl,ol,al,cl);g(bn.links);dn.on("click",function(){nn.selectAll("#rctext").remove();nn.selectAll("#rcrect").remove();if(Un||_t){yn.on("mouseover",m).on("mouseout",b)}if(Ln){yn.on("mouseover",null).on("mouseout",null)}});if(ml&&_t&&0<Object.keys(qt).length){cn.on("tick",k)}else{cn.on("tick",E)}for(var t=0;80>t;t++){cn.tick()}if(_t){setTimeout(function(){cn.stop();cn.on("tick",E);f();if(0==Object.keys(qt).length||!ml){I();bn.edges={};o();ml=!0;gn=Un?1:0}},500)}if(Un&&!ml){setTimeout(function(){bn.nodes=[];bn.links=[];d()},600)}}function p(e,t,n,l,i){yn=dn.selectAll(".node").data(e).enter().append("circle").attr("class","node").attr("r",ul).on("mouseover",m).on("mouseout",b).on("contextmenu",t).call(nn.drag().on("start",n).on("drag",l).on("end",i))}function g(e){un=dn.selectAll(".link").data(e).enter().append("line").attr("class","link").style("stroke",function(e){return e.colour}).style("stroke-width",function(e){return 2*e.weight+"px"})}function m(e,n){if(el){return}yn.on("mouseover",null);if(!n){nn.selectAll(".text").remove();nn.selectAll("rect").remove()}if(150>Date.now()-dl){return}var l=[0],i=!1,s=!1,d=!1,o=150,a=304,c=154,y=e.type+": "+e.name;if(tl){a=0;c=0}var u=dn.append("text").attr("class","text").attr("id","t-"+e.id).attr("y",e.y+32).attr("dy",".40em").style("pointer-events","none").text(y).call(h,o,e.x-(o+6)/2+8,l),t=16*l[0]+16;if(t+e.y>=an-c){u.attr("y",an-t-(an-e.y)).text(y).call(h,o,e.x-(o+6)/2+8,l);i=!0}if(e.x<=a/2){u.text(y).call(h,o,e.x+8,l);d=!0}else if(e.x>=on-a/2){u.text(y).call(h,o,e.x-(o+6)+8,l);s=!0}var p;if(d){p=e.x}else if(s){p=e.x-(o+6)}else{p=e.x-(o+6)/2}var g=dn.append("rect").attr("id","r-"+e.id).attr("x",p).attr("y",i?an-t-16-(an-e.y):e.y+16).attr("width",o+16).attr("height",t).style("stroke","black").style("fill","yellow");u.raise();if(!isNaN(e.id)){if(tl){a=400;c=300}x(e,t,o,a,c,i,d,s,parseInt(g.attr("x")),parseInt(g.attr("y")))}}function h(e,t,n,l){var i=0;e.each(function(){var e=nn.select(this),l=e.text().split(/\s+/).reverse(),r,s=[],d=e.attr("y"),o=parseFloat(e.attr("dy")),a=e.text(null).append("tspan").attr("x",n).attr("y",d).attr("dy",o+"em");r=l.pop();while(r){s.push(r);a.text(s.join(" "));if(a.node().getComputedTextLength()>t){s.pop();a.text(s.join(" "));s=[r];a=e.append("tspan").attr("x",n).attr("y",d).attr("dy",++i*1.1+o+"em").text(r)}r=l.pop()}});l[0]=++i}function x(e,t,n,l,i,r,s,d,o,a){var c=document.createElement("iframe");c.id="preview";c.style.position="absolute";c.style.width=l+"px";c.style.height=i+"px";var y=document.getElementsByTagName("svg")[0].getBoundingClientRect(),u=document.body.getBoundingClientRect();if(0<u.x){u.x=0}if(nl){c.style.left=window.innerWidth-10-l+"px"}else if(tl){c.style.left="10px"}else if(s){c.style.left=o+y.x+"px"}else if(d){c.style.left=o+y.x+n-l+18+"px"}else{c.style.left=o+y.x-l/2+n/2+"px"}var p=il?0:50;if(tl){c.style.top=y.y-u.y+an/2+"px"}else if(r){c.style.top=p+a+y.y-u.y-i+"px"}else{c.style.top=p+a+y.y+t-u.y+"px"}if("lti"!=e.entype&&"unknown"!=e.type){var g=document.createElement("div");g.id="bgrnd";g.style.position="absolute";g.style.width=parseInt(c.style.width)+24+"px";g.style.height=parseInt(c.style.height)+24+"px";g.style.left=parseInt(c.style.left)-12+"px";g.style.top=parseInt(c.style.top)-12+"px";g.addEventListener("mouseout",function(e){var t=this.getBoundingClientRect();if(e.x>t.x&&e.x<t.x+t.width&&e.y>t.y&&e.y<t.y+t.height){return}ll=!1;setTimeout(v,750)});g.addEventListener("mouseover",function(){ll=!0});c.src=Nt+"mod/"+e.entype+"/view.php?id="+e.id;document.body.appendChild(g);document.body.appendChild(c)}}function b(e){if(el||"lightgrey"==e.colour){return}yn.on("mouseout",null);un.on("mouseout",null);setTimeout(v,750)}function v(){if(ll){return}nn.selectAll(".text").remove();nn.selectAll("rect").remove();nn.selectAll("#preview").remove();nn.selectAll("#bgrnd").remove();yn.on("mouseover",m).on("mouseout",b);if(tl){un.on("mouseover",We).on("mouseout",b);for(var e=0;e<Qn.length;e++){nn.select("#cluster1-"+e).on("mouseover",Ue.bind(this,e,!1));nn.select("#cluster2-"+e).on("mouseover",Ue.bind(this,e,!1))}}}function k(){var e=on/2,t=an/2,n=jt;if(pl.originalx===void 0){pl.originalx=e;pl.originaly=t}else{e=pl.originalx;t=pl.originaly}for(var l=0,r,s;l<bn.nodes.length;l++){r=bn.nodes[l].xcoord*n+e;s=bn.nodes[l].ycoord*n+t;if(0>r||r>on||0>s||s>an){n*=.9;--l}}jt=n;pl.distance=n;un.attr("x1",function(i){var l=bn.nodes.filter(function(e){var t="string"==typeof i.source?i.source:i.source.id;return e.id==t})[0];nn.select(this).attr("y1",l.ycoord*n+t);return l.xcoord*n+e}).attr("x2",function(i){var l=bn.nodes.filter(function(e){var t="string"==typeof i.target?i.target:i.target.id;return e.id==t})[0];nn.select(this).attr("y2",l.ycoord*n+t);return l.xcoord*n+e}).style("display",function(e){return!e.source.visible||!e.target.visible?"none":"block"});yn.attr("cx",function(t){t.x=t.xcoord*n+e;return t.x}).attr("cy",function(e){e.y=e.ycoord*n+t;return e.y}).style("display",function(e){return!e.visible?"none":"block"}).style("fill",function(e){return e.colour}).raise()}function E(){var e=ul;un.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).style("stroke-width",function(e){return 2*e.weight+"px"}).style("display",function(e){return e.source.visible&&e.target.visible?"block":"none"});yn.attr("cx",function(t){t.x=Math.max(e,Math.min(on-e,t.x));return t.x}).attr("cy",function(t){t.y=Math.max(e,Math.min(an-e,t.y));return t.y}).style("fill",function(e){return e.colour}).style("display",function(e){return e.visible?"block":"none"}).raise();nn.selectAll("rect").raise();nn.selectAll("text").raise()}function f(){if(!Xt){return}nn.select("#time").remove();if(0==Zt){Zt=Date.now()}var e=new Date;e.setTime(Zt);var t=e.getMinutes();if(10>t){t="0"+t}dn.append("text").attr("id","time").attr("y",an-16).attr("dy",".40em").attr("x",6).style("pointer-events","none").text(Xt[Yt]+" "+e.getHours()+":"+t+" "+e.toDateString())}function I(){var e=L();if(Ut&&Wt){var t={};for(var n in e){if("scale"==n||"module"==n){continue}t[n]=e[n]}Ut[Ot]=t;Wt[Ot]=e.scale}e.time=Date.now();Zt=e.time;if(Dt){Dt[Ot]=e.time}B(vt,e)}function L(){var e={},t,n,l,i,r=0,s=on/2,o=an/2;bn.nodes.forEach(function(e){t=e.x-s;n=e.y-o;l=Math.sqrt(t*t+n*n);if(l>r){r=l;i=e}});e.scale=r;e.module=i.id;jt=r;bn.nodes.forEach(function(t){e[t.id]={xcoord:""+(t.x-s)/r,ycoord:""+(t.y-o)/r,visible:t.visible?1:0};if(!t.xcoord){t.xcoord=(t.x-s)/r;t.ycoord=(t.y-o)/r}});qt=e;return e}function B(e,t){var n=new XMLHttpRequest;n.open("POST",e);n.setRequestHeader("Content-type","application/x-www-form-urlencoded");n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){}};n.send("cid="+Ft+"&data="+JSON.stringify(t)+"&sesskey="+en)}function T(){var e=document.getElementById("student-menu"),t=document.createElement("button");t.innerHTML=$t.copy;t.className="btn btn-secondary mb-1";t.addEventListener("click",w);e.appendChild(t);var n=t.getBoundingClientRect().height,l=document.createElement("button");l.innerHTML=$t.print;l.className="btn btn-secondary mb-1";l.addEventListener("click",M);e.appendChild(l);qn=document.createElement("select");qn.size=3;qn.id="teacher-select";qn.style.minWidth="40px";var i=an-n-20;qn.style.height=i+"px";qn.addEventListener("change",H);for(var r in Wt){var s=document.createElement("option");s.value=r;s.text=r;if(Ot==r){s.selected=!0}qn.appendChild(s)}e.appendChild(qn)}function w(){var e=new Image,t=new XMLSerializer,n=t.serializeToString(dn.node());e.src="data:image/svg+xml;base64,"+window.btoa(n);document.body.appendChild(e);var l=document.createRange();l.setStartBefore(e);l.setEndAfter(e);l.selectNode(e);var i=window.getSelection();i.addRange(l);document.execCommand("Copy");document.body.removeChild(e)}function M(){var e=new XMLSerializer,t=e.serializeToString(dn.node()),n=window.open();n.document.write("<img src=\"data:image/svg+xml;base64,"+window.btoa(t)+"\"/>");n.print();n.close()}function H(){for(var e=document.getElementById("teacher-select"),t,n=0;n<e.options.length;n++){if(e.options[n].selected){t=e.options[n].value;break}}if(t==Ot){ol=j;al=F;cl=O;yl=K}else{ol=null;al=null;cl=null;yl=null}qt=Ut[t];Kt=zt[t];jt=Wt[t];Zt=Dt[t];Ht=Gt[t];St=Pt[t];Yt=t;dn.remove();Rn={};l();nn.selectAll("#legendUL").remove();A();gn=1;s();gn=0;var r=document.getElementById("weights-output").innerHTML;r=parseFloat(r.split(" ")[1]);u(r);for(var d in Rn){if(qt[d]){Rn[d].checked=1==qt[d].visible?!0:!1}if(Ot==t){Rn[d].removeEventListener("change",C);Rn[d].addEventListener("change",R)}else{Rn[d].removeEventListener("change",R);Rn[d].addEventListener("change",C)}}}function C(){this.checked=!this.checked}function A(){var t;_n=document.getElementById("legend");_n.style="width: "+At+"px; height: "+an+"px; min-width: "+At+"px; max-width: "+500+"px;";var n=function(t){var e=_n.offsetLeft+28;if(t.x>=e&&t.x<=e+6){_n.style.cursor="col-resize"}else{_n.style.cursor="auto"}},l=function(n){var e=t-n.x;t=n.x;var l=parseInt(_n.style.width)+e;if(l>500){l=500}else if(l<At){l=At}_n.style.width=l+"px"};_n.addEventListener("mousemove",n);_n.addEventListener("mousedown",function(n){t=n.x;if("col-resize"==_n.style.cursor){_n.addEventListener("mousemove",l)}});document.addEventListener("mouseup",function(){_n.removeEventListener("mousemove",l)});S(_n)}function S(e){var t=document.createElement("ul");t.id="legendUL";var n=document.createElement("span");n.className="no-select-text";n.innerHTML=St;var l=document.createElement("li");l.appendChild(n);var i=document.createElement("ul");l.appendChild(i);t.appendChild(l);var r,s,d,o=-1;Ht.sort(function(e,t){return e.sect-t.sect});Ht.forEach(function(e){if(o!=e.sect){s=document.createElement("ul");s.className="nested";d=document.createElement("span");d.className="caret";d.addEventListener("click",N);r=document.createElement("li");r.appendChild(d);_("g"+e.sect,$t.section+" "+e.sect,Fn.grouping,e.sect,"grouping",r);r.appendChild(s);i.appendChild(r);o=e.sect}r=document.createElement("li");r.className="indented";_(e.id,e.name,Fn[e.entype],e.sect,e.type,r);s.appendChild(r)});e.appendChild(t)}function N(){this.parentElement.querySelector(".nested").classList.toggle("active");this.classList.toggle("caret-down")}function _(e,t,n,l,i,r){var s=document.createElement("input");s.type="checkbox";if(qt[e]){s.checked=0==qt[e].visible?!1:!0}else if(qt["g"+l]){s.checked=1==qt["g"+l].visible&&Ot==Yt?!0:!1}else{s.checked=!0}s.id=e;s.group=l;s.nodeT=i;s.addEventListener("change",R);Rn[s.id]=s;var d=document.createElement("label");d.style.color=n;d.className="no-select-text";var o="grouping"==i?t:i+"_"+t;d.appendChild(document.createTextNode(o));r.appendChild(s);r.appendChild(d)}function R(){var e=this.id,t=this.checked,n=this.nodeT,l=this.group;bn.nodes.forEach(function(i){if(i.id==e){i.visible=t;Rn[i.id].checked=t}else if("grouping"==n&&i.group==l){i.visible=t;Rn[i.id].checked=t}else if(t&&"grouping"==i.type&&i.group==l){i.visible=t;Rn[i.id].checked=t}});q();G()}function q(){var e=parseFloat(document.getElementById("weight-slider").value);if(0>e){pn.strength(0);document.getElementById("weights-output").innerHTML="&nbsp;= 0";document.getElementById("weight-slider").value=0}}function K(e){nn.selectAll(".text").remove();nn.selectAll("rect").remove();nn.selectAll("#preview").remove();nn.selectAll("#bgrnd").remove();nn.event.preventDefault();if("root"==e.id){return}var n=e;yn.on("mouseover",null).on("mouseout",null);var l=dn.append("rect"),i=dn.append("text").attr("class","text").attr("id","rctext").attr("x",e.x+10).attr("y",e.y+12).attr("dy",".40em").style("pointer-events","none").text($t.hide);if(e.y+20>=an){i.attr("y",an-(an-e.y)-10).text($t.hide)}l.attr("id","rcrect").attr("x",e.x).attr("y",e.y+20<=an?e.y:an-(an-e.y)-20).attr("width",60).attr("height",24).style("stroke","black").style("fill","lightgrey");l.on("mouseover",function(){nn.event.target.style="fill: grey;"});l.on("mouseout",function(){nn.event.target.style="fill: lightgrey;"});l.on("click",function(){nn.selectAll("#rctext").remove();nn.selectAll("#rcrect").remove();yn.on("mouseover",m).on("mouseout",b);n.visible=!1;Rn[n.id].checked=!1;if("grouping"==n.type){bn.nodes.forEach(function(e){if(e.group==n.group){e.visible=!1;Rn[e.id].checked=!1}})}q();G()})}function j(e){if(!nn.event.active){cn.alphaTarget(hn).restart()}e.fx=e.x;e.fy=e.y}function F(e){nn.selectAll("rect").remove();nn.selectAll(".text").remove();nn.selectAll("#preview").remove();nn.selectAll("#bgrnd").remove();e.fx=nn.event.x;e.fy=nn.event.y}function O(e){if(!nn.event.active){if(_t){cn.stop();I();f()}else{cn.alphaTarget(xn)}}e.fx=null;e.fy=null;dl=Date.now()}function U(){var e=document.getElementById("student-menu");In=document.createElement("button");In.innerHTML=$t.cluster;In.className="btn btn-secondary mb-1";In.addEventListener("click",ne);e.appendChild(In);return In.getBoundingClientRect().height}function z(e){var t=document.getElementById("student-menu");vn=document.createElement("select");vn.multiple=!0;vn.id="student-select";var n=0<Tt.length?an-e-120:an-e-12;vn.style="height: "+n+"px;";vn.addEventListener("change",function(){for(var e=document.getElementById("student-select"),t=0,n;t<e.options.length;t++){n="box-shadow: 0 0 10px 100px "+e.options[t].colour+" inset;";e.options[t].style=e.options[t].selected?n:"box-shadow: 0 0 0 0 white inset;"}if(0<Lt.length){P(!0)}});if(1==rl){Bt.sort(function(e,t){var n=e.firstname+" "+e.lastname,l=t.firstname+" "+t.lastname;if(n>l){return 1}if(n<l){return-1}return 0})}else{Bt.sort(function(e,t){return e.id-t.id})}Bt.forEach(function(e){W(e,vn)});t.appendChild(vn)}function W(e,t){var n=document.createElement("option");n.value=e.id;n.text=1==rl?e.firstname+" "+e.lastname:e.id;n.colour=Kn[jn++];if(jn>=Kn.length){jn=0}bn.edges[e.id].forEach(function(e){e.colour=n.colour});t.appendChild(n)}function D(){if(0==Tt.length){return}var e=document.getElementById("student-menu");Mt=document.createElement("select");Mt.multiple=!0;Mt.id="group-select";Mt.style="height: 120px;";Mt.addEventListener("change",function(){nn.selectAll(".link").remove();nn.selectAll(".hull").remove();g(bn.links);cn.on("tick",k);cn.restart();setTimeout(cn.stop,100);vn.options.length=0;for(var e=0;e<Mt.options.length;e++){if(Mt.options[e].selected){for(var t=0;t<Bt.length;t++){if(wt[Bt[t].realId]==Mt.options[e].value){W(Bt[t],vn)}}}}});var t;for(var n in Tt){t=document.createElement("option");t.value=n;t.text=Tt[n];Mt.appendChild(t)}e.appendChild(Mt)}function X(){kn=document.getElementById("slider");En=[0,bn.maxSession];var e;if(500>bn.maxSession){e=10}else if(1e3>bn.maxSession){e=20}else if(5e3>bn.maxSession){e=100}else if(1e4>bn.maxSession){e=200}else{e=500}rn.create(kn,{start:[0,bn.maxSession],range:{min:[0],max:[bn.maxSession]},step:1,connect:!0,pips:{mode:"steps",stepped:!0,density:100,filter:function filter(t){if(0==t||t==bn.maxSession){return 1}else if(0==t%e){return 2}else{return 0}}}});setTimeout(function(){kn.noUiSlider.on("update",function(e,t){En[t]=parseInt(e[t]);vn.dispatchEvent(new Event("change"))})},1e3)}function G(){un.remove();yn.remove();nn.selectAll(".hull").remove();var e=Y(K);Z(e);Q(e);cn.alphaTarget(mn).restart();if(_t){setTimeout(function(){cn.stop();I();f()},100)}}function P(e){un.remove();yn.remove();nn.selectAll(".hull").remove();_t=!1;var t=Y(null);Z(t);if(e){Q(t)}_t=!0;cn.on("tick",k);cn.restart();setTimeout(cn.stop,100)}function Y(e){var t=[],n={};bn.nodes.forEach(function(e){if(null===e.fx){e.fx=e.x;e.fy=e.y}if(e.visible){t[t.length]=e}else{n[e.id]=1}});cn.nodes(t);p(t,e,ol,al,cl);return n}function Z(e){var t=[],n,l,r,s,d;for(d in bn.links){r=bn.links[d];if("string"==typeof r.source){n=r.source;l=r.target}else{n=r.source.id;l=r.target.id}if(e[n]||e[l]){continue}else{t[t.length]=r}}var o=_t?[]:document.getElementById("student-select").options;for(d=0;d<o.length;d++){if(o[d].selected){var a,c={},y;for(y=En[0];y<=En[1];y++){if(bn.edges[o[d].value].length>y){s=bn.edges[o[d].value][y];if("string"==typeof s.source){a=s.source+"_"+s.target;n=s.source;l=s.target}else{a=s.source.id+"_"+s.target.id;n=s.source.id;l=s.target.id}if(c[a]){c[a]++}else{c[a]=1}if(e[n]||e[l]){continue}else{t[t.length]=s}}else{break}}for(y=En[0];y<=En[1];y++){if(bn.edges[o[d].value].length>y){s=bn.edges[o[d].value][y];if("string"==typeof s.source){a=s.source+"_"+s.target}else{a=s.source.id+"_"+s.target.id}s.weight=c[a]}else{break}}}}cn.force("link").links(t);g(t)}function J(e){var t=bn.nodes.find(function(t){return t.id==e});return t}function Q(e){if(_t){return}nn.selectAll(".hull").remove();for(var t=document.getElementById("student-select").options,n={},l=0;l<t.length;l++){if(t[l].selected){var r,s,d,o,a,c,y;n[t[l].value]={};for(var u=En[0];u<=En[1];u++){if(bn.edges[t[l].value].length>u){var p=bn.edges[t[l].value][u];if("string"==typeof p.source){c=p.source;y=p.target;var g=J(c);r=g.x;s=g.y;g=J(y);d=g.x;o=g.y}else{c=p.source.id;y=p.target.id;r=p.source.x;s=p.source.y;d=p.target.x;o=p.target.y}if(e[c]||e[y]){continue}else{a=p.colour;n[t[l].value][c]={x:r,y:s,colour:a};n[t[l].value][y]={x:d,y:o,colour:a}}}else{break}}}}for(var m in n){ee(n[m],m,!1,!1)}if(Un){if(Il){$(t)}else{V(t)}}}function V(e){Zn={};if(0==Object.keys(fl).length){return}for(var t=0;t<e.length;t++){if(e[t].selected){var n=e[t].value;if(fl[n].length<=En[0]){continue}var l=En[0],r=fl[n].length>En[1]+1?En[1]:fl[n].length,s=parseInt(l/2+r/2),d=fl[n][s],o=parseFloat(qt[d].xcoord),a=parseFloat(qt[d].ycoord);Zn[n]={x:o*jt+pl.originalx,y:a*jt+pl.originaly,colour:e[t].colour}}}}function $(e){Zn={};if(0==Object.keys(fl).length){return}for(var t=0;t<e.length;t++){if(e[t].selected){var l=e[t].value;if(fl[l].length<=En[0]){continue}for(var r=En[0],s=fl[l].length>En[1]+1?En[1]:fl[l].length,d=0,o=0,a=0,c=r,y;c<s;c++){y=fl[l][c];d+=parseFloat(qt[y].xcoord);o+=parseFloat(qt[y].ycoord);a++}Zn[l]={x:d/a*jt+pl.originalx,y:o/a*jt+pl.originaly,colour:e[t].colour}}}}function ee(e,t,n,l){if(0==Object.keys(e).length){return}var i=[],r,s,d;if(Un){d="hull"}else if(n){d="manual-hull"}else{d="cluster-hull"}for(var o in e){i[i.length]=[e[o].x,e[o].y];r=e[o].colour}if(1==i.length){s=function(e){var t=[e[0][0],e[0][1]-20],n=[e[0][0],e[0][1]+20];return"M "+t+" A "+[20,20,"0,0,0",n].join(",")+" A "+[20,20,"0,0,0",t].join(",")}}else if(2==i.length){var a=function(e,t){return[t[0]-e[0],t[1]-e[1]]},c=function(e,t){return[t*e[0],t*e[1]]},y=function(e,t){return[e[0]+t[0],e[1]+t[1]]},u=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return c(e,1/t)},p=function(e,t){return c(u(e),t)},g=function(e,t){if(t!==void 0){e=a(e,t)}var n=[-e[1],e[0]];return u(n)};s=function(e){var t=a(e[0],e[1]),n=p(t,20),l=y(e[0],c(n,-1)),i=y(e[1],n),r=p(g(t),24),s=c(r,-1),d=y(l,s),o=y(i,s),u=y(l,r);return"M "+l+" C "+[d,o,i].join(",")+" S "+[u,l].join(",")+" Z"}}else{var m=nn.concaveHull().padding(15);if(!Xn){m.distance(Gn)}var h=4<i.length?m(i):[i];s=nn.line().curve(Pn);dn.selectAll("#hull-"+t).data(h).enter().append("path").attr("id","hull-"+t).attr("class",d).style("stroke",r).style("stroke-opacity",l?0:1).style("fill",r).style("fill-opacity",l?0:Yn).attr("d",s);return}dn.append("path").attr("id","hull-"+t).attr("class",d).style("stroke",r).style("stroke-opacity",l?0:1).style("fill",r).style("fill-opacity",l?0:Yn).attr("d",s(i))}function te(){clearInterval(Dn);Dn=void 0;Jn=null;Te();nn.selectAll(".clustering-centroid").remove();nn.selectAll(".cluster-hull").remove();nn.selectAll(".centroid").remove();nn.selectAll(".server-centroid").remove();Cn.style.display="none";document.getElementById("anim-controls").style.display="none";document.getElementById("log-panel").style.display="none";var e=document.getElementById("student-menu");e.style.width=In.style.width;document.getElementById("clustering-replay-comment").innerHTML="&nbsp";Un=!0;tl=!1;kn.style.display="block";vn.style.display="block";if(Mt){Mt.style.display="block"}yn.style("display","block");yn.style("opacity",1);un.style("display","block");un.style("opacity",1);P(!0);yn.on("mouseover",m).on("mouseout",b);In.innerHTML=$t.cluster;In.removeEventListener("click",te);In.addEventListener("click",ne)}function ne(){Un=!1;kn.style.display="none";vn.style.display="none";if(Mt){Mt.style.display="none"}nn.selectAll(".hull").remove();nn.selectAll(".text").remove();nn.selectAll("rect").remove();var e=document.getElementById("student-menu");e.style.width=Sn+"px";In.innerHTML=$t.graph;In.removeEventListener("click",ne);In.addEventListener("click",te);cn.stop();yn.on("mouseover",null).on("mouseout",null).on("contextmenu",null).call(nn.drag().on("start",null).on("drag",null).on("end",null));pl.clusterId=Date.now();Jt={};Wn=0;zn=!1;An=1;Dn=void 0;document.getElementById("clustering-replay-comment").innerHTML="&nbsp";var t="<p id=\"cluster-text\">"+$t.numclusters+"</p>";setTimeout(function(){if(!Cn){var e=Se();Qe(t,e);ot()}else{document.getElementById("clustering").innerHTML="&nbsp";document.getElementById("dragdrop").innerHTML="&nbsp";document.getElementById("cluster-text").innerHTML=t;document.getElementById("play-pause").innerHTML="&#9654";document.getElementById("play-pause").disabled=!0;document.getElementById("play-step").disabled=!0;document.getElementById("anim-controls").style.display="block";document.getElementById("log-panel").style.display="block";Cn.removeAttribute("disabled");Cn.noUiSlider.set(1);Cn.style.display="block"}at()},gl/2)}function le(e){_t=!0;qt={0:0,1:1,2:2};an=window.innerHeight-190;Ie();ot();ie(e)}function ie(e){var t=document.getElementById("student-menu");Bn=document.createElement("select");Bn.size=3;Bn.id="replay-select";Bn.style="height: "+(an-12)+"px;";Bn.addEventListener("change",re.bind(this,e));for(var n in tn){var l=0;for(var r in tn[n]){var s=0;l++;for(var d in tn[n][r]){if(!isNaN(d)&&tn[n][r][d][1]){var a=document.createElement("option");a.value=n+"_"+r+"_"+d;a.text=n.split("-")[0]+"_"+l+"_"+ ++s;Bn.appendChild(a)}}}}t.appendChild(Bn)}function re(e){var t=ke(e),n=t.members;if(dn){dn.remove();we();Te();document.getElementById("replayer").innerHTML="&nbsp;";document.getElementById("replaydragdrop").innerHTML="&nbsp;"}if(vn){document.body.removeChild(vn)}Jn=null;l();s();En=[0,bn.maxSession];document.getElementById("replay-stop").style.opacity=1;document.getElementById("replay-pause").style.opacity=1;document.getElementById("replay-back").style.opacity=1;document.getElementById("replay-forward").style.opacity=1;document.getElementById("delete-button").style.opacity=1;for(var r=0;r<bn.nodes.length;r++){if(bn.nodes[r].xcoord===void 0){bn.nodes[r].visible=!1}}Ee(n);u(0);P(!1);yn.on("mouseover",null).on("mouseout",null);$n=!0;document.getElementById("clustering-replay-comment").innerHTML="&nbsp";qe();setTimeout(function(){fe(Zn,!1);at();cn.on("tick",k);for(var n in Zn){nn.select("#centroid-"+n).call(nn.drag().on("start",se.bind(this,n)).on("drag",de.bind(this,n)).on("end",oe.bind(this,n,e,t)))}},500)}function se(e){if(!ue(e)){return}vl=Date.now();dn.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+e).attr("points",ct(nn.event.x,nn.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Zn[e].colour).style("opacity",.5)}function de(e){nn.select("#dragged-"+e).attr("points",ct(nn.event.x,nn.event.y))}function oe(e,t,n){nn.selectAll(".dragged-centroid").remove();if(!ue(e)){return}if(300>Date.now()-vl){bt(Qt[e],e,!1);return}if(!bl){ge()}var l=pe();if(0==Object.keys(hl[l]).length){for(var r=0;r<Tn[l].length;r++){for(var s in Tn[l][r].members){var d=Vt[Tn[l][r].members[s].id];hl[l][d]=r}}}var o=gt(nn.event);for(var a in hl){if(a<=l){hl[a][e]=o}}me(l,t,n);bl=!0;ce(l);ae(l)}function ae(e){for(var t={clusterCoords:[],members:[]},n=0,l;n<xl.length;n++){l=xl[n]?xl[n]:Qn[n];t.clusterCoords[n]=Ze(l);t.clusterCoords[n].num=n;for(var r in hl[e]){if(hl[e][r]==n){t.members[t.members.length]={id:Qt[r],num:n}}}}t.iteration=e;t.clusterId=pl.clusterId;t.coordsid=Zt;B(ft,t)}function ce(e){if(0<=e||!hl[e]||0==Object.keys(hl[e]).length){return}var t=ye(e),n=$t.manualcluster+"<br>",l;for(l=0;l<xl.length;l++){if(!xl[l]){continue}var r=xl[l].x-on/2,s=xl[l].y-an/2,o=Math.sqrt(r*r+s*s),d=Qn[l].colour;n+=$t.disttocluster+" <span style=\"color:"+d+"\">"+d+"</span>: "+Math.round(o)+"<br>"+$t.cluster+" "+d+" "+$t.members+": [";for(var a in hl[e]){if(hl[e][a]==l){n+=a+", "}}if(-1!=n.indexOf(",",n.length-3)){n=n.slice(0,-2)}n+="]<br>";if(El){n+=$t.precision+": "+t[l].precision.toFixed(4)+"<br>";n+=$t.recall+": "+t[l].recall.toFixed(4)+"<br>";n+=$t.f1+": "+t[l].f1.toFixed(4)+"<br>";n+=$t.fhalf+": "+t[l].fhalf.toFixed(4)+"<br>";n+=$t.f2+": "+t[l].f2.toFixed(4)+"<br>"}}var c=Nn.innerHTML.split("<br><br>"),y=c[0].split("<br>");Nn.innerHTML="";for(l=0;l<y.length;l++){if(y[l].startsWith($t.manualcluster)){break}Nn.innerHTML+=y[l]+"<br>"}if(El){l=t.length-1;n+=$t.totalmeasures+"<br>";n+=$t.precision+": "+t[l].precision.toFixed(4)+"<br>";n+=$t.recall+": "+t[l].recall.toFixed(4)+"<br>";n+=$t.f1+": "+t[l].f1.toFixed(4)+"<br>";n+=$t.fhalf+": "+t[l].fhalf.toFixed(4)+"<br>";n+=$t.f2+": "+t[l].f2.toFixed(4)+"<br>"}Nn.innerHTML+=n+"<br>";for(l=1;l<c.length;l++){Nn.innerHTML+=c[l]+"<br><br>"}}function ye(e){var t=0,n=0,l=0,s=[],d,o,a;for(a=0;a<Qn.length;a++){for(var c in Jn){if(Jn[c].ci==a&&hl[e][c]==Jn[c].ci){t++}else if(Jn[c].ci==a&&hl[e][c]!=Jn[c].ci){n++}else if(hl[e][c]==a&&hl[e][c]!=Jn[c].ci){l++}}d=t/(t+n);o=t/(t+l);s[a]={tp:t,fp:n,fn:l,precision:d,recall:o,f1:0==d+o?0:2*d*o/(d+o),fhalf:0==d+o?0:1.25*d*o/(.25*d+o),f2:0==d+o?0:5*d*o/(4*d+o)};t=0;n=0;l=0}for(a=0;a<s.length;a++){t+=s[a].tp;n+=s[a].fp;l+=s[a].fn}d=t/(t+n);o=t/(t+l);s[s.length]={tp:t,fp:n,fn:l,precision:d,recall:o,f1:0==d+o?0:2*d*o/(d+o),fhalf:0==d+o?0:1.25*d*o/(.25*d+o),f2:0==d+o?0:5*d*o/(4*d+o)};return s}function ue(e){if(document.getElementById("replayer").innerHTML!=$t.convergence){return!1}if(kl!=Ot){return!1}var t=Jn[e].ci,n=0,l;for(l in Jn){if(Jn[l].ci==t){n++}}var i=pe(),r=0;if(hl[i]){t=hl[i][e];for(l in hl[i]){if(hl[i][l]==t){r++}}}if(1==n&&1>=r){return!1}if(1==r){return!1}return!0}function pe(){var e=Nn.innerHTML.split("<br>");if(e[2]&&e[2].startsWith($t.iteration)){return parseInt(e[2].split(" ")[1])}else{return null}}function ge(){for(var e in Tn){if(0<=e){continue}hl[e]={};for(var t=0;t<Tn[e].length;t++){for(var n in Tn[e][t].members){var l=Vt[Tn[e][t].members[n].id];hl[e][l]=t}}}}function me(e,t,n){var r=[],s=[],d,o;for(d=0;d<Tn[e].length;d++){r[d]={};s[d]=[];for(o in hl[e]){if(hl[e][o]==d){var a=Jn[o].x,c=Jn[o].y;r[d][a+"_"+c]={x:a,y:c,colour:Qn[d].colour};s[d][s[d].length]=[a,c]}}}var y=document.getElementsByClassName("manual-centroid").length,l=0==y?!0:!1;nn.selectAll(".manual-hull").remove();for(d=0;d<r.length;d++){ee(r[d],-1*(d+1),!0,l);xl[d]=Ge(s[d])}if(t){if(!t[n.did]){t[n.did]={}}if(!t[n.did][n.gid]){t[n.did][n.gid]={}}if(!t[n.did][n.gid][n.cid]){t[n.did][n.gid][n.cid]={}}if(!t[n.did][n.gid][n.cid][e]){t[n.did][n.gid][n.cid][e]=[]}for(d=0;d<xl.length;d++){if(!xl[d]){continue}var u=[];for(o in hl[e]){if(hl[e][o]==d){u[u.length]={id:Qt[o],num:d}}}t[n.did][n.gid][n.cid][e][d]={centroidx:xl[d].x,centroidy:xl[d].y,members:u}}}if(l){xe()}else{be()}dn.selectAll(".centroid").raise();dn.selectAll(".clustering-centroid").raise();dn.selectAll(".manual-centroid").raise()}function he(){nn.event.stopPropagation()}function xe(){nn.selectAll(".manual-centroid").remove();for(var e=14,t=0,n,l;t<xl.length;t++){if(!xl[t]){return}n=xl[t].x;l=xl[t].y;dn.append("line").attr("class","manual-centroid").attr("id","manual1-"+t).attr("x1",n-e).attr("y1",l-e).attr("x2",n+e).attr("y2",l+e).style("stroke",Qn[t].colour).style("stroke-width","5px").style("opacity",0).on("click",he).on("click.centroidClick",bt.bind(this,-1*(t+1),t,!0)).on("mouseover",Ue.bind(this,t,!0));dn.append("line").attr("class","manual-centroid").attr("id","manual2-"+t).attr("x1",n+e).attr("y1",l-e).attr("x2",n-e).attr("y2",l+e).style("stroke",Qn[t].colour).style("stroke-width","5px").style("opacity",0).on("click",he).on("click.centroidClick",bt.bind(this,-1*(t+1),t,!0)).on("mouseover",Ue.bind(this,t,!0))}nn.selectAll(".manual-centroid").transition().duration(gl).style("opacity",.5);nn.selectAll(".manual-hull").transition().duration(gl).style("stroke-opacity",1).style("fill-opacity",Yn)}function be(){for(var e=14,t=0,n,l;t<xl.length;t++){if(!xl[t]){nn.selectAll(".manual-centroid").remove();return}n=xl[t].x;l=xl[t].y;nn.select("#manual1-"+t).transition().duration(gl).attr("x1",n-e).attr("y1",l-e).attr("x2",n+e).attr("y2",l+e).style("display","block");nn.select("#manual2-"+t).transition().duration(gl).attr("x1",n+e).attr("y1",l-e).attr("x2",n-e).attr("y2",l+e).style("display","block")}}function ve(e){if(!e||0<e){dn.selectAll(".manual-centroid").remove();dn.selectAll(".manual-hull").remove();return}if(!bl){return}me(e,null,null)}function ke(e){var t=document.getElementById("replay-select"),n,l;for(l=0;l<t.options.length;l++){if(t.options[l].selected){n=t.options[l].value.split("_");break}}var r=n[0],s=n[1],d=n[2];kl=r.split("-")[0];pl.clusterId=d;Zt=tn[r][s].last;qt=tn[r][s].nodes;Kt=tn[r][s].links;jt=tn[r][s].scale;Ht=tn[r][s].mods;Tn=tn[r][s][d];Lt=tn[r][s].logs;Bt=tn[r][s].users;Jt=tn[r][s][d].comments;Vt={};Qt={};Bt.forEach(function(e){Qt[e.id]=e.realId;Vt[e.realId]=e.id});Wn=0;An=1;Mn=0;Hn=0;for(var o in Tn){if(isNaN(o)){continue}else if(0<=o){Mn++}else{Hn--}}xl=[];hl={};bl=!1;var a=e[r][s][d],y,u;if(a){bl=!0;for(l=-1;l>=Hn;l--){if(a[l]&&!a[l-1]){a[l-1]=a[l]}hl[l]={};for(y in a[l]){for(u in a[l][y].members){var p=a[l][y].members[u].id;hl[l][Vt[p]]=y}}}}Qn=[];Zn={};var g={},m=0;for(y in Tn[1]){l=Qn.length;Qn[l]={x:0,y:0};if(m<On.length){Qn[l].colour=On[m++]}else{var h;while(!h){h=Kn[Math.floor(sn.random()*Kn.length)];h=On.includes(h)?void 0:h}Qn[l].colour=h}for(u in Tn[1][y].members){var x=Vt[Tn[1][y].members[u].id];Zn[x]={x:Tn[1][y].members[u].x,y:Tn[1][y].members[u].y};g[x]=!0}}return{members:g,did:r,gid:s,cid:d}}function Ee(e){vn=document.createElement("select");vn.multiple=!0;vn.id="student-select";vn.style.display="none";jn=0;Bt.forEach(function(e){W(e,vn)});for(var t=0,n;t<vn.options.length;t++){n=vn.options[t].value;if(e[n]){vn.options[t].selected=!0}else{vn.options[t].selected=!1}if(Zn[n]){Zn[n].colour=vn.options[t].colour}}document.body.appendChild(vn)}function fe(e,t){for(var n in e){e[n].x*=pl.distance;e[n].x+=pl.originalx;e[n].y*=pl.distance;e[n].y+=pl.originaly;if(t){e[n].x-=pl.centre.x;e[n].x*=pl.scale;e[n].x+=on/2;e[n].y-=pl.centre.y;e[n].y*=pl.scale;e[n].y+=an/2}}}function Ie(){var e=document.getElementById("slider"),t=document.createElement("p");t.innerHTML="&nbsp";t.id="replayer";t.style.marginTop="-20px";e.appendChild(t);var n=document.createElement("p");n.innerHTML="&nbsp";n.id="replaydragdrop";n.style.marginTop="-12px";e.appendChild(n);var l=document.createElement("button");l.id="replay-stop";l.innerHTML="&#9606";l.addEventListener("click",Be);l.style.opacity=0;e.appendChild(l);var i=document.createElement("button");i.id="replay-pause";i.innerHTML="&#9654";i.value="play";i.addEventListener("click",Me);i.style.opacity=0;e.appendChild(i);var r=document.createElement("button");r.id="replay-back";r.innerHTML="&#9614&#9664";r.addEventListener("click",Ce);r.style.opacity=0;e.appendChild(r);var s=document.createElement("button");s.id="replay-forward";s.style.marginRight="80px";s.innerHTML="&#9654&nbsp&nbsp&#9614";s.addEventListener("click",He.bind(this,!0));s.style.opacity=0;e.appendChild(s);var d=document.createElement("button");d.id="delete-button";d.innerHTML=$t.delbutton;d.addEventListener("click",Le);d.style.opacity=0;e.appendChild(d)}function Le(){if(confirm($t.delconfirm)){var e=document.getElementById("replay-select");if(-1<e.selectedIndex){var t=e.options[e.selectedIndex].value;if(0<t.length){B(It,t.replace("-","_"));e.options[e.selectedIndex]=null;Be()}}}}function Be(){if(dn){setTimeout(function(){dn.remove();Te();document.getElementById("replayer").innerHTML="&nbsp;";document.getElementById("replaydragdrop").innerHTML="&nbsp;"},500)}Tn=void 0;Jn=null;we();document.getElementById("clustering-replay-comment").innerHTML="&nbsp";document.getElementById("replay-stop").style.opacity=0;document.getElementById("replay-pause").style.opacity=0;document.getElementById("replay-back").style.opacity=0;document.getElementById("replay-forward").style.opacity=0;document.getElementById("delete-button").style.opacity=0;var e=document.getElementById("replay-select");if(-1<e.selectedIndex){e.options[e.selectedIndex].selected=!1}}function Te(){Nn.readOnly=!1;Nn.innerHTML="";setTimeout(function(){Nn.readOnly=!0},300)}function we(){var e=document.getElementById("replay-pause");e.innerHTML="&#9654";e.value="play";clearInterval(Dn);Dn=void 0}function Me(){if(!Tn){return}var e=document.getElementById("replay-pause");if("play"==e.value){e.innerHTML="&#9613&#9613";e.value="pause";He(!1);Dn=setInterval(He.bind(this,!1),1200)}else{we()}}function He(e){if(!Tn){return}if(e){we()}Wn++;var t=Wn-1;if(Wn>Mn&&Tn[-1]){t=Mn-Wn+1;if(!Tn[t-1]){Wn--;we();return}}if(t>Mn){Wn--;we();return}if(1==Wn){An=2;zn=!0;$n=!1;tt()}else if(2==Wn){nt();Ae(t-1,!1,!0)}else{Ae(t-1,!1,!1)}}function Ce(){if(!Tn||!wn||0>Wn-1){return}we();Wn--;var e=Wn-1;if(Wn>Mn){e=Mn-Wn+1}if(0==Wn){An=1;et();zn=!1;Nn.innerHTML=Nn.innerHTML.slice(Nn.innerHTML.indexOf("<br><br>")+8);document.getElementById("replayer").innerHTML="&nbsp;";document.getElementById("replaydragdrop").innerHTML="&nbsp;"}else if(1==Wn){Jn=null;tt();Nn.innerHTML=Nn.innerHTML.slice(Nn.innerHTML.indexOf("<br><br>")+8);document.getElementById("replayer").innerHTML="&nbsp;";document.getElementById("replaydragdrop").innerHTML="&nbsp;"}else{Jn=null;Ae(e-1,!0,2==Wn)}}function Ae(e,t,n){var l=[],r={},s,d={};for(s=0;s<Tn[e].length;s++,d={}){dn.selectAll("#hull-"+s).remove();Qn[s].x=Tn[e][s].centroidx;Qn[s].y=Tn[e][s].centroidy;for(var o in Tn[e][s].members){var a=Tn[e][s].members[o].x,c=Tn[e][s].members[o].y,y=Vt[Tn[e][s].members[o].id];Zn[y].x=a;Zn[y].y=c;d[a+"_"+c]={x:a,y:c,colour:Qn[s].colour};r[y]=s}l[s]=d}fe(Qn,!0);if(n){Fe()}else{fe(Zn,!1);for(s=0;s<l.length;s++){fe(l[s],!0);ee(l[s],s,!1,!1)}Je(gl)}lt(wn[2],wn[0],wn[1],gl);dn.selectAll(".centroid").raise();dn.selectAll(".clustering-centroid").raise();ve(e);if(t){Nn.innerHTML=Nn.innerHTML.slice(Nn.innerHTML.indexOf("<br><br>")+8)}else{for(var u in r){Jn[u].ci=r[u]}Pe(e);ce(e)}if(0>e){document.getElementById("replayer").innerHTML=$t.convergence;document.getElementById("replayer").style.color="green";if(El){var p=document.getElementById("replay-select").options;for(s=0;s<p.length;s++){if(p[s].selected){var g=p[s].value.split("-")[0];if(g==Ot){document.getElementById("replaydragdrop").innerHTML=$t.dragon}break}}}else{document.getElementById("replaydragdrop").innerHTML=$t.dragon}}else{document.getElementById("replayer").innerHTML=$t.iteration+" "+e;document.getElementById("replayer").style.color="black";document.getElementById("replaydragdrop").innerHTML=$t.dragoff}}function Se(){var e=document.getElementById("anim-controls");e.appendChild(document.createTextNode($t.runkmeans));var t=document.createElement("p");t.innerHTML="&nbsp";t.id="clustering";e.appendChild(t);var n=document.createElement("p");n.innerHTML="&nbsp";n.id="dragdrop";n.style.marginTop="-12px";e.appendChild(n);var l=document.createElement("button");l.id="play-pause";l.style.marginLeft="5px";l.style.marginRight="5px";l.innerHTML="&#9654";l.className="btn btn-secondary";l.addEventListener("click",Re);l.disabled=!0;var i=document.createElement("button");i.id="play-step";i.style.marginLeft="5px";i.innerHTML="&#9654&nbsp&nbsp&#9614";i.className="btn btn-secondary";i.addEventListener("click",_e.bind(this,l));i.disabled=!0;e.appendChild(i);e.appendChild(l);var r=document.createElement("button");r.id="stop";r.style.marginTop="5px";r.style.marginLeft="5px";r.innerHTML=$t.reset;r.className="btn btn-secondary";r.addEventListener("click",Ne);e.appendChild(r);return e}function Ne(){zn=!1;Wn=0;clearInterval(Dn);Dn=void 0;pl.clusterId=Date.now();Cn.removeAttribute("disabled");document.getElementById("clustering-replay-comment").innerHTML="&nbsp";if(3==An){Cn.noUiSlider.set(2);setTimeout(function(){Cn.noUiSlider.set(1);An=1},gl)}else{Cn.noUiSlider.set(1);An=1}document.getElementById("clustering").innerHTML="&nbsp";document.getElementById("dragdrop").innerHTML="&nbsp";document.getElementById("play-pause").innerHTML="&#9654";document.getElementById("play-pause").disabled=!0;document.getElementById("play-step").disabled=!0;if(document.getElementById("num-clusters")){document.getElementById("num-clusters").readOnly=!1;document.getElementById("num-clusters").value=""}nn.selectAll(".clustering-centroid").transition(ln).style.display="none";nn.selectAll(".cluster-hull").transition(ln).style.display="none";setTimeout(function(){nn.selectAll(".clustering-centroid").remove();nn.selectAll(".cluster-hull").remove();Te()},gl);for(var e in Jn){Jn[e].ci=void 0}}function _e(e){if(3!=An){return}if(Dn){clearInterval(Dn);Dn=void 0;e.innerHTML="&#9654";Cn.removeAttribute("disabled")}else{Ke()}}function Re(){if(3!=An){return}if(!Dn){Dn=setInterval(Ke,1e3);this.innerHTML="&#9613&#9613";Cn.setAttribute("disabled",!0)}else{clearInterval(Dn);Dn=void 0;this.innerHTML="&#9654";Cn.removeAttribute("disabled")}}function qe(){var e=document.getElementById("clustering-replay-comment"),t=document.createElement("input");t.type="text";t.id="clustering-replay-comment-text";if(Jt[0]){t.value=Jt[0]}else{t.placeholder=$t.clusteringname}e.appendChild(t);var n=document.createElement("button");n.innerHTML=$t.clusteringnamebutton;e.appendChild(n);n.addEventListener("click",function(){if(kl==Ot){if(""!=t.value){var e={coordsid:Zt,clusterid:pl.clusterId,studentid:0,remark:t.value};B(Et,e);var n=document.getElementById("replay-select");if(n){for(var l,r=0;r<n.options.length;r++){if(n.options[r].selected){l=n.options[r].value.split("_");break}}var s=l[0],d=l[1],o=l[2];tn[s][d][o].comments[0]=t.value}}}})}function Ke(){if(0==Wn){zn=!0;qe();var e=document.getElementById("num-clusters"),t=parseInt(e.value);if(isNaN(t)||2>t){t=3}var n={};for(var l in Zn){n[Zn[l].x+"_"+Zn[l].y]=1}while(t>Object.keys(n).length){t--}e.value=t;e.readOnly=!0;Qn=[];Vn=null;var r,s;for(r=0,s=0;r<t;r++){if(s<On.length){Qn[r]=je(null,On[s++])}else{var d;while(!d){d=Kn[Math.floor(sn.random()*Kn.length)];d=On.includes(d)?void 0:d}Qn[r]=je(null,d)}}Fe();document.getElementById("clustering").innerHTML=$t.randcentroids;document.getElementById("dragdrop").innerHTML=$t.dragoff;document.getElementById("clustering").style.color="black";var o=Pe(Wn);pl.iteration=Wn;Ye(o)}else{De(Wn);Je(gl)}Wn++;if(document.getElementById("clustering").innerHTML==$t.convergence){clearInterval(Dn);Dn=void 0;Cn.removeAttribute("disabled");document.getElementById("play-pause").innerHTML="&#9654";document.getElementById("play-pause").disabled=!0;document.getElementById("play-step").disabled=!0}}function je(e,t){var n=on-100,l=100,i=an-100,r=100,s,o,a,c,y=0;if(e){while(100>y){s=Math.floor(Math.random()*(n-l)+l);o=Math.floor(Math.random()*(i-r)+r);a=s-e.x;c=o-e.y;y=Math.sqrt(a*a+c*c)}}else{s=Math.floor(Math.random()*(n-l)+l);o=Math.floor(Math.random()*(i-r)+r)}return{x:s,y:o,colour:t}}function Fe(){nn.selectAll(".clustering-centroid").remove();var e,t,n;for(e=0;e<Qn.length;e++){t=Qn[e].x;n=Qn[e].y;dn.append("line").attr("class","clustering-centroid").attr("id","cluster1-"+e).attr("x1",t-14).attr("y1",n-14).attr("x2",t+14).attr("y2",n+14).style("stroke",Qn[e].colour).style("stroke-width","5px").on("click",he).on("click.centroidClick",bt.bind(this,-1*(e+1),e,!0)).on("mouseover",Ue.bind(this,e,!1));dn.append("line").attr("class","clustering-centroid").attr("id","cluster2-"+e).attr("x1",t+14).attr("y1",n-14).attr("x2",t-14).attr("y2",n+14).style("stroke",Qn[e].colour).style("stroke-width","5px").on("click",he).on("click.centroidClick",bt.bind(this,-1*(e+1),e,!0)).on("mouseover",Ue.bind(this,e,!1))}}function Oe(e,n,l){var r={},d,o,a,c,y,u;for(d in e){for(u=En[0];u<bn.edges[d].length&&u<=En[1];u++){o=bn.edges[d][u];if("string"==typeof o.source){a=parseInt(o.source);c=parseInt(o.target)}else{a=o.source.id;c=o.target.id}if(n[a]||n[c]){continue}y=a+"_"+c;if(a>c){y=c+"_"+a}if(!r[y]){r[y]={};r[y][d]=1}else if(!r[y][d]){r[y][d]=1}else{r[y][d]++}}}var p=[],g,m;for(g in r){if(Object.keys(r[g]).length==l){var h=Number.MAX_SAFE_INTEGER;for(m in r[g]){if(h>r[g][m]){h=r[g][m]}}var x=g.split("_");p[p.length]={source:x[0],target:x[1],weight:h,colour:"black"}}}for(u=0;u<bn.links.length;u++){p[p.length]=bn.links[u]}return p}function Ue(e,t){un.remove();$n=!0;el=!1;tl=!0;dn.on("click",ze);var n={},l;if(t){var r=pe();for(l in hl[r]){if(hl[r][l]==e){n[l]=l}}}else{for(l in Jn){if(Jn[l].ci==e){n[l]=l}}}var s=Object.keys(n).length,d={},o;for(o=0;o<bn.nodes.length;o++){if(!bn.nodes[o].visible){d[bn.nodes[o].id]=1}}var a=Oe(n,d,s);yn.style("display","block").style("opacity",1).on("mouseover",m).on("mouseout",b);cn.force("link").links(a);g(a);un.on("mouseover",We).on("mouseout",b);cn.restart();setTimeout(function(){cn.stop();un.lower();nn.selectAll(".cluster-hull").lower()},10)}function ze(){$n=!1;el=!0;tl=!1;un.remove();yn.style("display","none").on("mouseover",null).on("mouseout",null);dn.on("click",null)}function We(e){if("black"!=e.colour){return}un.on("mouseover",null);yn.on("mouseover",null).on("mouseout",null);nn.selectAll(".clustering-centroid").on("mouseover",null);m(e.source);nl=!0;m(e.target,!0);nl=!1}function De(e){if(document.getElementById("clustering").innerHTML==$t.convergence){return}else if(0==Object.keys(Jn).length){document.getElementById("clustering").innerHTML=$t.convergence;return}var t=$t.iteration+": "+e,n,l,r,s;for(n in Jn){Jn[n].ci=gt(Jn[n])}var d=[];for(l=0;l<Qn.length;l++){d[l]=Xe(l)}Vn=Qn;Qn=d;var o=!1;if(Vn){var a=0;for(l=0;l<Qn.length;l++){r=Vn[l].x-Qn[l].x;s=Vn[l].y-Qn[l].y;a+=Math.sqrt(r*r+s*s)}if(a<=sl){t=$t.convergence;document.getElementById("clustering").style.color="green";o=!0}}document.getElementById("clustering").innerHTML=t;document.getElementById("dragdrop").innerHTML=0<e&&!o?$t.dragon:$t.dragoff;var c=Pe(e);pl.iteration=o?-1:e;Ye(c)}function Xe(e){var t=[],n={},l;for(l in Jn){if(Jn[l].ci==e){t[t.length]=[Jn[l].x,Jn[l].y];n[Jn[l].x+"_"+Jn[l].y]={x:Jn[l].x,y:Jn[l].y,colour:Qn[e].colour}}}dn.selectAll("#hull-"+e).remove();ee(n,e,!1,!1);dn.selectAll(".centroid").raise();dn.selectAll(".clustering-centroid").raise();var i=Object.keys(n);if(0==i.length){return je(Qn[e],Qn[e].colour)}else{var r=Ge(t);r.colour=Qn[e].colour;return r}}function Ge(e){if(0==e.length){return null}var t=0,n=0,l;for(l=0;l<e.length;l++){t+=e[l][0];n+=e[l][1]}return{x:t/e.length,y:n/e.length}}function Pe(e){var t=$t.numstudents+": "+Object.keys(Jn).length+"<br>"+$t.numofclusters+": "+Qn.length+"<br>"+$t.iteration+": "+e+"<br>";if(document.getElementById("clustering")&&document.getElementById("clustering").innerHTML==$t.convergence){t+="<span style=\"color:green\">"+$t.convergence+"</span><br>"}var n=[],l,r,s,o,a,y;for(l=0;l<Qn.length;l++){r=Qn[l].x-on/2;s=Qn[l].y-an/2;o=Math.sqrt(r*r+s*s);y=Qn[l].colour;t+=$t.disttocluster+" <span style=\"color:"+y+"\">"+y+"</span>: "+Math.round(o,2)+"<br>"+$t.cluster+" "+y+" "+$t.members+": [";n[l]=[];for(a in Jn){if(Jn[a].ci==l){t+=a+", ";n[l][n[l].length]=a}}if(-1!=t.indexOf(",",t.length-3)){t=t.slice(0,-2)}t+="]<br>"}t+="<br>";Nn.innerHTML=t+Nn.innerHTML;return n}function Ye(e){var t={clusterCoords:[]},n,l,r;for(n=0;n<e.length;n++){t.clusterCoords[n]=Ze(Qn[n]);t.clusterCoords[n].num=n;for(l=0;l<e[n].length;l++){r=Ze(Jn[e[n][l]]);e[n][l]={id:Qt[e[n][l]],num:n,x:r.x,y:r.y}}}t.members=e;t.iteration=pl.iteration;t.clusterId=pl.clusterId;t.coordsid=Zt;t.usegeometric=Il?1:0;if((0!=En[0]||En[1]!=bn.maxSession)&&0>t.iteration){t.iteration=Wn}B(kt,t)}function Ze(e){var t=(e.x-on/2)/pl.scale+pl.centre.x,n=(e.y-an/2)/pl.scale+pl.centre.y;t=(t-pl.originalx)/pl.distance;n=(n-pl.originaly)/pl.distance;return{x:t,y:n}}function Je(e){var t,n,l;for(t=0;t<Qn.length;t++){n=Qn[t].x;l=Qn[t].y;nn.select("#cluster1-"+t).transition().duration(e).attr("x1",n-14).attr("y1",l-14).attr("x2",n+14).attr("y2",l+14);nn.select("#cluster2-"+t).transition().duration(e).attr("x1",n+14).attr("y1",l-14).attr("x2",n-14).attr("y2",l+14)}}function Qe(e,t){Cn=document.getElementById("cluster-slider");rn.create(Cn,{start:[1],handles:1,range:{min:1,max:3},step:1,orientation:"vertical",direction:"rtl",pips:{mode:"steps",stepped:!0,density:100,filter:function filter(){return 1},format:{to:function to(t){switch(t){case 1:return $t.showcentroids;case 2:return $t.removegraph;case 3:return e;default:return"";}},from:function from(){return""}}}});Cn.noUiSlider.on("update",$e);Cn.style="margin-top: 20px;";var n=In.getBoundingClientRect().height,l=t.getBoundingClientRect().height;Cn.style.height=an-n-l-120+"px";var i=document.createElement("input");i.type="radio";i.name="centroid-type";i.value="geometric";i.style="margin-top: 40px";i.checked=!0;i.addEventListener("click",Ve);var r=document.createElement("label");r.appendChild(i);r.appendChild(document.createTextNode($t.geometrics));Cn.appendChild(r);if(0==Object.keys(Kt).length){i=document.createElement("input");i.type="radio";i.name="centroid-type";i.value="decomposed";i.addEventListener("click",Ve);r=document.createElement("label");r.appendChild(i);r.appendChild(document.createTextNode($t.decomposed));Cn.appendChild(r)}}function Ve(){Il="geometric"==this.value?!0:!1;dn.selectAll(".centroid").remove();var e=[],t=0,n;for(n in Zn){e[t++]={value:n,selected:!0,colour:Zn[n].colour}}if(Il){$(e)}else{V(e)}ne()}function $e(e,t){var n,l;switch(parseInt(e[t])){case 1:if(3==An){Cn.noUiSlider.set(2);break}An=1;et();if(!zn){n=document.getElementsByName("centroid-type");for(l in n){n[l].disabled=!1}}break;case 2:An=2;tt();n=document.getElementsByName("centroid-type");for(l in n){n[l].disabled=!0}document.getElementById("play-pause").disabled=!0;document.getElementById("play-step").disabled=!0;if(document.getElementById("dragdrop").innerHTML==$t.dragon){document.getElementById("dragdrop").innerHTML="--"}break;case 3:if(1==An){Cn.noUiSlider.set(2);break}An=3;nt();if(!zn){var i="<input type=\"text\" placeholder=\""+$t.numclusters+"\" id=\"num-clusters\" size=\"8\" pattern=\"[0-9]{1,2}\">";document.getElementById("cluster-text").innerHTML=i}document.getElementById("play-pause").disabled=!1;document.getElementById("play-step").disabled=!1;if(document.getElementById("clustering").innerHTML==$t.convergence){document.getElementById("play-pause").disabled=!0;document.getElementById("play-step").disabled=!0}if("--"==document.getElementById("dragdrop").innerHTML){document.getElementById("dragdrop").innerHTML=$t.dragon}break;}}function et(){P(!1);yn.on("mouseover",null).on("mouseout",null);lt(1,0,0,gl);setTimeout(function(){nn.selectAll(".centroid").raise()},100)}function tt(){yn.transition(ln).style("opacity",0);un.transition(ln).style("opacity",0);nn.selectAll(".clustering-centroid").transition(ln).style("opacity",0);nn.selectAll(".cluster-hull").transition(ln).style("opacity",0);setTimeout(function(){yn.style("display","none");un.style("display","none");nn.selectAll(".clustering-centroid").style("display","none");nn.selectAll(".cluster-hull").style("display","none")},gl);if(!zn&&document.getElementById("cluster-text")){document.getElementById("cluster-text").innerHTML=$t.numclusters}var e=it();if(null===e){return}pl.scale=e[2];wn=e;setTimeout(function(){lt(e[2],e[0],e[1],gl)},gl/2)}function nt(){nn.selectAll(".clustering-centroid").transition(ln).style("display","block").style("opacity",1);nn.selectAll(".cluster-hull").transition(ln).style("display","block").style("opacity",1);nn.selectAll(".clustering-centroid").raise()}function lt(e,n,l,i){var t,r,s,d,o,a=on/2,c=an/2,u;if(!Jn){Jn={};for(u in Zn){Jn[u]={x:0,y:0}}}pl.centre={x:n,y:l};for(u in Zn){t=Zn[u].x;r=Zn[u].y;s=(t-n)*e;d=(r-l)*e;if(1==e&&0==n&&0==l){t=n+s;r=l+d}else{t=a+s;r=c+d}Jn[u].x=t;Jn[u].y=r;o=t+","+(r-14)+" "+(t+14)+","+(r+14)+" "+(t-14)+","+(r+14);nn.select("#centroid-"+u).transition().duration(i).attr("points",o)}var p=function(e,t){e*=pl.distance;e+=pl.originalx;t*=pl.distance;t+=pl.originaly;e-=pl.centre.x;e*=pl.scale;e+=on/2;t-=pl.centre.y;t*=pl.scale;t+=an/2;return{x:e,y:t}};for(u in Bl){var g=p(Bl[u].x,Bl[u].y);t=g.x;r=g.y;nn.select("#server-centroid-"+u).transition().duration(i).attr("cx",t).attr("cy",r)}}function it(){var e=[],t;if(Ln){return rt()}for(t in Zn){e[e.length]=[Zn[t].x,Zn[t].y]}var n=st(e);if(null===n){return null}var l=[n.x,n.y],i,r,s,d,o=0,a=0;for(t in Zn){i=Math.abs(Zn[t].x-l[0]);r=Math.abs(Zn[t].y-l[1]);if(i>o){o=i;s=t}if(r>a){a=r;d=t}}if(d===void 0&&s===void 0){l[2]=1;return l}var c=Zn[s].x-l[0]+on/2,y=Zn[s].y-l[1]+an/2,u=dt(c,y,on/2,an/2);c=Zn[d].x-l[0]+on/2;y=Zn[d].y-l[1]+an/2;var p=dt(c,y,on/2,an/2);l[2]=u<p?u:p;l[2]*=.9;return l}function rt(){var e=[],t=0,n=0,l;for(l in Tn){if(0<=l&&1!=l){continue}for(var r in Tn[l]){for(var s in Tn[l][r].members){t=Tn[l][r].members[s].x;t=t*jt+pl.originalx;n=Tn[l][r].members[s].y;n=n*jt+pl.originaly;e[e.length]=[t,n]}}}var d=st(e);if(null===d){return null}var o=[d.x,d.y],a,c,u,p,g=0,m=0,h;for(h=0;h<e.length;h++){a=Math.abs(e[h][0]-o[0]);c=Math.abs(e[h][1]-o[1]);if(a>g){g=a;u=h}if(c>m){m=c;p=h}}if(p===void 0&&u===void 0){o[2]=1;return o}var b=e[u][0]-o[0]+on/2,v=e[u][1]-o[1]+an/2,k=dt(b,v,on/2,an/2);b=e[p][0]-o[0]+on/2;v=e[p][1]-o[1]+an/2;var E=dt(b,v,on/2,an/2);o[2]=k<E?k:E;o[2]*=.9;return o}function st(e){if(0==e.length){return null}else if(1==e.length){return{x:e[0][0],y:e[0][1]}}var t=0,n=0,l=on,r=an,s,d,o;for(s=0;s<e.length;s++){d=e[s][0];o=e[s][1];if(d>t){t=d}if(d<l){l=d}if(o>n){n=o}if(o<r){r=o}}return{x:(t+l)/2,y:(n+r)/2}}function dt(e,t,n,l){var i=e-n,r=t-l,s=0<i?on:0,d=0<r?an:0,o=(s-on/2)/i,a=(d-an/2)/r;if(isFinite(o)&&isFinite(a)&&o<=a){return o}else if(isFinite(o)&&!isFinite(a)){return o}else if(isFinite(a)){return a}else{return 1}}function ot(){var e=document.getElementById("log-panel");e.style.width=At+"px";var t=document.createElement("button");t.innerHTML=$t.copy;t.className="btn btn-secondary mb-1";t.addEventListener("click",function(){window.getSelection().selectAllChildren(Nn);document.execCommand("copy")});if(il){t.style.marginLeft="10px"}else{t.style.position="absolute";t.style.right=At-40+"px"}e.appendChild(t);var n=document.createElement("button");n.innerHTML=$t.print;n.className="btn btn-secondary mb-1";n.addEventListener("click",function(){var e=window.open();e.document.write("<html><head></head><body>");e.document.write(Nn.innerHTML);e.document.write("</body></html>");e.print();e.close()});if(il){n.style.marginLeft="10px"}else{n.style.position="absolute";n.style.right=At-100+"px"}e.appendChild(n);Nn=document.createElement("div");Nn.readOnly=!0;Nn.style.overflow="scroll";Nn.style.width="200px";Nn.style.height=an+"px";Nn.style.resize="none";Nn.style.border="2px solid black";if(!il){Nn.style.position="absolute";Nn.style.right="6px";Nn.style.top="110px"}e.appendChild(Nn)}function at(){for(var e in Zn){dn.append("polygon").attr("class","centroid").attr("id","centroid-"+e).attr("points",ct(Zn[e].x,Zn[e].y)).style("stroke","black").style("stroke-width","3px").style("fill",Zn[e].colour).call(nn.drag().on("start",yt.bind(this,e)).on("drag",ut.bind(this,e)).on("end",pt.bind(this,e))).on("mouseout",ht).on("mouseover",xt.bind(this,e)).on("click",he).on("click.centroidClick",bt.bind(this,Qt[e],e,!1))}if(Ll){for(e in Bl){var t=Bl[e].x*pl.distance+pl.originalx,n=Bl[e].y*pl.distance+pl.originaly;dn.append("circle").attr("class","server-centroid").attr("id","server-centroid-"+e).attr("r",5).attr("cx",t).attr("cy",n).style("fill","black")}}}function ct(e,t){return e+","+(t-14)+" "+(e+14)+","+(t+14)+" "+(e-14)+","+(t+14)}function yt(e){if(!mt()){return}vl=Date.now();dn.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+e).attr("points",ct(nn.event.x,nn.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Zn[e].colour).style("opacity",.5)}function ut(e){if(!mt()){return}nn.select("#dragged-"+e).attr("points",ct(nn.event.x,nn.event.y))}function pt(e){nn.selectAll(".dragged-centroid").remove();if(!mt()){return}if(300>Date.now()-vl){bt(Qt[e],e,!1);return}Jn[e].ci=gt(nn.event);for(var t=[],n=0;n<Qn.length;n++){t[n]=Xe(n)}Vn=Qn;Qn=t;Je(gl);var l=$t.iteration+": "+Wn;document.getElementById("clustering").innerHTML=l;document.getElementById("dragdrop").innerHTML=$t.dragon;var r=Pe(Wn);pl.iteration=Wn++;Ye(r)}function gt(e){for(var t=Number.MAX_SAFE_INTEGER,n=-1,l=0,r,s,o;l<Qn.length;l++){s=e.x-Qn[l].x;o=e.y-Qn[l].y;r=Math.sqrt(s*s+o*o);if(r<t){t=r;n=l}}return n}function mt(){if(!Qn||!document.getElementById("clustering")){return!1}if(document.getElementById("clustering").innerHTML==$t.convergence){return!1}for(var e in Jn){if(Jn[e].ci===void 0){return!1}}if(3!=An){return!1}return!0}function ht(){if($n){return}nn.selectAll(".text").remove();nn.selectAll("rect").remove();if(zn&&(Ln||3==An)&&null!==pe()){yn.style("display","none").style("opacity",0);un.remove()}}function xt(e){if($n){return}nn.selectAll(".text").remove();nn.selectAll("rect").remove();var n=dn.append("rect"),l=[0],r=1==An?Zn:Jn,s=e;Bt.forEach(function(t){if(t.id==e){s=1==rl?t.firstname+" "+t.lastname:t.id}});var d=1==rl?70:30,o=dn.append("text").attr("class","text").attr("id","t-"+e).attr("y",r[e].y+32).attr("dy",".40em").style("pointer-events","none").text(s).call(h,d,r[e].x-(d+6)/2+8,l),t=18*l[0]+16;if(t+r[e].y+10>=an){o.attr("y",an-t-(an-r[e].y)).text(s).call(h,d,r[e].x-(d+6)/2+8,l)}n.attr("id","r-"+e).attr("x",r[e].x-(d+6)/2).attr("y",t+r[e].y+10<=an?r[e].y+16:an-t-16-(an-r[e].y)).attr("width",d+16).attr("height",t).style("stroke","black").style("fill","yellow");if(zn&&(Ln||3==An)&&null!==pe()){un.remove();var a={},c;for(c=0;c<bn.nodes.length;c++){if(!bn.nodes[c].visible){a[bn.nodes[c].id]=1}}var y={},u,p,m,x;for(c=En[0];c<bn.edges[e].length&&c<=En[1];c++){u=bn.edges[e][c];if("string"==typeof u.source){p=parseInt(u.source);m=parseInt(u.target)}else{p=u.source.id;m=u.target.id}if(a[p]||a[m]){continue}x=p+"_"+m;if(!y[x]){y[x]=1}else{y[x]++}}var b=[],v,k=bn.edges[e][0].colour;for(u in y){v=u.split("_");b[b.length]={source:v[0],target:v[1],weight:y[u],colour:k}}for(c=0;c<bn.links.length;c++){b[b.length]=bn.links[c]}cn.force("link").links(b);g(b);yn.style("display","block").style("opacity",1);cn.restart();setTimeout(function(){cn.stop();yn.lower();un.lower()},1)}}function bt(e,t,n){if(!zn||document.getElementById("textbox-"+e)||null===pe()){return}else if(!Ln&&zn&&3!=An){return}var l=document.createElement("textarea");l.id="textbox-"+e;l.style.resize="both";l.style.position="absolute";if(Jt[e]){l.value=Jt[e]}if(kl!=Ot){l.readOnly=!0}document.body.appendChild(l);var i=l.getBoundingClientRect(),r=document.getElementsByTagName("svg")[0].getBoundingClientRect(),s=n?Qn[t].x:Jn[t].x,d;if(s+i.width/2>=on){d=s+r.x-i.width}else if(0>=s-i.width/2){d=s+r.x}else{d=s+r.x-i.width/2}l.style.left=d+"px";var o=n?Qn[t].y:Jn[t].y,a=o+190>=an?o+140:o+290;if(n){a=o+165>=an?o+165:o+265}l.style.top=a+"px";var c=document.createElement("button");c.innerHTML=kl==Ot?$t.save:$t.close;c.id=e;c.style.position="absolute";c.style.left=d+"px";c.style.top=a+i.height+"px";document.body.appendChild(c);l.focus();l.addEventListener("click",function(){this.parentNode.appendChild(this);c.parentNode.appendChild(c);this.focus()});var y=!1;l.addEventListener("mousedown",function(){y=!0});l.addEventListener("mouseup",function(){y=!1});l.addEventListener("mousemove",function(){if(y){i=this.getBoundingClientRect();c.style.left=d+"px";c.style.top=a+i.height+"px"}});c.addEventListener("click",function(){if(kl==Ot){var t={coordsid:Zt,clusterid:pl.clusterId,studentid:e,remark:l.value};if(""!=l.value&&l.value!=Jt[e]){Jt[e]=l.value;B(Et,t)}}document.body.removeChild(l);document.body.removeChild(c)})}t(e)}});
//# sourceMappingURL=behaviour-analytics.min.js.map
