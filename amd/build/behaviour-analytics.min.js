/*! moodle-block_behaviour v0.7.6 28-01-2021 */
!function(a){"function"==typeof define&&define.amd?define([],a):window.behaviourAnalytics=a()}(function(){return function(a){function b(a){wb=a.logs,xb=a.users,yb=a.groups,zb=a.members,Bb=a.mods,Cb=a.panelwidth,Db=a.legendwidth,Eb=a.name,Fb=a.iframeurl,bd=a.version36,cd=a.showstudentnames,Gb=a.positioning,Hb=a.positioning,Ib=a.nodecoords,Jb=a.links,Lb=a.courseid,Mb=a.userid,Kb=a.scale,Nb=a.graphs,Ob=a.alllinks,Pb=a.scales,Qb=a.changes,Rb=a.names,Sb=a.allmods,Tb=a.setnames,Ub=Mb,Vb=a.lastchange,Wb=a.comments,Zb=a.strings,rb=a.coordsscript,sb=a.clustersscript,tb=a.commentsscript,ub=a.manualscript,vb=a.deletescript,$b=a.sesskey,md=a.gotallnodes,vc=a.replaying,td=a.debugcentroids,ud=a.centroids,qd=a.isresearcher,pd=Mb,_b=a.replaydata,ac=window.dataDrivenDocs,cc=window.noUiSlider;var b=window.mersenneTwister;dc=new b(259),Jc=0,Ic=c(),ed=Date.now()+3e3,ld=1e3,bc=ac.transition().duration(ld).ease(ac.easeLinear),Dc=120,dd=1,oc=1e-4,lc=1,id=J,Qc=!1,Rc=220,Tc=.15,Sc=ac.curveCatmullRomClosed,sd=!0,Gc={},kd={},Kc={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown",data:"coral",chat:"maroon",choice:"grey",feedback:"lime",glossary:"navy",survey:"tan",wiki:"teal",workshop:"silver",scorm:"tomato",imscp:"lightpink",folder:"peru"},Lc=["blue","red","orange","green","yellow","brown","purple","magenta","cyan"],tc=Gb?0:36,Cb=Gb?0:Cb,fc=window.innerWidth-Dc-Db-150,gc=window.innerHeight-tc-90,jd=Math.min(fc,gc)<450?6:8,Xb={},xb.forEach(function(a){Xb[a.id]=a.realId}),d(),e(),vc?ba(a.manualdata):Gb?h():j()}function c(){return["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"]}function d(){Bb.forEach(function(a){for(;!Kc[a.entype];){var b=Ic[Math.floor(dc.random()*Ic.length)],c=!0;for(var d in Kc)Kc[d]==b&&(c=!1);Kc[a.entype]=c?b:void 0}})}function e(){pc={nodes:[],links:[],edges:{},maxSession:0},f(),g()}function f(){var a,b,c,d=pc,e={};Bb.forEach(function(f){a=!0,b=void 0,c=void 0,Ib[f.id]?(a=1==Ib[f.id].visible&&1==Ib["g"+f.sect].visible,1!=Ib[f.id].visible||a||(Ib[f.id].visible=0),b=Ib[f.id].xcoord,c=Ib[f.id].ycoord):Ib["g"+f.sect]&&(a=1==Ib["g"+f.sect].visible&&Mb==Ub),d.nodes[d.nodes.length]={id:f.id,name:f.name,group:f.sect,type:f.type,entype:f.entype,colour:Kc[f.entype],visible:a,xcoord:b,ycoord:c},e[f.sect]||(Ib["g"+f.sect]&&(a=1==Ib["g"+f.sect].visible,b=Ib["g"+f.sect].xcoord,c=Ib["g"+f.sect].ycoord),e[f.sect]={id:"g"+f.sect,name:Zb.section+" "+f.sect,group:f.sect,type:"grouping",colour:Kc.grouping,visible:a,xcoord:b,ycoord:c},d.nodes[d.nodes.length]=e[f.sect]),d.links[d.links.length]={source:"g"+f.sect,target:f.id,weight:lc,colour:Kc.originalLinks}}),b=c=void 0,Ib.root&&(b=Ib.root.xcoord,c=Ib.root.ycoord);var f={id:"root",name:Eb,group:-1,type:"grouping",colour:Kc.grouping,visible:!0,xcoord:b,ycoord:c};for(var g in e)d.links[d.links.length]={source:"root",target:e[g].id,weight:lc,colour:Kc.originalLinks};if(d.nodes[d.nodes.length]=f,Object.keys(Jb).length>0){var h,i,j;for(var k in Jb)j=k.split("_"),h=j[0],i=j[1],d.links[d.links.length]={source:h,target:i,weight:5*Jb[k],colour:Kc.originalLinks};if(!Hb)for(var l in d.nodes)isNaN(d.nodes[l].id)&&(d.nodes[l].visible=!1)}}function g(){var a,b=pc,c=0,d=0;rd={};for(var e=0;e<wb.length;e++)a={source:wb[e].moduleId,target:wb[e].moduleId,weight:lc,user:wb[e].userId,colour:""},b.edges[wb[e].userId]||(b.edges[wb[e].userId]=[],rd[wb[e].userId]=[],b.maxSession=b.maxSession<c?c:b.maxSession,c=0,d=0),Ib[wb[e].moduleId]&&1==Ib[wb[e].moduleId].visible&&(rd[wb[e].userId][d++]=wb[e].moduleId),e+1<wb.length&&wb[e].userId==wb[e+1].userId?(a.target=wb[e+1].moduleId,b.edges[wb[e].userId][c++]=a):0==b.edges[wb[e].userId].length&&(b.edges[wb[e].userId][c++]=a);b.maxSession=b.maxSession<c?c:b.maxSession,xb.forEach(function(a){b.edges[a.id]||(b.edges[a.id]=[])})}function h(){Mc=!1,mc=.01,nc=.01,fd=K,gd=L,hd=M,md&&Object.keys(Ib).length>0&&(lc=0),Nb&&Pb&&y(),k(.6),D(),i(),setTimeout(function(){hc.force("charge",null).force("x",null).force("y",null)},500)}function i(){var a=document.getElementById("student-menu"),b=document.createElement("input");b.id="weight-slider",b.type="range",b.min="-0.2",b.max="2",b.step="0.2",b.value="0.6",b.style.width="130px",b.addEventListener("change",function(){kc.strength(this.value),document.getElementById("weights-output").innerHTML="&nbsp;= "+this.value}),a.appendChild(b);var c=document.createTextNode(Zb.linksweight);a.appendChild(c),c=document.createElement("label"),c.id="weights-output",c.innerHTML="&nbsp;= "+b.value,a.appendChild(c)}function j(){if(Mc=!0,Gb=!0,mc=0,fd=null,gd=null,hd=null,md&&0!=Object.keys(Ib).length){var a=N();Q(),O(a),k(0),R()}else k(.6),setTimeout(function(){var a=N();Q(),O(a),R()},500);kc=null}function k(a){ec=ac.select("#graph").append("svg").attr("width",fc).attr("height",gc),kc=ac.forceLink(pc.links).id(function(a){return a.id}).strength(a),hc=ac.forceSimulation(pc.nodes).force("link",kc).force("charge",ac.forceManyBody().strength(-80)).force("collide",ac.forceCollide().radius(12)).force("center",ac.forceCenter(fc/2,gc/2)).force("x",ac.forceX()).force("y",ac.forceY()),l(pc.nodes,id,fd,gd,hd),m(pc.links),ec.on("click",function(){ac.selectAll("#rctext").remove(),ac.selectAll("#rcrect").remove(),(Mc||Gb)&&ic.on("mouseover",n).on("mouseout",q),vc&&ic.on("mouseover",null).on("mouseout",null)}),md&&Gb&&Object.keys(Ib).length>0?hc.on("tick",s):hc.on("tick",t);for(var b=0;b<80;b++)hc.tick();Gb&&setTimeout(function(){hc.stop(),hc.on("tick",t),u(),0!=Object.keys(Ib).length&&md||(v(),pc.edges={},g(),md=!0,lc=Mc?1:0)},500),Mc&&!md&&setTimeout(function(){pc.nodes=[],pc.links=[],f()},600)}function l(a,b,c,d,e){ic=ec.selectAll(".node").data(a).enter().append("circle").attr("class","node").attr("r",jd).on("mouseover",n).on("mouseout",q).on("contextmenu",b).call(ac.drag().on("start",c).on("drag",d).on("end",e))}function m(a){jc=ec.selectAll(".link").data(a).enter().append("line").attr("class","link").style("stroke",function(a){return a.colour}).style("stroke-width",function(a){return 2*a.weight+"px"})}function n(a,b){if(!(Zc||(ic.on("mouseover",null),b||(ac.selectAll(".text").remove(),ac.selectAll("rect").remove()),Date.now()-ed<150))){var c=[0],d=!1,e=!1,f=!1,g=150,h=304,i=154,j=a.type+": "+a.name;$c&&(h=0,i=0);var k=ec.append("text").attr("class","text").attr("id","t-"+a.id).attr("y",a.y+32).attr("dy",".40em").style("pointer-events","none").text(j).call(o,g,a.x-(g+6)/2+8,c),l=16*c[0]+16;l+a.y>=gc-i&&(k.attr("y",gc-l-(gc-a.y)).text(j).call(o,g,a.x-(g+6)/2+8,c),d=!0),a.x<=h/2?(k.text(j).call(o,g,a.x+8,c),f=!0):a.x>=fc-h/2&&(k.text(j).call(o,g,a.x-(g+6)+8,c),e=!0);var m;m=f?a.x:e?a.x-(g+6):a.x-(g+6)/2;var n=ec.append("rect").attr("id","r-"+a.id).attr("x",m).attr("y",d?gc-l-16-(gc-a.y):a.y+16).attr("width",g+16).attr("height",l).style("stroke","black").style("fill","yellow");k.raise(),isNaN(a.id)||($c&&(h=400,i=300),p(a,l,g,h,i,d,f,e,parseInt(n.attr("x")),parseInt(n.attr("y"))))}}function o(a,b,c,d){var e=0;a.each(function(){var a,d=ac.select(this),f=d.text().split(/\s+/).reverse(),g=[],h=d.attr("y"),i=parseFloat(d.attr("dy")),j=d.text(null).append("tspan").attr("x",c).attr("y",h).attr("dy",i+"em");for(a=f.pop();a;)g.push(a),j.text(g.join(" ")),j.node().getComputedTextLength()>b&&(g.pop(),j.text(g.join(" ")),g=[a],j=d.append("tspan").attr("x",c).attr("y",h).attr("dy",1.1*++e+i+"em").text(a)),a=f.pop()}),d[0]=++e}function p(a,b,c,d,e,f,g,h,i,j){var k=document.createElement("iframe");k.id="preview",k.style.position="absolute",k.style.width=d+"px",k.style.height=e+"px";var l=document.getElementsByTagName("svg")[0].getBoundingClientRect(),m=document.body.getBoundingClientRect();m.x>0&&(m.x=0),k.style.left=_c?window.innerWidth-10-d+"px":$c?"10px":g?i+l.x+"px":h?i+l.x+c-d+18+"px":i+l.x-d/2+c/2+"px";var n=bd?0:50;if(k.style.top=$c?l.y-m.y+gc/2+"px":f?n+j+l.y-m.y-e+"px":n+j+l.y+b-m.y+"px","lti"!=a.entype&&"unknown"!=a.type){var o=document.createElement("div");o.id="bgrnd",o.style.position="absolute",o.style.width=parseInt(k.style.width)+24+"px",o.style.height=parseInt(k.style.height)+24+"px",o.style.left=parseInt(k.style.left)-12+"px",o.style.top=parseInt(k.style.top)-12+"px",o.addEventListener("mouseout",function(a){var b=this.getBoundingClientRect();a.x>b.x&&a.x<b.x+b.width&&a.y>b.y&&a.y<b.y+b.height||(ad=!1,setTimeout(r,750))}),o.addEventListener("mouseover",function(){ad=!0}),k.src=Fb+"/mod/"+a.entype+"/view.php?id="+a.id,document.body.appendChild(o),document.body.appendChild(k)}}function q(a){Zc||"lightgrey"==a.colour||(ic.on("mouseout",null),jc.on("mouseout",null),setTimeout(r,750))}function r(){if(!ad&&(ac.selectAll(".text").remove(),ac.selectAll("rect").remove(),ac.selectAll("#preview").remove(),ac.selectAll("#bgrnd").remove(),ic.on("mouseover",n).on("mouseout",q),$c)){jc.on("mouseover",Pa).on("mouseout",q);for(var a=0;a<Wc.length;a++)ac.select("#cluster1-"+a).on("mouseover",Na.bind(this,a,!1)),ac.select("#cluster2-"+a).on("mouseover",Na.bind(this,a,!1))}}function s(){var a=fc/2,b=gc/2,c=Kb;void 0===kd.originalx?(kd.originalx=a,kd.originaly=b):(a=kd.originalx,b=kd.originaly);for(var d,e,f=0;f<pc.nodes.length;f++)d=pc.nodes[f].xcoord*c+a,e=pc.nodes[f].ycoord*c+b,(d<0||d>fc||e<0||e>gc)&&(c*=.9,--f);Kb=c,kd.distance=c,jc.attr("x1",function(d){var e=pc.nodes.filter(function(a){var b="string"==typeof d.source?d.source:d.source.id;return a.id==b})[0];return ac.select(this).attr("y1",e.ycoord*c+b),e.xcoord*c+a}).attr("x2",function(d){var e=pc.nodes.filter(function(a){var b="string"==typeof d.target?d.target:d.target.id;return a.id==b})[0];return ac.select(this).attr("y2",e.ycoord*c+b),e.xcoord*c+a}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}),ic.attr("cx",function(b){return b.x=b.xcoord*c+a,b.x}).attr("cy",function(a){return a.y=a.ycoord*c+b,a.y}).style("display",function(a){return a.visible?"block":"none"}).style("fill",function(a){return a.colour}).raise()}function t(){var a=jd;jc.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).style("stroke-width",function(a){return 2*a.weight+"px"}).style("display",function(a){return a.source.visible&&a.target.visible?"block":"none"}),ic.attr("cx",function(b){return b.x=Math.max(a,Math.min(fc-a,b.x)),b.x}).attr("cy",function(b){return b.y=Math.max(a,Math.min(gc-a,b.y)),b.y}).style("fill",function(a){return a.colour}).style("display",function(a){return a.visible?"block":"none"}).raise(),ac.selectAll("rect").raise(),ac.selectAll("text").raise()}function u(){if(Rb){ac.select("#time").remove(),0==Vb&&(Vb=Date.now());var a=new Date;a.setTime(Vb);var b=a.getMinutes();b<10&&(b="0"+b),ec.append("text").attr("id","time").attr("y",gc-16).attr("dy",".40em").attr("x",6).style("pointer-events","none").text(Rb[Ub]+" "+a.getHours()+":"+b+" "+a.toDateString())}}function v(){var a=w();if(Nb&&Pb){var b={};for(var c in a)"scale"!=c&&"module"!=c&&(b[c]=a[c]);Nb[Mb]=b,Pb[Mb]=a.scale}a.time=Date.now(),Vb=a.time,Qb&&(Qb[Mb]=a.time),x(rb,a)}function w(){var a,b,c,d,e={},f=0,g=fc/2,h=gc/2;return pc.nodes.forEach(function(e){a=e.x-g,b=e.y-h,(c=Math.sqrt(a*a+b*b))>f&&(f=c,d=e)}),e.scale=f,e.module=d.id,Kb=f,pc.nodes.forEach(function(a){e[a.id]={xcoord:""+(a.x-g)/f,ycoord:""+(a.y-h)/f,visible:a.visible?1:0},a.xcoord||(a.xcoord=(a.x-g)/f,a.ycoord=(a.y-h)/f)}),Ib=e,e}function x(a,b){var c=new XMLHttpRequest;c.open("POST",a),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4==this.readyState&&this.status},c.send("cid="+Lb+"&data="+JSON.stringify(b)+"&sesskey="+$b)}function y(){var a=document.getElementById("student-menu"),b=document.createElement("button");b.innerHTML=Zb.copy,b.addEventListener("click",z),a.appendChild(b);var c=b.getBoundingClientRect().height,d=document.createElement("button");d.innerHTML=Zb.print,d.addEventListener("click",A),a.appendChild(d),Hc=document.createElement("select"),Hc.size=3,Hc.id="teacher-select",Hc.style.minWidth="40px";var e=gc-c-20;Hc.style.height=e+"px",Hc.addEventListener("change",B);for(var f in Pb){var g=document.createElement("option");g.value=f,g.text=f,Mb==f&&(g.selected=!0),Hc.appendChild(g)}a.appendChild(Hc)}function z(){var a=new Image,b=new XMLSerializer,c=b.serializeToString(ec.node());a.src="data:image/svg+xml;base64,"+window.btoa(c),document.body.appendChild(a);var d=document.createRange();d.setStartBefore(a),d.setEndAfter(a),d.selectNode(a),window.getSelection().addRange(d),document.execCommand("Copy"),document.body.removeChild(a)}function A(){var a=new XMLSerializer,b=a.serializeToString(ec.node()),c=window.open();c.document.write('<img src="data:image/svg+xml;base64,'+window.btoa(b)+'"/>'),c.print(),c.close()}function B(){for(var a,b=document.getElementById("teacher-select"),c=0;c<b.options.length;c++)if(b.options[c].selected){a=b.options[c].value;break}a==Mb?(fd=K,gd=L,hd=M,id=J):(fd=null,gd=null,hd=null,id=null),Ib=Nb[a],Jb=Ob[a],Kb=Pb[a],Vb=Qb[a],Bb=Sb[a],Eb=Tb[a],Ub=a,ec.remove(),Gc={},d(),ac.selectAll("#legendUL").remove(),D(),lc=1,e(),lc=0;var f=document.getElementById("weights-output").innerHTML;f=parseFloat(f.split(" ")[1]),k(f);for(var g in Gc)Ib[g]&&(Gc[g].checked=1==Ib[g].visible),Mb==a?(Gc[g].removeEventListener("change",C),Gc[g].addEventListener("change",H)):(Gc[g].removeEventListener("change",H),Gc[g].addEventListener("change",C))}function C(){this.checked=!this.checked}function D(){var a,b=500;Fc=document.getElementById("legend"),Fc.style="width: "+Db+"px; height: "+gc+"px; min-width: "+Db+"px; max-width: "+b+"px;";var c=function(a){var b=Fc.offsetLeft+28;a.x>=b&&a.x<=b+6?Fc.style.cursor="col-resize":Fc.style.cursor="auto"},d=function(c){var d=a-c.x;a=c.x;var e=parseInt(Fc.style.width)+d;e>b?e=b:e<Db&&(e=Db),Fc.style.width=e+"px"};Fc.addEventListener("mousemove",c),Fc.addEventListener("mousedown",function(b){a=b.x,"col-resize"==Fc.style.cursor&&Fc.addEventListener("mousemove",d)}),document.addEventListener("mouseup",function(){Fc.removeEventListener("mousemove",d)}),E(Fc)}function E(a){var b=document.createElement("ul");b.id="legendUL";var c=document.createElement("span");c.className="no-select-text",c.innerHTML=Eb;var d=document.createElement("li");d.appendChild(c);var e=document.createElement("ul");d.appendChild(e),b.appendChild(d);var f,g,h,i=-1;Bb.sort(function(a,b){return a.sect-b.sect}),Bb.forEach(function(a){i!=a.sect&&(g=document.createElement("ul"),g.className="nested",h=document.createElement("span"),h.className="caret",h.addEventListener("click",F),f=document.createElement("li"),f.appendChild(h),G("g"+a.sect,Zb.section+" "+a.sect,Kc.grouping,a.sect,"grouping",f),f.appendChild(g),e.appendChild(f),i=a.sect),f=document.createElement("li"),f.className="indented",G(a.id,a.name,Kc[a.entype],a.sect,a.type,f),g.appendChild(f)}),a.appendChild(b)}function F(){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("caret-down")}function G(a,b,c,d,e,f){var g=document.createElement("input");g.type="checkbox",Ib[a]?g.checked=0!=Ib[a].visible:Ib["g"+d]?g.checked=1==Ib["g"+d].visible&&Mb==Ub:g.checked=!0,g.id=a,g.group=d,g.nodeT=e,g.addEventListener("change",H),Gc[g.id]=g;var h=document.createElement("label");h.style.color=c,h.className="no-select-text";var i="grouping"==e?b:e+"_"+b;h.appendChild(document.createTextNode(i)),f.appendChild(g),f.appendChild(h)}function H(){var a=this.id,b=this.checked,c=this.nodeT,d=this.group;pc.nodes.forEach(function(e){e.id==a?(e.visible=b,Gc[e.id].checked=b):"grouping"==c&&e.group==d?(e.visible=b,Gc[e.id].checked=b):b&&"grouping"==e.type&&e.group==d&&(e.visible=b,Gc[e.id].checked=b)}),I(),S()}function I(){parseFloat(document.getElementById("weight-slider").value)<0&&(kc.strength(0),document.getElementById("weights-output").innerHTML="&nbsp;= 0",document.getElementById("weight-slider").value=0)}function J(a){if(ac.selectAll(".text").remove(),ac.selectAll("rect").remove(),ac.selectAll("#preview").remove(),ac.selectAll("#bgrnd").remove(),ac.event.preventDefault(),"root"!=a.id){var b=a;ic.on("mouseover",null).on("mouseout",null);var c=ec.append("rect"),d=ec.append("text").attr("class","text").attr("id","rctext").attr("x",a.x+10).attr("y",a.y+12).attr("dy",".40em").style("pointer-events","none").text(Zb.hide);a.y+20>=gc&&d.attr("y",gc-(gc-a.y)-10).text(Zb.hide),c.attr("id","rcrect").attr("x",a.x).attr("y",a.y+20<=gc?a.y:gc-(gc-a.y)-20).attr("width",60).attr("height",24).style("stroke","black").style("fill","lightgrey"),c.on("mouseover",function(){ac.event.target.style="fill: grey;"}),c.on("mouseout",function(){ac.event.target.style="fill: lightgrey;"}),c.on("click",function(){ac.selectAll("#rctext").remove(),ac.selectAll("#rcrect").remove(),ic.on("mouseover",n).on("mouseout",q),b.visible=!1,Gc[b.id].checked=!1,"grouping"==b.type&&pc.nodes.forEach(function(a){a.group==b.group&&(a.visible=!1,Gc[a.id].checked=!1)}),I(),S()})}}function K(a){ac.event.active||hc.alphaTarget(nc).restart(),a.fx=a.x,a.fy=a.y}function L(a){ac.selectAll("rect").remove(),ac.selectAll(".text").remove(),ac.selectAll("#preview").remove(),ac.selectAll("#bgrnd").remove(),a.fx=ac.event.x,a.fy=ac.event.y}function M(a){ac.event.active||(Gb?(hc.stop(),v(),u()):hc.alphaTarget(oc)),a.fx=null,a.fy=null,ed=Date.now()}function N(){var a=document.getElementById("student-menu");return uc=document.createElement("button"),uc.innerHTML=Zb.cluster,uc.addEventListener("click",aa),a.appendChild(uc),uc.getBoundingClientRect().height}function O(a){var b=document.getElementById("student-menu");qc=document.createElement("select"),qc.multiple=!0,qc.id="student-select";var c=yb.length>0?gc-a-120:gc-a-12;qc.style="height: "+c+"px;",qc.addEventListener("change",function(){for(var a=document.getElementById("student-select"),b="box-shadow: 0 0 0 0 white inset;",c=0;c<a.options.length;c++){var d="box-shadow: 0 0 10px 100px "+a.options[c].colour+" inset;";a.options[c].style=a.options[c].selected?d:b}wb.length>0&&T(!0)}),1==cd?xb.sort(function(a,b){var c=a.firstname+" "+a.lastname,d=b.firstname+" "+b.lastname;return c>d?1:c<d?-1:0}):xb.sort(function(a,b){return a.id-b.id}),xb.forEach(function(a){P(a,qc)}),b.appendChild(qc)}function P(a,b){var c=document.createElement("option");c.value=a.id,c.text=1==cd?a.firstname+" "+a.lastname:a.id,c.colour=Ic[Jc++],Jc>=Ic.length&&(Jc=0),pc.edges[a.id].forEach(function(a){a.colour=c.colour}),b.appendChild(c)}function Q(){if(0!=yb.length){var a=document.getElementById("student-menu");Ab=document.createElement("select"),Ab.multiple=!0,Ab.id="group-select",Ab.style="height: 120px;",Ab.addEventListener("change",function(){ac.selectAll(".link").remove(),ac.selectAll(".hull").remove(),m(pc.links),hc.on("tick",s),hc.restart(),setTimeout(hc.stop,100),qc.options.length=0;for(var a=0;a<Ab.options.length;a++)if(Ab.options[a].selected)for(var b=0;b<xb.length;b++)zb[xb[b].realId]==Ab.options[a].value&&P(xb[b],qc)});var b;for(var c in yb)b=document.createElement("option"),b.value=c,b.text=yb[c],Ab.appendChild(b);a.appendChild(Ab)}}function R(){rc=document.getElementById("slider"),sc=[0,pc.maxSession];var a;a=pc.maxSession<500?10:pc.maxSession<1e3?20:pc.maxSession<5e3?100:pc.maxSession<1e4?200:500,cc.create(rc,{start:[0,pc.maxSession],range:{min:[0],max:[pc.maxSession]},step:1,connect:!0,pips:{mode:"steps",stepped:!0,density:100,filter:function(b){return 0==b||b==pc.maxSession?1:b%a==0?2:0}}}),setTimeout(function(){rc.noUiSlider.on("update",function(a,b){sc[b]=parseInt(a[b]),qc.dispatchEvent(new Event("change"))})},1e3)}function S(){jc.remove(),ic.remove(),ac.selectAll(".hull").remove();var a=U(J);V(a),X(a),hc.alphaTarget(mc).restart(),Gb&&setTimeout(function(){hc.stop(),v(),u()},100)}function T(a){jc.remove(),ic.remove(),ac.selectAll(".hull").remove(),Gb=!1;var b=U(null);V(b),a&&X(b),Gb=!0,hc.on("tick",s),hc.restart(),setTimeout(hc.stop,100)}function U(a){var b=[],c={};return pc.nodes.forEach(function(a){null===a.fx&&(a.fx=a.x,a.fy=a.y),a.visible?b[b.length]=a:c[a.id]=1}),hc.nodes(b),l(b,a,fd,gd,hd),c}function V(a){var b,c,d,e,f,g=[];for(f in pc.links)d=pc.links[f],"string"==typeof d.source?(b=d.source,c=d.target):(b=d.source.id,c=d.target.id),a[b]||a[c]||(g[g.length]=d);var h=Gb?[]:document.getElementById("student-select").options;for(f=0;f<h.length;f++)if(h[f].selected){var i,j,k={};for(j=sc[0];j<=sc[1]&&pc.edges[h[f].value].length>j;j++)e=pc.edges[h[f].value][j],"string"==typeof e.source?(i=e.source+"_"+e.target,b=e.source,c=e.target):(i=e.source.id+"_"+e.target.id,b=e.source.id,c=e.target.id),k[i]?k[i]++:k[i]=1,a[b]||a[c]||(g[g.length]=e);for(j=sc[0];j<=sc[1]&&pc.edges[h[f].value].length>j;j++)e=pc.edges[h[f].value][j],i="string"==typeof e.source?e.source+"_"+e.target:e.source.id+"_"+e.target.id,e.weight=k[i]}hc.force("link").links(g),m(g)}function W(a){return pc.nodes.find(function(b){return b.id==a})}function X(a){if(!Gb){ac.selectAll(".hull").remove();for(var b=document.getElementById("student-select").options,c={},d=0;d<b.length;d++)if(b[d].selected){var e,f,g,h,i,j,k;c[b[d].value]={};for(var l=sc[0];l<=sc[1]&&pc.edges[b[d].value].length>l;l++){var m=pc.edges[b[d].value][l];if("string"==typeof m.source){j=m.source,k=m.target;var n=W(j);e=n.x,f=n.y,n=W(k),g=n.x,h=n.y}else j=m.source.id,k=m.target.id,e=m.source.x,f=m.source.y,g=m.target.x,h=m.target.y;a[j]||a[k]||(i=m.colour,c[b[d].value][j]={x:e,y:f,colour:i},c[b[d].value][k]={x:g,y:h,colour:i})}}for(var o in c)$(c[o],o,!1,!1);Mc&&(sd?Z(b):Y(b))}}function Y(a){if(Uc={},0!=Object.keys(rd).length)for(var b=0;b<a.length;b++)if(a[b].selected){var c=a[b].value;if(rd[c].length<=sc[0])continue;var d=sc[0],e=rd[c].length>sc[1]+1?sc[1]:rd[c].length,f=parseInt(d/2+e/2),g=rd[c][f],h=parseFloat(Ib[g].xcoord),i=parseFloat(Ib[g].ycoord);Uc[c]={x:h*Kb+kd.originalx,y:i*Kb+kd.originaly,colour:a[b].colour}}}function Z(a){if(Uc={},0!=Object.keys(rd).length)for(var b=0;b<a.length;b++)if(a[b].selected){var c=a[b].value;if(rd[c].length<=sc[0])continue;for(var d,e=sc[0],f=rd[c].length>sc[1]+1?sc[1]:rd[c].length,g=0,h=0,i=0,j=e;j<f;j++)d=rd[c][j],g+=parseFloat(Ib[d].xcoord),h+=parseFloat(Ib[d].ycoord),i++;Uc[c]={x:g/i*Kb+kd.originalx,y:h/i*Kb+kd.originaly,colour:a[b].colour}}}function $(a,b,c,d){if(0!=Object.keys(a).length){var e,f,g,h=[],i=20;g=Mc?"hull":c?"manual-hull":"cluster-hull";for(var j in a)h[h.length]=[a[j].x,a[j].y],e=a[j].colour;if(1==h.length)f=function(a){var b=[a[0][0],a[0][1]-i],c=[a[0][0],a[0][1]+i];return"M "+b+" A "+[i,i,"0,0,0",c].join(",")+" A "+[i,i,"0,0,0",b].join(",")};else{if(2!=h.length){var k=ac.concaveHull().padding(15);Qc||k.distance(Rc);var l=h.length>4?k(h):[h];return f=ac.line().curve(Sc),void ec.selectAll("#hull-"+b).data(l).enter().append("path").attr("id","hull-"+b).attr("class",g).style("stroke",e).style("stroke-opacity",d?0:1).style("fill",e).style("fill-opacity",d?0:Tc).attr("d",f)}var m=function(a,b){return[b[0]-a[0],b[1]-a[1]]},n=function(a,b){return[b*a[0],b*a[1]]},o=function(a,b){return[a[0]+b[0],a[1]+b[1]]},p=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return n(a,1/b)},q=function(a,b){return n(p(a),b)},r=function(a,b){void 0!==b&&(a=m(a,b));var c=[-a[1],a[0]];return p(c)};f=function(a){var b=m(a[0],a[1]),c=q(b,i),d=o(a[0],n(c,-1)),e=o(a[1],c),f=1.2*i,g=q(r(b),f),h=n(g,-1),j=o(d,h),k=o(e,h),l=o(d,g);return"M "+d+" C "+[j,k,e].join(",")+" S "+[l,d].join(",")+" Z"}}ec.append("path").attr("id","hull-"+b).attr("class",g).style("stroke",e).style("stroke-opacity",d?0:1).style("fill",e).style("fill-opacity",d?0:Tc).attr("d",f(h))}}function _(){clearInterval(Pc),Pc=void 0,Vc=null,ya(),ac.selectAll(".clustering-centroid").remove(),ac.selectAll(".cluster-hull").remove(),ac.selectAll(".centroid").remove(),ac.selectAll(".server-centroid").remove(),Bc.style.display="none",document.getElementById("anim-controls").style.display="none",document.getElementById("log-panel").style.display="none",document.getElementById("student-menu").style.width=uc.style.width,document.getElementById("clustering-replay-comment").innerHTML="&nbsp",Mc=!0,$c=!1,rc.style.display="block",qc.style.display="block",Ab.style.display="block",ic.style("display","block"),ic.style("opacity",1),jc.style("display","block"),jc.style("opacity",1),T(!0),ic.on("mouseover",n).on("mouseout",q),uc.innerHTML=Zb.cluster,uc.removeEventListener("click",_),uc.addEventListener("click",aa)}function aa(){Mc=!1,rc.style.display="none",qc.style.display="none",Ab.style.display="none",ac.selectAll(".hull").remove(),ac.selectAll(".text").remove(),ac.selectAll("rect").remove(),document.getElementById("student-menu").style.width=Dc+"px",uc.innerHTML=Zb.graph,uc.removeEventListener("click",aa),uc.addEventListener("click",_),hc.stop(),ic.on("mouseover",null).on("mouseout",null).on("contextmenu",null).call(ac.drag().on("start",null).on("drag",null).on("end",null)),kd.clusterId=Date.now(),Wb={},Oc=0,Nc=!1,Cc=1,Pc=void 0,document.getElementById("clustering-replay-comment").innerHTML="&nbsp";var a='<p id="cluster-text">'+Zb.numclusters+"</p>";setTimeout(function(){if(Bc)document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("cluster-text").innerHTML=a,document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("anim-controls").style.display="block",document.getElementById("log-panel").style.display="block",Bc.removeAttribute("disabled"),Bc.noUiSlider.set(1),Bc.style.display="block";else{var b=Ea();Xa(a,b),gb()}hb()},ld/2)}function ba(a){Gb=!0,Ib={0:0,1:1,2:2},gc=window.innerHeight-190,va(),gb(),ca(a)}function ca(a){var b=document.getElementById("student-menu");wc=document.createElement("select"),wc.size=3,wc.id="replay-select",wc.style="height: "+(gc-12)+"px;",wc.addEventListener("change",da.bind(this,a));for(var c in _b){var d=0;for(var e in _b[c]){var f=0;d++;for(var g in _b[c][e])if(!isNaN(g)&&_b[c][e][g][1]){var h=document.createElement("option");h.value=c+"_"+e+"_"+g,h.text=c.split("-")[0]+"_"+d+"_"+ ++f,wc.appendChild(h)}}}b.appendChild(wc)}function da(a){var b=sa(a),c=b.members;ec&&(ec.remove(),za(),ya(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"),qc&&document.body.removeChild(qc),Vc=null,d(),e(),sc=[0,pc.maxSession];for(var f=0;f<pc.nodes.length;f++)void 0===pc.nodes[f].xcoord&&(pc.nodes[f].visible=!1);ta(c),k(0),T(!1),ic.on("mouseover",null).on("mouseout",null),Yc=!0,document.getElementById("clustering-replay-comment").innerHTML="&nbsp",Ia(),setTimeout(function(){ua(Uc,!1),hb(),hc.on("tick",s);for(var c in Uc)ac.select("#centroid-"+c).call(ac.drag().on("start",ea.bind(this,c)).on("drag",fa.bind(this,c)).on("end",ga.bind(this,c,a,b)))},500)}function ea(a){ka(a)&&(od=Date.now(),ec.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+a).attr("points",ib(ac.event.x,ac.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Uc[a].colour).style("opacity",.5))}function fa(a){ac.select("#dragged-"+a).attr("points",ib(ac.event.x,ac.event.y))}function ga(a,b,c){if(ac.selectAll(".dragged-centroid").remove(),ka(a)){if(Date.now()-od<300)return void qb(Xb[a],a,!1);nd||ma();var d=la();if(0==Object.keys(vd[d]).length)for(var e=0;e<xc[d].length;e++)for(var f in xc[d][e].members){var g=Yb[xc[d][e].members[f].id];vd[d][g]=e}var h=mb(ac.event);for(var i in vd)i<=d&&(vd[i][a]=h);na(d,b,c),nd=!0,ia(d),ha(d)}}function ha(a){for(var b={clusterCoords:[],members:[]},c=0;c<wd.length;c++){var d=wd[c]?wd[c]:Wc[c];b.clusterCoords[c]=Va(d),b.clusterCoords[c].num=c;for(var e in vd[a])vd[a][e]==c&&(b.members[b.members.length]={id:Xb[e],num:c})}b.iteration=a,b.clusterId=kd.clusterId,b.coordsid=Vb,x(ub,b)}function ia(a){if(!(a>=0)&&vd[a]&&0!=Object.keys(vd[a]).length){var b,c=ja(a),d=Zb.manualcluster+"<br>";for(b=0;b<wd.length;b++)if(wd[b]){var e=wd[b].x-fc/2,f=wd[b].y-gc/2,g=Math.sqrt(e*e+f*f),h=Wc[b].colour;d+=Zb.disttocluster+' <span style="color:'+h+'">'+h+"</span>: "+Math.round(g)+"<br>"+Zb.cluster+" "+h+" "+Zb.members+": [";for(var i in vd[a])vd[a][i]==b&&(d+=i+", ");-1!=d.indexOf(",",d.length-3)&&(d=d.slice(0,-2)),d+="]<br>",qd&&(d+=Zb.precision+": "+c[b].precision.toFixed(4)+"<br>",d+=Zb.recall+": "+c[b].recall.toFixed(4)+"<br>",d+=Zb.f1+": "+c[b].f1.toFixed(4)+"<br>",d+=Zb.fhalf+": "+c[b].fhalf.toFixed(4)+"<br>",d+=Zb.f2+": "+c[b].f2.toFixed(4)+"<br>")}var j=Ec.innerHTML.split("<br><br>"),k=j[0].split("<br>");for(Ec.innerHTML="",b=0;b<k.length&&!k[b].startsWith(Zb.manualcluster);b++)Ec.innerHTML+=k[b]+"<br>";for(qd&&(b=c.length-1,d+=Zb.totalmeasures+"<br>",d+=Zb.precision+": "+c[b].precision.toFixed(4)+"<br>",d+=Zb.recall+": "+c[b].recall.toFixed(4)+"<br>",d+=Zb.f1+": "+c[b].f1.toFixed(4)+"<br>",d+=Zb.fhalf+": "+c[b].fhalf.toFixed(4)+"<br>",d+=Zb.f2+": "+c[b].f2.toFixed(4)+"<br>"),Ec.innerHTML+=d+"<br>",b=1;b<j.length;b++)Ec.innerHTML+=j[b]+"<br><br>"}}function ja(a){var b,c,d,e=0,f=0,g=0,h=[];for(d=0;d<Wc.length;d++){for(var i in Vc)Vc[i].ci==d&&vd[a][i]==Vc[i].ci?e++:Vc[i].ci==d&&vd[a][i]!=Vc[i].ci?f++:vd[a][i]==d&&vd[a][i]!=Vc[i].ci&&g++;b=e/(e+f),c=e/(e+g),h[d]={tp:e,fp:f,fn:g,precision:b,recall:c,f1:b+c==0?0:2*b*c/(b+c),fhalf:b+c==0?0:1.25*b*c/(.25*b+c),f2:b+c==0?0:5*b*c/(4*b+c)},e=0,f=0,g=0}for(d=0;d<h.length;d++)e+=h[d].tp,f+=h[d].fp,g+=h[d].fn;return b=e/(e+f),c=e/(e+g),h[h.length]={tp:e,fp:f,fn:g,precision:b,recall:c,f1:b+c==0?0:2*b*c/(b+c),fhalf:b+c==0?0:1.25*b*c/(.25*b+c),f2:b+c==0?0:5*b*c/(4*b+c)},h}function ka(a){if(document.getElementById("replayer").innerHTML!=Zb.convergence)return!1;if(pd!=Mb)return!1;var b,c=Vc[a].ci,d=0;for(b in Vc)Vc[b].ci==c&&d++;var e=la(),f=0;if(vd[e]){c=vd[e][a];for(b in vd[e])vd[e][b]==c&&f++}return!(1==d&&f<=1)&&1!=f}function la(){var a=Ec.innerHTML.split("<br>");return a[2]&&a[2].startsWith(Zb.iteration)?parseInt(a[2].split(" ")[1]):null}function ma(){for(var a in xc)if(!(a>=0)){vd[a]={};for(var b=0;b<xc[a].length;b++)for(var c in xc[a][b].members){var d=Yb[xc[a][b].members[c].id];vd[a][d]=b}}}function na(a,b,c){var d,e,f=[],g=[];for(d=0;d<xc[a].length;d++){f[d]={},g[d]=[];for(e in vd[a])if(vd[a][e]==d){var h=Vc[e].x,i=Vc[e].y;f[d][h+"_"+i]={x:h,y:i,colour:Wc[d].colour},g[d][g[d].length]=[h,i]}}var j=document.getElementsByClassName("manual-centroid").length,k=0==j;for(ac.selectAll(".manual-hull").remove(),d=0;d<f.length;d++)$(f[d],-1*(d+1),!0,k),wd[d]=Sa(g[d]);if(b)for(b[c.did]||(b[c.did]={}),b[c.did][c.gid]||(b[c.did][c.gid]={}),b[c.did][c.gid][c.cid]||(b[c.did][c.gid][c.cid]={}),b[c.did][c.gid][c.cid][a]||(b[c.did][c.gid][c.cid][a]=[]),d=0;d<wd.length;d++)if(wd[d]){var l=[];for(e in vd[a])vd[a][e]==d&&(l[l.length]={id:Xb[e],num:d});b[c.did][c.gid][c.cid][a][d]={centroidx:wd[d].x,centroidy:wd[d].y,members:l}}k?pa():qa(),ec.selectAll(".centroid").raise(),ec.selectAll(".clustering-centroid").raise(),ec.selectAll(".manual-centroid").raise()}function oa(){ac.event.stopPropagation()}function pa(){ac.selectAll(".manual-centroid").remove();for(var a,b,c=14,d=0;d<wd.length;d++){if(!wd[d])return;a=wd[d].x,b=wd[d].y,ec.append("line").attr("class","manual-centroid").attr("id","manual1-"+d).attr("x1",a-c).attr("y1",b-c).attr("x2",a+c).attr("y2",b+c).style("stroke",Wc[d].colour).style("stroke-width","5px").style("opacity",0).on("click",oa).on("click.centroidClick",qb.bind(this,-1*(d+1),d,!0)).on("mouseover",Na.bind(this,d,!0)),ec.append("line").attr("class","manual-centroid").attr("id","manual2-"+d).attr("x1",a+c).attr("y1",b-c).attr("x2",a-c).attr("y2",b+c).style("stroke",Wc[d].colour).style("stroke-width","5px").style("opacity",0).on("click",oa).on("click.centroidClick",qb.bind(this,-1*(d+1),d,!0)).on("mouseover",Na.bind(this,d,!0))}ac.selectAll(".manual-centroid").transition().duration(ld).style("opacity",.5),ac.selectAll(".manual-hull").transition().duration(ld).style("stroke-opacity",1).style("fill-opacity",Tc)}function qa(){for(var a,b,c=14,d=0;d<wd.length;d++){if(!wd[d])return void ac.selectAll(".manual-centroid").remove();a=wd[d].x,b=wd[d].y,ac.select("#manual1-"+d).transition().duration(ld).attr("x1",a-c).attr("y1",b-c).attr("x2",a+c).attr("y2",b+c).style("display","block"),ac.select("#manual2-"+d).transition().duration(ld).attr("x1",a+c).attr("y1",b-c).attr("x2",a-c).attr("y2",b+c).style("display","block")}}function ra(a){if(!a||a>0)return ec.selectAll(".manual-centroid").remove(),void ec.selectAll(".manual-hull").remove();nd&&na(a,null,null)}function sa(a){var b,c,d=document.getElementById("replay-select");for(c=0;c<d.options.length;c++)if(d.options[c].selected){b=d.options[c].value.split("_");break}var e=b[0],f=b[1],g=b[2];pd=e.split("-")[0],kd.clusterId=g,Vb=_b[e][f].last,Ib=_b[e][f].nodes,Jb=_b[e][f].links,Kb=_b[e][f].scale,Bb=_b[e][f].mods,xc=_b[e][f][g],wb=_b[e][f].logs,xb=_b[e][f].users,Wb=_b[e][f][g].comments,Yb={},Xb={},xb.forEach(function(a){Xb[a.id]=a.realId,Yb[a.realId]=a.id}),Oc=0,Cc=1,zc=0,Ac=0;for(var h in xc)isNaN(h)||(h>=0?zc++:Ac--);wd=[],vd={},nd=!1;var i,j,k=a[e][f][g];if(k)for(nd=!0,c=-1;c>=Ac;c--){k[c]&&!k[c-1]&&(k[c-1]=k[c]),vd[c]={};for(i in k[c])for(j in k[c][i].members){var l=k[c][i].members[j].id;vd[c][Yb[l]]=i}}Wc=[],Uc={};var m={},n=0;for(i in xc[1]){if(c=Wc.length,Wc[c]={x:0,y:0},n<Lc.length)Wc[c].colour=Lc[n++];else{for(var o;!o;)o=Ic[Math.floor(dc.random()*Ic.length)],o=Lc.includes(o)?void 0:o;Wc[c].colour=o}for(j in xc[1][i].members){var p=Yb[xc[1][i].members[j].id];Uc[p]={x:xc[1][i].members[j].x,y:xc[1][i].members[j].y},m[p]=!0}}return{members:m,did:e,gid:f,cid:g}}function ta(a){qc=document.createElement("select"),qc.multiple=!0,qc.id="student-select",qc.style.display="none",Jc=0,xb.forEach(function(a){P(a,qc)});for(var b,c=0;c<qc.options.length;c++)b=qc.options[c].value,a[b]?qc.options[c].selected=!0:qc.options[c].selected=!1,Uc[b]&&(Uc[b].colour=qc.options[c].colour);document.body.appendChild(qc)}function ua(a,b){for(var c in a)a[c].x*=kd.distance,a[c].x+=kd.originalx,a[c].y*=kd.distance,a[c].y+=kd.originaly,b&&(a[c].x-=kd.centre.x,a[c].x*=kd.scale,a[c].x+=fc/2,a[c].y-=kd.centre.y,a[c].y*=kd.scale,a[c].y+=gc/2)}function va(){var a=document.getElementById("slider"),b=document.createElement("p");b.innerHTML="&nbsp",b.id="replayer",b.style.marginTop="-20px",a.appendChild(b);var c=document.createElement("p");c.innerHTML="&nbsp",c.id="replaydragdrop",c.style.marginTop="-12px",a.appendChild(c);var d=document.createElement("button");d.id="replay-stop",d.innerHTML="&#9606",d.addEventListener("click",xa),a.appendChild(d);var e=document.createElement("button");e.id="replay-pause",e.innerHTML="&#9654",e.value="play",e.addEventListener("click",Aa),a.appendChild(e);var f=document.createElement("button");f.id="replay-back",f.innerHTML="&#9614&#9664",f.addEventListener("click",Ca),a.appendChild(f);var g=document.createElement("button");g.id="replay-forward",g.style.marginRight="80px",g.innerHTML="&#9654&nbsp&nbsp&#9614",g.addEventListener("click",Ba.bind(this,!0)),a.appendChild(g);var h=document.createElement("button");h.id="delete-button",h.innerHTML=Zb.delbutton,h.addEventListener("click",wa),a.appendChild(h)}function wa(){if(confirm(Zb.delconfirm)){var a=document.getElementById("replay-select");if(a.selectedIndex>-1){var b=a.options[a.selectedIndex].value;b.length>0&&(x(vb,b.replace("-","_")),a.options[a.selectedIndex]=null,xa())}}}function xa(){ec&&setTimeout(function(){ec.remove(),ya(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"},500),xc=void 0,Vc=null,za(),document.getElementById("clustering-replay-comment").innerHTML="&nbsp";var a=document.getElementById("replay-select");a.selectedIndex>-1&&(a.options[a.selectedIndex].selected=!1)}function ya(){Ec.readOnly=!1,Ec.innerHTML="",setTimeout(function(){Ec.readOnly=!0},300)}function za(){var a=document.getElementById("replay-pause");a.innerHTML="&#9654",a.value="play",clearInterval(Pc),Pc=void 0}function Aa(){if(xc){var a=document.getElementById("replay-pause");"play"==a.value?(a.innerHTML="&#9613&#9613",a.value="pause",Ba(!1),Pc=setInterval(Ba.bind(this,!1),1200)):za()}}function Ba(a){if(xc){a&&za(),Oc++;var b=Oc-1;return Oc>zc&&xc[-1]&&(b=zc-Oc+1,!xc[b-1])?(Oc--,void za()):b>zc?(Oc--,void za()):void(1==Oc?(Cc=2,Nc=!0,Yc=!1,_a()):2==Oc?(ab(),Da(b-1,!1,!0)):Da(b-1,!1,!1))}}function Ca(){if(xc&&yc&&!(Oc-1<0)){za(),Oc--;var a=Oc-1;Oc>zc&&(a=zc-Oc+1),0==Oc?(Cc=1,$a(),Nc=!1,Ec.innerHTML=Ec.innerHTML.slice(Ec.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):1==Oc?(Vc=null,_a(),Ec.innerHTML=Ec.innerHTML.slice(Ec.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):(Vc=null,Da(a-1,!0,2==Oc))}}function Da(a,b,c){var d,e=[],f={},g={};for(d=0;d<xc[a].length;d++,g={}){ec.selectAll("#hull-"+d).remove(),Wc[d].x=xc[a][d].centroidx,Wc[d].y=xc[a][d].centroidy;for(var h in xc[a][d].members){var i=xc[a][d].members[h].x,j=xc[a][d].members[h].y,k=Yb[xc[a][d].members[h].id];Uc[k].x=i,Uc[k].y=j,g[i+"_"+j]={x:i,y:j,colour:Wc[d].colour},f[k]=d}e[d]=g}if(ua(Wc,!0),c)La();else{for(ua(Uc,!1),d=0;d<e.length;d++)ua(e[d],!0),$(e[d],d,!1,!1);Wa(ld)}if(bb(yc[2],yc[0],yc[1],ld),ec.selectAll(".centroid").raise(),ec.selectAll(".clustering-centroid").raise(),ra(a),b)Ec.innerHTML=Ec.innerHTML.slice(Ec.innerHTML.indexOf("<br><br>")+8);else{for(var l in f)Vc[l].ci=f[l];Ta(a),ia(a)}if(a<0)if(document.getElementById("replayer").innerHTML=Zb.convergence,document.getElementById("replayer").style.color="green",qd){var m=document.getElementById("replay-select").options;for(d=0;d<m.length;d++)if(m[d].selected){var n=m[d].value.split("-")[0];n==Mb&&(document.getElementById("replaydragdrop").innerHTML=Zb.dragon);break}}else document.getElementById("replaydragdrop").innerHTML=Zb.dragon;else document.getElementById("replayer").innerHTML=Zb.iteration+" "+a,document.getElementById("replayer").style.color="black",document.getElementById("replaydragdrop").innerHTML=Zb.dragoff}function Ea(){var a=document.getElementById("anim-controls");a.appendChild(document.createTextNode(Zb.runkmeans));var b=document.createElement("p");b.innerHTML="&nbsp",b.id="clustering",a.appendChild(b);var c=document.createElement("p");c.innerHTML="&nbsp",c.id="dragdrop",c.style.marginTop="-12px",a.appendChild(c);var d=document.createElement("button");d.id="play-pause",d.style.marginLeft="5px",d.style.marginRight="5px",d.innerHTML="&#9654",d.addEventListener("click",Ha),d.disabled=!0;var e=document.createElement("button");e.id="play-step",e.style.marginLeft="5px",e.innerHTML="&#9654&nbsp&nbsp&#9614",e.addEventListener("click",Ga.bind(this,d)),e.disabled=!0,a.appendChild(e),a.appendChild(d);var f=document.createElement("button");return f.id="stop",f.style.marginTop="5px",f.style.marginLeft="5px",f.innerHTML=Zb.reset,f.addEventListener("click",Fa),a.appendChild(f),a}function Fa(){Nc=!1,Oc=0,clearInterval(Pc),Pc=void 0,kd.clusterId=Date.now(),Bc.removeAttribute("disabled"),document.getElementById("clustering-replay-comment").innerHTML="&nbsp",3==Cc?(Bc.noUiSlider.set(2),setTimeout(function(){Bc.noUiSlider.set(1),Cc=1},ld)):(Bc.noUiSlider.set(1),Cc=1),document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("num-clusters")&&(document.getElementById("num-clusters").readOnly=!1,document.getElementById("num-clusters").value=""),ac.selectAll(".clustering-centroid").transition(bc).style.display="none",ac.selectAll(".cluster-hull").transition(bc).style.display="none",setTimeout(function(){ac.selectAll(".clustering-centroid").remove(),ac.selectAll(".cluster-hull").remove(),ya()},ld);for(var a in Vc)Vc[a].ci=void 0}function Ga(a){3==Cc&&(Pc?(clearInterval(Pc),Pc=void 0,a.innerHTML="&#9654",Bc.removeAttribute("disabled")):Ja())}function Ha(){3==Cc&&(Pc?(clearInterval(Pc),Pc=void 0,this.innerHTML="&#9654",Bc.removeAttribute("disabled")):(Pc=setInterval(Ja,1e3),this.innerHTML="&#9613&#9613",Bc.setAttribute("disabled",!0)))}function Ia(){var a=document.getElementById("clustering-replay-comment"),b=document.createElement("input");b.type="text",b.id="clustering-replay-comment-text",Wb[0]?b.value=Wb[0]:b.placeholder=Zb.clusteringname,a.appendChild(b);var c=document.createElement("button");c.innerHTML=Zb.clusteringnamebutton,a.appendChild(c),c.addEventListener("click",function(){if(pd==Mb&&""!=b.value){var a={coordsid:Vb,clusterid:kd.clusterId,studentid:0,remark:b.value};x(tb,a);for(var c,d=document.getElementById("replay-select"),e=0;e<d.options.length;e++)if(d.options[e].selected){c=d.options[e].value.split("_");break}var f=c[0],g=c[1],h=c[2];_b[f][g][h].comments[0]=b.value}})}function Ja(){if(0==Oc){Nc=!0,Ia();var a=document.getElementById("num-clusters"),b=parseInt(a.value);(isNaN(b)||b<2)&&(b=3);var c={};for(var d in Uc)c[Uc[d].x+"_"+Uc[d].y]=1;for(;b>Object.keys(c).length;)b--;a.value=b,a.readOnly=!0,Wc=[],Xc=null;var e,f;for(e=0,f=0;e<b;e++)if(f<Lc.length)Wc[e]=Ka(null,Lc[f++]);else{for(var g;!g;)g=Ic[Math.floor(dc.random()*Ic.length)],g=Lc.includes(g)?void 0:g;Wc[e]=Ka(null,g)}La(),document.getElementById("clustering").innerHTML=Zb.randcentroids,document.getElementById("dragdrop").innerHTML=Zb.dragoff,document.getElementById("clustering").style.color="black";var h=Ta(Oc);kd.iteration=Oc,Ua(h)}else Qa(Oc),Wa(ld);Oc++,document.getElementById("clustering").innerHTML==Zb.convergence&&(clearInterval(Pc),Pc=void 0,Bc.removeAttribute("disabled"),document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0)}function Ka(a,b){var c,d,e,f,g=100,h=fc-g,i=g,j=gc-g,k=g,l=0;if(a)for(;l<100;)c=Math.floor(Math.random()*(h-i)+i),d=Math.floor(Math.random()*(j-k)+k),e=c-a.x,f=d-a.y,l=Math.sqrt(e*e+f*f);else c=Math.floor(Math.random()*(h-i)+i),d=Math.floor(Math.random()*(j-k)+k);return{x:c,y:d,colour:b}}function La(){ac.selectAll(".clustering-centroid").remove();var a,b,c,d=14;for(a=0;a<Wc.length;a++)b=Wc[a].x,c=Wc[a].y,ec.append("line").attr("class","clustering-centroid").attr("id","cluster1-"+a).attr("x1",b-d).attr("y1",c-d).attr("x2",b+d).attr("y2",c+d).style("stroke",Wc[a].colour).style("stroke-width","5px").on("click",oa).on("click.centroidClick",qb.bind(this,-1*(a+1),a,!0)).on("mouseover",Na.bind(this,a,!1)),ec.append("line").attr("class","clustering-centroid").attr("id","cluster2-"+a).attr("x1",b+d).attr("y1",c-d).attr("x2",b-d).attr("y2",c+d).style("stroke",Wc[a].colour).style("stroke-width","5px").on("click",oa).on("click.centroidClick",qb.bind(this,-1*(a+1),a,!0)).on("mouseover",Na.bind(this,a,!1))}function Ma(a,b,c){var d,e,f,g,h,i,j={};for(d in a)for(i=sc[0];i<pc.edges[d].length&&i<=sc[1];i++)e=pc.edges[d][i],"string"==typeof e.source?(f=parseInt(e.source),g=parseInt(e.target)):(f=e.source.id,g=e.target.id),b[f]||b[g]||(h=f+"_"+g,f>g&&(h=g+"_"+f),j[h]?j[h][d]?j[h][d]++:j[h][d]=1:(j[h]={},j[h][d]=1));var k,l,m=[];for(k in j)if(Object.keys(j[k]).length==c){var n=Number.MAX_SAFE_INTEGER;for(l in j[k])n>j[k][l]&&(n=j[k][l]);var o=k.split("_");m[m.length]={source:o[0],target:o[1],weight:n,colour:"black"}}for(i=0;i<pc.links.length;i++)m[m.length]=pc.links[i];return m}function Na(a,b){jc.remove(),Yc=!0,Zc=!1,$c=!0,ec.on("click",Oa);var c,d={};if(b){var e=la();for(c in vd[e])vd[e][c]==a&&(d[c]=c)}else for(c in Vc)Vc[c].ci==a&&(d[c]=c);var f,g=Object.keys(d).length,h={};for(f=0;f<pc.nodes.length;f++)pc.nodes[f].visible||(h[pc.nodes[f].id]=1);var i=Ma(d,h,g);ic.style("display","block").style("opacity",1).on("mouseover",n).on("mouseout",q),hc.force("link").links(i),m(i),jc.on("mouseover",Pa).on("mouseout",q),hc.restart(),setTimeout(function(){hc.stop(),jc.lower(),ac.selectAll(".cluster-hull").lower()},10)}function Oa(){Yc=!1,Zc=!0,$c=!1,jc.remove(),ic.style("display","none").on("mouseover",null).on("mouseout",null),ec.on("click",null)}function Pa(a){"black"==a.colour&&(jc.on("mouseover",null),ic.on("mouseover",null).on("mouseout",null),ac.selectAll(".clustering-centroid").on("mouseover",null),n(a.source),_c=!0,n(a.target,!0),_c=!1)}function Qa(a){if(document.getElementById("clustering").innerHTML!=Zb.convergence){if(0==Object.keys(Vc).length)return void(document.getElementById("clustering").innerHTML=Zb.convergence);var b,c,d,e,f=Zb.iteration+": "+a;for(b in Vc)Vc[b].ci=mb(Vc[b]);var g=[];for(c=0;c<Wc.length;c++)g[c]=Ra(c);Xc=Wc,Wc=g;var h=!1;if(Xc){var i=0;for(c=0;c<Wc.length;c++)d=Xc[c].x-Wc[c].x,e=Xc[c].y-Wc[c].y,i+=Math.sqrt(d*d+e*e);i<=dd&&(f=Zb.convergence,document.getElementById("clustering").style.color="green",h=!0)}document.getElementById("clustering").innerHTML=f,document.getElementById("dragdrop").innerHTML=a>0&&!h?Zb.dragon:Zb.dragoff;var j=Ta(a);kd.iteration=h?-1:a,Ua(j)}}function Ra(a){var b,c=[],d={};for(b in Vc)Vc[b].ci==a&&(c[c.length]=[Vc[b].x,Vc[b].y],d[Vc[b].x+"_"+Vc[b].y]={x:Vc[b].x,y:Vc[b].y,colour:Wc[a].colour});if(ec.selectAll("#hull-"+a).remove(),$(d,a,!1,!1),ec.selectAll(".centroid").raise(),ec.selectAll(".clustering-centroid").raise(),0==Object.keys(d).length)return Ka(Wc[a],Wc[a].colour);var e=Sa(c);return e.colour=Wc[a].colour,e}function Sa(a){if(0==a.length)return null;var b,c=0,d=0;for(b=0;b<a.length;b++)c+=a[b][0],d+=a[b][1];return{x:c/a.length,y:d/a.length}}function Ta(a){var b=Zb.numstudents+": "+Object.keys(Vc).length+"<br>"+Zb.numofclusters+": "+Wc.length+"<br>"+Zb.iteration+": "+a+"<br>";document.getElementById("clustering")&&document.getElementById("clustering").innerHTML==Zb.convergence&&(b+='<span style="color:green">'+Zb.convergence+"</span><br>");var c,d,e,f,g,h,i=[];for(c=0;c<Wc.length;c++){d=Wc[c].x-fc/2,e=Wc[c].y-gc/2,f=Math.sqrt(d*d+e*e),h=Wc[c].colour,b+=Zb.disttocluster+' <span style="color:'+h+'">'+h+"</span>: "+Math.round(f,2)+"<br>"+Zb.cluster+" "+h+" "+Zb.members+": [",i[c]=[];for(g in Vc)Vc[g].ci==c&&(b+=g+", ",i[c][i[c].length]=g);-1!=b.indexOf(",",b.length-3)&&(b=b.slice(0,-2)),b+="]<br>"}return b+="<br>",Ec.innerHTML=b+Ec.innerHTML,i}function Ua(a){var b,c,d,e={clusterCoords:[]};for(b=0;b<a.length;b++)for(e.clusterCoords[b]=Va(Wc[b]),e.clusterCoords[b].num=b,c=0;c<a[b].length;c++)d=Va(Vc[a[b][c]]),a[b][c]={id:Xb[a[b][c]],num:b,x:d.x,y:d.y};e.members=a,e.iteration=kd.iteration,e.clusterId=kd.clusterId,e.coordsid=Vb,e.usegeometric=sd?1:0,(0!=sc[0]||sc[1]!=pc.maxSession)&&e.iteration<0&&(e.iteration=Oc),x(sb,e)}function Va(a){var b=(a.x-fc/2)/kd.scale+kd.centre.x,c=(a.y-gc/2)/kd.scale+kd.centre.y;return b=(b-kd.originalx)/kd.distance,c=(c-kd.originaly)/kd.distance,{x:b,y:c}}function Wa(a){var b,c,d,e=14;for(b=0;b<Wc.length;b++)c=Wc[b].x,d=Wc[b].y,ac.select("#cluster1-"+b).transition().duration(a).attr("x1",c-e).attr("y1",d-e).attr("x2",c+e).attr("y2",d+e),ac.select("#cluster2-"+b).transition().duration(a).attr("x1",c+e).attr("y1",d-e).attr("x2",c-e).attr("y2",d+e)}function Xa(a,b){Bc=document.getElementById("cluster-slider"),cc.create(Bc,{start:[1],handles:1,range:{min:1,max:3},step:1,orientation:"vertical",direction:"rtl",pips:{mode:"steps",stepped:!0,density:100,filter:function(){return 1},format:{to:function(b){switch(b){case 1:return Zb.showcentroids;case 2:return Zb.removegraph;case 3:return a;default:return""}},from:function(){return""}}}}),Bc.noUiSlider.on("update",Za),Bc.style="margin-top: 20px;";var c=uc.getBoundingClientRect().height,d=b.getBoundingClientRect().height;Bc.style.height=gc-c-d-120+"px";var e=document.createElement("input");e.type="radio",e.name="centroid-type",e.value="geometric",e.style="margin-top: 40px",e.checked=!0,e.addEventListener("click",Ya);var f=document.createElement("label");f.appendChild(e),f.appendChild(document.createTextNode(Zb.geometrics)),Bc.appendChild(f),0==Object.keys(Jb).length&&(e=document.createElement("input"),e.type="radio",e.name="centroid-type",e.value="decomposed",e.addEventListener("click",Ya),f=document.createElement("label"),f.appendChild(e),f.appendChild(document.createTextNode(Zb.decomposed)),Bc.appendChild(f))}function Ya(){sd="geometric"==this.value,ec.selectAll(".centroid").remove();var a,b=[],c=0;for(a in Uc)b[c++]={value:a,selected:!0,colour:Uc[a].colour};sd?Z(b):Y(b),aa()}function Za(a,b){var c,d;switch(parseInt(a[b])){case 1:if(3==Cc){Bc.noUiSlider.set(2);break}if(Cc=1,$a(),!Nc){c=document.getElementsByName("centroid-type");for(d in c)c[d].disabled=!1}break;case 2:Cc=2,_a(),c=document.getElementsByName("centroid-type");for(d in c)c[d].disabled=!0;document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("dragdrop").innerHTML==Zb.dragon&&(document.getElementById("dragdrop").innerHTML="--");break;case 3:if(1==Cc){Bc.noUiSlider.set(2);break}if(Cc=3,ab(),!Nc){var e='<input type="text" placeholder="'+Zb.numclusters+'" id="num-clusters" size="8" pattern="[0-9]{1,2}">';document.getElementById("cluster-text").innerHTML=e}document.getElementById("play-pause").disabled=!1,document.getElementById("play-step").disabled=!1,document.getElementById("clustering").innerHTML==Zb.convergence&&(document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0),"--"==document.getElementById("dragdrop").innerHTML&&(document.getElementById("dragdrop").innerHTML=Zb.dragon)}}function $a(){T(!1),ic.on("mouseover",null).on("mouseout",null),bb(1,0,0,ld),setTimeout(function(){ac.selectAll(".centroid").raise()},100)}function _a(){ic.transition(bc).style("opacity",0),jc.transition(bc).style("opacity",0),ac.selectAll(".clustering-centroid").transition(bc).style("opacity",0),ac.selectAll(".cluster-hull").transition(bc).style("opacity",0),setTimeout(function(){ic.style("display","none"),jc.style("display","none"),ac.selectAll(".clustering-centroid").style("display","none"),ac.selectAll(".cluster-hull").style("display","none")},ld),!Nc&&document.getElementById("cluster-text")&&(document.getElementById("cluster-text").innerHTML=Zb.numclusters);var a=cb();null!==a&&(kd.scale=a[2],yc=a,setTimeout(function(){bb(a[2],a[0],a[1],ld)},ld/2))}function ab(){ac.selectAll(".clustering-centroid").transition(bc).style("display","block").style("opacity",1),ac.selectAll(".cluster-hull").transition(bc).style("display","block").style("opacity",1),ac.selectAll(".clustering-centroid").raise()}function bb(a,b,c,d){var e,f,g,h,i,j,k=14,l=fc/2,m=gc/2;if(!Vc){Vc={};for(j in Uc)Vc[j]={x:0,y:0}}kd.centre={x:b,y:c};for(j in Uc)e=Uc[j].x,f=Uc[j].y,g=(e-b)*a,h=(f-c)*a,1==a&&0==b&&0==c?(e=b+g,f=c+h):(e=l+g,f=m+h),Vc[j].x=e,Vc[j].y=f,i=e+","+(f-k)+" "+(e+k)+","+(f+k)+" "+(e-k)+","+(f+k),ac.select("#centroid-"+j).transition().duration(d).attr("points",i);var n=function(a,b){return a*=kd.distance,a+=kd.originalx,b*=kd.distance,b+=kd.originaly,a-=kd.centre.x,a*=kd.scale,a+=fc/2,b-=kd.centre.y,b*=kd.scale,b+=gc/2,{x:a,y:b}};for(j in ud){var o=n(ud[j].x,ud[j].y);e=o.x,f=o.y,ac.select("#server-centroid-"+j).transition().duration(d).attr("cx",e).attr("cy",f)}}function cb(){var a,b=[];if(vc)return db();for(a in Uc)b[b.length]=[Uc[a].x,Uc[a].y];var c=eb(b);if(null===c)return null;var d,e,f,g,h=[c.x,c.y],i=0,j=0;for(a in Uc)d=Math.abs(Uc[a].x-h[0]),e=Math.abs(Uc[a].y-h[1]),d>i&&(i=d,f=a),e>j&&(j=e,g=a);if(void 0===g&&void 0===f)return h[2]=1,h;var k=Uc[f].x-h[0]+fc/2,l=Uc[f].y-h[1]+gc/2,m=fb(k,l,fc/2,gc/2);k=Uc[g].x-h[0]+fc/2,l=Uc[g].y-h[1]+gc/2;var n=fb(k,l,fc/2,gc/2);return h[2]=m<n?m:n,h[2]*=.9,h}function db(){var a,b=[],c=0,d=0;for(a in xc)if(!(a>=0&&1!=a))for(var e in xc[a])for(var f in xc[a][e].members)c=xc[a][e].members[f].x,c=c*Kb+kd.originalx,d=xc[a][e].members[f].y,d=d*Kb+kd.originaly,b[b.length]=[c,d];var g=eb(b);if(null===g)return null;var h,i,j,k,l,m=[g.x,g.y],n=0,o=0;for(l=0;l<b.length;l++)h=Math.abs(b[l][0]-m[0]),i=Math.abs(b[l][1]-m[1]),h>n&&(n=h,j=l),i>o&&(o=i,k=l);if(void 0===k&&void 0===j)return m[2]=1,m;var p=b[j][0]-m[0]+fc/2,q=b[j][1]-m[1]+gc/2,r=fb(p,q,fc/2,gc/2);p=b[k][0]-m[0]+fc/2,q=b[k][1]-m[1]+gc/2;var s=fb(p,q,fc/2,gc/2);return m[2]=r<s?r:s,m[2]*=.9,m}function eb(a){if(0==a.length)return null;if(1==a.length)return{x:a[0][0],y:a[0][1]};var b,c,d,e=0,f=0,g=fc,h=gc;for(b=0;b<a.length;b++)c=a[b][0],d=a[b][1],c>e&&(e=c),c<g&&(g=c),d>f&&(f=d),d<h&&(h=d);return{x:(e+g)/2,y:(f+h)/2}}function fb(a,b,c,d){var e=a-c,f=b-d,g=e>0?fc:0,h=f>0?gc:0,i=(g-fc/2)/e,j=(h-gc/2)/f;return isFinite(i)&&isFinite(j)&&i<=j?i:isFinite(i)&&!isFinite(j)?i:isFinite(j)?j:1}function gb(){var a=document.getElementById("log-panel");a.style.width=Db+"px";var b=document.createElement("button");b.innerHTML=Zb.copy,b.addEventListener("click",function(){window.getSelection().selectAllChildren(Ec),document.execCommand("copy")}),bd?b.style.marginLeft="10px":(b.style.position="absolute",b.style.right=Db-40+"px"),a.appendChild(b);var c=document.createElement("button");c.innerHTML=Zb.print,c.addEventListener("click",function(){var a=window.open();a.document.write("<html><head></head><body>"),a.document.write(Ec.innerHTML),a.document.write("</body></html>"),a.print(),a.close()}),bd?c.style.marginLeft="10px":(c.style.position="absolute",c.style.right=Db-100+"px"),a.appendChild(c),Ec=document.createElement("div"),Ec.readOnly=!0,Ec.style.overflow="scroll",Ec.style.width="200px",Ec.style.height=gc+"px",Ec.style.resize="none",Ec.style.border="2px solid black",bd||(Ec.style.position="absolute",Ec.style.right="6px",Ec.style.top="110px"),a.appendChild(Ec)}function hb(){var a;for(a in Uc)ec.append("polygon").attr("class","centroid").attr("id","centroid-"+a).attr("points",ib(Uc[a].x,Uc[a].y)).style("stroke","black").style("stroke-width","3px").style("fill",Uc[a].colour).call(ac.drag().on("start",jb.bind(this,a)).on("drag",kb.bind(this,a)).on("end",lb.bind(this,a))).on("mouseout",ob).on("mouseover",pb.bind(this,a)).on("click",oa).on("click.centroidClick",qb.bind(this,Xb[a],a,!1));if(td)for(a in ud){var b=ud[a].x*kd.distance+kd.originalx,c=ud[a].y*kd.distance+kd.originaly;ec.append("circle").attr("class","server-centroid").attr("id","server-centroid-"+a).attr("r",5).attr("cx",b).attr("cy",c).style("fill","black")}}function ib(a,b){var c=14;return a+","+(b-c)+" "+(a+c)+","+(b+c)+" "+(a-c)+","+(b+c)}function jb(a){nb()&&(od=Date.now(),ec.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+a).attr("points",ib(ac.event.x,ac.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Uc[a].colour).style("opacity",.5))}function kb(a){nb()&&ac.select("#dragged-"+a).attr("points",ib(ac.event.x,ac.event.y))}function lb(a){if(ac.selectAll(".dragged-centroid").remove(),nb()){if(Date.now()-od<300)return void qb(Xb[a],a,!1);Vc[a].ci=mb(ac.event);for(var b=[],c=0;c<Wc.length;c++)b[c]=Ra(c);Xc=Wc,Wc=b,Wa(ld);var d=Zb.iteration+": "+Oc;document.getElementById("clustering").innerHTML=d,document.getElementById("dragdrop").innerHTML=Zb.dragon;var e=Ta(Oc);kd.iteration=Oc++,Ua(e)}}function mb(a){for(var b,c,d,e=Number.MAX_SAFE_INTEGER,f=-1,g=0;g<Wc.length;g++)c=a.x-Wc[g].x,d=a.y-Wc[g].y,(b=Math.sqrt(c*c+d*d))<e&&(e=b,f=g);return f}function nb(){if(!Wc||!document.getElementById("clustering"))return!1;if(document.getElementById("clustering").innerHTML==Zb.convergence)return!1;for(var a in Vc)if(void 0===Vc[a].ci)return!1;return 3==Cc}function ob(){Yc||(ac.selectAll(".text").remove(),ac.selectAll("rect").remove(),Nc&&(vc||3==Cc)&&null!==la()&&(ic.style("display","none").style("opacity",0),jc.remove()))}function pb(a){if(!Yc){ac.selectAll(".text").remove(),ac.selectAll("rect").remove();var b=ec.append("rect"),c=[0],d=1==Cc?Uc:Vc,e=a;xb.forEach(function(b){b.id==a&&(e=1==cd?b.firstname+" "+b.lastname:b.id)});var f=1==cd?70:30,g=ec.append("text").attr("class","text").attr("id","t-"+a).attr("y",d[a].y+32).attr("dy",".40em").style("pointer-events","none").text(e).call(o,f,d[a].x-(f+6)/2+8,c),h=18*c[0]+16;if(h+d[a].y+10>=gc&&g.attr("y",gc-h-(gc-d[a].y)).text(e).call(o,f,d[a].x-(f+6)/2+8,c),b.attr("id","r-"+a).attr("x",d[a].x-(f+6)/2).attr("y",h+d[a].y+10<=gc?d[a].y+16:gc-h-16-(gc-d[a].y)).attr("width",f+16).attr("height",h).style("stroke","black").style("fill","yellow"),Nc&&(vc||3==Cc)&&null!==la()){jc.remove();var i,j={};for(i=0;i<pc.nodes.length;i++)pc.nodes[i].visible||(j[pc.nodes[i].id]=1);var k,l,n,p,q={};for(i=sc[0];i<pc.edges[a].length&&i<=sc[1];i++)k=pc.edges[a][i],"string"==typeof k.source?(l=parseInt(k.source),n=parseInt(k.target)):(l=k.source.id,n=k.target.id),j[l]||j[n]||(p=l+"_"+n,q[p]?q[p]++:q[p]=1);var r,s=[],t=pc.edges[a][0].colour;for(k in q)r=k.split("_"),s[s.length]={source:r[0],target:r[1],weight:q[k],colour:t};for(i=0;i<pc.links.length;i++)s[s.length]=pc.links[i];hc.force("link").links(s),m(s),ic.style("display","block").style("opacity",1),hc.restart(),setTimeout(function(){hc.stop(),ic.lower(),jc.lower()},1)}}}function qb(a,b,c){if(Nc&&!document.getElementById("textbox-"+a)&&null!==la()&&(vc||!Nc||3==Cc)){var d=document.createElement("textarea");d.id="textbox-"+a,d.style.resize="both",d.style.position="absolute",Wb[a]&&(d.value=Wb[a]),pd!=Mb&&(d.readOnly=!0),document.body.appendChild(d);var e,f=d.getBoundingClientRect(),g=document.getElementsByTagName("svg")[0].getBoundingClientRect(),h=c?Wc[b].x:Vc[b].x;e=h+f.width/2>=fc?h+g.x-f.width:h-f.width/2<=0?h+g.x:h+g.x-f.width/2,d.style.left=e+"px";var i=c?Wc[b].y:Vc[b].y,j=i+190>=gc?i+140:i+290;c&&(j=i+165>=gc?i+165:i+265),d.style.top=j+"px";var k=document.createElement("button");k.innerHTML=pd==Mb?Zb.save:Zb.close,k.id=a,k.style.position="absolute",k.style.left=e+"px",k.style.top=j+f.height+"px",document.body.appendChild(k),d.focus(),d.addEventListener("click",function(){this.parentNode.appendChild(this),k.parentNode.appendChild(k),this.focus()});var l=!1;d.addEventListener("mousedown",function(){l=!0}),d.addEventListener("mouseup",function(){l=!1}),d.addEventListener("mousemove",function(){l&&(f=this.getBoundingClientRect(),k.style.left=e+"px",k.style.top=j+f.height+"px")}),k.addEventListener("click",function(){if(pd==Mb){var b={coordsid:Vb,clusterid:kd.clusterId,studentid:a,remark:d.value};""!=d.value&&d.value!=Wb[a]&&(Wb[a]=d.value,x(tb,b))}document.body.removeChild(d),document.body.removeChild(k)})}}var rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,sd,td,ud,vd={},wd=[];b(a)}});