/*! moodle-block_behaviour v0.7.8 09-11-2021 */

!function(e){"function"==typeof define&&define.amd?define([],e):window.behaviourAnalytics=e()}(function(){return function(e){var c,l,u,a,n,f,v,r,o,i,h,s,m,y,p,g,x,b,E,d,k,I,L,w,T,M,B,H,C,A,S,N,O,_,F,j,R,q,D,z,U,X,W,G,P,J,Y,Z,K,Q,V,$,ee,te,ne,re,oe,le,ie,se,ae,de,ce,ue,me,ye,pe,ge,fe,ve,he,xe,be,Ee,ke,Ie,Le,we,Te,Me,Be,He,Ce,Ae,Se,Ne,Oe,_e,Fe,je,Re,qe,De,ze,Ue,Xe,We,Ge,Pe,Je,Ye,Ze,Ke,Qe,Ve,$e,et,tt,nt,rt,ot,lt={},it=[];function st(){h.forEach(function(e){for(;!be[e.entype];){var t,n=he[Math.floor(z.random()*he.length)],r=!0;for(t in be)be[t]==n&&(r=!1);be[e.entype]=r?n:void 0}})}function at(){$={nodes:[],links:[],edges:{},maxSession:0},dt(),ct()}function dt(){var t,n,r,o=$,l={};h.forEach(function(e){t=!0,r=n=void 0,x[e.id]?(t=1==x[e.id].visible&&1==x["g"+e.sect].visible,1!=x[e.id].visible||t||(x[e.id].visible=0),n=x[e.id].xcoord,r=x[e.id].ycoord):x["g"+e.sect]&&(t=1==x["g"+e.sect].visible&&k==C),o.nodes[o.nodes.length]={id:e.id,name:e.name,group:e.sect,type:e.type,entype:e.entype,colour:be[e.entype],visible:t,xcoord:n,ycoord:r},l[e.sect]||(x["g"+e.sect]&&(t=1==x["g"+e.sect].visible,n=x["g"+e.sect].xcoord,r=x["g"+e.sect].ycoord),l[e.sect]={id:"g"+e.sect,name:_.section+" "+e.sect,group:e.sect,type:"grouping",colour:be.grouping,visible:t,xcoord:n,ycoord:r},o.nodes[o.nodes.length]=l[e.sect]),o.links[o.links.length]={source:"g"+e.sect,target:e.id,weight:Z,colour:be.originalLinks}}),n=r=void 0,x.root&&(n=x.root.xcoord,r=x.root.ycoord);var e,i,s,a,d={id:"root",name:m,group:-1,type:"grouping",colour:be.grouping,visible:!0,xcoord:n,ycoord:r};for(e in l)o.links[o.links.length]={source:"root",target:l[e].id,weight:Z,colour:be.originalLinks};if(o.nodes[o.nodes.length]=d,0<Object.keys(b).length){for(a in b)i=(s=a.split("_"))[0],s=s[1],o.links[o.links.length]={source:i,target:s,weight:5*b[a],colour:be.originalLinks};if(!g)for(var c in o.nodes)isNaN(o.nodes[c].id)&&(o.nodes[c].visible=!1)}}function ct(){var e,t=$,n=0,r=0;tt={};for(var o=0;o<f.length;o++)e={source:f[o].moduleId,target:f[o].moduleId,weight:Z,user:f[o].userId,colour:""},t.edges[f[o].userId]||(t.edges[f[o].userId]=[],tt[f[o].userId]=[],t.maxSession=t.maxSession<n?n:t.maxSession,r=n=0),x[f[o].moduleId]&&1==x[f[o].moduleId].visible&&(tt[f[o].userId][r++]=f[o].moduleId),o+1<f.length&&f[o].userId==f[o+1].userId?(e.target=f[o+1].moduleId,t.edges[f[o].userId][n++]=e):0==t.edges[f[o].userId].length&&(t.edges[f[o].userId][n++]=e);t.maxSession=t.maxSession<n?n:t.maxSession,v.forEach(function(e){t.edges[e.id]||(t.edges[e.id]=[])})}function ut(e){U=R.select("#graph").append("svg").attr("width",X).attr("height",W),Y=R.forceLink($.links).id(function(e){return e.id}).strength(e),G=R.forceSimulation($.nodes).force("link",Y).force("charge",R.forceManyBody().strength(-80)).force("collide",R.forceCollide().radius(12)).force("center",R.forceCenter(X/2,W/2)).force("x",R.forceX()).force("y",R.forceY()),mt($.nodes,Pe,Xe,We,Ge),yt($.links),U.on("click",function(){R.selectAll("#rctext").remove(),R.selectAll("#rcrect").remove(),(ke||p)&&P.on("mouseover",pt).on("mouseout",ft),le&&P.on("mouseover",null).on("mouseout",null)}),Ke&&p&&0<Object.keys(x).length?G.on("tick",ht):G.on("tick",xt);for(var t=0;t<80;t++)G.tick();p&&setTimeout(function(){G.stop(),G.on("tick",xt),bt(),0!=Object.keys(x).length&&Ke||(Et(),$.edges={},ct(),Ke=!0,Z=ke?1:0)},500),ke&&!Ke&&setTimeout(function(){$.nodes=[],$.links=[],dt()},600)}function mt(e,t,n,r,o){P=U.selectAll(".node").data(e).enter().append("circle").attr("class","node").attr("r",Je).on("mouseover",pt).on("mouseout",ft).on("contextmenu",t).call(R.drag().on("start",n).on("drag",r).on("end",o))}function yt(e){J=U.selectAll(".link").data(e).enter().append("line").attr("class","link").style("stroke",function(e){return e.colour}).style("stroke-width",function(e){return 2*e.weight+"px"})}function pt(e,t){var n,r,o,l,i,s,a,d,c;_e||(P.on("mouseover",null),t||(R.selectAll(".text").remove(),R.selectAll("rect").remove()),Date.now()-Ue<150||(o=r=n=!(c=[0]),l=150,i=304,s=154,a=e.type+": "+e.name,Fe&&(s=i=0),d=U.append("text").attr("class","text").attr("id","t-"+e.id).attr("y",e.y+32).attr("dy",".40em").style("pointer-events","none").text(a).call(gt,l,e.x-78+8,c),(t=16*c[0]+16)+e.y>=W-s&&(d.attr("y",W-t-(W-e.y)).text(a).call(gt,l,e.x-78+8,c),n=!0),e.x<=i/2?(d.text(a).call(gt,l,e.x+8,c),o=!0):e.x>=X-i/2&&(d.text(a).call(gt,l,e.x-156+8,c),r=!0),c=o?e.x:r?e.x-156:e.x-78,c=U.append("rect").attr("id","r-"+e.id).attr("x",c).attr("y",n?W-t-16-(W-e.y):e.y+16).attr("width",166).attr("height",t).style("stroke","black").style("fill","yellow"),d.raise(),isNaN(e.id)||(Fe&&(i=400,s=300),function(e,t,n,r,o,l,i,s,a,d){var c=document.createElement("iframe");c.id="preview",c.style.position="absolute",c.style.width=r+"px",c.style.height=o+"px";var u=document.getElementsByTagName("svg")[0].getBoundingClientRect(),m=document.body.getBoundingClientRect();0<m.x&&(m.x=0);c.style.left=je?window.innerWidth-10-r+"px":Fe?"10px":i?a+u.x+"px":s?a+u.x+n-r+18+"px":a+u.x-r/2+n/2+"px";n=qe?0:50;c.style.top=Fe?u.y-m.y+W/2+"px":l?n+d+u.y-m.y-o+"px":n+d+u.y+t-m.y+"px";"lti"!=e.entype&&"unknown"!=e.type&&((m=document.createElement("div")).id="bgrnd",m.style.position="absolute",m.style.width=parseInt(c.style.width)+24+"px",m.style.height=parseInt(c.style.height)+24+"px",m.style.left=parseInt(c.style.left)-12+"px",m.style.top=parseInt(c.style.top)-12+"px",m.addEventListener("mouseout",function(e){var t=this.getBoundingClientRect();e.x>t.x&&e.x<t.x+t.width&&e.y>t.y&&e.y<t.y+t.height||(Re=!1,setTimeout(vt,750))}),m.addEventListener("mouseover",function(){Re=!0}),c.src=y+"mod/"+e.entype+"/view.php?id="+e.id,document.body.appendChild(m),document.body.appendChild(c))}(e,t,l,i,s,n,o,r,parseInt(c.attr("x")),parseInt(c.attr("y"))))))}function gt(e,s,a,t){var d=0;e.each(function(){for(var e=R.select(this),t=e.text().split(/\s+/).reverse(),n=[],r=e.attr("y"),o=parseFloat(e.attr("dy")),l=e.text(null).append("tspan").attr("x",a).attr("y",r).attr("dy",o+"em"),i=t.pop();i;)n.push(i),l.text(n.join(" ")),l.node().getComputedTextLength()>s&&(n.pop(),l.text(n.join(" ")),n=[i],l=e.append("tspan").attr("x",a).attr("y",r).attr("dy",1.1*++d+o+"em").text(i)),i=t.pop()}),t[0]=++d}function ft(e){_e||"lightgrey"==e.colour||(P.on("mouseout",null),J.on("mouseout",null),setTimeout(vt,750))}function vt(){if(!Re&&(R.selectAll(".text").remove(),R.selectAll("rect").remove(),R.selectAll("#preview").remove(),R.selectAll("#bgrnd").remove(),P.on("mouseover",pt).on("mouseout",ft),Fe)){J.on("mouseover",In).on("mouseout",ft);for(var e=0;e<Se.length;e++)R.select("#cluster1-"+e).on("mouseover",En.bind(this,e,!1)),R.select("#cluster2-"+e).on("mouseover",En.bind(this,e,!1))}}function ht(){var t=X/2,r=W/2,o=E;void 0===Ye.originalx?(Ye.originalx=t,Ye.originaly=r):(t=Ye.originalx,r=Ye.originaly);for(var e,n,l=0;l<$.nodes.length;l++)e=$.nodes[l].xcoord*o+t,n=$.nodes[l].ycoord*o+r,(e<0||X<e||n<0||W<n)&&(o*=.9,--l);E=o,Ye.distance=o,J.attr("x1",function(n){var e=$.nodes.filter(function(e){var t="string"==typeof n.source?n.source:n.source.id;return e.id==t})[0];return R.select(this).attr("y1",e.ycoord*o+r),e.xcoord*o+t}).attr("x2",function(n){var e=$.nodes.filter(function(e){var t="string"==typeof n.target?n.target:n.target.id;return e.id==t})[0];return R.select(this).attr("y2",e.ycoord*o+r),e.xcoord*o+t}).style("display",function(e){return e.source.visible&&e.target.visible?"block":"none"}),P.attr("cx",function(e){return e.x=e.xcoord*o+t,e.x}).attr("cy",function(e){return e.y=e.ycoord*o+r,e.y}).style("display",function(e){return e.visible?"block":"none"}).style("fill",function(e){return e.colour}).raise()}function xt(){var t=Je;J.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).style("stroke-width",function(e){return 2*e.weight+"px"}).style("display",function(e){return e.source.visible&&e.target.visible?"block":"none"}),P.attr("cx",function(e){return e.x=Math.max(t,Math.min(X-t,e.x)),e.x}).attr("cy",function(e){return e.y=Math.max(t,Math.min(W-t,e.y)),e.y}).style("fill",function(e){return e.colour}).style("display",function(e){return e.visible?"block":"none"}).raise(),R.selectAll("rect").raise(),R.selectAll("text").raise()}function bt(){var e,t;M&&(R.select("#time").remove(),0==A&&(A=Date.now()),(e=new Date).setTime(A),(t=e.getMinutes())<10&&(t="0"+t),U.append("text").attr("id","time").attr("y",W-16).attr("dy",".40em").attr("x",6).style("pointer-events","none").text(M[C]+" "+e.getHours()+":"+t+" "+e.toDateString()))}function Et(){var t,n,r,o,l,i,s,e=(o={},l=0,i=X/2,s=W/2,$.nodes.forEach(function(e){t=e.x-i,n=e.y-s,n=Math.sqrt(t*t+n*n),l<n&&(l=n,r=e)}),o.scale=l,o.module=r.id,E=l,$.nodes.forEach(function(e){o[e.id]={xcoord:""+(e.x-i)/l,ycoord:""+(e.y-s)/l,visible:e.visible?1:0},e.xcoord||(e.xcoord=(e.x-i)/l,e.ycoord=(e.y-s)/l)}),x=o);if(I&&w){var a,d={};for(a in e)"scale"!=a&&"module"!=a&&(d[a]=e[a]);I[k]=d,w[k]=e.scale}e.time=Date.now(),A=e.time,T&&(T[k]=e.time),kt(c,e)}function kt(e,t){var n=new XMLHttpRequest;n.open("POST",e),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==this.readyState&&this.status},n.send("cid="+d+"&data="+JSON.stringify(t)+"&sesskey="+F)}function It(){var e=new Image,t=(new XMLSerializer).serializeToString(U.node());e.src="data:image/svg+xml;base64,"+window.btoa(t),document.body.appendChild(e);t=document.createRange();t.setStartBefore(e),t.setEndAfter(e),t.selectNode(e),window.getSelection().addRange(t),document.execCommand("Copy"),document.body.removeChild(e)}function Lt(){var e=(new XMLSerializer).serializeToString(U.node()),t=window.open();t.document.write('<img src="data:image/svg+xml;base64,'+window.btoa(e)+'"/>'),t.print(),t.close()}function wt(){for(var e,t=document.getElementById("teacher-select"),n=0;n<t.options.length;n++)if(t.options[n].selected){e=t.options[n].value;break}Pe=e==k?(Xe=Nt,We=Ot,Ge=_t,St):Ge=We=Xe=null,x=I[e],b=L[e],E=w[e],A=T[e],h=B[e],m=H[e],C=e,U.remove(),fe={},st(),R.selectAll("#legendUL").remove(),Mt(),Z=1,at(),Z=0;var r,o=document.getElementById("weights-output").innerHTML;for(r in ut(o=parseFloat(o.split(" ")[1])),fe)x[r]&&(fe[r].checked=1==x[r].visible),k==e?(fe[r].removeEventListener("change",Tt),fe[r].addEventListener("change",Ct)):(fe[r].removeEventListener("change",Ct),fe[r].addEventListener("change",Tt))}function Tt(){this.checked=!this.checked}function Mt(){var n;(ge=document.getElementById("legend")).style="width: "+s+"px; height: "+W+"px; min-width: "+s+"px; max-width: 500px;";function t(e){var t=n-e.x;n=e.x,500<(t=parseInt(ge.style.width)+t)?t=500:t<s&&(t=s),ge.style.width=t+"px"}ge.addEventListener("mousemove",function(e){var t=ge.offsetLeft+28;e.x>=t&&e.x<=t+6?ge.style.cursor="col-resize":ge.style.cursor="auto"}),ge.addEventListener("mousedown",function(e){n=e.x,"col-resize"==ge.style.cursor&&ge.addEventListener("mousemove",t)}),document.addEventListener("mouseup",function(){ge.removeEventListener("mousemove",t)}),function(e){var t=document.createElement("ul");t.id="legendUL";var n=document.createElement("span");n.className="no-select-text",n.innerHTML=m;var r=document.createElement("li");r.appendChild(n);var o=document.createElement("ul");r.appendChild(o),t.appendChild(r);var l,i,s,a=-1;h.sort(function(e,t){return e.sect-t.sect}),h.forEach(function(e){a!=e.sect&&((i=document.createElement("ul")).className="nested",(s=document.createElement("span")).className="caret",s.addEventListener("click",Bt),(l=document.createElement("li")).appendChild(s),Ht("g"+e.sect,_.section+" "+e.sect,be.grouping,e.sect,"grouping",l),l.appendChild(i),o.appendChild(l),a=e.sect),(l=document.createElement("li")).className="indented",Ht(e.id,e.name,be[e.entype],e.sect,e.type,l),i.appendChild(l)}),e.appendChild(t)}(ge)}function Bt(){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("caret-down")}function Ht(e,t,n,r,o,l){var i=document.createElement("input");i.type="checkbox",x[e]?i.checked=0!=x[e].visible:x["g"+r]?i.checked=1==x["g"+r].visible&&k==C:i.checked=!0,i.id=e,i.group=r,i.nodeT=o,i.addEventListener("change",Ct),fe[i.id]=i;r=document.createElement("label");r.style.color=n,r.className="no-select-text",r.appendChild(document.createTextNode("grouping"==o?t:o+"_"+t)),l.appendChild(i),l.appendChild(r)}function Ct(){var t=this.id,n=this.checked,r=this.nodeT,o=this.group;$.nodes.forEach(function(e){(e.id==t||"grouping"==r&&e.group==o||n&&"grouping"==e.type&&e.group==o)&&(e.visible=n,fe[e.id].checked=n)}),At(),zt()}function At(){parseFloat(document.getElementById("weight-slider").value)<0&&(Y.strength(0),document.getElementById("weights-output").innerHTML="&nbsp;= 0",document.getElementById("weight-slider").value=0)}function St(e){var t,n,r;R.selectAll(".text").remove(),R.selectAll("rect").remove(),R.selectAll("#preview").remove(),R.selectAll("#bgrnd").remove(),R.event.preventDefault(),"root"!=e.id&&(t=e,P.on("mouseover",null).on("mouseout",null),n=U.append("rect"),r=U.append("text").attr("class","text").attr("id","rctext").attr("x",e.x+10).attr("y",e.y+12).attr("dy",".40em").style("pointer-events","none").text(_.hide),e.y+20>=W&&r.attr("y",W-(W-e.y)-10).text(_.hide),n.attr("id","rcrect").attr("x",e.x).attr("y",e.y+20<=W?e.y:W-(W-e.y)-20).attr("width",60).attr("height",24).style("stroke","black").style("fill","lightgrey"),n.on("mouseover",function(){R.event.target.style="fill: grey;"}),n.on("mouseout",function(){R.event.target.style="fill: lightgrey;"}),n.on("click",function(){R.selectAll("#rctext").remove(),R.selectAll("#rcrect").remove(),P.on("mouseover",pt).on("mouseout",ft),t.visible=!1,fe[t.id].checked=!1,"grouping"==t.type&&$.nodes.forEach(function(e){e.group==t.group&&(e.visible=!1,fe[e.id].checked=!1)}),At(),zt()}))}function Nt(e){R.event.active||G.alphaTarget(Q).restart(),e.fx=e.x,e.fy=e.y}function Ot(e){R.selectAll("rect").remove(),R.selectAll(".text").remove(),R.selectAll("#preview").remove(),R.selectAll("#bgrnd").remove(),e.fx=R.event.x,e.fy=R.event.y}function _t(e){R.event.active||(p?(G.stop(),Et(),bt()):G.alphaTarget(V)),e.fx=null,e.fy=null,Ue=Date.now()}function Ft(){var e=document.getElementById("student-menu");return(oe=document.createElement("button")).innerHTML=_.cluster,oe.addEventListener("click",Qt),e.appendChild(oe),oe.getBoundingClientRect().height}function jt(e){var t=document.getElementById("student-menu");(ee=document.createElement("select")).multiple=!0,ee.id="student-select";e=0<r.length?W-e-120:W-e-12;ee.style="height: "+e+"px;",ee.addEventListener("change",function(){for(var e=document.getElementById("student-select"),t=0;t<e.options.length;t++){var n="box-shadow: 0 0 10px 100px "+e.options[t].colour+" inset;";e.options[t].style=e.options[t].selected?n:"box-shadow: 0 0 0 0 white inset;"}0<f.length&&Ut(!0)}),1==De?v.sort(function(e,t){e=e.firstname+" "+e.lastname,t=t.firstname+" "+t.lastname;return t<e?1:e<t?-1:0}):v.sort(function(e,t){return e.id-t.id}),v.forEach(function(e){Rt(e,ee)}),t.appendChild(ee)}function Rt(e,t){var n=document.createElement("option");n.value=e.id,n.text=1==De?e.firstname+" "+e.lastname:e.id,n.colour=he[xe++],xe>=he.length&&(xe=0),$.edges[e.id].forEach(function(e){e.colour=n.colour}),t.appendChild(n)}function qt(){if(0!=r.length){var e,t,n=document.getElementById("student-menu");for(t in(i=document.createElement("select")).multiple=!0,i.id="group-select",i.style="height: 120px;",i.addEventListener("change",function(){R.selectAll(".link").remove(),R.selectAll(".hull").remove(),yt($.links),G.on("tick",ht),G.restart(),setTimeout(G.stop,100);for(var e=ee.options.length=0;e<i.options.length;e++)if(i.options[e].selected)for(var t=0;t<v.length;t++)o[v[t].realId]==i.options[e].value&&Rt(v[t],ee)}),r)(e=document.createElement("option")).value=t,e.text=r[t],i.appendChild(e);n.appendChild(i)}}function Dt(){var t;te=document.getElementById("slider"),ne=[0,$.maxSession],t=$.maxSession<500?10:$.maxSession<1e3?20:$.maxSession<5e3?100:$.maxSession<1e4?200:500,D.create(te,{start:[0,$.maxSession],range:{min:[0],max:[$.maxSession]},step:1,connect:!0,pips:{mode:"steps",stepped:!0,density:100,filter:function(e){return 0==e||e==$.maxSession?1:e%t==0?2:0}}}),setTimeout(function(){te.noUiSlider.on("update",function(e,t){ne[t]=parseInt(e[t]),ee.dispatchEvent(new Event("change"))})},1e3)}function zt(){J.remove(),P.remove(),R.selectAll(".hull").remove();var e=Xt(St);Wt(e),Pt(e),G.alphaTarget(K).restart(),p&&setTimeout(function(){G.stop(),Et(),bt()},100)}function Ut(e){J.remove(),P.remove(),R.selectAll(".hull").remove(),p=!1;var t=Xt(null);Wt(t),e&&Pt(t),p=!0,G.on("tick",ht),G.restart(),setTimeout(G.stop,100)}function Xt(e){var t=[],n={};return $.nodes.forEach(function(e){null===e.fx&&(e.fx=e.x,e.fy=e.y),e.visible?t[t.length]=e:n[e.id]=1}),G.nodes(t),mt(t,e,Xe,We,Ge),n}function Wt(e){var t,n,r,o,l=[];for(s in $.links)n="string"==typeof(r=$.links[s]).source?(t=r.source,r.target):(t=r.source.id,r.target.id),e[t]||e[n]||(l[l.length]=r);for(var i=p?[]:document.getElementById("student-select").options,s=0;s<i.length;s++)if(i[s].selected){for(var a,d={},c=ne[0];c<=ne[1]&&$.edges[i[s].value].length>c;c++)n="string"==typeof(o=$.edges[i[s].value][c]).source?(a=o.source+"_"+o.target,t=o.source,o.target):(a=o.source.id+"_"+o.target.id,t=o.source.id,o.target.id),d[a]?d[a]++:d[a]=1,e[t]||e[n]||(l[l.length]=o);for(c=ne[0];c<=ne[1]&&$.edges[i[s].value].length>c;c++)a="string"==typeof(o=$.edges[i[s].value][c]).source?o.source+"_"+o.target:o.source.id+"_"+o.target.id,o.weight=d[a]}G.force("link").links(l),yt(l)}function Gt(t){return $.nodes.find(function(e){return e.id==t})}function Pt(e){if(!p){R.selectAll(".hull").remove();for(var t,n=document.getElementById("student-select").options,r={},o=0;o<n.length;o++)if(n[o].selected){r[n[o].value]={};for(var l=ne[0];l<=ne[1]&&$.edges[n[o].value].length>l;l++){var i,s,a,d,c,u,m=$.edges[n[o].value][l];u="string"==typeof m.source?(i=m.source,s=m.target,a=(u=Gt(i)).x,d=u.y,c=(u=Gt(s)).x,u.y):(i=m.source.id,s=m.target.id,a=m.source.x,d=m.source.y,c=m.target.x,m.target.y),e[i]||e[s]||(m=m.colour,r[n[o].value][i]={x:a,y:d,colour:m},r[n[o].value][s]={x:c,y:u,colour:m})}}for(t in r)Zt(r[t],t,!1,!1);ke&&(nt?Yt:Jt)(n)}}function Jt(e){if(Ce={},0!=Object.keys(tt).length)for(var t,n,r,o=0;o<e.length;o++)e[o].selected&&(t=e[o].value,tt[t].length<=ne[0]||(n=ne[0],r=tt[t].length>ne[1]+1?ne[1]:tt[t].length,n=parseInt(n/2+r/2),r=tt[t][n],n=parseFloat(x[r].xcoord),r=parseFloat(x[r].ycoord),Ce[t]={x:n*E+Ye.originalx,y:r*E+Ye.originaly,colour:e[o].colour}))}function Yt(e){if(Ce={},0!=Object.keys(tt).length)for(var t=0;t<e.length;t++)if(e[t].selected){var n=e[t].value;if(!(tt[n].length<=ne[0])){for(var r,o=ne[0],l=tt[n].length>ne[1]+1?ne[1]:tt[n].length,i=0,s=0,a=0,d=o;d<l;d++)r=tt[n][d],i+=parseFloat(x[r].xcoord),s+=parseFloat(x[r].ycoord),a++;Ce[n]={x:i/a*E+Ye.originalx,y:s/a*E+Ye.originaly,colour:e[t].colour}}}}function Zt(e,t,n,r){if(0!=Object.keys(e).length){var o,l,i=[],s=20,a=ke?"hull":n?"manual-hull":"cluster-hull";for(l in e)i[i.length]=[e[l].x,e[l].y],o=e[l].colour;if(1==i.length)p=function(e){var t=[e[0][0],e[0][1]-s],e=[e[0][0],e[0][1]+s];return"M "+t+" A "+[s,s,"0,0,0",e].join(",")+" A "+[s,s,"0,0,0",t].join(",")};else{if(2!=i.length){n=R.concaveHull().padding(15);Te||n.distance(Me);n=4<i.length?n(i):[i];return p=R.line().curve(Be),void U.selectAll("#hull-"+t).data(n).enter().append("path").attr("id","hull-"+t).attr("class",a).style("stroke",o).style("stroke-opacity",r?0:1).style("fill",o).style("fill-opacity",r?0:He).attr("d",p)}function d(e,t){return[e[0]+t[0],e[1]+t[1]]}function c(e,t){return m(y(e),t)}var u=function(e,t){return[t[0]-e[0],t[1]-e[1]]},m=function(e,t){return[t*e[0],t*e[1]]},y=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return m(e,1/t)},p=function(e){var t=u(e[0],e[1]),n=c(t,s),r=d(e[0],m(n,-1)),o=d(e[1],n),e=1.2*s,n=c(function(e,t){e=[-(e=void 0!==t?u(e,t):e)[1],e[0]];return y(e)}(t),e),t=m(n,-1),e=d(r,t),t=d(o,t),n=d(r,n);return"M "+r+" C "+[e,t,o].join(",")+" S "+[n,r].join(",")+" Z"}}U.append("path").attr("id","hull-"+t).attr("class",a).style("stroke",o).style("stroke-opacity",r?0:1).style("fill",o).style("fill-opacity",r?0:He).attr("d",p(i))}}function Kt(){clearInterval(we),we=void 0,Ae=null,cn(),R.selectAll(".clustering-centroid").remove(),R.selectAll(".cluster-hull").remove(),R.selectAll(".centroid").remove(),R.selectAll(".server-centroid").remove(),ue.style.display="none",document.getElementById("anim-controls").style.display="none",document.getElementById("log-panel").style.display="none",document.getElementById("student-menu").style.width=oe.style.width,document.getElementById("clustering-replay-comment").innerHTML="&nbsp",Fe=!(ke=!0),te.style.display="block",ee.style.display="block",i&&(i.style.display="block"),P.style("display","block"),P.style("opacity",1),J.style("display","block"),J.style("opacity",1),Ut(!0),P.on("mouseover",pt).on("mouseout",ft),oe.innerHTML=_.cluster,oe.removeEventListener("click",Kt),oe.addEventListener("click",Qt)}function Qt(){ke=!1,te.style.display="none",ee.style.display="none",i&&(i.style.display="none"),R.selectAll(".hull").remove(),R.selectAll(".text").remove(),R.selectAll("rect").remove(),document.getElementById("student-menu").style.width=ye+"px",oe.innerHTML=_.graph,oe.removeEventListener("click",Qt),oe.addEventListener("click",Kt),G.stop(),P.on("mouseover",null).on("mouseout",null).on("contextmenu",null).call(R.drag().on("start",null).on("drag",null).on("end",null)),Ye.clusterId=Date.now(),Ie=!(S={}),me=1,we=void(Le=0),document.getElementById("clustering-replay-comment").innerHTML="&nbsp";var t='<p id="cluster-text">'+_.numclusters+"</p>";setTimeout(function(){var e;ue?(document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("cluster-text").innerHTML=t,document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("anim-controls").style.display="block",document.getElementById("log-panel").style.display="block",ue.removeAttribute("disabled"),ue.noUiSlider.set(1),ue.style.display="block"):(e=function(){var e=document.getElementById("anim-controls");e.appendChild(document.createTextNode(_.runkmeans));var t=document.createElement("p");t.innerHTML="&nbsp",t.id="clustering",e.appendChild(t);var n=document.createElement("p");n.innerHTML="&nbsp",n.id="dragdrop",n.style.marginTop="-12px",e.appendChild(n);t=document.createElement("button");t.id="play-pause",t.style.marginLeft="5px",t.style.marginRight="5px",t.innerHTML="&#9654",t.addEventListener("click",fn),t.disabled=!0;n=document.createElement("button");n.id="play-step",n.style.marginLeft="5px",n.innerHTML="&#9654&nbsp&nbsp&#9614",n.addEventListener("click",function(e){3==me&&(we?(clearInterval(we),we=void 0,e.innerHTML="&#9654",ue.removeAttribute("disabled")):hn())}.bind(this,t)),n.disabled=!0,e.appendChild(n),e.appendChild(t);t=document.createElement("button");return t.id="stop",t.style.marginTop="5px",t.style.marginLeft="5px",t.innerHTML=_.reset,t.addEventListener("click",gn),e.appendChild(t),e}(),function(t,e){ue=document.getElementById("cluster-slider"),D.create(ue,{start:[1],handles:1,range:{min:1,max:3},step:1,orientation:"vertical",direction:"rtl",pips:{mode:"steps",stepped:!0,density:100,filter:function(){return 1},format:{to:function(e){switch(e){case 1:return _.showcentroids;case 2:return _.removegraph;case 3:return t;default:return""}},from:function(){return""}}}}),ue.noUiSlider.on("update",An),ue.style="margin-top: 20px;";var n=oe.getBoundingClientRect().height,e=e.getBoundingClientRect().height;ue.style.height=W-n-e-120+"px";n=document.createElement("input");n.type="radio",n.name="centroid-type",n.value="geometric",n.style="margin-top: 40px",n.checked=!0,n.addEventListener("click",Cn);e=document.createElement("label");e.appendChild(n),e.appendChild(document.createTextNode(_.geometrics)),ue.appendChild(e),0==Object.keys(b).length&&((n=document.createElement("input")).type="radio",n.name="centroid-type",n.value="decomposed",n.addEventListener("click",Cn),(e=document.createElement("label")).appendChild(n),e.appendChild(document.createTextNode(_.decomposed)),ue.appendChild(e))}(t,e),Rn()),qn()},Ze/2)}function Vt(e){nn(e)&&(Ve=Date.now(),U.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+e).attr("points",Dn(R.event.x,R.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Ce[e].colour).style("opacity",.5))}function $t(e){R.select("#dragged-"+e).attr("points",Dn(R.event.x,R.event.y))}function en(e,t,n){if(R.selectAll(".dragged-centroid").remove(),nn(e))if(Date.now()-Ve<300)Yn(N[e],e,!1);else{Qe||function(){for(var e in se)if(!(0<=e)){lt[e]={};for(var t=0;t<se[e].length;t++)for(var n in se[e][t].members){n=O[se[e][t].members[n].id];lt[e][n]=t}}}();var r=rn();if(0==Object.keys(lt[r]).length)for(var o=0;o<se[r].length;o++)for(var l in se[r][o].members){l=O[se[r][o].members[l].id];lt[r][l]=o}var i,s=Wn(R.event);for(i in lt)i<=r&&(lt[i][e]=s);on(r,t,n),Qe=!0,tn(r),function(e){for(var t={clusterCoords:[],members:[]},n=0;n<it.length;n++){var r,o=it[n]||Se[n];for(r in t.clusterCoords[n]=Bn(o),t.clusterCoords[n].num=n,lt[e])lt[e][r]==n&&(t.members[t.members.length]={id:N[r],num:n})}t.iteration=e,t.clusterId=Ye.clusterId,t.coordsid=A,kt(a,t)}(r)}}function tn(e){if(!(0<=e)&&lt[e]&&0!=Object.keys(lt[e]).length){for(var t=function(e){var t,n,r,o=0,l=0,i=0,s=[];for(r=0;r<Se.length;r++){for(var a in Ae)Ae[a].ci==r&&lt[e][a]==Ae[a].ci?o++:Ae[a].ci==r&&lt[e][a]!=Ae[a].ci?l++:lt[e][a]==r&&lt[e][a]!=Ae[a].ci&&i++;t=o/(o+l),n=o/(o+i),s[r]={tp:o,fp:l,fn:i,precision:t,recall:n,f1:t+n==0?0:2*t*n/(t+n),fhalf:t+n==0?0:1.25*t*n/(.25*t+n),f2:t+n==0?0:5*t*n/(4*t+n)},i=l=o=0}for(r=0;r<s.length;r++)o+=s[r].tp,l+=s[r].fp,i+=s[r].fn;return t=o/(o+l),n=o/(o+i),s[s.length]={tp:o,fp:l,fn:i,precision:t,recall:n,f1:t+n==0?0:2*t*n/(t+n),fhalf:t+n==0?0:1.25*t*n/(.25*t+n),f2:t+n==0?0:5*t*n/(4*t+n)},s}(e),n=_.manualcluster+"<br>",r=0;r<it.length;r++)if(it[r]){var o,l=it[r].x-X/2,i=it[r].y-W/2,l=Math.sqrt(l*l+i*i),i=Se[r].colour;for(o in n+=_.disttocluster+' <span style="color:'+i+'">'+i+"</span>: "+Math.round(l)+"<br>"+_.cluster+" "+i+" "+_.members+": [",lt[e])lt[e][o]==r&&(n+=o+", ");-1!=n.indexOf(",",n.length-3)&&(n=n.slice(0,-2)),n+="]<br>",et&&(n+=_.precision+": "+t[r].precision.toFixed(4)+"<br>",n+=_.recall+": "+t[r].recall.toFixed(4)+"<br>",n+=_.f1+": "+t[r].f1.toFixed(4)+"<br>",n+=_.fhalf+": "+t[r].fhalf.toFixed(4)+"<br>",n+=_.f2+": "+t[r].f2.toFixed(4)+"<br>")}var s=pe.innerHTML.split("<br><br>"),a=s[0].split("<br>");for(pe.innerHTML="",r=0;r<a.length&&!a[r].startsWith(_.manualcluster);r++)pe.innerHTML+=a[r]+"<br>";for(et&&(r=t.length-1,n+=_.totalmeasures+"<br>",n+=_.precision+": "+t[r].precision.toFixed(4)+"<br>",n+=_.recall+": "+t[r].recall.toFixed(4)+"<br>",n+=_.f1+": "+t[r].f1.toFixed(4)+"<br>",n+=_.fhalf+": "+t[r].fhalf.toFixed(4)+"<br>",n+=_.f2+": "+t[r].f2.toFixed(4)+"<br>"),pe.innerHTML+=n+"<br>",r=1;r<s.length;r++)pe.innerHTML+=s[r]+"<br><br>"}}function nn(e){if(document.getElementById("replayer").innerHTML==_.convergence&&$e==k){var t,n=Ae[e].ci,r=0;for(t in Ae)Ae[t].ci==n&&r++;var o=rn(),l=0;if(lt[o])for(t in n=lt[o][e],lt[o])lt[o][t]==n&&l++;return 1==r&&l<=1?void 0:1!=l}}function rn(){var e=pe.innerHTML.split("<br>");return e[2]&&e[2].startsWith(_.iteration)?parseInt(e[2].split(" ")[1]):null}function on(e,t,n){for(var r,o,l,i=[],s=[],a=0;a<se[e].length;a++)for(r in i[a]={},s[a]=[],lt[e])lt[e][r]==a&&(o=Ae[r].x,l=Ae[r].y,i[a][o+"_"+l]={x:o,y:l,colour:Se[a].colour},s[a][s[a].length]=[o,l]);var d=0==document.getElementsByClassName("manual-centroid").length;for(R.selectAll(".manual-hull").remove(),a=0;a<i.length;a++)Zt(i[a],-1*(a+1),!0,d),it[a]=wn(s[a]);if(t)for(t[n.did]||(t[n.did]={}),t[n.did][n.gid]||(t[n.did][n.gid]={}),t[n.did][n.gid][n.cid]||(t[n.did][n.gid][n.cid]={}),t[n.did][n.gid][n.cid][e]||(t[n.did][n.gid][n.cid][e]=[]),a=0;a<it.length;a++)if(it[a]){var c=[];for(r in lt[e])lt[e][r]==a&&(c[c.length]={id:N[r],num:a});t[n.did][n.gid][n.cid][e][a]={centroidx:it[a].x,centroidy:it[a].y,members:c}}(d?function(){R.selectAll(".manual-centroid").remove();for(var e,t,n=0;n<it.length;n++){if(!it[n])return;e=it[n].x,t=it[n].y,U.append("line").attr("class","manual-centroid").attr("id","manual1-"+n).attr("x1",e-14).attr("y1",t-14).attr("x2",e+14).attr("y2",t+14).style("stroke",Se[n].colour).style("stroke-width","5px").style("opacity",0).on("click",ln).on("click.centroidClick",Yn.bind(this,-1*(n+1),n,!0)).on("mouseover",En.bind(this,n,!0)),U.append("line").attr("class","manual-centroid").attr("id","manual2-"+n).attr("x1",e+14).attr("y1",t-14).attr("x2",e-14).attr("y2",t+14).style("stroke",Se[n].colour).style("stroke-width","5px").style("opacity",0).on("click",ln).on("click.centroidClick",Yn.bind(this,-1*(n+1),n,!0)).on("mouseover",En.bind(this,n,!0))}R.selectAll(".manual-centroid").transition().duration(Ze).style("opacity",.5),R.selectAll(".manual-hull").transition().duration(Ze).style("stroke-opacity",1).style("fill-opacity",He)}:function(){for(var e,t,n=0;n<it.length;n++){if(!it[n])return R.selectAll(".manual-centroid").remove();e=it[n].x,t=it[n].y,R.select("#manual1-"+n).transition().duration(Ze).attr("x1",e-14).attr("y1",t-14).attr("x2",e+14).attr("y2",t+14).style("display","block"),R.select("#manual2-"+n).transition().duration(Ze).attr("x1",e+14).attr("y1",t-14).attr("x2",e-14).attr("y2",t+14).style("display","block")}})(),U.selectAll(".centroid").raise(),U.selectAll(".clustering-centroid").raise(),U.selectAll(".manual-centroid").raise()}function ln(){R.event.stopPropagation()}function sn(e,t){for(var n in e)e[n].x*=Ye.distance,e[n].x+=Ye.originalx,e[n].y*=Ye.distance,e[n].y+=Ye.originaly,t&&(e[n].x-=Ye.centre.x,e[n].x*=Ye.scale,e[n].x+=X/2,e[n].y-=Ye.centre.y,e[n].y*=Ye.scale,e[n].y+=W/2)}function an(){var e,t;!confirm(_.delconfirm)||-1<(e=document.getElementById("replay-select")).selectedIndex&&(0<(t=e.options[e.selectedIndex].value).length&&(kt(n,t.replace("-","_")),e.options[e.selectedIndex]=null,dn()))}function dn(){U&&setTimeout(function(){U.remove(),cn(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"},500),se=void 0,Ae=null,un(),document.getElementById("clustering-replay-comment").innerHTML="&nbsp",document.getElementById("replay-stop").style.opacity=0,document.getElementById("replay-pause").style.opacity=0,document.getElementById("replay-back").style.opacity=0,document.getElementById("replay-forward").style.opacity=0,document.getElementById("delete-button").style.opacity=0;var e=document.getElementById("replay-select");-1<e.selectedIndex&&(e.options[e.selectedIndex].selected=!1)}function cn(){pe.readOnly=!1,pe.innerHTML="",setTimeout(function(){pe.readOnly=!0},300)}function un(){var e=document.getElementById("replay-pause");e.innerHTML="&#9654",e.value="play",clearInterval(we),we=void 0}function mn(){var e;se&&("play"==(e=document.getElementById("replay-pause")).value?(e.innerHTML="&#9613&#9613",yn(!(e.value="pause")),we=setInterval(yn.bind(this,!1),1200)):un())}function yn(e){if(se){e&&un();e=++Le-1;return de<Le&&se[-1]&&!se[(e=de-Le+1)-1]||de<e?(Le--,void un()):void(1==Le?(me=2,Oe=!(Ie=!0),Nn()):2==Le?(On(),t(e-1,!1,!0)):t(e-1,!1,!1))}}function pn(){var e;!se||!ae||Le-1<0||(un(),e=de<--Le?de-Le+1:Le-1,0==Le?(me=1,Sn(),Ie=!1,pe.innerHTML=pe.innerHTML.slice(pe.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):1==Le?(Ae=null,Nn(),pe.innerHTML=pe.innerHTML.slice(pe.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):t(e-1,!(Ae=null),2==Le))}function t(e,t,n){var r=[],o={},l={};for(u=0;u<se[e].length;u++,l={}){for(var i in U.selectAll("#hull-"+u).remove(),Se[u].x=se[e][u].centroidx,Se[u].y=se[e][u].centroidy,se[e][u].members){var s=se[e][u].members[i].x,a=se[e][u].members[i].y,i=O[se[e][u].members[i].id];l[(Ce[i].x=s)+"_"+(Ce[i].y=a)]={x:s,y:a,colour:Se[u].colour},o[i]=u}r[u]=l}if(sn(Se,!0),n)bn();else{for(sn(Ce,!1),u=0;u<r.length;u++)sn(r[u],!0),Zt(r[u],u,!1,!1);Hn(Ze)}if(_n(ae[2],ae[0],ae[1],Ze),U.selectAll(".centroid").raise(),U.selectAll(".clustering-centroid").raise(),function(e){if(!e||0<e)return U.selectAll(".manual-centroid").remove(),U.selectAll(".manual-hull").remove();Qe&&on(e,null,null)}(e),t)pe.innerHTML=pe.innerHTML.slice(pe.innerHTML.indexOf("<br><br>")+8);else{for(var d in o)Ae[d].ci=o[d];Tn(e),tn(e)}if(e<0)if(document.getElementById("replayer").innerHTML=_.convergence,document.getElementById("replayer").style.color="green",et){for(var c=document.getElementById("replay-select").options,u=0;u<c.length;u++)if(c[u].selected){c[u].value.split("-")[0]==k&&(document.getElementById("replaydragdrop").innerHTML=_.dragon);break}}else document.getElementById("replaydragdrop").innerHTML=_.dragon;else document.getElementById("replayer").innerHTML=_.iteration+" "+e,document.getElementById("replayer").style.color="black",document.getElementById("replaydragdrop").innerHTML=_.dragoff}function gn(){for(var e in Ie=!1,Le=0,clearInterval(we),we=void 0,Ye.clusterId=Date.now(),ue.removeAttribute("disabled"),document.getElementById("clustering-replay-comment").innerHTML="&nbsp",3==me?(ue.noUiSlider.set(2),setTimeout(function(){ue.noUiSlider.set(1),me=1},Ze)):(ue.noUiSlider.set(1),me=1),document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("num-clusters")&&(document.getElementById("num-clusters").readOnly=!1,document.getElementById("num-clusters").value=""),R.selectAll(".clustering-centroid").transition(q).style.display="none",R.selectAll(".cluster-hull").transition(q).style.display="none",setTimeout(function(){R.selectAll(".clustering-centroid").remove(),R.selectAll(".cluster-hull").remove(),cn()},Ze),Ae)Ae[e].ci=void 0}function fn(){3==me&&(we?(clearInterval(we),we=void 0,this.innerHTML="&#9654",ue.removeAttribute("disabled")):(we=setInterval(hn,1e3),this.innerHTML="&#9613&#9613",ue.setAttribute("disabled",!0)))}function vn(){var e=document.getElementById("clustering-replay-comment"),i=document.createElement("input");i.type="text",i.id="clustering-replay-comment-text",S[0]?i.value=S[0]:i.placeholder=_.clusteringname,e.appendChild(i);var t=document.createElement("button");t.innerHTML=_.clusteringnamebutton,e.appendChild(t),t.addEventListener("click",function(){if($e==k&&""!=i.value){var e={coordsid:A,clusterid:Ye.clusterId,studentid:0,remark:i.value};kt(u,e);var t=document.getElementById("replay-select");if(t){for(var n,r=0;r<t.options.length;r++)if(t.options[r].selected){n=t.options[r].value.split("_");break}var o=n[0],l=n[1],e=n[2];j[o][l][e].comments[0]=i.value}}})}function hn(){if(0==Le){Ie=!0,vn();var e=document.getElementById("num-clusters"),t=parseInt(e.value);(isNaN(t)||t<2)&&(t=3);var n,r,o,l,i={};for(n in Ce)i[Ce[n].x+"_"+Ce[n].y]=1;for(;t>Object.keys(i).length;)t--;for(e.value=t,e.readOnly=!0,Se=[],Ne=null,o=r=0;r<t;r++)if(o<Ee.length)Se[r]=xn(null,Ee[o++]);else{for(;!l;)l=he[Math.floor(z.random()*he.length)],l=Ee.includes(l)?void 0:l;Se[r]=xn(null,l)}bn(),document.getElementById("clustering").innerHTML=_.randcentroids,document.getElementById("dragdrop").innerHTML=_.dragoff,document.getElementById("clustering").style.color="black";e=Tn(Le);Ye.iteration=Le,Mn(e)}else!function(e){if(document.getElementById("clustering").innerHTML!=_.convergence)if(0!=Object.keys(Ae).length){var t,n,r,o,l=_.iteration+": "+e;for(t in Ae)Ae[t].ci=Wn(Ae[t]);var i=[];for(n=0;n<Se.length;n++)i[n]=Ln(n);Ne=Se,Se=i;var s=!1;if(Ne){var a=0;for(n=0;n<Se.length;n++)r=Ne[n].x-Se[n].x,o=Ne[n].y-Se[n].y,a+=Math.sqrt(r*r+o*o);a<=ze&&(l=_.convergence,document.getElementById("clustering").style.color="green",s=!0)}document.getElementById("clustering").innerHTML=l,document.getElementById("dragdrop").innerHTML=0<e&&!s?_.dragon:_.dragoff;l=Tn(e);Ye.iteration=s?-1:e,Mn(l)}else document.getElementById("clustering").innerHTML=_.convergence}(Le),Hn(Ze);Le++,document.getElementById("clustering").innerHTML==_.convergence&&(clearInterval(we),we=void 0,ue.removeAttribute("disabled"),document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0)}function xn(e,t){var n,r,o,l,i=X-100,s=W-100,a=0;if(e)for(;a<100;)n=Math.floor(Math.random()*(i-100)+100),r=Math.floor(Math.random()*(s-100)+100),o=n-e.x,l=r-e.y,a=Math.sqrt(o*o+l*l);else n=Math.floor(Math.random()*(i-100)+100),r=Math.floor(Math.random()*(s-100)+100);return{x:n,y:r,colour:t}}function bn(){R.selectAll(".clustering-centroid").remove();for(var e,t,n=0;n<Se.length;n++)e=Se[n].x,t=Se[n].y,U.append("line").attr("class","clustering-centroid").attr("id","cluster1-"+n).attr("x1",e-14).attr("y1",t-14).attr("x2",e+14).attr("y2",t+14).style("stroke",Se[n].colour).style("stroke-width","5px").on("click",ln).on("click.centroidClick",Yn.bind(this,-1*(n+1),n,!0)).on("mouseover",En.bind(this,n,!1)),U.append("line").attr("class","clustering-centroid").attr("id","cluster2-"+n).attr("x1",e+14).attr("y1",t-14).attr("x2",e-14).attr("y2",t+14).style("stroke",Se[n].colour).style("stroke-width","5px").on("click",ln).on("click.centroidClick",Yn.bind(this,-1*(n+1),n,!0)).on("mouseover",En.bind(this,n,!1))}function En(e,t){J.remove(),Fe=!(_e=!(Oe=!0)),U.on("click",kn);var n,r={};if(t){var o=rn();for(n in lt[o])lt[o][n]==e&&(r[n]=n)}else for(n in Ae)Ae[n].ci==e&&(r[n]=n);for(var t=Object.keys(r).length,l={},i=0;i<$.nodes.length;i++)$.nodes[i].visible||(l[$.nodes[i].id]=1);t=function(e,t,n){var r,o,l,i,s,a={};for(r in e)for(s=ne[0];s<$.edges[r].length&&s<=ne[1];s++)l="string"==typeof(i=$.edges[r][s]).source?(o=parseInt(i.source),parseInt(i.target)):(o=i.source.id,i.target.id),t[o]||t[l]||(i=o+"_"+l,a[i=l<o?l+"_"+o:i]?a[i][r]?a[i][r]++:a[i][r]=1:(a[i]={},a[i][r]=1));var d,c,u=[];for(d in a)if(Object.keys(a[d]).length==n){var m=Number.MAX_SAFE_INTEGER;for(c in a[d])m>a[d][c]&&(m=a[d][c]);var y=d.split("_");u[u.length]={source:y[0],target:y[1],weight:m,colour:"black"}}for(s=0;s<$.links.length;s++)u[u.length]=$.links[s];return u}(r,l,t);P.style("display","block").style("opacity",1).on("mouseover",pt).on("mouseout",ft),G.force("link").links(t),yt(t),J.on("mouseover",In).on("mouseout",ft),G.restart(),setTimeout(function(){G.stop(),J.lower(),R.selectAll(".cluster-hull").lower()},10)}function kn(){Fe=!(_e=!(Oe=!1)),J.remove(),P.style("display","none").on("mouseover",null).on("mouseout",null),U.on("click",null)}function In(e){"black"==e.colour&&(J.on("mouseover",null),P.on("mouseover",null).on("mouseout",null),R.selectAll(".clustering-centroid").on("mouseover",null),pt(e.source),je=!0,pt(e.target,!0),je=!1)}function Ln(e){var t,n=[],r={};for(t in Ae)Ae[t].ci==e&&(n[n.length]=[Ae[t].x,Ae[t].y],r[Ae[t].x+"_"+Ae[t].y]={x:Ae[t].x,y:Ae[t].y,colour:Se[e].colour});if(U.selectAll("#hull-"+e).remove(),Zt(r,e,!1,!1),U.selectAll(".centroid").raise(),U.selectAll(".clustering-centroid").raise(),0==Object.keys(r).length)return xn(Se[e],Se[e].colour);var o=wn(n);return o.colour=Se[e].colour,o}function wn(e){if(0==e.length)return null;for(var t=0,n=0,r=0;r<e.length;r++)t+=e[r][0],n+=e[r][1];return{x:t/e.length,y:n/e.length}}function Tn(e){var t=_.numstudents+": "+Object.keys(Ae).length+"<br>"+_.numofclusters+": "+Se.length+"<br>"+_.iteration+": "+e+"<br>";document.getElementById("clustering")&&document.getElementById("clustering").innerHTML==_.convergence&&(t+='<span style="color:green">'+_.convergence+"</span><br>");for(var n,r,o,l=[],i=0;i<Se.length;i++){for(r in n=Se[i].x-X/2,o=Se[i].y-W/2,n=Math.sqrt(n*n+o*o),o=Se[i].colour,t+=_.disttocluster+' <span style="color:'+o+'">'+o+"</span>: "+Math.round(n,2)+"<br>"+_.cluster+" "+o+" "+_.members+": [",l[i]=[],Ae)Ae[r].ci==i&&(t+=r+", ",l[i][l[i].length]=r);-1!=t.indexOf(",",t.length-3)&&(t=t.slice(0,-2)),t+="]<br>"}return pe.innerHTML=(t+="<br>")+pe.innerHTML,l}function Mn(e){for(var t,n,r={clusterCoords:[]},o=0;o<e.length;o++)for(r.clusterCoords[o]=Bn(Se[o]),r.clusterCoords[o].num=o,t=0;t<e[o].length;t++)n=Bn(Ae[e[o][t]]),e[o][t]={id:N[e[o][t]],num:o,x:n.x,y:n.y};r.members=e,r.iteration=Ye.iteration,r.clusterId=Ye.clusterId,r.coordsid=A,r.usegeometric=nt?1:0,(0!=ne[0]||ne[1]!=$.maxSession)&&r.iteration<0&&(r.iteration=Le),kt(l,r)}function Bn(e){var t=(e.x-X/2)/Ye.scale+Ye.centre.x,e=(e.y-W/2)/Ye.scale+Ye.centre.y;return{x:t=(t-Ye.originalx)/Ye.distance,y:e=(e-Ye.originaly)/Ye.distance}}function Hn(e){for(var t,n,r=0;r<Se.length;r++)t=Se[r].x,n=Se[r].y,R.select("#cluster1-"+r).transition().duration(e).attr("x1",t-14).attr("y1",n-14).attr("x2",t+14).attr("y2",n+14),R.select("#cluster2-"+r).transition().duration(e).attr("x1",t+14).attr("y1",n-14).attr("x2",t-14).attr("y2",n+14)}function Cn(){nt="geometric"==this.value,U.selectAll(".centroid").remove();var e,t=[],n=0;for(e in Ce)t[n++]={value:e,selected:!0,colour:Ce[e].colour};(nt?Yt:Jt)(t),Qt()}function An(e,t){var n,r,o;switch(parseInt(e[t])){case 1:if(3==me){ue.noUiSlider.set(2);break}if(me=1,Sn(),!Ie)for(r in n=document.getElementsByName("centroid-type"))n[r].disabled=!1;break;case 2:for(r in me=2,Nn(),n=document.getElementsByName("centroid-type"))n[r].disabled=!0;document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("dragdrop").innerHTML==_.dragon&&(document.getElementById("dragdrop").innerHTML="--");break;case 3:if(1==me){ue.noUiSlider.set(2);break}me=3,On(),Ie||(o='<input type="text" placeholder="'+_.numclusters+'" id="num-clusters" size="8" pattern="[0-9]{1,2}">',document.getElementById("cluster-text").innerHTML=o),document.getElementById("play-pause").disabled=!1,document.getElementById("play-step").disabled=!1,document.getElementById("clustering").innerHTML==_.convergence&&(document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0),"--"==document.getElementById("dragdrop").innerHTML&&(document.getElementById("dragdrop").innerHTML=_.dragon)}}function Sn(){Ut(!1),P.on("mouseover",null).on("mouseout",null),_n(1,0,0,Ze),setTimeout(function(){R.selectAll(".centroid").raise()},100)}function Nn(){P.transition(q).style("opacity",0),J.transition(q).style("opacity",0),R.selectAll(".clustering-centroid").transition(q).style("opacity",0),R.selectAll(".cluster-hull").transition(q).style("opacity",0),setTimeout(function(){P.style("display","none"),J.style("display","none"),R.selectAll(".clustering-centroid").style("display","none"),R.selectAll(".cluster-hull").style("display","none")},Ze),!Ie&&document.getElementById("cluster-text")&&(document.getElementById("cluster-text").innerHTML=_.numclusters);var e=function(){var e,t=[];if(le)return function(){var e,t=[],n=0,r=0;for(e in se)if(!(0<=e&&1!=e))for(var o in se[e])for(var l in se[e][o].members)n=(n=se[e][o].members[l].x)*E+Ye.originalx,r=(r=se[e][o].members[l].y)*E+Ye.originaly,t[t.length]=[n,r];var i=Fn(t);if(null===i)return null;var s,a,d,c,u,m=[i.x,i.y],y=0,p=0;for(u=0;u<t.length;u++)s=Math.abs(t[u][0]-m[0]),a=Math.abs(t[u][1]-m[1]),y<s&&(y=s,d=u),p<a&&(p=a,c=u);if(void 0===c&&void 0===d)return m[2]=1,m;var g=t[d][0]-m[0]+X/2,f=t[d][1]-m[1]+W/2,i=jn(g,f,X/2,W/2);g=t[c][0]-m[0]+X/2,f=t[c][1]-m[1]+W/2;f=jn(g,f,X/2,W/2);return m[2]=i<f?i:f,m[2]*=.9,m}();for(e in Ce)t[t.length]=[Ce[e].x,Ce[e].y];var n=Fn(t);if(null===n)return null;var r,o,l,i,s=[n.x,n.y],a=0,d=0;for(e in Ce)r=Math.abs(Ce[e].x-s[0]),o=Math.abs(Ce[e].y-s[1]),a<r&&(a=r,l=e),d<o&&(d=o,i=e);if(void 0===i&&void 0===l)return s[2]=1,s;var c=Ce[l].x-s[0]+X/2,u=Ce[l].y-s[1]+W/2,n=jn(c,u,X/2,W/2);c=Ce[i].x-s[0]+X/2,u=Ce[i].y-s[1]+W/2;u=jn(c,u,X/2,W/2);return s[2]=n<u?n:u,s[2]*=.9,s}();null!==e&&(Ye.scale=e[2],ae=e,setTimeout(function(){_n(e[2],e[0],e[1],Ze)},Ze/2))}function On(){R.selectAll(".clustering-centroid").transition(q).style("display","block").style("opacity",1),R.selectAll(".cluster-hull").transition(q).style("display","block").style("opacity",1),R.selectAll(".clustering-centroid").raise()}function _n(e,t,n,r){var o,l,i,s=X/2,a=W/2;if(!Ae)for(i in Ae={},Ce)Ae[i]={x:0,y:0};for(i in Ye.centre={x:t,y:n},Ce)o=((m=Ce[i].x)-t)*e,l=((y=Ce[i].y)-n)*e,y=1==e&&0==t&&0==n?(m=t+o,n+l):(m=s+o,a+l),l=(Ae[i].x=m)+","+((Ae[i].y=y)-14)+" "+(m+14)+","+(y+14)+" "+(m-14)+","+(y+14),R.select("#centroid-"+i).transition().duration(r).attr("points",l);var d,c;for(i in ot){var u=(d=ot[i].x,c=ot[i].y,d*=Ye.distance,d+=Ye.originalx,c*=Ye.distance,c+=Ye.originaly,d-=Ye.centre.x,d*=Ye.scale,d+=X/2,c-=Ye.centre.y,c*=Ye.scale,{x:d,y:c+=W/2}),m=u.x,y=u.y;R.select("#server-centroid-"+i).transition().duration(r).attr("cx",m).attr("cy",y)}}function Fn(e){if(0==e.length)return null;if(1==e.length)return{x:e[0][0],y:e[0][1]};for(var t,n=0,r=0,o=X,l=W,i=0;i<e.length;i++)n<(t=e[i][0])&&(n=t),t<o&&(o=t),r<(t=e[i][1])&&(r=t),t<l&&(l=t);return{x:(n+o)/2,y:(r+l)/2}}function jn(e,t,n,r){n=e-n,r=t-r,n=((0<n?X:0)-X/2)/n,r=((0<r?W:0)-W/2)/r;return isFinite(n)&&isFinite(r)&&n<=r||isFinite(n)&&!isFinite(r)?n:isFinite(r)?r:1}function Rn(){var e=document.getElementById("log-panel");e.style.width=s+"px";var t=document.createElement("button");t.innerHTML=_.copy,t.addEventListener("click",function(){window.getSelection().selectAllChildren(pe),document.execCommand("copy")}),qe?t.style.marginLeft="10px":(t.style.position="absolute",t.style.right=s-40+"px"),e.appendChild(t);t=document.createElement("button");t.innerHTML=_.print,t.addEventListener("click",function(){var e=window.open();e.document.write("<html><head></head><body>"),e.document.write(pe.innerHTML),e.document.write("</body></html>"),e.print(),e.close()}),qe?t.style.marginLeft="10px":(t.style.position="absolute",t.style.right=s-100+"px"),e.appendChild(t),(pe=document.createElement("div")).readOnly=!0,pe.style.overflow="scroll",pe.style.width="200px",pe.style.height=W+"px",pe.style.resize="none",pe.style.border="2px solid black",qe||(pe.style.position="absolute",pe.style.right="6px",pe.style.top="110px"),e.appendChild(pe)}function qn(){for(var e in Ce)U.append("polygon").attr("class","centroid").attr("id","centroid-"+e).attr("points",Dn(Ce[e].x,Ce[e].y)).style("stroke","black").style("stroke-width","3px").style("fill",Ce[e].colour).call(R.drag().on("start",zn.bind(this,e)).on("drag",Un.bind(this,e)).on("end",Xn.bind(this,e))).on("mouseout",Pn).on("mouseover",Jn.bind(this,e)).on("click",ln).on("click.centroidClick",Yn.bind(this,N[e],e,!1));if(rt)for(e in ot){var t=ot[e].x*Ye.distance+Ye.originalx,n=ot[e].y*Ye.distance+Ye.originaly;U.append("circle").attr("class","server-centroid").attr("id","server-centroid-"+e).attr("r",5).attr("cx",t).attr("cy",n).style("fill","black")}}function Dn(e,t){return e+","+(t-14)+" "+(e+14)+","+(t+14)+" "+(e-14)+","+(t+14)}function zn(e){Gn()&&(Ve=Date.now(),U.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+e).attr("points",Dn(R.event.x,R.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",Ce[e].colour).style("opacity",.5))}function Un(e){Gn()&&R.select("#dragged-"+e).attr("points",Dn(R.event.x,R.event.y))}function Xn(e){if(R.selectAll(".dragged-centroid").remove(),Gn())if(Date.now()-Ve<300)Yn(N[e],e,!1);else{Ae[e].ci=Wn(R.event);for(var t=[],n=0;n<Se.length;n++)t[n]=Ln(n);Ne=Se,Se=t,Hn(Ze);e=_.iteration+": "+Le;document.getElementById("clustering").innerHTML=e,document.getElementById("dragdrop").innerHTML=_.dragon;e=Tn(Le);Ye.iteration=Le++,Mn(e)}}function Wn(e){for(var t,n,r=Number.MAX_SAFE_INTEGER,o=-1,l=0;l<Se.length;l++)t=e.x-Se[l].x,n=e.y-Se[l].y,(n=Math.sqrt(t*t+n*n))<r&&(r=n,o=l);return o}function Gn(){if(Se&&document.getElementById("clustering")&&document.getElementById("clustering").innerHTML!=_.convergence){for(var e in Ae)if(void 0===Ae[e].ci)return;return 3==me?1:void 0}}function Pn(){Oe||(R.selectAll(".text").remove(),R.selectAll("rect").remove(),Ie&&(le||3==me)&&null!==rn()&&(P.style("display","none").style("opacity",0),J.remove()))}function Jn(t){if(!Oe){R.selectAll(".text").remove(),R.selectAll("rect").remove();var e=U.append("rect"),n=[0],r=1==me?Ce:Ae,o=t;v.forEach(function(e){e.id==t&&(o=1==De?e.firstname+" "+e.lastname:e.id)});var l=1==De?70:30,i=U.append("text").attr("class","text").attr("id","t-"+t).attr("y",r[t].y+32).attr("dy",".40em").style("pointer-events","none").text(o).call(gt,l,r[t].x-(6+l)/2+8,n),s=18*n[0]+16;if(s+r[t].y+10>=W&&i.attr("y",W-s-(W-r[t].y)).text(o).call(gt,l,r[t].x-(6+l)/2+8,n),e.attr("id","r-"+t).attr("x",r[t].x-(6+l)/2).attr("y",s+r[t].y+10<=W?r[t].y+16:W-s-16-(W-r[t].y)).attr("width",16+l).attr("height",s).style("stroke","black").style("fill","yellow"),Ie&&(le||3==me)&&null!==rn()){J.remove();for(var a={},d=0;d<$.nodes.length;d++)$.nodes[d].visible||(a[$.nodes[d].id]=1);var c,u,m,y={};for(d=ne[0];d<$.edges[t].length&&d<=ne[1];d++)m="string"==typeof(c=$.edges[t][d]).source?(u=parseInt(c.source),parseInt(c.target)):(u=c.source.id,c.target.id),a[u]||a[m]||(y[m=u+"_"+m]?y[m]++:y[m]=1);var p,g=[],f=$.edges[t][0].colour;for(c in y)p=c.split("_"),g[g.length]={source:p[0],target:p[1],weight:y[c],colour:f};for(d=0;d<$.links.length;d++)g[g.length]=$.links[d];G.force("link").links(g),yt(g),P.style("display","block").style("opacity",1),G.restart(),setTimeout(function(){G.stop(),P.lower(),J.lower()},1)}}}function Yn(t,e,n){var r,o,l,i,s,a,d,c;Ie&&!document.getElementById("textbox-"+t)&&null!==rn()&&(!le&&Ie&&3!=me||((r=document.createElement("textarea")).id="textbox-"+t,r.style.resize="both",r.style.position="absolute",S[t]&&(r.value=S[t]),$e!=k&&(r.readOnly=!0),document.body.appendChild(r),o=r.getBoundingClientRect(),l=document.getElementsByTagName("svg")[0].getBoundingClientRect(),i=(n?Se:Ae)[e].x,s=i+o.width/2>=X?i+l.x-o.width:i-o.width/2<=0?i+l.x:i+l.x-o.width/2,r.style.left=s+"px",e=(n?Se:Ae)[e].y,a=n?W<=e+165?e+165:e+265:W<=e+190?e+140:e+290,r.style.top=a+"px",(d=document.createElement("button")).innerHTML=$e==k?_.save:_.close,d.id=t,d.style.position="absolute",d.style.left=s+"px",d.style.top=a+o.height+"px",document.body.appendChild(d),r.focus(),r.addEventListener("click",function(){this.parentNode.appendChild(this),d.parentNode.appendChild(d),this.focus()}),c=!1,r.addEventListener("mousedown",function(){c=!0}),r.addEventListener("mouseup",function(){c=!1}),r.addEventListener("mousemove",function(){c&&(o=this.getBoundingClientRect(),d.style.left=s+"px",d.style.top=a+o.height+"px")}),d.addEventListener("click",function(){var e;$e==k&&(e={coordsid:A,clusterid:Ye.clusterId,studentid:t,remark:r.value},""!=r.value&&r.value!=S[t]&&(S[t]=r.value,kt(u,e))),document.body.removeChild(r),document.body.removeChild(d)})))}!function(e){f=e.logs,v=e.users,r=e.groups,o=e.members,h=e.mods,e.panelwidth,s=e.legendwidth,m=e.name,y=e.iframeurl,qe=e.version36,De=e.showstudentnames,p=e.positioning,g=e.positioning,x=e.nodecoords,b=e.links,d=e.courseid,k=e.userid,E=e.scale,I=e.graphs,L=e.alllinks,w=e.scales,T=e.changes,M=e.names,B=e.allmods,H=e.setnames,C=k,A=e.lastchange,S=e.comments,_=e.strings,c=e.coordsscript,l=e.clustersscript,u=e.commentsscript,a=e.manualscript,n=e.deletescript,F=e.sesskey,Ke=e.gotallnodes,le=e.replaying,rt=e.debugcentroids,ot=e.centroids,et=e.isresearcher,$e=k,j=e.replaydata,R=window.dataDrivenDocs,D=window.noUiSlider;var t=window.mersenneTwister;z=new t(259),xe=0,he=["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"],Ue=Date.now()+3e3,Ze=1e3,q=R.transition().duration(Ze).ease(R.easeLinear),ye=120,V=1e-4,Pe=St,Te=!(Z=ze=1),Me=220,He=.15,Be=R.curveCatmullRomClosed,nt=!0,fe={},Ye={},be={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown",data:"coral",chat:"maroon",choice:"grey",feedback:"lime",glossary:"navy",survey:"tan",wiki:"teal",workshop:"silver",scorm:"tomato",imscp:"lightpink",folder:"peru"},Ee=["blue","red","orange","green","yellow","brown","purple","magenta","cyan"],re=p?0:36,X=window.innerWidth-ye-s-150,W=window.innerHeight-re-90,Je=Math.min(X,W)<450?6:8,N={},v.forEach(function(e){N[e.id]=e.realId}),st(),at(),le?(e=e.manualdata,p=!0,x={0:0,1:1,2:2},W=window.innerHeight-190,function(){var e=document.getElementById("slider"),t=document.createElement("p");t.innerHTML="&nbsp",t.id="replayer",t.style.marginTop="-20px",e.appendChild(t);t=document.createElement("p");t.innerHTML="&nbsp",t.id="replaydragdrop",t.style.marginTop="-12px",e.appendChild(t);t=document.createElement("button");t.id="replay-stop",t.innerHTML="&#9606",t.addEventListener("click",dn),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="replay-pause",t.innerHTML="&#9654",t.value="play",t.addEventListener("click",mn),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="replay-back",t.innerHTML="&#9614&#9664",t.addEventListener("click",pn),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="replay-forward",t.style.marginRight="80px",t.innerHTML="&#9654&nbsp&nbsp&#9614",t.addEventListener("click",yn.bind(this,!0)),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="delete-button",t.innerHTML=_.delbutton,t.addEventListener("click",an),t.style.opacity=0,e.appendChild(t)}(),Rn(),function(e){var t,n=document.getElementById("student-menu");for(t in(ie=document.createElement("select")).size=3,ie.id="replay-select",ie.style="height: "+(W-12)+"px;",ie.addEventListener("change",function(t){var n=function(e){var t,n,r=document.getElementById("replay-select");for(n=0;n<r.options.length;n++)if(r.options[n].selected){t=r.options[n].value.split("_");break}var o,l=t[0],i=t[1],s=t[2];for(o in $e=l.split("-")[0],Ye.clusterId=s,A=j[l][i].last,x=j[l][i].nodes,b=j[l][i].links,E=j[l][i].scale,h=j[l][i].mods,se=j[l][i][s],f=j[l][i].logs,v=j[l][i].users,S=j[l][i][s].comments,O={},N={},v.forEach(function(e){N[e.id]=e.realId,O[e.realId]=e.id}),me=1,ce=de=Le=0,se)isNaN(o)||(0<=o?de++:ce--);it=[],lt={},Qe=!1;var a,d,c=e[l][i][s];if(c)for(Qe=!0,n=-1;ce<=n;n--)for(a in c[n]&&!c[n-1]&&(c[n-1]=c[n]),lt[n]={},c[n])for(d in c[n][a].members){var u=c[n][a].members[d].id;lt[n][O[u]]=a}Se=[],Ce={};var m,y={},p=0;for(a in se[1]){if(n=Se.length,Se[n]={x:0,y:0},p<Ee.length)Se[n].colour=Ee[p++];else{for(;!m;)m=he[Math.floor(z.random()*he.length)],m=Ee.includes(m)?void 0:m;Se[n].colour=m}for(d in se[1][a].members){var g=O[se[1][a].members[d].id];Ce[g]={x:se[1][a].members[d].x,y:se[1][a].members[d].y},y[g]=!0}}return{members:y,did:l,gid:i,cid:s}}(t),e=n.members;U&&(U.remove(),un(),cn(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;");ee&&document.body.removeChild(ee);Ae=null,st(),at(),ne=[0,$.maxSession],document.getElementById("replay-stop").style.opacity=1,document.getElementById("replay-pause").style.opacity=1,document.getElementById("replay-back").style.opacity=1,document.getElementById("replay-forward").style.opacity=1,document.getElementById("delete-button").style.opacity=1;for(var r=0;r<$.nodes.length;r++)void 0===$.nodes[r].xcoord&&($.nodes[r].visible=!1);(function(e){(ee=document.createElement("select")).multiple=!0,ee.id="student-select",ee.style.display="none",xe=0,v.forEach(function(e){Rt(e,ee)});for(var t,n=0;n<ee.options.length;n++)t=ee.options[n].value,e[t]?ee.options[n].selected=!0:ee.options[n].selected=!1,Ce[t]&&(Ce[t].colour=ee.options[n].colour);document.body.appendChild(ee)})(e),ut(0),Ut(!1),P.on("mouseover",null).on("mouseout",null),Oe=!0,document.getElementById("clustering-replay-comment").innerHTML="&nbsp",vn(),setTimeout(function(){for(var e in sn(Ce,!1),qn(),G.on("tick",ht),Ce)R.select("#centroid-"+e).call(R.drag().on("start",Vt.bind(this,e)).on("drag",$t.bind(this,e)).on("end",en.bind(this,e,t,n)))},500)}.bind(this,e)),j){var r,o=0;for(r in j[t]){var l,i,s=0;for(l in o++,j[t][r])!isNaN(l)&&j[t][r][l][1]&&((i=document.createElement("option")).value=t+"_"+r+"_"+l,i.text=t.split("-")[0]+"_"+o+"_"+ ++s,ie.appendChild(i))}}n.appendChild(ie)}(e)):(p?function(){ke=!1,Q=K=.01,Xe=Nt,We=Ot,Ge=_t,Ke&&0<Object.keys(x).length&&(Z=0);I&&w&&function(){var e=document.getElementById("student-menu"),t=document.createElement("button");t.innerHTML=_.copy,t.addEventListener("click",It),e.appendChild(t);var n=t.getBoundingClientRect().height,t=document.createElement("button");t.innerHTML=_.print,t.addEventListener("click",Lt),e.appendChild(t),(ve=document.createElement("select")).size=3,ve.id="teacher-select",ve.style.minWidth="40px";var r,n=W-n-20;for(r in ve.style.height=n+"px",ve.addEventListener("change",wt),w){var o=document.createElement("option");o.value=r,o.text=r,k==r&&(o.selected=!0),ve.appendChild(o)}e.appendChild(ve)}();ut(.6),Mt(),function(){var e=document.getElementById("student-menu"),t=document.createElement("input");t.id="weight-slider",t.type="range",t.min="-0.2",t.max="2",t.step="0.2",t.value="0.6",t.style.width="130px",t.addEventListener("change",function(){Y.strength(this.value),document.getElementById("weights-output").innerHTML="&nbsp;= "+this.value}),e.appendChild(t);var n=document.createTextNode(_.linksweight);e.appendChild(n),(n=document.createElement("label")).id="weights-output",n.innerHTML="&nbsp;= "+t.value,e.appendChild(n)}(),setTimeout(function(){G.force("charge",null).force("x",null).force("y",null)},500)}:function(){{var e;p=ke=!0,K=0,Ge=We=Xe=null,Ke&&0!=Object.keys(x).length?(e=Ft(),qt(),jt(e),ut(0),Dt()):(ut(.6),setTimeout(function(){var e=Ft();qt(),jt(e),Dt()},500))}Y=null})()}(e)}});