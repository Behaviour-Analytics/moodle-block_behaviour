/*! moodle-block_behaviour v0.9.1 14-03-2022 */

!function(e){"function"==typeof define&&define.amd?define([],e):window.behaviourAnalytics=e()}(function(){return function(e){var a,l,u,c,i,s,v,h,d,m,r,b,y,p,g,f,x,k,E,I,L,w,T,B,M,C,H,A,N,S,O,j,_,F,R,q,D,z,U,W,X,G,P,Y,J,Z,K,Q,V,$,t,ee,te,ne,n,re,oe,o,le,ie,se,ae,ce,de,ue,me,ye,pe,ge,fe,ve,he,be,xe,ke,Ee,Ie,Le,we,Te,Be,Me,Ce,He,Ae,Ne,Se,Oe,je,_e,Fe,Re,qe,De,ze,Ue,We,Xe,Ge,Pe,Ye,Je,Ze,Ke,Qe,Ve,$e,et,tt,nt,rt,ot,lt,it,st,at,ct={},dt=[];function ut(){b.forEach(function(e){for(;!xe[e.entype];){var t,n=he[Math.floor(X.random()*he.length)],r=!0;for(t in xe)xe[t]==n&&(r=!1);xe[e.entype]=r?n:void 0}})}function mt(){te={nodes:[],links:[],edges:{},maxSession:0},yt(),pt()}function yt(){var t,n,r,o=te,l={};b.forEach(function(e){t=!0,r=n=void 0,k[e.id]?(t=k[e.id].visible&&k["g"+e.sect].visible?1:0,k[e.id].visible&&!t&&(k[e.id].visible=0),n=k[e.id].xcoord,r=k[e.id].ycoord):k["g"+e.sect]&&(t=!(!k["g"+e.sect].visible||w!=S)),o.nodes[o.nodes.length]={id:e.id,name:e.name,group:e.sect,type:e.type,entype:e.entype,colour:xe[e.entype],visible:t,xcoord:n,ycoord:r},l[e.sect]||(k["g"+e.sect]&&(t=k["g"+e.sect].visible?1:0,n=k["g"+e.sect].xcoord,r=k["g"+e.sect].ycoord),l[e.sect]={id:"g"+e.sect,name:R.section+" "+e.sect,group:e.sect,type:"grouping",colour:xe.grouping,visible:t,xcoord:n,ycoord:r},o.nodes[o.nodes.length]=l[e.sect]),o.links[o.links.length]={source:"g"+e.sect,target:e.id,weight:V,colour:xe.originalLinks}}),n=r=void 0,k.root&&(n=k.root.xcoord,r=k.root.ycoord);var e,i,s,a,c={id:"root",name:p,group:-1,type:"grouping",colour:xe.grouping,visible:1,xcoord:n,ycoord:r};for(e in l)o.links[o.links.length]={source:"root",target:l[e].id,weight:V,colour:xe.originalLinks};if(o.nodes[o.nodes.length]=c,0<Object.keys(E).length){for(a in E)i=(s=a.split("_"))[0],s=s[1],o.links[o.links.length]={source:i,target:s,weight:5*E[a],colour:xe.originalLinks};if(!x)for(var d in o.nodes)isNaN(o.nodes[d].id)&&(o.nodes[d].visible=0)}}function pt(){var e,t=te,n=0,r=0;tt={};for(var o=0;o<v.length;o++)e={source:v[o].moduleId,target:v[o].moduleId,weight:V,user:v[o].userId,colour:""},t.edges[v[o].userId]||(t.edges[v[o].userId]=[],tt[v[o].userId]=[],t.maxSession=t.maxSession<n?n:t.maxSession,r=n=0),k[v[o].moduleId]&&k[v[o].moduleId].visible&&(tt[v[o].userId][r++]=v[o].moduleId),o+1<v.length&&v[o].userId==v[o+1].userId?(e.target=v[o+1].moduleId,t.edges[v[o].userId][n++]=e):0==t.edges[v[o].userId].length&&(t.edges[v[o].userId][n++]=e);t.maxSession=t.maxSession<n?n:t.maxSession,h.forEach(function(e){t.edges[e.id]||(t.edges[e.id]=[])})}function gt(){Ee=!1,t=$=.01,We=Rt,Xe=qt,Ge=Dt,Ke&&0<Object.keys(k).length&&(V=0),T&&M&&function(){var e=document.getElementById("student-menu"),t=document.createElement("div"),n=document.createElement("button");n.innerHTML=R.copy,n.className="btn btn-secondary mb-1",n.addEventListener("click",Mt),t.appendChild(n);var r=n.getBoundingClientRect().height,n=document.createElement("button");n.innerHTML=R.print,n.className="btn btn-secondary mb-1",n.addEventListener("click",Ct),t.appendChild(n),e.appendChild(t),(ve=document.createElement("select")).size=3,ve.id="teacher-select",ve.style.minWidth="40px";var o,r=Y-r-80;for(o in ve.style.height=r+"px",ve.addEventListener("change",Ht),M){var l=document.createElement("option");l.value=o,l.text=o,w==o&&(l.selected=!0),ve.appendChild(l)}e.appendChild(ve)}(),ft(.6),Nt(),function(){var e=document.getElementById("student-menu"),t=document.createElement("input");t.id="weight-slider",t.type="range",t.min="-0.2",t.max="1",t.step="0.2",t.value="0.0",t.style.width="130px",t.addEventListener("change",function(){Q.strength(this.value),document.getElementById("weights-output").innerHTML="&nbsp;= "+this.value}),e.appendChild(t);var n=document.createTextNode(R.linksweight);e.appendChild(n),(n=document.createElement("label")).id="weights-output",n.innerHTML="&nbsp;= "+t.value,e.appendChild(n)}(),setTimeout(function(){J.force("charge",null).force("x",null).force("y",null)},500)}function ft(e){G=z.select("#graph").append("svg").attr("width",P).attr("height",Y),Q=z.forceLink(te.links).id(function(e){return e.id}).strength(e),J=z.forceSimulation(te.nodes).force("link",Q).force("charge",z.forceManyBody().strength(-80)).force("collide",z.forceCollide().radius(12)).force("center",z.forceCenter(P/2,Y/2)).force("x",z.forceX()).force("y",z.forceY()),vt(te.nodes,Pe,We,Xe,Ge),ht(te.links),G.on("click",function(){z.selectAll("#rctext").remove(),z.selectAll("#rcrect").remove(),(Ee||f)&&Z.on("mouseover",bt).on("mouseout",kt),le&&Z.on("mouseover",null).on("mouseout",null)}),Ke&&f&&0<Object.keys(k).length?J.on("tick",It):J.on("tick",Lt);for(var t=0;t<80;t++)J.tick();f&&setTimeout(function(){J.stop(),J.on("tick",Lt),wt(),0!=Object.keys(k).length&&Ke||(Tt(null),te.edges={},pt(),Ke=!0,V=Ee?1:0)},500),Ee&&!Ke&&setTimeout(function(){te.nodes=[],te.links=[],yt()},600)}function vt(e,t,n,r,o){Z=G.selectAll(".node").data(e).enter().append("circle").attr("class","node").attr("r",Ye).style("display",function(e){return e.visible?"block":"none"}).on("mouseover",bt).on("mouseout",kt).on("contextmenu",t).call(z.drag().on("start",n).on("drag",r).on("end",o))}function ht(e){K=G.selectAll(".link").data(e).enter().append("line").attr("class","link").style("stroke",function(e){return e.colour}).style("stroke-width",function(e){return e.weight?2*e.weight+"px":e.value/3+"px"})}function bt(e,t){var n,r,o,l,i,s,a,c,d;je||(Z.on("mouseover",null),!1===t&&(z.selectAll(".text").remove(),z.selectAll("rect").remove()),Date.now()-Ue<150||(o=r=n=!(d=[0]),l=150,i=304,s=154,a=e.type+": "+e.name,_e&&(s=i=0),c=G.append("text").attr("class","text").attr("id","t-"+e.id).attr("y",e.y+32).attr("dy",".40em").style("pointer-events","none").text(a).call(xt,l,e.x-78+8,d),(t=16*d[0]+16)+e.y>=Y-s&&(c.attr("y",Y-t-(Y-e.y)).text(a).call(xt,l,e.x-78+8,d),n=!0),e.x<=i/2?(c.text(a).call(xt,l,e.x+8,d),o=!0):e.x>=P-i/2&&(c.text(a).call(xt,l,e.x-156+8,d),r=!0),d=o?e.x:r?e.x-156:e.x-78,d=G.append("rect").attr("id","r-"+e.id).attr("x",d).attr("y",n?Y-t-16-(Y-e.y):e.y+16).attr("width",166).attr("height",t).style("stroke","black").style("fill","yellow"),c.raise(),isNaN(e.id)||(_e&&(i=400,s=300),function(e,t,n,r,o,l,i,s,a,c){var d=document.createElement("iframe");d.id="preview",d.style.position="absolute",d.style.width=r+"px",d.style.height=o+"px";var u=document.getElementsByTagName("svg")[0].getBoundingClientRect(),m=document.body.getBoundingClientRect();0<m.x&&(m.x=0);d.style.left=Fe?window.innerWidth-10-r+"px":_e?"10px":i?a+u.x+"px":s?a+u.x+n-r+18+"px":a+u.x-r/2+n/2+"px";n=qe?0:50;d.style.top=_e?u.y-m.y+Y/2+"px":l?n+c+u.y-m.y-o+"px":n+c+u.y+t-m.y+"px";"lti"!=e.entype&&"unknown"!=e.type&&((m=document.createElement("div")).id="bgrnd",m.style.position="absolute",m.style.width=parseInt(d.style.width)+24+"px",m.style.height=parseInt(d.style.height)+24+"px",m.style.left=parseInt(d.style.left)-12+"px",m.style.top=parseInt(d.style.top)-12+"px",m.addEventListener("mouseout",function(e){var t=this.getBoundingClientRect();e.x>t.x&&e.x<t.x+t.width&&e.y>t.y&&e.y<t.y+t.height||(Re=!1,setTimeout(Et,400))}),m.addEventListener("mouseover",function(){Re=!0}),d.src=g+"mod/"+e.entype+"/view.php?id="+e.id,document.body.appendChild(m),document.body.appendChild(d))}(e,t,l,i,s,n,o,r,parseInt(d.attr("x")),parseInt(d.attr("y"))))))}function xt(e,s,a,t){var c=0;e.each(function(){for(var e=z.select(this),t=e.text().split(/\s+/).reverse(),n=[],r=e.attr("y"),o=parseFloat(e.attr("dy")),l=e.text(null).append("tspan").attr("x",a).attr("y",r).attr("dy",o+"em"),i=t.pop();i;)n.push(i),l.text(n.join(" ")),l.node().getComputedTextLength()>s&&(n.pop(),l.text(n.join(" ")),n=[i],l=e.append("tspan").attr("x",a).attr("y",r).attr("dy",1.1*++c+o+"em").text(i)),i=t.pop()}),t[0]=++c}function kt(e){je||"lightgrey"==e.colour||(Z.on("mouseout",null),K.on("mouseout",null),setTimeout(Et,400))}function Et(){if(!Re&&(z.selectAll(".text").remove(),z.selectAll("rect").remove(),z.selectAll("#preview").remove(),z.selectAll("#bgrnd").remove(),Z.on("mouseover",bt).on("mouseout",kt),_e)){K.on("mouseover",Hn).on("mouseout",kt);for(var e=0;e<Ne.length;e++)z.select("#cluster1-"+e).on("mouseover",Mn.bind(this,e,!1)),z.select("#cluster2-"+e).on("mouseover",Mn.bind(this,e,!1))}}function It(){var t=P/2,r=Y/2,o=I;void 0===Je.originalx?(Je.originalx=t,Je.originaly=r):(t=Je.originalx,r=Je.originaly);for(var e,n,l=0;l<te.nodes.length;l++)e=te.nodes[l].xcoord*o+t,n=te.nodes[l].ycoord*o+r,(e<0||P<e||n<0||Y<n)&&(o*=.9,--l);I=o,Je.distance=o,K.attr("x1",function(n){var e=te.nodes.filter(function(e){var t="string"==typeof n.source?n.source:n.source.id;return e.id==t})[0];return z.select(this).attr("y1",e.ycoord*o+r),e.xcoord*o+t}).attr("x2",function(n){var e=te.nodes.filter(function(e){var t="string"==typeof n.target?n.target:n.target.id;return e.id==t})[0];return z.select(this).attr("y2",e.ycoord*o+r),e.xcoord*o+t}).style("display",function(e){return e.source.visible&&e.target.visible?"block":"none"}),Z.attr("cx",function(e){return e.x=e.xcoord*o+t,e.x}).attr("cy",function(e){return e.y=e.ycoord*o+r,e.y}).style("display",function(e){return e.visible?"block":"none"}).style("fill",function(e){return e.colour}).raise()}function Lt(){var t=Ye;K.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).style("stroke-width",function(e){return e.weight?2*e.weight+"px":e.value/3+"px"}).style("display",function(e){return e.source.visible&&e.target.visible?"block":"none"}),Z.attr("cx",function(e){return e.x=Math.max(t,Math.min(P-t,e.x)),e.x}).attr("cy",function(e){return e.y=Math.max(t,Math.min(Y-t,e.y)),e.y}).style("fill",function(e){return e.colour}).style("display",function(e){return e.visible?"block":"none"}).raise(),z.selectAll("rect").raise(),z.selectAll("text").raise()}function wt(){var e,t;H&&(z.select("#time").remove(),0==O&&(O=Date.now()),(e=new Date).setTime(O),(t=e.getMinutes())<10&&(t="0"+t),G.append("text").attr("id","time").attr("y",Y-16).attr("dy",".40em").attr("x",6).style("pointer-events","none").text(H[S]+" "+e.getHours()+":"+t+" "+e.toDateString()))}function Tt(e){var t,n,r,o,l,i,s=(r={},o=0,l=P/2,i=Y/2,te.nodes.forEach(function(e){t=e.x-l,n=e.y-i,n=Math.sqrt(t*t+n*n),o<n&&(o=n)}),I=o,te.nodes.forEach(function(e){r[e.id]={xcoord:""+(e.x-l)/o,ycoord:""+(e.y-i)/o,visible:e.visible},e.xcoord||(e.xcoord=(e.x-l)/o,e.ycoord=(e.y-i)/o)}),{nodes:k=r,scale:o});e&&(s.links=e),T&&M&&(M[w]=s.scale,T[w]=s.nodes),s.time=Date.now(),O=s.time,C&&(C[w]=s.time),Bt(a,s)}function Bt(e,t){var n=new XMLHttpRequest;n.open("POST",e),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==this.readyState&&this.status};t=JSON.stringify(t);e==u&&(t=t.replaceAll("&","%amp;")),n.send("cid="+L+"&data="+t+"&sesskey="+q)}function Mt(){var e=new Image,t=(new XMLSerializer).serializeToString(G.node());e.src="data:image/svg+xml;base64,"+window.btoa(t),document.body.appendChild(e);t=document.createRange();t.setStartBefore(e),t.setEndAfter(e),t.selectNode(e),window.getSelection().addRange(t),document.execCommand("Copy"),document.body.removeChild(e)}function Ct(){var e=(new XMLSerializer).serializeToString(G.node()),t=window.open();t.document.write('<img src="data:image/svg+xml;base64,'+window.btoa(e)+'"/>'),t.print(),t.close()}function Ht(){for(var e,t=document.getElementById("teacher-select"),n=0;n<t.options.length;n++)if(t.options[n].selected){e=t.options[n].value;break}if(Pe=e==w?(We=Rt,Xe=qt,Ge=Dt,Ft):Ge=Xe=We=null,k=T[e],E=B[e],I=M[e],O=C[e],b=A[e],p=N[e],S=e,G.remove(),fe={},ut(),z.selectAll("#legendUL").remove(),Nt(),(ot=0)<E.length&&E[0].value){for(var r,o=[],l=Object.keys(k),i=0;i<l.length;i++)o[i]=k[l[i]],o[i].colour=xe[o[i].entype];for(r in E)E[r].colour=xe.originalLinks;te={nodes:o,links:E,edges:{},maxSession:0},ot=1}else V=1,mt(),V=0;var s,a=document.getElementById("weights-output").innerHTML;for(s in ft(a=parseFloat(a.split(" ")[1])),fe)k[s]&&(fe[s].checked=!!k[s].visible),w==e?(fe[s].removeEventListener("change",At),fe[s].addEventListener("change",jt)):(fe[s].removeEventListener("change",jt),fe[s].addEventListener("change",At))}function At(){this.checked=!this.checked}function Nt(){var n;(ge=document.getElementById("legend")).style.width=y+"px",ge.style.height=Y+"px",ge.style.minWidth=y+"px",ge.style.maxWidth="500px",ge.style.marginTop="50px";function t(e){var t=n-e.x;n=e.x,500<(t=parseInt(ge.style.width)+t)?t=500:t<y&&(t=y),ge.style.width=t+"px"}ge.addEventListener("mousemove",function(e){var t=ge.offsetLeft+28;e.x>=t&&e.x<=t+6?ge.style.cursor="col-resize":ge.style.cursor="auto"}),ge.addEventListener("mousedown",function(e){n=e.x,"col-resize"==ge.style.cursor&&ge.addEventListener("mousemove",t)}),document.addEventListener("mouseup",function(){ge.removeEventListener("mousemove",t)}),function(e){var t=document.createElement("ul");t.id="legendUL";var n=document.createElement("span");n.className="no-select-text",n.innerHTML=p;var r=document.createElement("li");r.appendChild(n);var o=document.createElement("ul");r.appendChild(o),t.appendChild(r);var l,i,s,a=-1;b.sort(function(e,t){return e.sect-t.sect}),b.forEach(function(e){a!=e.sect&&((i=document.createElement("ul")).className="nested",(s=document.createElement("span")).className="caret",s.addEventListener("click",St),(l=document.createElement("li")).appendChild(s),Ot("g"+e.sect,R.section+" "+e.sect,xe.grouping,e.sect,"grouping",l),l.appendChild(i),o.appendChild(l),a=e.sect),(l=document.createElement("li")).className="indented",Ot(e.id,e.name,xe[e.entype],e.sect,e.type,l),i.appendChild(l)}),e.appendChild(t)}(ge)}function St(){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("caret-down")}function Ot(e,t,n,r,o,l){var i=document.createElement("input");i.type="checkbox",k[e]?i.checked=!!k[e].visible:k["g"+r]?i.checked=!(!k["g"+r].visible||w!=S):i.checked=!0,i.id=e,i.group=r,i.nodeT=o,i.addEventListener("change",jt),fe[i.id]=i;r=document.createElement("label");r.style.color=n,r.className="no-select-text",r.appendChild(document.createTextNode("grouping"==o?t:o+"_"+t)),l.appendChild(i),l.appendChild(r)}function jt(){var t=this.id,n=this.checked,r=this.nodeT,o=this.group;te.nodes.forEach(function(e){(e.id==t||"grouping"==r&&e.group==o||n&&"grouping"==e.type&&e.group==o)&&(e.visible=n?1:0,fe[e.id].checked=n)}),_t(),Pt()}function _t(){parseFloat(document.getElementById("weight-slider").value)<0&&(Q.strength(0),document.getElementById("weights-output").innerHTML="&nbsp;= 0",document.getElementById("weight-slider").value=0)}function Ft(e){var t,n,r;z.selectAll(".text").remove(),z.selectAll("rect").remove(),z.selectAll("#preview").remove(),z.selectAll("#bgrnd").remove(),z.event.preventDefault(),"root"!=e.id&&(t=e,Z.on("mouseover",null).on("mouseout",null),n=G.append("rect"),r=G.append("text").attr("class","text").attr("id","rctext").attr("x",e.x+10).attr("y",e.y+12).attr("dy",".40em").style("pointer-events","none").text(R.hide),e.y+20>=Y&&r.attr("y",Y-(Y-e.y)-10).text(R.hide),n.attr("id","rcrect").attr("x",e.x).attr("y",e.y+20<=Y?e.y:Y-(Y-e.y)-20).attr("width",60).attr("height",24).style("stroke","black").style("fill","lightgrey"),n.on("mouseover",function(){z.event.target.style="fill: grey;"}),n.on("mouseout",function(){z.event.target.style="fill: lightgrey;"}),n.on("click",function(){z.selectAll("#rctext").remove(),z.selectAll("#rcrect").remove(),Z.on("mouseover",bt).on("mouseout",kt),t.visible=0,fe[t.id].checked=!1,"grouping"==t.type&&te.nodes.forEach(function(e){e.group==t.group&&(e.visible=0,fe[e.id].checked=!1)}),_t(),Pt()}))}function Rt(e){z.event.active||J.alphaTarget(t).restart(),e.fx=e.x,e.fy=e.y}function qt(e){z.selectAll("rect").remove(),z.selectAll(".text").remove(),z.selectAll("#preview").remove(),z.selectAll("#bgrnd").remove(),e.fx=z.event.x,e.fy=z.event.y}function Dt(e){z.event.active||(f?(J.stop(),te.links[0].value?Tt(te.links):Tt(null),wt()):J.alphaTarget(ee)),e.fx=null,e.fy=null,Ue=Date.now()}function zt(){var e=document.getElementById("student-menu");return(o=document.createElement("button")).innerHTML=R.cluster,o.className="btn btn-secondary mb-1",o.addEventListener("click",nn),e.appendChild(o),o.getBoundingClientRect().height}function Ut(e){var t=document.getElementById("student-menu");(ne=document.createElement("select")).multiple=!0,ne.id="student-select";e=0<d.length?Y-e-120:Y-e-12;ne.style="height: "+e+"px;",ne.addEventListener("change",function(){for(var e=document.getElementById("student-select"),t=0;t<e.options.length;t++){var n="box-shadow: 0 0 10px 100px "+e.options[t].colour+" inset;";e.options[t].style=e.options[t].selected?n:"box-shadow: 0 0 0 0 white inset;"}0<v.length&&Yt(!0)}),1==De?h.sort(function(e,t){e=e.firstname+" "+e.lastname,t=t.firstname+" "+t.lastname;return t<e?1:e<t?-1:0}):h.sort(function(e,t){return e.id-t.id}),h.forEach(function(e){Wt(e,ne)}),t.appendChild(ne)}function Wt(e,t){var n=document.createElement("option");n.value=e.id,n.text=1==De?e.firstname+" "+e.lastname:e.id,n.colour=he[be++],be>=he.length&&(be=0),te.edges[e.id].forEach(function(e){e.colour=n.colour}),t.appendChild(n)}function Xt(){if(0!=d.length){var e,t,n=document.getElementById("student-menu");for(t in(r=document.createElement("select")).multiple=!0,r.id="group-select",r.style="height: 120px;",r.addEventListener("change",function(){z.selectAll(".link").remove(),z.selectAll(".hull").remove(),ht(te.links),J.on("tick",It),J.restart(),setTimeout(J.stop,100),ne.options.length=0;for(var e=be=0;e<r.options.length;e++)if(r.options[e].selected)for(var t=0;t<h.length;t++)m[h[t].realId]==r.options[e].value&&Wt(h[t],ne)}),d)(e=document.createElement("option")).value=t,e.text=d[t],r.appendChild(e);n.appendChild(r)}}function Gt(){var t;n=document.getElementById("slider"),re=[0,te.maxSession],t=te.maxSession<500?10:te.maxSession<1e3?20:te.maxSession<5e3?100:te.maxSession<1e4?200:500,W.create(n,{start:[0,te.maxSession],range:{min:[0],max:[te.maxSession]},step:1,connect:!0,pips:{mode:"steps",stepped:!0,density:100,filter:function(e){return 0==e||e==te.maxSession?1:e%t==0?2:0}}}),setTimeout(function(){n.noUiSlider.on("update",function(e,t){re[t]=parseInt(e[t]),ne.dispatchEvent(new Event("change"))})},1e3)}function Pt(){K.remove(),Z.remove(),z.selectAll(".hull").remove();var e=Jt(Ft);Zt(e),Qt(e),J.alphaTarget($).restart(),f&&setTimeout(function(){J.stop(),Tt(ot?te.links:null),wt()},100)}function Yt(e){K.remove(),Z.remove(),z.selectAll(".hull").remove(),f=!1,ot&&(Ee=!0);var t=Jt(null);Zt(t),e&&Qt(t),f=!0,ot&&te.links[0].label?(Ee=!1,J.on("tick",Lt)):J.on("tick",It),J.restart(),setTimeout(J.stop,100)}function Jt(e){var t=[],n={};return te.nodes.forEach(function(e){null===e.fx&&(e.fx=e.x,e.fy=e.y),e.visible?t[t.length]=e:n[e.id]=1}),ot||J.nodes(t),vt(t,e,We,Xe,Ge),n}function Zt(e){var t,n,r,o,l=[];for(s in te.links)r=te.links[s],ot&&(r.colour=xe.originalLinks),"string"==typeof r.source?(t=r.source,n=r.target,ot&&(r.source=Kt(t),r.target=Kt(n))):(t=r.source.id,n=r.target.id),e[t]||e[n]||(l[l.length]=r);for(var i=f?[]:document.getElementById("student-select").options,s=0;s<i.length;s++)if(i[s].selected){for(var a,c={},d=re[0];d<=re[1]&&te.edges[i[s].value].length>d;d++)"string"==typeof(o=te.edges[i[s].value][d]).source?(a=o.source+"_"+o.target,t=o.source,n=o.target,ot&&(o.source=Kt(t),o.target=Kt(n))):(a=o.source.id+"_"+o.target.id,t=o.source.id,n=o.target.id),c[a]?c[a]++:c[a]=1,e[t]||e[n]||(l[l.length]=o);for(d=re[0];d<=re[1]&&te.edges[i[s].value].length>d;d++)a="string"==typeof(o=te.edges[i[s].value][d]).source?o.source+"_"+o.target:o.source.id+"_"+o.target.id,o.weight=c[a]}ot||0!=Object.keys(E).length||J.force("link").links(l),ht(l)}function Kt(t){return te.nodes.find(function(e){return e.id==t})}function Qt(e){if(!f){z.selectAll(".hull").remove();for(var t,n=document.getElementById("student-select").options,r={},o=0;o<n.length;o++)if(n[o].selected){r[n[o].value]={};for(var l=re[0];l<=re[1]&&te.edges[n[o].value].length>l;l++){var i,s,a,c,d,u,m=te.edges[n[o].value][l];u="string"==typeof m.source?(i=m.source,s=m.target,a=(u=Kt(i)).x,c=u.y,d=(u=Kt(s)).x,u.y):(i=m.source.id,s=m.target.id,a=m.source.x,c=m.source.y,d=m.target.x,m.target.y),e[i]||e[s]||(m=m.colour,r[n[o].value][i]={x:a,y:c,colour:m},r[n[o].value][s]={x:d,y:u,colour:m})}}for(t in r)en(r[t],t,!1,!1);Ee&&(nt?$t:Vt)(n)}}function Vt(e){if(He={},0!=Object.keys(tt).length)for(var t,n,r,o=0;o<e.length;o++)e[o].selected&&(t=e[o].value,tt[t].length<=re[0]||(n=re[0],r=tt[t].length>re[1]+1?re[1]:tt[t].length,n=parseInt(n/2+r/2),r=tt[t][n],n=parseFloat(k[r].xcoord),r=parseFloat(k[r].ycoord),He[t]={x:n*I+Je.originalx,y:r*I+Je.originaly,colour:e[o].colour}))}function $t(e){if(He={},0!=Object.keys(tt).length)for(var t=0;t<e.length;t++)if(e[t].selected){var n=e[t].value;if(!(tt[n].length<=re[0])){for(var r,o=re[0],l=tt[n].length>re[1]+1?re[1]:tt[n].length,i=0,s=0,a=0,c=o;c<l;c++)r=tt[n][c],i+=parseFloat(k[r].xcoord),s+=parseFloat(k[r].ycoord),a++;He[n]={x:i/a*I+Je.originalx,y:s/a*I+Je.originaly,colour:e[t].colour}}}}function en(e,t,n,r){if(0!=Object.keys(e).length){var o,l,i=[],s=20,a=Ee?"hull":n?"manual-hull":"cluster-hull";for(l in e)i[i.length]=[e[l].x,e[l].y],o=e[l].colour;if(1==i.length)p=function(e){var t=[e[0][0],e[0][1]-s],e=[e[0][0],e[0][1]+s];return"M "+t+" A "+[s,s,"0,0,0",e].join(",")+" A "+[s,s,"0,0,0",t].join(",")};else{if(2!=i.length){n=z.concaveHull().padding(15);Te||n.distance(Be);n=4<i.length?n(i):[i];return p=z.line().curve(Me),void G.selectAll("#hull-"+t).data(n).enter().append("path").attr("id","hull-"+t).attr("class",a).style("stroke",o).style("stroke-opacity",r?0:1).style("fill",o).style("fill-opacity",r?0:Ce).attr("d",p)}function c(e,t){return[e[0]+t[0],e[1]+t[1]]}function d(e,t){return m(y(e),t)}var u=function(e,t){return[t[0]-e[0],t[1]-e[1]]},m=function(e,t){return[t*e[0],t*e[1]]},y=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return m(e,1/t)},p=function(e){var t=u(e[0],e[1]),n=d(t,s),r=c(e[0],m(n,-1)),o=c(e[1],n),e=1.2*s,n=d(function(e,t){e=[-(e=void 0!==t?u(e,t):e)[1],e[0]];return y(e)}(t),e),t=m(n,-1),e=c(r,t),t=c(o,t),n=c(r,n);return"M "+r+" C "+[e,t,o].join(",")+" S "+[n,r].join(",")+" Z"}}G.append("path").attr("id","hull-"+t).attr("class",a).style("stroke",o).style("stroke-opacity",r?0:1).style("fill",o).style("fill-opacity",r?0:Ce).attr("d",p(i))}}function tn(){clearInterval(we),we=void 0,Ae=null,fn(),z.selectAll(".clustering-centroid").remove(),z.selectAll(".cluster-hull").remove(),z.selectAll(".centroid").remove(),z.selectAll(".server-centroid").remove(),ue.style.display="none",document.getElementById("anim-controls").style.display="none",document.getElementById("log-panel").style.display="none",document.getElementById("student-menu").style.width=o.style.width,document.getElementById("clustering-replay-comment").innerHTML="&nbsp",_e=!(Ee=!0),n.style.display="block",ne.style.display="block",r&&(r.style.display="block"),Z.style("display","block"),Z.style("opacity",1),K.style("display","block"),K.style("opacity",1),Yt(!0),Z.on("mouseover",bt).on("mouseout",kt),o.innerHTML=R.cluster,o.removeEventListener("click",tn),o.addEventListener("click",nn)}function nn(){Ee=!1,n.style.display="none",ne.style.display="none",r&&(r.style.display="none"),z.selectAll(".hull").remove(),z.selectAll(".text").remove(),z.selectAll("rect").remove(),document.getElementById("student-menu").style.width=ye+"px",o.innerHTML=R.graph,o.removeEventListener("click",nn),o.addEventListener("click",tn),J.stop(),Z.on("mouseover",null).on("mouseout",null).on("contextmenu",null).call(z.drag().on("start",null).on("drag",null).on("end",null)),Je.clusterId=Date.now(),Ie=!(j={}),me=1,we=void(Le=0),document.getElementById("clustering-replay-comment").innerHTML="&nbsp";var t='<p id="cluster-text">'+R.numclusters+"</p>";setTimeout(function(){var e;ue?(document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("cluster-text").innerHTML=t,document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("anim-controls").style.display="block",document.getElementById("log-panel").style.display="block",ue.removeAttribute("disabled"),ue.noUiSlider.set(1),ue.style.display="block"):(e=function(){var e=document.getElementById("anim-controls");e.appendChild(document.createTextNode(R.runkmeans));var t=document.createElement("p");t.innerHTML="&nbsp",t.id="clustering",e.appendChild(t);var n=document.createElement("p");n.innerHTML="&nbsp",n.id="dragdrop",n.style.marginTop="-12px",e.appendChild(n);t=document.createElement("button");t.id="play-pause",t.style.marginLeft="5px",t.style.marginRight="5px",t.innerHTML="&#9654",t.className="btn btn-secondary",t.addEventListener("click",In),t.disabled=!0;n=document.createElement("button");n.id="play-step",n.style.marginLeft="5px",n.innerHTML="&#9654&nbsp&nbsp&#9614",n.className="btn btn-secondary",n.addEventListener("click",function(e){3==me&&(we?(clearInterval(we),we=void 0,e.innerHTML="&#9654",ue.removeAttribute("disabled")):wn())}.bind(this,t)),n.disabled=!0,e.appendChild(n),e.appendChild(t);t=document.createElement("button");return t.id="stop",t.style.marginTop="5px",t.style.marginLeft="5px",t.innerHTML=R.reset,t.className="btn btn-secondary",t.addEventListener("click",En),e.appendChild(t),e}(),function(t,e){ue=document.getElementById("cluster-slider"),W.create(ue,{start:[1],handles:1,range:{min:1,max:3},step:1,orientation:"vertical",direction:"rtl",pips:{mode:"steps",stepped:!0,density:100,filter:function(){return 1},format:{to:function(e){switch(e){case 1:return R.showcentroids;case 2:return R.removegraph;case 3:return t;default:return""}},from:function(){return""}}}}),ue.noUiSlider.on("update",Rn),ue.style="margin-top: 20px;";var n=o.getBoundingClientRect().height,e=e.getBoundingClientRect().height;ue.style.height=Y-n-e-120+"px";n=document.createElement("input");n.type="radio",n.name="centroid-type",n.value="geometric",n.style="margin-top: 40px",n.checked=!0,n.addEventListener("click",Fn);e=document.createElement("label");e.appendChild(n),e.appendChild(document.createTextNode(R.geometrics)),ue.appendChild(e),0==Object.keys(E).length&&((n=document.createElement("input")).type="radio",n.name="centroid-type",n.value="decomposed",n.addEventListener("click",Fn),(e=document.createElement("label")).appendChild(n),e.appendChild(document.createTextNode(R.decomposed)),ue.appendChild(e))}(t,e),Gn()),Pn()},Ze/2)}function rn(e){an(e)&&(Ve=Date.now(),G.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+e).attr("points",Yn(z.event.x,z.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",He[e].colour).style("opacity",.5))}function on(e){z.select("#dragged-"+e).attr("points",Yn(z.event.x,z.event.y))}function ln(e,t,n){if(z.selectAll(".dragged-centroid").remove(),an(e))if(Date.now()-Ve<300)tr(_[e],e,!1);else{Qe||function(){for(var e in se)if(!(0<=e)){ct[e]={};for(var t=0;t<se[e].length;t++)for(var n in se[e][t].members){n=F[se[e][t].members[n].id];ct[e][n]=t}}}();var r=cn();if(0==Object.keys(ct[r]).length)for(var o=0;o<se[r].length;o++)for(var l in se[r][o].members){l=F[se[r][o].members[l].id];ct[r][l]=o}var i,s=Qn(z.event);for(i in ct)i<=r&&(ct[i][e]=s);dn(r,t,n),Qe=!0,sn(r),function(e){for(var t={clusterCoords:[],members:[]},n=0;n<dt.length;n++){var r,o=dt[n]||Ne[n];for(r in t.clusterCoords[n]=jn(o),t.clusterCoords[n].num=n,ct[e])ct[e][r]==n&&(t.members[t.members.length]={id:_[r],num:n})}t.iteration=e,t.clusterId=Je.clusterId,t.coordsid=O,Bt(c,t)}(r)}}function sn(e){if(!(0<=e)&&ct[e]&&0!=Object.keys(ct[e]).length){for(var t=function(e){var t,n,r,o=0,l=0,i=0,s=[];for(r=0;r<Ne.length;r++){for(var a in Ae)Ae[a].ci==r&&ct[e][a]==Ae[a].ci?o++:Ae[a].ci==r&&ct[e][a]!=Ae[a].ci?l++:ct[e][a]==r&&ct[e][a]!=Ae[a].ci&&i++;t=o/(o+l),n=o/(o+i),s[r]={tp:o,fp:l,fn:i,precision:t,recall:n,f1:t+n==0?0:2*t*n/(t+n),fhalf:t+n==0?0:1.25*t*n/(.25*t+n),f2:t+n==0?0:5*t*n/(4*t+n)},i=l=o=0}for(r=0;r<s.length;r++)o+=s[r].tp,l+=s[r].fp,i+=s[r].fn;return t=o/(o+l),n=o/(o+i),s[s.length]={tp:o,fp:l,fn:i,precision:t,recall:n,f1:t+n==0?0:2*t*n/(t+n),fhalf:t+n==0?0:1.25*t*n/(.25*t+n),f2:t+n==0?0:5*t*n/(4*t+n)},s}(e),n=R.manualcluster+"<br>",r=0;r<dt.length;r++)if(dt[r]){var o,l=dt[r].x-P/2,i=dt[r].y-Y/2,l=Math.sqrt(l*l+i*i),i=Ne[r].colour;for(o in n+=R.disttocluster+' <span style="color:'+i+'">'+i+"</span>: "+Math.round(l)+"<br>"+R.cluster+" "+i+" "+R.members+": [",ct[e])ct[e][o]==r&&(n+=o+", ");-1!=n.indexOf(",",n.length-3)&&(n=n.slice(0,-2)),n+="]<br>",et&&(n+=R.precision+": "+t[r].precision.toFixed(4)+"<br>",n+=R.recall+": "+t[r].recall.toFixed(4)+"<br>",n+=R.f1+": "+t[r].f1.toFixed(4)+"<br>",n+=R.fhalf+": "+t[r].fhalf.toFixed(4)+"<br>",n+=R.f2+": "+t[r].f2.toFixed(4)+"<br>")}var s=pe.innerHTML.split("<br><br>"),a=s[0].split("<br>");for(pe.innerHTML="",r=0;r<a.length&&!a[r].startsWith(R.manualcluster);r++)pe.innerHTML+=a[r]+"<br>";for(et&&(r=t.length-1,n+=R.totalmeasures+"<br>",n+=R.precision+": "+t[r].precision.toFixed(4)+"<br>",n+=R.recall+": "+t[r].recall.toFixed(4)+"<br>",n+=R.f1+": "+t[r].f1.toFixed(4)+"<br>",n+=R.fhalf+": "+t[r].fhalf.toFixed(4)+"<br>",n+=R.f2+": "+t[r].f2.toFixed(4)+"<br>"),pe.innerHTML+=n+"<br>",r=1;r<s.length;r++)pe.innerHTML+=s[r]+"<br><br>"}}function an(e){if(document.getElementById("replayer").innerHTML==R.convergence&&$e==w){var t,n=Ae[e].ci,r=0;for(t in Ae)Ae[t].ci==n&&r++;var o=cn(),l=0;if(ct[o])for(t in n=ct[o][e],ct[o])ct[o][t]==n&&l++;return 1==r&&l<=1?void 0:1!=l}}function cn(){var e=pe.innerHTML.split("<br>");return e[2]&&e[2].startsWith(R.iteration)?parseInt(e[2].split(" ")[1]):null}function dn(e,t,n){for(var r,o,l,i=[],s=[],a=0;a<se[e].length;a++)for(r in i[a]={},s[a]=[],ct[e])ct[e][r]==a&&(o=Ae[r].x,l=Ae[r].y,i[a][o+"_"+l]={x:o,y:l,colour:Ne[a].colour},s[a][s[a].length]=[o,l]);var c=0==document.getElementsByClassName("manual-centroid").length;for(z.selectAll(".manual-hull").remove(),a=0;a<i.length;a++)en(i[a],-1*(a+1),!0,c),dt[a]=Nn(s[a]);if(t)for(t[n.did]||(t[n.did]={}),t[n.did][n.gid]||(t[n.did][n.gid]={}),t[n.did][n.gid][n.cid]||(t[n.did][n.gid][n.cid]={}),t[n.did][n.gid][n.cid][e]||(t[n.did][n.gid][n.cid][e]=[]),a=0;a<dt.length;a++)if(dt[a]){var d=[];for(r in ct[e])ct[e][r]==a&&(d[d.length]={id:_[r],num:a});t[n.did][n.gid][n.cid][e][a]={centroidx:dt[a].x,centroidy:dt[a].y,members:d}}(c?function(){z.selectAll(".manual-centroid").remove();for(var e,t,n=0;n<dt.length;n++){if(!dt[n])return;e=dt[n].x,t=dt[n].y,G.append("line").attr("class","manual-centroid").attr("id","manual1-"+n).attr("x1",e-14).attr("y1",t-14).attr("x2",e+14).attr("y2",t+14).style("stroke",Ne[n].colour).style("stroke-width","5px").style("opacity",0).on("click",un).on("click.centroidClick",tr.bind(this,-1*(n+1),n,!0)).on("mouseover",Mn.bind(this,n,!0)),G.append("line").attr("class","manual-centroid").attr("id","manual2-"+n).attr("x1",e+14).attr("y1",t-14).attr("x2",e-14).attr("y2",t+14).style("stroke",Ne[n].colour).style("stroke-width","5px").style("opacity",0).on("click",un).on("click.centroidClick",tr.bind(this,-1*(n+1),n,!0)).on("mouseover",Mn.bind(this,n,!0))}z.selectAll(".manual-centroid").transition().duration(Ze).style("opacity",.5),z.selectAll(".manual-hull").transition().duration(Ze).style("stroke-opacity",1).style("fill-opacity",Ce)}:function(){for(var e,t,n=0;n<dt.length;n++){if(!dt[n])return z.selectAll(".manual-centroid").remove();e=dt[n].x,t=dt[n].y,z.select("#manual1-"+n).transition().duration(Ze).attr("x1",e-14).attr("y1",t-14).attr("x2",e+14).attr("y2",t+14).style("display","block"),z.select("#manual2-"+n).transition().duration(Ze).attr("x1",e+14).attr("y1",t-14).attr("x2",e-14).attr("y2",t+14).style("display","block")}})(),G.selectAll(".centroid").raise(),G.selectAll(".clustering-centroid").raise(),G.selectAll(".manual-centroid").raise()}function un(){z.event.stopPropagation()}function mn(e,t){for(var n in e)e[n].x*=Je.distance,e[n].x+=Je.originalx,e[n].y*=Je.distance,e[n].y+=Je.originaly,t&&(e[n].x-=Je.centre.x,e[n].x*=Je.scale,e[n].x+=P/2,e[n].y-=Je.centre.y,e[n].y*=Je.scale,e[n].y+=Y/2)}function yn(){var e=document.getElementById("replay-select"),e={userid:e.options[e.selectedIndex].value.split("_")[0].split("-")[0],coordsid:O,clusterid:Je.clusterId};Bt(s,e),rt=e}function pn(){var e,t;!confirm(R.delconfirm)||-1<(e=document.getElementById("replay-select")).selectedIndex&&(0<(t=e.options[e.selectedIndex].value).length&&(Bt(i,t.replace("-","_")),e.options[e.selectedIndex]=null,gn()))}function gn(){G&&setTimeout(function(){for(var e in G.remove(),fn(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;",it)document.body.removeChild(it[e].textbox),document.body.removeChild(it[e].button);it={}},500),se=void 0,Ae=null,vn(),document.getElementById("clustering-replay-comment").innerHTML="&nbsp",document.getElementById("replay-stop").style.opacity=0,document.getElementById("replay-pause").style.opacity=0,document.getElementById("replay-back").style.opacity=0,document.getElementById("replay-forward").style.opacity=0,document.getElementById("delete-button").style.opacity=0,document.getElementById("prediction-label").style.opacity=0,document.getElementById("prediction-box").style.opacity=0;var e=document.getElementById("replay-select");-1<e.selectedIndex&&(e.options[e.selectedIndex].selected=!1)}function fn(){pe.readOnly=!1,pe.innerHTML="",setTimeout(function(){pe.readOnly=!0},300)}function vn(){var e=document.getElementById("replay-pause");e.innerHTML="&#9654",e.value="play",clearInterval(we),we=void 0}function hn(){var e;se&&("play"==(e=document.getElementById("replay-pause")).value?(e.innerHTML="&#9613&#9613",bn(!(e.value="pause")),we=setInterval(bn.bind(this,!1),1200)):vn())}function bn(e){if(se){e&&vn();e=++Le-1;return ce<Le&&se[-1]&&!se[(e=ce-Le+1)-1]||ce<e?(Le--,void vn()):void(1==Le?(me=2,Oe=!(Ie=!0),Dn()):2==Le?(zn(),kn(e-1,!1,!0)):kn(e-1,!1,!1))}}function xn(){var e;!se||!ae||Le-1<0||(vn(),e=ce<--Le?ce-Le+1:Le-1,0==Le?(me=1,qn(),Ie=!1,pe.innerHTML=pe.innerHTML.slice(pe.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):1==Le?(Ae=null,Dn(),pe.innerHTML=pe.innerHTML.slice(pe.innerHTML.indexOf("<br><br>")+8),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;"):kn(e-1,!(Ae=null),2==Le))}function kn(e,t,n){var r=[],o={},l={};for(u=0;u<se[e].length;u++,l={}){for(var i in G.selectAll("#hull-"+u).remove(),Ne[u].x=se[e][u].centroidx,Ne[u].y=se[e][u].centroidy,se[e][u].members){var s=se[e][u].members[i].x,a=se[e][u].members[i].y,i=F[se[e][u].members[i].id];l[(He[i].x=s)+"_"+(He[i].y=a)]={x:s,y:a,colour:Ne[u].colour},o[i]=u}r[u]=l}if(mn(Ne,!0),n)Bn();else{for(mn(He,!1),u=0;u<r.length;u++)mn(r[u],!0),en(r[u],u,!1,!1);_n(Ze)}if(Un(ae[2],ae[0],ae[1],Ze),G.selectAll(".centroid").raise(),G.selectAll(".clustering-centroid").raise(),function(e){if(!e||0<e)return G.selectAll(".manual-centroid").remove(),G.selectAll(".manual-hull").remove();Qe&&dn(e,null,null)}(e),t)pe.innerHTML=pe.innerHTML.slice(pe.innerHTML.indexOf("<br><br>")+8);else{for(var c in o)Ae[c].ci=o[c];Sn(e),sn(e)}if(e<0)if(document.getElementById("replayer").innerHTML=R.convergence,document.getElementById("replayer").style.color="green",et){for(var d=document.getElementById("replay-select").options,u=0;u<d.length;u++)if(d[u].selected){d[u].value.split("-")[0]==w&&(document.getElementById("replaydragdrop").innerHTML=R.dragon);break}}else document.getElementById("replaydragdrop").innerHTML=R.dragon;else document.getElementById("replayer").innerHTML=R.iteration+" "+e,document.getElementById("replayer").style.color="black",document.getElementById("replaydragdrop").innerHTML=R.dragoff}function En(){for(var e in Ie=!1,Le=0,clearInterval(we),we=void 0,Je.clusterId=Date.now(),ue.removeAttribute("disabled"),document.getElementById("clustering-replay-comment").innerHTML="&nbsp",3==me?(ue.noUiSlider.set(2),setTimeout(function(){ue.noUiSlider.set(1),me=1},Ze)):(ue.noUiSlider.set(1),me=1),document.getElementById("clustering").innerHTML="&nbsp",document.getElementById("dragdrop").innerHTML="&nbsp",document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("num-clusters")&&(document.getElementById("num-clusters").readOnly=!1,document.getElementById("num-clusters").value=""),z.selectAll(".clustering-centroid").transition(U).style.display="none",z.selectAll(".cluster-hull").transition(U).style.display="none",setTimeout(function(){z.selectAll(".clustering-centroid").remove(),z.selectAll(".cluster-hull").remove(),fn()},Ze),Ae)Ae[e].ci=void 0}function In(){3==me&&(we?(clearInterval(we),we=void 0,this.innerHTML="&#9654",ue.removeAttribute("disabled")):(we=setInterval(wn,1e3),this.innerHTML="&#9613&#9613",ue.setAttribute("disabled",!0)))}function Ln(){var e=document.getElementById("clustering-replay-comment"),i=document.createElement("input");i.type="text",i.className="form-control custom-control mr-1",i.style.width="160px",i.style.marginRight="10px",i.id="clustering-replay-comment-text",j[0]?i.value=j[0]:i.placeholder=R.clusteringname,e.appendChild(i);var t=document.createElement("button");t.innerHTML=R.clusteringnamebutton,t.className="btn btn-primary",e.appendChild(t),t.addEventListener("click",function(){if($e==w&&""!=i.value){var e={coordsid:O,clusterid:Je.clusterId,studentid:0,remark:i.value};Bt(u,e);var t=document.getElementById("replay-select");if(t){for(var n,r=0;r<t.options.length;r++)if(t.options[r].selected){n=t.options[r].value.split("_");break}var o=n[0],l=n[1],e=n[2];D[o][l][e].comments[0]=i.value}}})}function wn(){if(0==Le){Ie=!0,Ln();var e=document.getElementById("num-clusters"),t=parseInt(e.value);(isNaN(t)||t<2)&&(t=3);var n,r,o,l,i={};for(n in He)i[He[n].x+"_"+He[n].y]=1;for(;t>Object.keys(i).length;)t--;for(e.value=t,e.readOnly=!0,Ne=[],Se=null,o=r=0;r<t;r++)if(o<ke.length)Ne[r]=Tn(null,ke[o++]);else{for(;!l;)l=he[Math.floor(X.random()*he.length)],l=ke.includes(l)?void 0:l;Ne[r]=Tn(null,l)}Bn(),document.getElementById("clustering").innerHTML=R.randcentroids,document.getElementById("dragdrop").innerHTML=R.dragoff,document.getElementById("clustering").style.color="black";e=Sn(Le);Je.iteration=Le,On(e)}else!function(e){if(document.getElementById("clustering").innerHTML!=R.convergence)if(0!=Object.keys(Ae).length){var t,n,r,o,l=R.iteration+": "+e;for(t in Ae)Ae[t].ci=Qn(Ae[t]);var i=[];for(n=0;n<Ne.length;n++)i[n]=An(n);Se=Ne,Ne=i;var s=!1;if(Se){var a=0;for(n=0;n<Ne.length;n++)r=Se[n].x-Ne[n].x,o=Se[n].y-Ne[n].y,a+=Math.sqrt(r*r+o*o);a<=ze&&(l=R.convergence,document.getElementById("clustering").style.color="green",s=!0)}document.getElementById("clustering").innerHTML=l,document.getElementById("dragdrop").innerHTML=0<e&&!s?R.dragon:R.dragoff;l=Sn(e);Je.iteration=s?-1:e,On(l)}else document.getElementById("clustering").innerHTML=R.convergence}(Le),_n(Ze);Le++,document.getElementById("clustering").innerHTML==R.convergence&&(clearInterval(we),we=void 0,ue.removeAttribute("disabled"),document.getElementById("play-pause").innerHTML="&#9654",document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0)}function Tn(e,t){var n,r,o,l,i=P-100,s=Y-100,a=0;if(e)for(;a<100;)n=Math.floor(Math.random()*(i-100)+100),r=Math.floor(Math.random()*(s-100)+100),o=n-e.x,l=r-e.y,a=Math.sqrt(o*o+l*l);else n=Math.floor(Math.random()*(i-100)+100),r=Math.floor(Math.random()*(s-100)+100);return{x:n,y:r,colour:t}}function Bn(){z.selectAll(".clustering-centroid").remove();for(var e,t,n=0;n<Ne.length;n++)e=Ne[n].x,t=Ne[n].y,G.append("line").attr("class","clustering-centroid").attr("id","cluster1-"+n).attr("x1",e-14).attr("y1",t-14).attr("x2",e+14).attr("y2",t+14).style("stroke",Ne[n].colour).style("stroke-width","5px").on("click",un).on("click.centroidClick",tr.bind(this,-1*(n+1),n,!0)).on("mouseover",Mn.bind(this,n,!1)),G.append("line").attr("class","clustering-centroid").attr("id","cluster2-"+n).attr("x1",e+14).attr("y1",t-14).attr("x2",e-14).attr("y2",t+14).style("stroke",Ne[n].colour).style("stroke-width","5px").on("click",un).on("click.centroidClick",tr.bind(this,-1*(n+1),n,!0)).on("mouseover",Mn.bind(this,n,!1))}function Mn(e,t){K.remove(),_e=!(je=!(Oe=!0)),G.on("click",Cn);var n,r={};if(t){var o=cn();for(n in ct[o])ct[o][n]==e&&(r[n]=n)}else for(n in Ae)Ae[n].ci==e&&(r[n]=n);for(var t=Object.keys(r).length,l={},i=0;i<te.nodes.length;i++)te.nodes[i].visible||(l[te.nodes[i].id]=1);t=function(e,t,n){var r,o,l,i,s={};for(r in e)for(i=re[0];i<te.edges[r].length&&i<=re[1];i++)l="string"==typeof(l=te.edges[r][i]).source?(o=parseInt(l.source),parseInt(l.target)):(o=l.source.id,l.target.id),t[o]||t[l]||(s[l=o+"_"+l]?s[l][r]?s[l][r]++:s[l][r]=1:(s[l]={},s[l][r]=1));var a,c,d=[];for(a in s)if(Object.keys(s[a]).length==n){var u=Number.MAX_SAFE_INTEGER;for(c in s[a])u>s[a][c]&&(u=s[a][c]);var m=a.split("_");d[d.length]=ot?{source:Kt(m[0]),target:Kt(m[1]),weight:u,colour:"black"}:{source:m[0],target:m[1],weight:u,colour:"black"}}for(i=0;i<te.links.length;i++)d[d.length]=te.links[i];return d}(r,l,t);Z.style("display","block").style("opacity",1).on("mouseover",bt).on("mouseout",kt),ot||J.force("link").links(t),ht(t),K.on("mouseover",Hn).on("mouseout",kt),J.restart(),setTimeout(function(){J.stop(),K.lower(),z.selectAll(".cluster-hull").lower()},10)}function Cn(){_e=!(je=!(Oe=!1)),K.remove(),Z.style("display","none").on("mouseover",null).on("mouseout",null),G.on("click",null)}function Hn(e){"black"==e.colour&&(K.on("mouseover",null),Z.on("mouseover",null).on("mouseout",null),z.selectAll(".clustering-centroid").on("mouseover",null),bt(e.source,!1),Fe=!0,bt(e.target,!0),Fe=!1)}function An(e){var t,n=[],r={};for(t in Ae)Ae[t].ci==e&&(n[n.length]=[Ae[t].x,Ae[t].y],r[Ae[t].x+"_"+Ae[t].y]={x:Ae[t].x,y:Ae[t].y,colour:Ne[e].colour});if(G.selectAll("#hull-"+e).remove(),en(r,e,!1,!1),G.selectAll(".centroid").raise(),G.selectAll(".clustering-centroid").raise(),0==Object.keys(r).length)return Tn(Ne[e],Ne[e].colour);var o=Nn(n);return o.colour=Ne[e].colour,o}function Nn(e){if(0==e.length)return null;for(var t=0,n=0,r=0;r<e.length;r++)t+=e[r][0],n+=e[r][1];return{x:t/e.length,y:n/e.length}}function Sn(e){var t=R.numstudents+": "+Object.keys(Ae).length+"<br>"+R.numofclusters+": "+Ne.length+"<br>"+R.iteration+": "+e+"<br>";document.getElementById("clustering")&&document.getElementById("clustering").innerHTML==R.convergence&&(t+='<span style="color:green">'+R.convergence+"</span><br>");for(var n,r,o,l=[],i=0;i<Ne.length;i++){for(r in n=Ne[i].x-P/2,o=Ne[i].y-Y/2,n=Math.sqrt(n*n+o*o),o=Ne[i].colour,t+=R.disttocluster+' <span style="color:'+o+'">'+o+"</span>: "+Math.round(n,2)+"<br>"+R.cluster+" "+o+" "+R.members+": [",l[i]=[],Ae)Ae[r].ci==i&&(t+=r+", ",l[i][l[i].length]=r);-1!=t.indexOf(",",t.length-3)&&(t=t.slice(0,-2)),t+="]<br>"}return pe.innerHTML=(t+="<br>")+pe.innerHTML,l}function On(e){for(var t,n,r={clusterCoords:[]},o=0;o<e.length;o++)for(r.clusterCoords[o]=jn(Ne[o]),r.clusterCoords[o].num=o,t=0;t<e[o].length;t++)n=jn(Ae[e[o][t]]),e[o][t]={id:_[e[o][t]],num:o,x:n.x,y:n.y};r.members=e,r.iteration=Je.iteration,r.clusterId=Je.clusterId,r.coordsid=O,r.usegeometric=nt?1:0,(0!=re[0]||re[1]!=te.maxSession)&&r.iteration<0&&(r.iteration=Le),Bt(l,r)}function jn(e){var t=(e.x-P/2)/Je.scale+Je.centre.x,e=(e.y-Y/2)/Je.scale+Je.centre.y;return{x:t=(t-Je.originalx)/Je.distance,y:e=(e-Je.originaly)/Je.distance}}function _n(e){for(var t,n,r=0;r<Ne.length;r++)t=Ne[r].x,n=Ne[r].y,z.select("#cluster1-"+r).transition().duration(e).attr("x1",t-14).attr("y1",n-14).attr("x2",t+14).attr("y2",n+14),z.select("#cluster2-"+r).transition().duration(e).attr("x1",t+14).attr("y1",n-14).attr("x2",t-14).attr("y2",n+14)}function Fn(){nt="geometric"==this.value,G.selectAll(".centroid").remove();var e,t=[],n=0;for(e in He)t[n++]={value:e,selected:!0,colour:He[e].colour};(nt?$t:Vt)(t),nn()}function Rn(e,t){var n,r,o;switch(parseInt(e[t])){case 1:if(3==me){ue.noUiSlider.set(2);break}if(me=1,qn(),!Ie)for(r in n=document.getElementsByName("centroid-type"))n[r].disabled=!1;break;case 2:for(r in me=2,Dn(),n=document.getElementsByName("centroid-type"))n[r].disabled=!0;document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0,document.getElementById("dragdrop").innerHTML==R.dragon&&(document.getElementById("dragdrop").innerHTML="--");break;case 3:if(1==me){ue.noUiSlider.set(2);break}me=3,zn(),Ie||(o='<input type="text" placeholder="'+R.numclusters+'" id="num-clusters" size="8" pattern="[0-9]{1,2}">',document.getElementById("cluster-text").innerHTML=o),document.getElementById("play-pause").disabled=!1,document.getElementById("play-step").disabled=!1,document.getElementById("clustering").innerHTML==R.convergence&&(document.getElementById("play-pause").disabled=!0,document.getElementById("play-step").disabled=!0),"--"==document.getElementById("dragdrop").innerHTML&&(document.getElementById("dragdrop").innerHTML=R.dragon)}}function qn(){Yt(!1),Z.on("mouseover",null).on("mouseout",null),Un(1,0,0,Ze),setTimeout(function(){z.selectAll(".centroid").raise()},100)}function Dn(){Z.transition(U).style("opacity",0),K.transition(U).style("opacity",0),z.selectAll(".clustering-centroid").transition(U).style("opacity",0),z.selectAll(".cluster-hull").transition(U).style("opacity",0),setTimeout(function(){Z.style("display","none"),K.style("display","none"),z.selectAll(".clustering-centroid").style("display","none"),z.selectAll(".cluster-hull").style("display","none")},Ze),!Ie&&document.getElementById("cluster-text")&&(document.getElementById("cluster-text").innerHTML=R.numclusters);var e=function(){var e,t=[];if(le)return function(){var e,t=[],n=0,r=0;for(e in se)if(!(0<=e&&1!=e))for(var o in se[e])for(var l in se[e][o].members)n=(n=se[e][o].members[l].x)*I+Je.originalx,r=(r=se[e][o].members[l].y)*I+Je.originaly,t[t.length]=[n,r];var i=Wn(t);if(null===i)return null;var s,a,c,d,u,m=[i.x,i.y],y=0,p=0;for(u=0;u<t.length;u++)s=Math.abs(t[u][0]-m[0]),a=Math.abs(t[u][1]-m[1]),y<s&&(y=s,c=u),p<a&&(p=a,d=u);if(void 0===d&&void 0===c)return m[2]=1,m;var g=t[c][0]-m[0]+P/2,f=t[c][1]-m[1]+Y/2,i=Xn(g,f,P/2,Y/2);g=t[d][0]-m[0]+P/2,f=t[d][1]-m[1]+Y/2;f=Xn(g,f,P/2,Y/2);return m[2]=i<f?i:f,m[2]*=.9,m}();for(e in He)t[t.length]=[He[e].x,He[e].y];var n=Wn(t);if(null===n)return null;var r,o,l,i,s=[n.x,n.y],a=0,c=0;for(e in He)r=Math.abs(He[e].x-s[0]),o=Math.abs(He[e].y-s[1]),a<r&&(a=r,l=e),c<o&&(c=o,i=e);if(void 0===i&&void 0===l)return s[2]=1,s;var d=He[l].x-s[0]+P/2,u=He[l].y-s[1]+Y/2,n=Xn(d,u,P/2,Y/2);d=He[i].x-s[0]+P/2,u=He[i].y-s[1]+Y/2;u=Xn(d,u,P/2,Y/2);return s[2]=n<u?n:u,s[2]*=.9,s}();null!==e&&(Je.scale=e[2],ae=e,setTimeout(function(){Un(e[2],e[0],e[1],Ze)},Ze/2))}function zn(){z.selectAll(".clustering-centroid").transition(U).style("display","block").style("opacity",1),z.selectAll(".cluster-hull").transition(U).style("display","block").style("opacity",1),z.selectAll(".clustering-centroid").raise()}function Un(e,t,n,r){var o,l,i,s=P/2,a=Y/2;if(!Ae)for(i in Ae={},He)Ae[i]={x:0,y:0};for(i in Je.centre={x:t,y:n},He)o=((m=He[i].x)-t)*e,l=((y=He[i].y)-n)*e,y=1==e&&0==t&&0==n?(m=t+o,n+l):(m=s+o,a+l),l=(Ae[i].x=m)+","+((Ae[i].y=y)-14)+" "+(m+14)+","+(y+14)+" "+(m-14)+","+(y+14),z.select("#centroid-"+i).transition().duration(r).attr("points",l);var c,d;for(i in at){var u=(c=at[i].x,d=at[i].y,c*=Je.distance,c+=Je.originalx,d*=Je.distance,d+=Je.originaly,c-=Je.centre.x,c*=Je.scale,c+=P/2,d-=Je.centre.y,d*=Je.scale,{x:c,y:d+=Y/2}),m=u.x,y=u.y;z.select("#server-centroid-"+i).transition().duration(r).attr("cx",m).attr("cy",y)}}function Wn(e){if(0==e.length)return null;if(1==e.length)return{x:e[0][0],y:e[0][1]};for(var t,n=0,r=0,o=P,l=Y,i=0;i<e.length;i++)n<(t=e[i][0])&&(n=t),t<o&&(o=t),r<(t=e[i][1])&&(r=t),t<l&&(l=t);return{x:(n+o)/2,y:(r+l)/2}}function Xn(e,t,n,r){n=e-n,r=t-r,n=((0<n?P:0)-P/2)/n,r=((0<r?Y:0)-Y/2)/r;return isFinite(n)&&isFinite(r)&&n<=r||isFinite(n)&&!isFinite(r)?n:isFinite(r)?r:1}function Gn(){var e=document.getElementById("log-panel");e.style.width=y+"px";var t=document.createElement("button");t.innerHTML=R.copy,t.className="btn btn-secondary mb-1",t.addEventListener("click",function(){window.getSelection().selectAllChildren(pe),document.execCommand("copy")}),qe?t.style.marginLeft="10px":(t.style.position="absolute",t.style.right=y-40+"px"),e.appendChild(t);t=document.createElement("button");t.innerHTML=R.print,t.className="btn btn-secondary mb-1",t.addEventListener("click",function(){var e=window.open();e.document.write("<html><head></head><body>"),e.document.write(pe.innerHTML),e.document.write("</body></html>"),e.print(),e.close()}),qe?t.style.marginLeft="10px":(t.style.position="absolute",t.style.right=y-100+"px"),e.appendChild(t),(pe=document.createElement("div")).readOnly=!0,pe.style.overflow="scroll",pe.style.width="200px",pe.style.height=Y+"px",pe.style.resize="none",pe.style.border="2px solid black",qe||(pe.style.position="absolute",pe.style.right="6px",pe.style.top="120px"),e.appendChild(pe)}function Pn(){for(var e in He)G.append("polygon").attr("class","centroid").attr("id","centroid-"+e).attr("points",Yn(He[e].x,He[e].y)).style("stroke","black").style("stroke-width","3px").style("fill",He[e].colour).call(z.drag().on("start",Jn.bind(this,e)).on("drag",Zn.bind(this,e)).on("end",Kn.bind(this,e))).on("mouseout",$n).on("mouseover",er.bind(this,e)).on("click",un).on("click.centroidClick",tr.bind(this,_[e],e,!1));if(st)for(e in at){var t=at[e].x*Je.distance+Je.originalx,n=at[e].y*Je.distance+Je.originaly;G.append("circle").attr("class","server-centroid").attr("id","server-centroid-"+e).attr("r",5).attr("cx",t).attr("cy",n).style("fill","black")}}function Yn(e,t){return e+","+(t-14)+" "+(e+14)+","+(t+14)+" "+(e-14)+","+(t+14)}function Jn(e){Vn()&&(Ve=Date.now(),G.append("polygon").attr("class","dragged-centroid").attr("id","dragged-"+e).attr("points",Yn(z.event.x,z.event.y)).style("stroke","black").style("stroke-width","3px").style("fill",He[e].colour).style("opacity",.5))}function Zn(e){Vn()&&z.select("#dragged-"+e).attr("points",Yn(z.event.x,z.event.y))}function Kn(e){if(z.selectAll(".dragged-centroid").remove(),Vn())if(Date.now()-Ve<300)tr(_[e],e,!1);else{Ae[e].ci=Qn(z.event);for(var t=[],n=0;n<Ne.length;n++)t[n]=An(n);Se=Ne,Ne=t,_n(Ze);e=R.iteration+": "+Le;document.getElementById("clustering").innerHTML=e,document.getElementById("dragdrop").innerHTML=R.dragon;e=Sn(Le);Je.iteration=Le++,On(e)}}function Qn(e){for(var t,n,r=Number.MAX_SAFE_INTEGER,o=-1,l=0;l<Ne.length;l++)t=e.x-Ne[l].x,n=e.y-Ne[l].y,(n=Math.sqrt(t*t+n*n))<r&&(r=n,o=l);return o}function Vn(){if(Ne&&document.getElementById("clustering")&&document.getElementById("clustering").innerHTML!=R.convergence){for(var e in Ae)if(void 0===Ae[e].ci)return;return 3==me?1:void 0}}function $n(){Oe||(z.selectAll(".text").remove(),z.selectAll("rect").remove(),Ie&&(le||3==me)&&null!==cn()&&(Z.style("display","none").style("opacity",0),K.remove()))}function er(t){if(!Oe){z.selectAll(".text").remove(),z.selectAll("rect").remove();var e=G.append("rect"),n=[0],r=1==me?He:Ae,o=t;h.forEach(function(e){e.id==t&&(o=1==De?e.firstname+" "+e.lastname:e.id)});var l=1==De?70:30,i=G.append("text").attr("class","text").attr("id","t-"+t).attr("y",r[t].y+32).attr("dy",".40em").style("pointer-events","none").text(o).call(xt,l,r[t].x-(6+l)/2+8,n),s=18*n[0]+16;if(s+r[t].y+10>=Y&&i.attr("y",Y-s-(Y-r[t].y)).text(o).call(xt,l,r[t].x-(6+l)/2+8,n),e.attr("id","r-"+t).attr("x",r[t].x-(6+l)/2).attr("y",s+r[t].y+10<=Y?r[t].y+16:Y-s-16-(Y-r[t].y)).attr("width",16+l).attr("height",s).style("stroke","black").style("fill","yellow"),Ie&&(le||3==me)&&null!==cn()){K.remove();for(var a={},c=0;c<te.nodes.length;c++)te.nodes[c].visible||(a[te.nodes[c].id]=1);var d,u,m,y={};for(c=re[0];c<te.edges[t].length&&c<=re[1];c++)m="string"==typeof(d=te.edges[t][c]).source?(u=parseInt(d.source),parseInt(d.target)):(u=d.source.id,d.target.id),a[u]||a[m]||(y[m=u+"_"+m]?y[m]++:y[m]=1);var p,g=[],f=te.edges[t][0].colour;for(d in y)p=d.split("_"),g[g.length]=ot?{source:Kt(p[0]),target:Kt(p[1]),weight:y[d],colour:f}:{source:p[0],target:p[1],weight:y[d],colour:f};for(c=0;c<te.links.length;c++)g[g.length]=te.links[c];ot||J.force("link").links(g),ht(g),Z.style("display","block").style("opacity",1),J.restart(),setTimeout(function(){J.stop(),Z.lower(),K.lower()},1)}}}function tr(t,e,n){var r,o,l,i,s,a,c,d;Ie&&!document.getElementById("textbox-"+t)&&null!==cn()&&(!le&&Ie&&3!=me||((r=document.createElement("textarea")).id="textbox-"+t,r.style.resize="both",r.style.position="absolute",j[t]&&(r.value=j[t]),$e!=w&&(r.readOnly=!0),document.body.appendChild(r),o=r.getBoundingClientRect(),l=document.getElementsByTagName("svg")[0].getBoundingClientRect(),i=(n?Ne:Ae)[e].x,s=i+o.width/2>=P?i+l.x-o.width:i-o.width/2<=0?i+l.x:i+l.x-o.width/2,r.style.left=s+"px",a=(n?Ne:Ae)[e].y+220,r.style.top=a+"px",(c=document.createElement("button")).innerHTML=$e==w?R.save:R.close,c.style.position="absolute",c.style.left=s+"px",c.style.top=a+o.height+"px",document.body.appendChild(c),r.focus(),it[t]={button:c,textbox:r},r.addEventListener("click",function(){this.parentNode.appendChild(this),c.parentNode.appendChild(c),this.focus()}),d=!1,r.addEventListener("mousedown",function(){d=!0}),r.addEventListener("mouseup",function(){d=!1}),r.addEventListener("mousemove",function(){d&&(o=this.getBoundingClientRect(),c.style.left=s+"px",c.style.top=a+o.height+"px")}),c.addEventListener("click",function(){var e;$e==w&&(e={coordsid:O,clusterid:Je.clusterId,studentid:t,remark:r.value},""!=r.value&&r.value!=j[t]&&(j[t]=r.value,Bt(u,e))),document.body.removeChild(r),document.body.removeChild(c),delete it[t]})))}!function(e){v=e.logs,h=e.users,d=e.groups,m=e.members,b=e.mods,e.panelwidth,y=e.legendwidth,p=e.name,g=e.iframeurl,qe=e.version36,De=e.showstudentnames,f=e.positioning,x=e.positioning,k=e.nodecoords,E=e.links,L=e.courseid,w=e.userid,I=e.scale,T=e.graphs,B=e.alllinks,M=e.scales,C=e.changes,H=e.names,A=e.allmods,N=e.setnames,S=w,O=e.lastchange,j=e.comments,R=e.strings,a=e.coordsscript,l=e.clustersscript,u=e.commentsscript,c=e.manualscript,i=e.deletescript,q=e.sesskey,Ke=e.gotallnodes,le=e.replaying,st=e.debugcentroids,at=e.centroids,et=e.isresearcher,$e=w,D=e.replaydata,s=e.predictionscript,ot=e.uselsa,rt=null,e.predictionanalysis&&(t=e.predictionanalysis.split("_"),rt={userid:t[0],coordsid:t[1],clusterid:t[2]}),z=window.dataDrivenDocs,W=window.noUiSlider;var t=window.mersenneTwister;if(X=new t(259),be=0,he=["aqua","blue","blueviolet","brown","cadetblue","chartreuse","chocolate","coral","cornflowerblue","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgrey","darkgreen","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgrey","dodgerblue","firebrick","forestgreen","fuchsia","gold","goldenrod","grey","green","greenyellow","hotpink","indianred","indigo","khaki","lawngreen","lightblue","lightcoral","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategrey","lightsteelblue","lime","limegreen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","navy","olive","olivedrab","orange","orangered","orchid","palegreen","paleturquoise","palevioletred","peru","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","sienna","silver","skyblue","slateblue","slategrey","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","yellow","yellowgreen"],Ue=Date.now()+3e3,Ze=1e3,U=z.transition().duration(Ze).ease(z.easeLinear),ye=120,ee=1e-4,Pe=Ft,Te=!(V=ze=1),Be=220,Ce=.15,Me=z.curveCatmullRomClosed,nt=!0,fe={},Je={},it={},xe={originalLinks:"lightgrey",grouping:"black",assign:"blue",quiz:"red",forum:"orange",resource:"green",lti:"yellow",url:"purple",book:"magenta",page:"cyan",lesson:"brown",data:"coral",chat:"maroon",choice:"grey",feedback:"lime",glossary:"navy",survey:"tan",wiki:"teal",workshop:"silver",scorm:"tomato",imscp:"lightpink",folder:"peru"},ke=["blue","red","orange","green","yellow","brown","purple","magenta","cyan"],oe=f?0:36,P=window.innerWidth-ye-y-150,Y=window.innerHeight-oe-90,Ye=Math.min(P,Y)<450?6:8,lt=10,_={},h.forEach(function(e){_[e.id]=e.realId}),ut(),ot){0<e.links.length&&e.links[0].label&&(lt=4e3,k={}),(te={nodes:e.nodecoords,links:e.links,edges:{},maxSession:0}).links.forEach(function(e){e.source=te.nodes[e.source],e.target=te.nodes[e.target],e.colour=xe.originalLinks});for(var n=[],r=Object.keys(te.nodes),o=0;o<r.length;o++)te.nodes[r[o]].entype&&(n[o]=te.nodes[r[o]],n[o].colour=xe[n[o].entype]);return te.nodes=n,f?gt():(setTimeout(function(){pt();var e=zt();Xt(),Ut(e),Gt()},lt+100),function(){var e=P/2,t=Y/2;Je.originalx=e,Je.originaly=t;var e=te.nodes,n=te.links,t=z.forceLink(n).distance(function(e){return 1/e.value*500});G=z.select("#graph").append("svg").attr("width",P).attr("height",Y),J=z.forceSimulation(e).force("link",t).force("charge",z.forceManyBody().strength(-250)).force("collide",z.forceCollide().radius(30)).force("center",z.forceCenter(P/2,Y/2)).force("x",z.forceX()).force("y",z.forceY()),Z=G.selectAll(".node").data(e).enter().append("circle").attr("class","node").attr("r",Ye).style("display",function(e){return e.visible?"block":"none"}).on("mouseover",bt).on("mouseout",kt),K=G.selectAll(".link").data(n).enter().append("line").attr("class","link").style("stroke",xe.originalLinks).style("stroke-width",function(e){return e.value/3+"px"}),0<n.length&&n[0].label?(J.on("tick",Lt),setTimeout(function(){J.stop(),Tt(n),Je.distance=I},lt)):(J.on("tick",It),setTimeout(function(){J.stop()},100))}())}mt(),le?(e=e.manualdata,f=!0,k={0:0,1:1,2:2},Y=window.innerHeight-190,function(){var e=document.getElementById("slider"),t=document.createElement("p");t.innerHTML="&nbsp",t.id="replayer",t.style.marginTop="-20px",e.appendChild(t);t=document.createElement("p");t.innerHTML="&nbsp",t.id="replaydragdrop",t.style.marginTop="-12px",e.appendChild(t);t=document.createElement("button");t.id="replay-stop",t.innerHTML="&#9606",t.className="btn btn-secondary",t.addEventListener("click",gn),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="replay-pause",t.innerHTML="&#9654",t.value="play",t.className="btn btn-secondary",t.addEventListener("click",hn),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="replay-back",t.innerHTML="&#9614&#9664",t.className="btn btn-secondary",t.addEventListener("click",xn),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="replay-forward",t.style.marginRight="80px",t.innerHTML="&#9654&nbsp&nbsp&#9614",t.className="btn btn-secondary",t.addEventListener("click",bn.bind(this,!0)),t.style.opacity=0,e.appendChild(t);t=document.createElement("button");t.id="delete-button",t.innerHTML=R.delbutton,t.className="btn btn-secondary",t.addEventListener("click",pn),t.style.opacity=0,e.appendChild(t);t=document.createElement("label");t.id="prediction-label",t.style.opacity=0,t.style.marginLeft="6px",t.appendChild(document.createTextNode(R.predictionbox)),e.appendChild(t);t=document.createElement("input");t.type="checkbox",t.id="prediction-box",t.addEventListener("click",yn),t.style.opacity=0,t.style.marginLeft="2px",e.appendChild(t)}(),Gn(),function(e){var t,n=document.getElementById("student-menu");for(t in(ie=document.createElement("select")).size=3,ie.id="replay-select",ie.style="height: "+(Y-12)+"px;",ie.addEventListener("change",function(t){var n=function(e){var t,n,r=document.getElementById("replay-select");for(n=0;n<r.options.length;n++)if(r.options[n].selected){t=r.options[n].value.split("_");break}var o=t[0],l=t[1],i=t[2];$e=o.split("-")[0],Je.clusterId=i,O=D[o][l].last,k=D[o][l].nodes,E=D[o][l].links,I=D[o][l].scale,b=D[o][l].mods,se=D[o][l][i];var s,a=D[o][l].islsa;for(s in v=D[o][l].logs,h=D[o][l].users,j=D[o][l][i].comments,F={},_={},h.forEach(function(e){_[e.id]=e.realId,F[e.realId]=e.id}),me=1,de=ce=Le=0,se)isNaN(s)||(0<=s?ce++:de--);dt=[],ct={},Qe=!1;var c,d,u=e[o][l][i];if(u)for(Qe=!0,n=-1;de<=n;n--)for(c in u[n]&&!u[n-1]&&(u[n-1]=u[n]),ct[n]={},u[n])for(d in u[n][c].members){var m=u[n][c].members[d].id;ct[n][F[m]]=c}Ne=[],He={};var y,p={},g=0;for(c in se[1]){if(n=Ne.length,Ne[n]={x:0,y:0},g<ke.length)Ne[n].colour=ke[g++];else{for(;!y;)y=he[Math.floor(X.random()*he.length)],y=ke.includes(y)?void 0:y;Ne[n].colour=y}for(d in se[1][c].members){var f=F[se[1][c].members[d].id];He[f]={x:se[1][c].members[d].x,y:se[1][c].members[d].y},p[f]=!0}}return{members:p,did:o,gid:l,cid:i,islsa:a}}(t),e=n.members;if(G){for(var r in G.remove(),vn(),fn(),document.getElementById("replayer").innerHTML="&nbsp;",document.getElementById("replaydragdrop").innerHTML="&nbsp;",document.getElementById("prediction-box").checked=!1,document.getElementById("prediction-label").style.opacity=0,document.getElementById("prediction-box").style.opacity=0,it)document.body.removeChild(it[r].textbox),document.body.removeChild(it[r].button);it={}}ne&&document.body.removeChild(ne);if(Ae=null,ut(),n.islsa){for(var o,l=[],i=Object.keys(k),s=0;s<i.length;s++)l[s]=k[i[s]],l[s].colour=xe[l[s].entype];for(o in te.nodes=l,E)E[o].colour=xe.originalLinks;te.links=E,te.edges={},pt()}else mt();re=[0,te.maxSession],document.getElementById("replay-stop").style.opacity=1,document.getElementById("replay-pause").style.opacity=1,document.getElementById("replay-back").style.opacity=1,document.getElementById("replay-forward").style.opacity=1,document.getElementById("delete-button").style.opacity=1,se[-1]&&(document.getElementById("prediction-label").style.opacity=1,document.getElementById("prediction-box").style.opacity=1);rt&&rt.coordsid===n.gid&&rt.clusterid===n.cid&&(document.getElementById("prediction-box").checked=!0);for(var a=0;a<te.nodes.length;a++)void 0===te.nodes[a].xcoord&&(te.nodes[a].visible=0);(function(e){(ne=document.createElement("select")).multiple=!0,ne.id="student-select",ne.style.display="none",be=0,h.forEach(function(e){Wt(e,ne)});for(var t,n=0;n<ne.options.length;n++)t=ne.options[n].value,e[t]?ne.options[n].selected=!0:ne.options[n].selected=!1,He[t]&&(He[t].colour=ne.options[n].colour);document.body.appendChild(ne)})(e),ft(0),Yt(!1),Z.on("mouseover",null).on("mouseout",null),Oe=!0,document.getElementById("clustering-replay-comment").innerHTML="&nbsp",Ln(),setTimeout(function(){for(var e in mn(He,!1),Pn(),J.on("tick",It),He)z.select("#centroid-"+e).call(z.drag().on("start",rn.bind(this,e)).on("drag",on.bind(this,e)).on("end",ln.bind(this,e,t,n)))},500)}.bind(this,e)),D){var r,o=0;for(r in D[t]){var l,i,s=0;for(l in o++,D[t][r])!isNaN(l)&&D[t][r][l][1]&&((i=document.createElement("option")).value=t+"_"+r+"_"+l,i.text=t.split("-")[0]+"_"+o+"_"+ ++s,ie.appendChild(i))}}n.appendChild(ie)}(e)):(f?gt:function(){{var e;f=Ee=!0,$=0,Ge=Xe=We=null,Ke&&0!=Object.keys(k).length?(e=zt(),Xt(),Ut(e),ft(0),Gt()):(ft(.6),setTimeout(function(){var e=zt();Xt(),Ut(e),Gt()},500))}Q=null})()}(e)}});
//# sourceMappingURL=behaviour-analytics.min.js.map