{"version":3,"file":"dashboard.min.js","sources":["../src/dashboard.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * File to render and control the dashboard bits.\n *\n * @package block_behaviour\n * @author Ted Krahn\n * @copyright 2021 Athabasca University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint max-depth: [\"warn\", 9] */\n/* eslint complexity: [\"warn\", 23] */\n\n(function(factory) {\n    if (typeof define === \"function\" && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else {\n        // Browser globals.\n        window.behaviourAnalyticsDashboard = factory();\n    }\n})(function() {\n\n    var behaviourAnalyticsDashboard = function(incoming) {\n\n        var surveyId = 0;\n        var questionList = {};\n        var questionOptions = {};\n        var edittingQuestion = false;\n        var chartIsBig = false;\n\n        /**\n         * Function called to initialize the program.\n         *\n         * @param {array} incoming - The data from the server.\n         */\n        function init(incoming) {\n\n            if (incoming.newsurvey || incoming.managesurvey) {\n                showSurvey(incoming);\n\n            } else if (incoming.showlsradar) {\n                showLSRadar();\n\n            } else if (incoming.showbfiradar) {\n                showBFIRadar();\n\n            } else {\n                showSummary(incoming);\n            }\n        }\n\n        /**\n         * Function called to render the existing questions.\n         *\n         * @param {object} d - The data from the server.\n         */\n        function addPreviousQuestions(d) {\n\n            var qdiv = null;\n            var node = null;\n            var edit = false;\n            var option;\n            var textbox;\n            var labels;\n\n            var div = document.createElement('div');\n            div.id = 'question-list';\n            var doAddOption = function(questionId, d) {\n                var o = 0;\n                var opt;\n                while (document.getElementById('option-div-' + questionId + '-' + o)) {\n                    opt = document.getElementById('option-div-' + questionId + '-' + o);\n                    o++;\n                }\n                addEditCheckboxOption(opt, d.langstrings.option, questionId, o, true);\n            };\n\n            var questionIds = Object.keys(questionList).sort(function(a, b) {\n                return questionList[a].ordering > questionList[b].ordering;\n            });\n\n            for (var key in questionIds) {\n                edit = false;\n                qdiv = document.createElement('div');\n                qdiv.id = 'qdiv-' + questionIds[key];\n\n                // User clicked the edit button for this question, do text box.\n                if (questionList[questionIds[key]].edit) {\n                    textbox = document.createElement('input');\n                    textbox.type = 'text';\n                    textbox.id = 'question-' + questionIds[key];\n                    textbox.value = questionList[questionIds[key]].qtext;\n                    edit = true;\n                    qdiv.appendChild(textbox);\n\n                } else { // Just a text node.\n                    qdiv.appendChild(document.createTextNode(questionList[questionIds[key]].qtext));\n                }\n                qdiv.appendChild(document.createElement('br'));\n\n                // Binary or custom question.\n                if (questionList[questionIds[key]].qtype == 'binary' || questionList[questionIds[key]].qtype == 'custom') {\n                    if (questionList[questionIds[key]].edit) {\n                        for (option in questionOptions[questionIds[key]]) {\n                            addEditRadioOption(qdiv, questionOptions[questionIds[key]][option], questionIds[key], option);\n                        }\n                    } else {\n                        for (option in questionOptions[questionIds[key]]) {\n                            addRadioOption(qdiv, questionOptions[questionIds[key]][option]);\n                        }\n                    }\n                } else if (questionList[questionIds[key]].qtype == 'multiple') { // Multiple answer question.\n                    if (questionList[questionIds[key]].edit) {\n                        for (option in questionOptions[questionIds[key]]) {\n                            addEditCheckboxOption(qdiv, questionOptions[questionIds[key]][option], questionIds[key], option);\n                        }\n                        var addOption = document.createElement('button');\n                        addOption.textContent = d.langstrings.addoption;\n                        addOption.id = 'add-option';\n                        addOption.addEventListener('click', doAddOption.bind(this, questionIds[key], d));\n                        qdiv.appendChild(addOption);\n                    } else {\n                        for (option in questionOptions[questionIds[key]]) {\n                            addCheckboxOption(qdiv, questionOptions[questionIds[key]][option]);\n                        }\n                    }\n                } else if (questionList[questionIds[key]].qtype == 'open') {\n                    textbox = document.createElement('textarea');\n                    textbox.disabled = true;\n                    qdiv.appendChild(textbox);\n\n                } else { // Premade question type.\n                    labels = d.langstrings[questionList[questionIds[key]].qtype + 'scale'].split(',');\n                    for (var l in labels) {\n                        addRadioOption(qdiv, labels[l]);\n                    }\n                }\n                // Add this question to the list.\n                node = getQuestionHeader(d, questionList[questionIds[key]].ordering, questionIds[key], edit);\n                div.appendChild(node);\n                div.appendChild(qdiv);\n            }\n\n            var oldList = document.getElementById('question-list');\n            if (oldList) {\n                document.getElementById('survey-questions').replaceChild(div, oldList);\n            } else {\n                document.getElementById('survey-questions').appendChild(div);\n            }\n        }\n\n        /**\n         * Function called to render a radio option.\n         *\n         * @param {DOMElement} parent - Parent element to append to.\n         * @param {string} text - The label text for the radio button.\n         */\n        function addRadioOption(parent, text) {\n\n            var radio = document.createElement('input');\n            radio.type = 'radio';\n            radio.name = 'radio';\n            radio.disabled = true;\n            radio.style.marginLeft = '5px';\n\n            var label = document.createElement('label');\n            label.appendChild(document.createTextNode(text));\n            label.appendChild(radio);\n            label.style.marginRight = '10px';\n\n            parent.appendChild(label);\n        }\n\n        /**\n         * Function called to render a editable radio option.\n         *\n         * @param {DOMElement} parent - Parent element to append to.\n         * @param {string} text - The label text for the radio button.\n         * @param {number} questionId - Question id.\n         * @param {number} optionId - Question option id.\n         * @param {boolean} asPlaceholder - Should the text be value or placeholder?\n         */\n        function addEditRadioOption(parent, text, questionId, optionId, asPlaceholder) {\n\n            var radio = document.createElement('input');\n            radio.id = 'radio-' + questionId + '-' + optionId;\n            radio.type = 'radio';\n            radio.name = 'radio';\n            radio.disabled = true;\n            radio.style.marginRight = '10px';\n\n            var tb = document.createElement('input');\n            tb.type = 'text';\n            tb.id = 'option-' + questionId + '-' + optionId;\n            if (asPlaceholder) {\n                tb.placeholder = text + ' ' + (optionId + 1);\n            } else {\n                tb.value = text;\n            }\n            tb.appendChild(radio);\n            tb.style.marginRight = '5px';\n\n            parent.appendChild(tb);\n            parent.appendChild(radio);\n        }\n\n        /**\n         * Function called to render a editable radio option.\n         *\n         * @param {DOMElement} parent - Parent element to append to.\n         * @param {string} text - The label text for the radio button.\n         * @param {number} optionId - Question option id.\n         * @param {boolean} asPlaceholder - Flag to use the text as placeholder.\n         */\n        function addRadioTextOption(parent, text, optionId, asPlaceholder) {\n\n            var radio = document.createElement('input');\n            radio.id = 'radio-' + optionId;\n            radio.type = 'radio';\n            radio.name = 'radio';\n            radio.disabled = true;\n            radio.style.marginLeft = '5px';\n            radio.style.marginRight = '10px';\n\n            var tb = document.createElement('input');\n            tb.type = 'text';\n            tb.id = 'text-label-' + optionId;\n            if (asPlaceholder) {\n                tb.placeholder = text + ' ' + (optionId + 1);\n            } else {\n                tb.value = text;\n            }\n\n            parent.appendChild(tb);\n            parent.appendChild(radio);\n        }\n\n        /**\n         * Function called to render a editable checkbox option.\n         *\n         * @param {DOMElement} parent - Parent element to append to.\n         * @param {string} text - The label text for the radio button.\n         */\n        function addCheckboxOption(parent, text) {\n\n            var div = document.createElement('div');\n\n            var box = document.createElement('input');\n            box.type = 'checkbox';\n            box.disabled = true;\n\n            var label = document.createElement('label');\n            label.appendChild(document.createTextNode(text));\n            label.style.marginLeft = '5px';\n\n            div.appendChild(box);\n            div.appendChild(label);\n            parent.appendChild(div);\n        }\n\n        /**\n         * Function called to render a editable checkbox option.\n         *\n         * @param {DOMElement} parent - Parent element to append to.\n         * @param {string} text - The label text for the radio button.\n         * @param {number} questionId - Question id.\n         * @param {number} optionId - Question option id.\n         * @param {boolean} asPlaceholder - Flag to render the text as placeholder.\n         */\n        function addEditCheckboxOption(parent, text, questionId, optionId, asPlaceholder) {\n\n            var div = document.createElement('div');\n            div.id = 'option-div-' + questionId + '-' + optionId;\n\n            var box = document.createElement('input');\n            box.type = 'checkbox';\n            box.disabled = true;\n            box.style.marginRight = '10px';\n\n            var tb = document.createElement('input');\n            tb.type = 'text';\n            tb.id = 'option-' + questionId + '-' + optionId;\n            if (asPlaceholder) {\n                tb.placeholder = text + ' ' + (optionId + 1);\n            } else {\n                tb.value = text;\n            }\n            tb.appendChild(box);\n            tb.style.marginRight = '5px';\n\n            div.appendChild(box);\n            div.appendChild(tb);\n            parent.appendChild(div);\n        }\n\n        /**\n         * Function called to render a editable checkbox option.\n         *\n         * @param {DOMElement} parent - Parent element to append to.\n         * @param {string} text - The label text for the radio button.\n         * @param {number} optionId - Question option id.\n         */\n        function addCheckboxTextOption(parent, text, optionId) {\n\n            var div = document.createElement('div');\n            div.id = 'option-div-' + optionId;\n\n            var box = document.createElement('input');\n            box.type = 'checkbox';\n            box.style.marginLeft = '5px';\n            box.style.marginRight = '10px';\n            box.disabled = true;\n\n            var tb = document.createElement('input');\n            tb.type = 'text';\n            tb.id = 'text-label-' + optionId;\n            tb.placeholder = text + ' ' + (optionId + 1);\n\n            div.appendChild(box);\n            div.appendChild(tb);\n            parent.appendChild(div);\n        }\n\n        /**\n         * Function called to get the question header with number and buttons.\n         *\n         * @param {object} d - Data from the server.\n         * @param {number} number - The question number.\n         * @param {number} questionId - Question id.\n         * @param {boolean} edit - Editing the question or not.\n         * @return {DOMElement}\n         */\n        function getQuestionHeader(d, number, questionId, edit) {\n\n            var div = document.createElement('div');\n            div.id = 'qdiv-header-' + questionId;\n\n            // Question number.\n            var node = document.createTextNode(number);\n            div.appendChild(node);\n\n            // Up arrow.\n            var up = document.createElement('img');\n            up.src = d.uparrowurl;\n            up.style.marginLeft = '12px';\n\n            if (number === 1) {\n                up.style.opacity = 0.0;\n            } else {\n                up.addEventListener('click', function() {\n\n                    // Swap the questions.\n                    var qid = 0;\n                    for (var q in questionList) {\n                        if (questionList[q].ordering === number - 1) {\n                            questionList[q].ordering++;\n                            qid = q;\n                            break;\n                        }\n                    }\n                    questionList[questionId].ordering--;\n                    addPreviousQuestions(d);\n\n                    // Let the server know what happened.\n                    var out = {\n                        courseid: d.courseid,\n                        minusqid: questionId,\n                        plusqid: qid\n                    };\n                    callServer(d.changequestionurl, out, d);\n                });\n            }\n            div.appendChild(up);\n\n            // Down arrow.\n            var down = document.createElement('img');\n            down.src = d.uparrowurl;\n            down.style.marginLeft = '12px';\n            down.style.transform = 'rotate(180deg)';\n\n            if (number === Object.keys(questionList).length) {\n                down.style.opacity = 0.0;\n            } else {\n                down.addEventListener('click', function() {\n\n                    // Swap the questions.\n                    var qid = 0;\n                    for (var q in questionList) {\n                        if (questionList[q].ordering === number + 1) {\n                            questionList[q].ordering--;\n                            qid = q;\n                            break;\n                        }\n                    }\n                    questionList[questionId].ordering++;\n                    addPreviousQuestions(d);\n\n                    // Let the server know what happened.\n                    var out = {\n                        courseid: d.courseid,\n                        minusqid: qid,\n                        plusqid: questionId\n                    };\n                    callServer(d.changequestionurl, out, d);\n                });\n            }\n\n            div.appendChild(down);\n\n            // Delete question button.\n            var dl = document.createElement('button');\n            dl.style.marginLeft = '12px';\n\n            dl.addEventListener('click', function() {\n\n                var out = {\n                    courseid: d.courseid,\n                    id: questionId,\n                    ordering: questionList[questionId].ordering,\n                    survey: surveyId,\n                    deleted: true,\n                };\n                callServer(d.deletequrl, out, d);\n\n                delete questionList[questionId];\n                addPreviousQuestions(d);\n            });\n\n            dl.textContent = d.langstrings.delete;\n            div.appendChild(dl);\n\n            // Add editing interface.\n            if (edit) {\n                // Cancel button.\n                var cancel = document.createElement('button');\n                cancel.textContent = d.langstrings.cancel;\n                cancel.style.marginLeft = '12px';\n\n                cancel.addEventListener('click', function() {\n\n                    // Restore old question type and label data.\n                    if (questionList[questionId].oldQType) {\n                        questionList[questionId].qtype = questionList[questionId].oldQType;\n\n                        if (questionList[questionId].qtype == 'custom' ||\n                            questionList[questionId].qtype == 'binary' ||\n                            questionList[questionId].qtype == 'multiple') {\n\n                            questionOptions[questionId] = questionList[questionId].labels;\n                            delete questionList[questionId].labels;\n                        }\n                        delete questionList[questionId].oldQType;\n                    }\n\n                    delete questionList[questionId].edit;\n                    edittingQuestion = false;\n                    addPreviousQuestions(d);\n                });\n\n                div.appendChild(cancel);\n\n                // Save button.\n                var save = document.createElement('button');\n                save.style.marginLeft = '12px';\n\n                save.addEventListener('click', function() {\n\n                    // Get question text box.\n                    var tb = document.getElementById('question-' + questionId);\n                    if (tb.value == '') {\n                        printEditError(questionId, d.langstrings.addqerr);\n                        return;\n                    }\n\n                    // Get option labels.\n                    var labels = [];\n                    var i = 0;\n                    var v;\n                    while (document.getElementById('option-' + questionId + '-' + i)) {\n                        v = document.getElementById('option-' + questionId + '-' + i);\n                        if (v.value != '') {\n                            labels[labels.length] = v.value;\n                        }\n                        i++;\n                    }\n\n                    // Ensure at least 2 labels for dichotomous and multiple choice questions.\n                    if ((questionList[questionId].qtype == 'multiple' ||\n                         questionList[questionId].qtype == 'binary') && labels.length < 2) {\n                        printEditError(questionId, d.langstrings.addopterr);\n                        return;\n\n                        // Ensure all custom question type options have labels.\n                    } else if (questionList[questionId].qtype == 'custom' &&\n                               labels.length != document.getElementById('edit-custom-select').value) {\n                        printEditError(questionId, d.langstrings.addopterr);\n                        return;\n                    }\n\n                    // Finish editing this question.\n                    edittingQuestion = false;\n                    delete questionList[questionId].edit;\n                    questionList[questionId].qtext = tb.value;\n                    questionOptions[questionId] = labels;\n\n                    // Send the question data to the server and reprint the question list.\n                    var out = {\n                        courseid: d.courseid,\n                        surveyid: surveyId,\n                        questionid: questionId,\n                        qtype: questionList[questionId].qtype,\n                        qtext: questionList[questionId].qtext,\n                        qorder: questionList[questionId].ordering,\n                        labels: labels\n                    };\n                    callServer(d.questionurl, out, d);\n                    addPreviousQuestions(d);\n                });\n\n                save.textContent = d.langstrings.save;\n                div.appendChild(save);\n\n                // Change question type select menu.\n                var qtypeSelect = getQuestionTypeSelect(d, questionId);\n                qtypeSelect.addEventListener('change', editSelectChange.bind(this, d, questionId));\n                div.appendChild(qtypeSelect);\n\n            } else { // Add edit button.\n                var ed = document.createElement('button');\n                ed.style.marginLeft = '12px';\n\n                ed.addEventListener('click', function() {\n                    if (edittingQuestion) {\n                        printEditError(questionId, d.langstrings.alreadyedit);\n                        return;\n                    }\n                    edittingQuestion = true;\n                    questionList[questionId].edit = true;\n                    addPreviousQuestions(d);\n                });\n\n                ed.textContent = d.langstrings.edit;\n                div.appendChild(ed);\n            }\n\n            return div;\n        }\n\n        /**\n         * Function called to get the select menu for changing question type.\n         *\n         * @param {array} d - The data needed.\n         * @param {string} qid - The id of the question.\n         * @return {DOMElement}\n         */\n        function getQuestionTypeSelect(d, qid) {\n\n            var qtypes = ['yn', 'tf', 'binary', 'gap', 'and', 'lnd', 'egapt',\n                          'likert', 'aossn', 'slnds', 'custom', 'multiple', 'open'];\n            var qtypeNames = {};\n            for (var t in qtypes) {\n                qtypeNames[qtypes[t]] = d.langstrings[qtypes[t]];\n            }\n\n            var qtypeSelect = document.createElement('select');\n            qtypeSelect.id = 'edit-qtype-select';\n            qtypeSelect.style.marginLeft = '10px';\n\n            var o = document.createElement('option');\n            o.text = d.langstrings.changeqtype;\n            o.disabled = true;\n            o.hidden = true;\n            o.selected = true;\n            qtypeSelect.appendChild(o);\n\n            for (var qt in qtypes) {\n                if (questionList[qid].qtype != qtypes[qt]) {\n                    o = document.createElement('option');\n                    o.text = qtypeNames[qtypes[qt]];\n                    o.value = qtypes[qt];\n                    qtypeSelect.appendChild(o);\n                }\n            }\n            return qtypeSelect;\n        }\n\n        /**\n         * Function called when select menu for changing question type changes.\n         *\n         * @param {array} d - The data needed.\n         * @param {string} questionId - The id of the question.\n         */\n        function editSelectChange(d, questionId) {\n\n            var oldMenu = document.getElementById('edit-qtype-select');\n            var qtype = oldMenu.options[oldMenu.selectedIndex].value;\n            var qdiv = document.createElement('div');\n            qdiv.id = 'qdiv-' + questionId;\n            var labels;\n\n            var oldText = document.getElementById('question-' + questionId);\n            questionList[questionId].qtext = oldText.value;\n\n            var qText = document.createElement('input');\n            qText.id = 'question-' + questionId;\n            qText.type = 'text';\n            qText.value = questionList[questionId].qtext;\n            qdiv.appendChild(qText);\n            qdiv.appendChild(document.createElement('br'));\n\n            // Save old data in case user clicks cancel.\n            questionList[questionId].oldQType = questionList[questionId].qtype;\n\n            if (questionList[questionId].qtype == 'custom' ||\n                questionList[questionId].qtype == 'binary' ||\n                questionList[questionId].qtype == 'multiple') {\n\n                var n = 0;\n                var ll;\n                questionList[questionId].labels = [];\n\n                while (document.getElementById('option-' + questionId + '-' + n)) {\n                    ll = document.getElementById('option-' + questionId + '-' + n);\n                    questionList[questionId].labels[n++] = ll.value;\n                }\n            }\n\n            questionList[questionId].qtype = qtype;\n            questionOptions[questionId] = [];\n\n            if (qtype == 'binary') {\n                for (var i = 0; i < 2; i++) {\n                    addEditRadioOption(qdiv, d.langstrings.option, questionId, i, true);\n                }\n            } else if (qtype == 'likert') {\n                labels = d.langstrings.likertscale.split(',');\n            } else if (qtype == 'yn') {\n                labels = d.langstrings.ynscale.split(',');\n            } else if (qtype == 'tf') {\n                labels = d.langstrings.tfscale.split(',');\n            } else if (qtype == 'gap') {\n                labels = d.langstrings.gapscale.split(',');\n            } else if (qtype == 'and') {\n                labels = d.langstrings.andscale.split(',');\n            } else if (qtype == 'lnd') {\n                labels = d.langstrings.lndscale.split(',');\n            } else if (qtype == 'egapt') {\n                labels = d.langstrings.egaptscale.split(',');\n            } else if (qtype == 'aossn') {\n                labels = d.langstrings.aossnscale.split(',');\n            } else if (qtype == 'slnds') {\n                labels = d.langstrings.slndsscale.split(',');\n\n            } else if (qtype == 'custom') {\n                var cs = document.createElement('select');\n                cs.id = 'edit-custom-select';\n                cs.style.marginLeft = '10px';\n\n                var o = document.createElement('option');\n                o.text = d.langstrings.customselect;\n                o.disabled = true;\n                o.hidden = true;\n                o.selected = true;\n                cs.appendChild(o);\n\n                for (var m = 2; m <= 10; m++) {\n                    o = document.createElement('option');\n                    o.text = m;\n                    o.value = m;\n                    cs.appendChild(o);\n                }\n\n                cs.addEventListener('change', function() {\n                    var o = 0;\n                    var l;\n                    var r;\n                    var labels = [];\n                    while (document.getElementById('option-' + questionId + '-' + o)) {\n                        l = document.getElementById('option-' + questionId + '-' + o);\n                        r = document.getElementById('radio-' + questionId + '-' + o);\n                        if (l.value != '') {\n                            labels[labels.length] = l.value;\n                        }\n                        qdiv.removeChild(l);\n                        qdiv.removeChild(r);\n                        o++;\n                    }\n                    for (var j = 0; j < cs.options[cs.selectedIndex].value; j++) {\n                        if (j < labels.length) {\n                            addEditRadioOption(qdiv, labels[j], questionId, j, false);\n                        } else {\n                            addEditRadioOption(qdiv, d.langstrings.option, questionId, j, true);\n                        }\n                    }\n                });\n\n                document.getElementById('qdiv-header-' + questionId).appendChild(cs);\n\n            } else if (qtype == 'multiple') {\n                for (var k = 0; k < 2; k++) {\n                    addEditCheckboxOption(qdiv, d.langstrings.option, questionId, k, true);\n                }\n\n                var addOption = document.createElement('button');\n                addOption.textContent = d.langstrings.addoption;\n                addOption.id = 'add-option';\n\n                addOption.addEventListener('click', function() {\n                    var o = 0;\n                    var option;\n                    while (document.getElementById('option-div-' + questionId + '-' + o)) {\n                        option = document.getElementById('option-div-' + questionId + '-' + o);\n                        o++;\n                    }\n                    addEditCheckboxOption(option, d.langstrings.option, questionId, o, true);\n                });\n\n                qdiv.appendChild(addOption);\n\n            } else { // Open question type.\n                var tb = document.createElement('textarea');\n                tb.disabled = true;\n                qdiv.appendChild(tb);\n            }\n\n            if (labels) {\n                for (var l in labels) {\n                    addRadioOption(qdiv, labels[l]);\n                }\n            }\n\n            var newMenu = getQuestionTypeSelect(d, questionId);\n            newMenu.addEventListener('change', editSelectChange.bind(this, d, questionId));\n            document.getElementById('qdiv-header-' + questionId).replaceChild(newMenu, oldMenu);\n            if (qtype != 'custom' && document.getElementById('edit-custom-select')) {\n                document.getElementById('qdiv-header-' + questionId)\n                    .removeChild(document.getElementById('edit-custom-select'));\n            }\n\n            var oldQdiv = document.getElementById('qdiv-' + questionId);\n            document.getElementById('question-list').replaceChild(qdiv, oldQdiv);\n        }\n\n        /**\n         * Function called to make a new survey.\n         *\n         * @param {array} serverData - The data from the server.\n         */\n        function showSurvey(serverData) {\n\n            var div = document.getElementById('new-survey');\n\n            // Survey title.\n            var title;\n            if (serverData.newsurvey) {\n                title = document.createElement('input');\n                title.type = 'text';\n                title.id = 'survey-title';\n                title.placeholder = serverData.langstrings.surveytitle;\n                div.appendChild(title);\n                div.appendChild(document.createElement('br'));\n            } else {\n                // Replace the input text box with static text.\n                title = document.createElement('h3');\n                title.textContent = serverData.survey.title;\n                div.appendChild(title);\n                surveyId = serverData.survey.id;\n                for (var q in serverData.questions) {\n                    questionList[q] = serverData.questions[q];\n                    questionList[q].ordering = parseInt(questionList[q].ordering);\n                    questionOptions[q] = [];\n                    for (var o in serverData.qoptions[q]) {\n                        questionOptions[q][o] = serverData.qoptions[q][o];\n                    }\n                }\n                addPreviousQuestions(serverData);\n            }\n\n            // Add a question button.\n            var addQ = document.createElement('button');\n            addQ.textContent = serverData.langstrings.addquestion;\n\n            serverData.title = title;\n            serverData.div = div;\n            serverData.addQ = addQ;\n\n            addQ.addEventListener('click', addQuestion.bind(this, serverData));\n            div.appendChild(addQ);\n            div.appendChild(document.createElement('br'));\n\n            // The questions area title.\n            var qt = document.getElementById('questions-title');\n            qt.style.display = Object.keys(serverData.questions).length > 0 ? 'block' : 'none';\n            qt.appendChild(document.createTextNode(serverData.langstrings.questionstitle));\n        }\n\n        /**\n         * Function called when add question button clicked.\n         *\n         * @param {array} d - The data needed.\n         */\n        function addQuestion(d) {\n\n            if (d.title.type == 'text' && d.title.value == '') {\n                printError(d.langstrings.surveytitleerr);\n                return;\n            }\n\n            if (surveyId === 0) {\n\n                // Start a DB record for this survey.\n                callServer(d.surveyurl, {\n                    courseid: d.courseid,\n                    title: d.title.value\n                }, true);\n\n                // Replace the input text box with static text.\n                var p = document.createElement('h3');\n                p.textContent = d.title.value;\n                d.div.replaceChild(p, d.title);\n            }\n\n            var qtypes = ['yn', 'tf', 'binary', 'gap', 'and', 'lnd', 'egapt',\n                          'likert', 'aossn', 'slnds', 'custom', 'multiple', 'open'];\n            var qtypeNames = {};\n            for (var t in qtypes) {\n                qtypeNames[qtypes[t]] = d.langstrings[qtypes[t]];\n            }\n\n            // Question type select menu.\n            var qtype = document.createElement('select');\n            qtype.id = 'qtype-select';\n            d.qtype = qtype;\n\n            var o = document.createElement('option');\n            o.text = d.langstrings.qtype;\n            o.disabled = true;\n            o.hidden = true;\n            o.selected = true;\n            qtype.appendChild(o);\n\n            for (var qt in qtypes) {\n                o = document.createElement('option');\n                o.text = qtypeNames[qtypes[qt]];\n                o.value = qtypes[qt];\n                qtype.appendChild(o);\n            }\n\n            qtype.addEventListener('change', selectQType.bind(this, d));\n            qtype.appendChild(document.createElement('br'));\n            d.div.appendChild(qtype);\n            d.addQ.style.display = 'none';\n        }\n\n        /**\n         * Function called when question type select changed.\n         *\n         * @param {array} d - The data needed.\n         */\n        function selectQType(d) {\n\n            // Remove old question type interface.\n            var oldQText;\n            if (document.getElementById('question-div')) {\n                oldQText = document.getElementById('qtext').value;\n                d.div.removeChild(document.getElementById('question-div'));\n                if (document.getElementById('custom-select')) {\n                    d.div.removeChild(document.getElementById('custom-select'));\n                }\n            }\n\n            var qdiv = document.createElement('div');\n            qdiv.id = 'question-div';\n\n            // Question text.\n            var qText = document.createElement('textarea');\n            qText.id = 'qtext';\n            if (oldQText) {\n                qText.value = oldQText;\n            } else {\n                qText.placeholder = d.langstrings.qtext;\n            }\n            d.qText = qText;\n            qdiv.appendChild(qText);\n            qdiv.appendChild(document.createElement('br'));\n\n            // The answer options for the question.\n            var qtype = d.qtype.options[d.qtype.selectedIndex].value;\n            var labels;\n\n            if (qtype == 'binary') {\n                for (var i = 0; i < 2; i++) {\n                    addRadioTextOption(qdiv, d.langstrings.option, i, true);\n                }\n            } else if (qtype == 'likert') {\n                labels = d.langstrings.likertscale.split(',');\n\n            } else if (qtype == 'yn') {\n                labels = d.langstrings.ynscale.split(',');\n\n            } else if (qtype == 'tf') {\n                labels = d.langstrings.tfscale.split(',');\n\n            } else if (qtype == 'gap') {\n                labels = d.langstrings.gapscale.split(',');\n\n            } else if (qtype == 'and') {\n                labels = d.langstrings.andscale.split(',');\n\n            } else if (qtype == 'lnd') {\n                labels = d.langstrings.lndscale.split(',');\n\n            } else if (qtype == 'egapt') {\n                labels = d.langstrings.egaptscale.split(',');\n\n            } else if (qtype == 'aossn') {\n                labels = d.langstrings.aossnscale.split(',');\n\n            } else if (qtype == 'slnds') {\n                labels = d.langstrings.slndsscale.split(',');\n\n            } else if (qtype == 'custom') {\n                doCustomQuestion(d, qdiv);\n\n            } else if (qtype == 'multiple') {\n                doMultipleQuestion(d, qdiv);\n\n            } else { // Open question type.\n                var tb = document.createElement('textarea');\n                tb.disabled = true;\n                qdiv.appendChild(tb);\n            }\n\n            if (labels) {\n                for (var l in labels) {\n                    addRadioOption(qdiv, labels[l]);\n                }\n            }\n            // The save question button.\n            if (qtype != 'custom') {\n                var save = document.createElement('button');\n                save.id = 'savequestion';\n                save.textContent = d.langstrings.save;\n                save.addEventListener('click', saveQuestion.bind(this, d));\n                qdiv.appendChild(document.createElement('br'));\n                qdiv.appendChild(save);\n            }\n            d.div.appendChild(qdiv);\n        }\n\n        /**\n         * Function called to render a multiple question type.\n         *\n         * @param {array} d - The data needed.\n         * @param {DOMElement} qdiv - The question div.\n         */\n        function doMultipleQuestion(d, qdiv) {\n\n            for (var k = 0; k < 2; k++) {\n                addCheckboxTextOption(qdiv, d.langstrings.option, k);\n            }\n\n            var addOption = document.createElement('button');\n            addOption.textContent = d.langstrings.addoption;\n            addOption.id = 'add-option';\n            addOption.addEventListener('click', function() {\n\n                var o = 0;\n                var option;\n                while (document.getElementById('option-div-' + o)) {\n                    option = document.getElementById('option-div-' + o);\n                    o++;\n                }\n                addCheckboxTextOption(option, d.langstrings.option, o);\n            });\n\n            qdiv.appendChild(addOption);\n        }\n\n        /**\n         * Function called to render a custom question type.\n         *\n         * @param {array} d - The data needed.\n         * @param {DOMElement} qdiv - The question div.\n         */\n        function doCustomQuestion(d, qdiv) {\n\n            var cs = document.createElement('select');\n            cs.id = 'custom-select';\n\n            var o = document.createElement('option');\n            o.text = d.langstrings.customselect;\n            o.disabled = true;\n            o.hidden = true;\n            o.selected = true;\n            cs.appendChild(o);\n\n            for (var i = 2; i <= 10; i++) {\n                o = document.createElement('option');\n                o.text = i;\n                o.value = i;\n                cs.appendChild(o);\n            }\n\n            cs.addEventListener('change', function() {\n                var labels = [];\n                if (document.getElementById('savequestion')) {\n                    qdiv.removeChild(document.getElementById('savequestion'));\n                    qdiv.removeChild(document.getElementById('savequestionbreak'));\n\n                    var o = 0;\n                    var opt;\n                    while (document.getElementById('text-label-' + o)) {\n                        opt = document.getElementById('text-label-' + o);\n                        if (opt.value != '') {\n                            labels[labels.length] = opt.value;\n                        }\n                        qdiv.removeChild(opt);\n                        qdiv.removeChild(document.getElementById('radio-' + o));\n                        o++;\n                    }\n                }\n\n                for (var j = 0; j < cs.options[cs.selectedIndex].value; j++) {\n                    if (j < labels.length) {\n                        addRadioTextOption(qdiv, labels[j], j, false);\n                    } else {\n                        addRadioTextOption(qdiv, d.langstrings.option, j, true);\n                    }\n                }\n\n                var s = document.createElement('button');\n                s.id = 'savequestion';\n                s.textContent = d.langstrings.save;\n                s.addEventListener('click', saveQuestion.bind(this, d));\n\n                var br = document.createElement('br');\n                br.id = 'savequestionbreak';\n                qdiv.appendChild(br);\n                qdiv.appendChild(s);\n            });\n\n            d.div.appendChild(cs);\n        }\n\n        /**\n         * Function called when save button clicked.\n         *\n         * @param {array} d - The data needed.\n         */\n        function saveQuestion(d) {\n\n            var qtype = d.qtype.options[d.qtype.selectedIndex].value;\n            var i = 0;\n            var label;\n            var labels;\n\n            // Show error message if the question text or any option text is blank.\n            if (d.qText.value == '') {\n                printError(d.langstrings.addqerr);\n                return;\n\n            } else if (qtype == 'binary' || qtype == 'custom') {\n                while (document.getElementById('text-label-' + i)) {\n                    label = document.getElementById('text-label-' + i);\n                    if (label.value == '') {\n                        printError(d.langstrings.addopterr);\n                        return;\n                    }\n                    i++;\n                }\n            } else if (qtype == 'multiple') { // Ensure at least 2 options filled.\n                labels = [];\n                while (document.getElementById('text-label-' + i)) {\n                    label = document.getElementById('text-label-' + i);\n                    if (label.value != '') {\n                        labels[labels.length] = 1;\n                    }\n                    i++;\n                }\n                if (labels.length < 2) {\n                    printError(d.langstrings.addopterr);\n                    return;\n                }\n            }\n\n            document.getElementById('questions-title').style.display = 'block';\n\n            // Get the user labels, if not likert scale.\n            labels = [];\n            if (qtype == 'binary' || qtype == 'custom' || qtype == 'multiple') {\n                i = 0;\n                while (document.getElementById('text-label-' + i)) {\n                    label = document.getElementById('text-label-' + i);\n                    if (label.value != '') {\n                        labels[labels.length] = label.value;\n                    }\n                    i++;\n                }\n            }\n\n            // Store this question in the DB.\n            var out = {\n                courseid: d.courseid,\n                surveyid: surveyId,\n                qtype: qtype,\n                qtext: d.qText.value,\n                qorder: Object.keys(questionList).length + 1,\n                labels: labels\n            };\n            callServer(d.questionurl, out, d);\n\n            // Remove the question from the create area.\n            d.div.removeChild(document.getElementById('question-div'));\n            d.div.removeChild(d.qtype);\n            if (qtype == 'custom') {\n                d.div.removeChild(document.getElementById('custom-select'));\n            }\n            d.addQ.style.display = 'block';\n        }\n\n        /**\n         * Function called to print an error message.\n         *\n         * @param {string} msg - The error message to print\n         */\n        function printError(msg) {\n\n            var div = document.getElementById('new-survey');\n\n            var p = document.createElement('p');\n            p.style.color = 'red';\n            p.appendChild(document.createTextNode(msg));\n            p.appendChild(document.createElement('br'));\n            div.appendChild(p);\n\n            setTimeout(function() {\n                div.removeChild(p);\n            }, 2000);\n        }\n\n        /**\n         * Function called to print an error message when editting a question.\n         *\n         * @param {number} qid - Question ID\n         * @param {string} msg - The error message to print\n         */\n        function printEditError(qid, msg) {\n\n            var div = document.getElementById('qdiv-' + qid);\n\n            var p = document.createElement('p');\n            p.style.color = 'red';\n            p.appendChild(document.createTextNode(msg));\n            p.appendChild(document.createElement('br'));\n            div.appendChild(p);\n\n            setTimeout(function() {\n                div.removeChild(p);\n            }, 2000);\n        }\n\n        /**\n         * Function called to send data to server.\n         *\n         * @param {string} url - The name of the file receiving the data\n         * @param {object} outData - The data to send to the server\n         * @param {object} d - Data from the server.\n         */\n        function callServer(url, outData, d) {\n\n            var req = new XMLHttpRequest();\n            req.open('POST', url);\n            req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\n            req.onreadystatechange = function() {\n                if (this.readyState == 4 && this.status == 200) {\n\n                    if (outData.title) { // Started a new survey, need the ID.\n                        surveyId = parseInt(this.responseText);\n\n                    } else if (outData.deleted) { // Deleted a question\n                        for (var q in questionList) {\n                            if (questionList[q].ordering > outData.ordering) {\n                                questionList[q].ordering--;\n                            }\n                        }\n                        addPreviousQuestions(d);\n\n                    } else if (outData.surveyid) { // Added a new question, need the ID.\n                        var qid = parseInt(this.responseText);\n                        questionList[qid] = outData;\n                        questionList[qid].ordering = outData.qorder;\n                        questionOptions[qid] = [];\n\n                        for (var l in outData.labels) {\n                            questionOptions[qid][l] = outData.labels[l];\n                        }\n                        addPreviousQuestions(d);\n                    }\n                }\n            };\n            // Ampersands cause issues in POST and GET, encode it.\n            var replaced = JSON.stringify(outData).replaceAll('&', '%amp;');\n            req.send('data=' + replaced + '&sesskey=' + M.cfg.sesskey);\n        }\n\n        /**\n         * Called to build the graph data and get the graphs. There is\n         * always a graph for system clustering, but the manual clustering\n         * may not have been done, so no graph then.\n         *\n         * @param {array} serverData The data from the server.\n         */\n        function showSummary(serverData) {\n\n            var map = serverData.membermap;\n\n            var data = [];\n            var diff = [];\n            var sys = [];\n            var man = [];\n            var gid = null;\n            var cid = null;\n            var uid = null;\n            var n = null;\n            var s = null;\n            var m = null;\n\n            if (serverData.iteration) {\n                for (uid in map) { // User id.\n                    for (gid in map[uid]) { // Graph id.\n                        for (cid in map[uid][gid]) { // Clustering id.\n                            for (var it in map[uid][gid][cid]) { // Iteration.\n\n                                data = [];\n\n                                for (n in map[uid][gid][cid][it]) { // Cluster number.\n                                    sys = map[uid][gid][cid][it][n][0].split(', ');\n                                    man = map[uid][gid][cid][it][n][1].split(', ');\n\n                                    // System clustering.\n                                    data[data.length] = {\n                                        members: map[uid][gid][cid][it][n][0],\n                                        memberCount: sys.length,\n                                        cluster: n,\n                                        type: 'system',\n                                    };\n\n                                    // Manual clustering.\n                                    if (map[uid][gid][cid][it][n][1].length > 0) {\n\n                                        data[data.length] = {\n                                            members: map[uid][gid][cid][it][n][1],\n                                            memberCount: man.length,\n                                            cluster: n,\n                                            type: 'manual',\n                                        };\n\n                                        // Compute the difference.\n                                        diff = [];\n                                        for (s in sys) {\n                                            if (man.indexOf(sys[s]) === -1) {\n                                                diff[diff.length] = sys[s];\n                                            }\n                                        }\n                                        for (m in man) {\n                                            if (sys.indexOf(man[m]) === -1) {\n                                                diff[diff.length] = man[m];\n                                            }\n                                        }\n                                        data[data.length] = {\n                                            members: diff.toString(),\n                                            memberCount: diff.length,\n                                            cluster: n,\n                                            type: 'diff',\n                                            percent: getBarDiffPercentage(sys, man, diff.length),\n                                        };\n                                    }\n                                }\n                                makeGraph(data,\n                                          '#pie' + cid + '-' + it,\n                                          map[uid][gid][cid][it].length * 3 == data.length,\n                                          serverData.langstrings);\n                            }\n                        }\n                    }\n                }\n            } else {\n                for (uid in map) { // User id.\n                    for (gid in map[uid]) { // Graphid.\n                        for (cid in map[uid][gid]) { // Clustering id.\n\n                            data = [];\n\n                            for (n in map[uid][gid][cid]) { // Cluster number.\n\n                                sys = map[uid][gid][cid][n][0].split(', ');\n                                man = map[uid][gid][cid][n][1].split(', ');\n\n                                // System clustering.\n                                data[data.length] = {\n                                    members: map[uid][gid][cid][n][0],\n                                    memberCount: sys.length,\n                                    cluster: n,\n                                    type: 'system',\n                                };\n\n                                // Manual clustering.\n                                if (map[uid][gid][cid][n][1].length > 0) {\n\n                                    data[data.length] = {\n                                        members: map[uid][gid][cid][n][1],\n                                        memberCount: man.length,\n                                        cluster: n,\n                                        type: 'manual',\n                                    };\n\n                                    // Compute the difference.\n                                    diff = [];\n                                    for (s in sys) {\n                                        if (man.indexOf(sys[s]) === -1) {\n                                            diff[diff.length] = sys[s];\n                                        }\n                                    }\n                                    for (m in man) {\n                                        if (sys.indexOf(man[m]) === -1) {\n                                            diff[diff.length] = man[m];\n                                        }\n                                    }\n                                    data[data.length] = {\n                                        members: diff.toString(),\n                                        memberCount: diff.length,\n                                        cluster: n,\n                                        type: 'diff',\n                                        percent: getBarDiffPercentage(sys, man, diff.length),\n                                    };\n                                }\n                            }\n                            makeGraph(data,\n                                      '#pie' + cid,\n                                      map[uid][gid][cid].length * 3 == data.length,\n                                      serverData.langstrings);\n                        }\n                    }\n                }\n            }\n        }\n\n        /**\n         * Gets the percentage difference between clusters.\n         *\n         * @param {object} sys - The system clustering.\n         * @param {object} man - The manual clustering.\n         * @param {diff} diff - The number different.\n         * @return {number}\n         */\n        function getBarDiffPercentage(sys, man, diff) {\n\n            var ob = {};\n            for (var i in sys) {\n                ob[sys[i]] = 1;\n            }\n            for (var j in man) {\n                ob[man[j]] = 1;\n            }\n            return (diff / Object.keys(ob).length * 100).toFixed(0);\n        }\n\n        /**\n         * Makes the horizontal bar graph.\n         *\n         * @param {array} data - Data from the server\n         * @param {string} gid - The graph id\n         * @param {bool} haveManualData - Display flag.\n         * @param {object} strings - Language strings.\n         */\n        function makeGraph(data, gid, haveManualData, strings) {\n\n            var d3 = window.dataDrivenDocs;\n\n            // Dimension variables and values.\n            var width = 800;\n            var height = 100 + (data.length * 25);\n            var margin = ({top: 0, right: 20, bottom: 30, left: 140});\n            var colours = haveManualData ? [\"#003f5c\", \"#bc5090\", \"#ffa600\"] :\n                ['#488f31', '#489a68', '#78ab63', '#a8ba61', '#dac767', '#dfa850', '#e18745', '#de6347', '#de425b'];\n\n            // Reverse the data so it shows the same as the above graph.\n            var revdata = [];\n            for (var i = data.length - 1; i >= 0; i--) {\n                revdata[revdata.length] = data[i];\n            }\n            data = revdata;\n\n            // Count the total number of students in this clustering.\n            var students = 0;\n            for (var d in data) {\n                if (data[d].type == 'system') {\n                    students += data[d].memberCount;\n                }\n            }\n\n            // Set the color scale.\n            var colour = d3.scaleOrdinal()\n                .domain(data)\n                .range(colours);\n\n            // X and Y axis functions.\n            var y = d3.scaleBand()\n                .domain(d3.range(data.length))\n                .range([height - margin.bottom, margin.top])\n                .padding(0.1);\n\n            var x = d3.scaleLinear()\n                .domain([0, students])\n                .range([margin.left, width - margin.right]);\n\n            var yAxis = function(g) {\n                g.attr('transform', 'translate(' + margin.left + ',0)')\n                    .call(d3.axisLeft(y).tickFormat(function(i) {\n                        var l = strings.cluster;\n                        if (haveManualData) {\n                            if (data[i].type == 'system') {\n                                l = strings.system;\n                            } else if (data[i].type == 'manual') {\n                                l = strings.manual;\n                            } else {\n                                l = strings.diff;\n                            }\n                        }\n                        return l + ' ' + data[i].cluster;\n                    }).tickSizeOuter(0))\n                    .selectAll('text')\n                    .style('font-size', '2.5em');\n            };\n            var xAxis = function(g) {\n                g.attr('transform', 'translate(0,' + (height - margin.bottom) + ')')\n                    .call(d3.axisBottom(x))\n                    .selectAll('text')\n                    .style('font-size', '2.5em');\n            };\n            // The graph itself.\n            var svg = d3.select(gid).append(\"svg\")\n                .attr(\"viewBox\", [0, 0, width, height])\n                .attr('id', 'graph-svg');\n\n            // The graph bars.\n            var bars = svg.selectAll('.bar')\n                .data(data)\n                .enter()\n                .append(\"g\");\n\n            bars.append('rect')\n                .attr('class', 'bar')\n                .attr('id', function(d) {\n                    return d.type + '-' + d.cluster;\n                })\n                .attr(\"fill\", function(d, i) {\n                    return colour(i);\n                })\n                .attr(\"y\", function(d, i) {\n                    return y(i);\n                })\n                .attr(\"x\", function() {\n                    return x(0);\n                })\n                .attr(\"width\", function(d) {\n                    return x(d.memberCount) - x(0);\n                })\n                .attr(\"height\", y.bandwidth())\n                .append('title')\n                .text(function(d) {\n                    if (d.percent) {\n                        return d.percent + '% - ' + d.members;\n                    } else {\n                        return d.members;\n                    }\n                })\n                .style('display', 'none')\n                .on('mouseover', function(d) {\n                    d3.select('#' + d.type + '-' + d.cluster).style('dislpay', 'block');\n                })\n                .on('mouseout', function(d) {\n                    d3.select('#' + d.type + '-' + d.cluster).style('dislpay', 'none');\n                });\n\n            // Add the X and Y axis to the graph.\n            svg.append(\"g\")\n                .call(xAxis);\n\n            svg.append(\"g\")\n                .call(yAxis);\n        }\n\n        /**\n         * Called show the learning style radar chart.\n         */\n        function showLSRadar() {\n\n            var b = document.createElement('button');\n            b.textContent = incoming.langstrings.show8dim;\n\n            var show8Dim = true;\n            b.addEventListener('click', function() {\n\n                window.dataDrivenDocs.select('#big-student-radar').remove();\n                chartIsBig = false;\n                doLSRadar(show8Dim);\n\n                if (show8Dim) {\n                    b.textContent = incoming.langstrings.show4dim;\n                    show8Dim = false;\n\n                } else {\n                    b.textContent = incoming.langstrings.show8dim;\n                    show8Dim = true;\n                }\n            });\n\n            var div = document.getElementById('lsradar');\n            div.appendChild(b);\n            div.appendChild(document.createElement('br'));\n\n            doLSRadar(false);\n        }\n\n        /**\n         * Called to set up the learning style radar chart.\n         *\n         * @param {boolean} show8Dim - Show 8 dimensions or 4?\n         */\n        function doLSRadar(show8Dim) {\n\n            var rd;\n            var features;\n            var svg;\n            var params;\n            var point;\n\n            window.dataDrivenDocs.selectAll('svg').remove();\n\n            if (show8Dim) {\n                features = [\n                    incoming.langstrings.active,\n                    incoming.langstrings.sensing,\n                    incoming.langstrings.visual,\n                    incoming.langstrings.sequential,\n                    incoming.langstrings.reflective,\n                    incoming.langstrings.intuitive,\n                    incoming.langstrings.verbal,\n                    incoming.langstrings.global\n                ];\n\n                // Course average chart.\n                params = {\n                    width: 600,\n                    height: 600,\n                    domain: 11,\n                    range: 230,\n                    tOffset: 0\n                };\n\n                rd = getRadarData(incoming.lsdata, features, 'avg8dim', incoming.namemap);\n                svg = makeRadar(rd, features, params);\n                svg.append('text')\n                    .text(incoming.langstrings.courseaverage)\n                    .attr('x', (params.width / 2) - ((incoming.langstrings.courseaverage.length / 2) * 8))\n                    .attr('y', params.height - 20);\n\n                // Individual student charts.\n                params = {\n                    width: 300,\n                    height: 300,\n                    domain: 11,\n                    range: 100,\n                    tOffset: 0\n                };\n\n                rd = getRadarData(incoming.lsdata, features, 'all8dim', incoming.namemap);\n                for (point in rd) {\n                    svg = makeRadar([rd[point]], features, params);\n                    svg.append('text')\n                        .text(rd[point].studentName)\n                        .attr('x', (params.width / 2) - ((rd[point].studentName.length / 2) * 8))\n                        .attr('y', params.height - 20);\n                }\n\n            } else {\n                features = [\n                    incoming.langstrings.active + '/' + incoming.langstrings.reflective,\n                    incoming.langstrings.sensing + '/' + incoming.langstrings.intuitive,\n                    incoming.langstrings.visual + '/' + incoming.langstrings.verbal,\n                    incoming.langstrings.sequential + '/' + incoming.langstrings.global,\n                ];\n\n                // Course average chart.\n                params = {\n                    width: 600,\n                    height: 600,\n                    domain: 22,\n                    range: 230,\n                    tOffset: -11\n                };\n\n                rd = getRadarData(incoming.lsdata2, features, 'avg4dim', incoming.namemap);\n                svg = makeRadar(rd, features, params);\n                svg.append('text')\n                    .text(incoming.langstrings.courseaverage)\n                    .attr('x', (params.width / 2) - ((incoming.langstrings.courseaverage.length / 2) * 8))\n                    .attr('y', params.height - 20);\n\n                // Individual student charts.\n                params = {\n                    width: 300,\n                    height: 300,\n                    domain: 22,\n                    range: 100,\n                    tOffset: -11\n                };\n\n                rd = getRadarData(incoming.lsdata2, features, 'all4dim', incoming.namemap);\n                for (point in rd) {\n                    svg = makeRadar([rd[point]], features, params);\n                    svg.append('text')\n                        .text(rd[point].studentName)\n                        .attr('x', (params.width / 2) - ((rd[point].studentName.length / 2) * 8))\n                        .attr('y', params.height - 20);\n                }\n            }\n        }\n\n        /**\n         * Makes the radar chart. Adapted from\n         * https://yangdanny97.github.io/blog/2019/03/01/D3-Spider-Chart.\n         *\n         * @param {array} data - Radar data\n         * @param {array} features - The radar features\n         * @param {object} params - The dimension parameters\n         * @return {object}\n         */\n        function makeRadar(data, features, params) {\n\n            var d3 = window.dataDrivenDocs;\n            var width = params.width || 600;\n            var height = params.height || 600;\n            var domain = params.domain || 11;\n            var range = params.range || 230;\n            var tOffset = params.tOffset || 0;\n            var divId = params.divId || 'lsradar';\n\n            var svg = d3.select(\"#\" + divId)\n                .append(\"svg\")\n                .attr('class', 'radar')\n                .attr(\"width\", width)\n                .attr(\"height\", height)\n                .style('float', 'left')\n                .on('click', function() {\n\n                    // Do not enlarge course average chart.\n                    if (data[0].studentName == incoming.langstrings.courseaverage) {\n                        return;\n                    }\n\n                    // Remove any existing big chart so it can be replaced.\n                    if (chartIsBig) {\n                        d3.select('#big-student-radar').remove();\n                        params.width /= 2;\n                        params.height /= 2;\n                        params.range = incoming.showlsradar ? 100 : params.range / 2;\n                        delete params.divId;\n                        chartIsBig = false;\n                    }\n\n                    // Div to hold the bigger chart.\n                    var div = document.createElement('div');\n                    div.id = 'big-student-radar';\n                    div.style.width = params.width * 2;\n                    div.style.height = params.height * 2;\n\n                    div.style.position = 'absolute';\n                    div.style.left = ((window.innerWidth / 2) - params.width) + 'px';\n                    div.style.top = (d3.event.pageY - 400) + 'px';\n\n                    div.style.border = '3px solid ' + data[0].colour;\n                    div.style.backgroundColor = 'lightgrey';\n\n                    document.getElementById('lsradar').appendChild(div);\n                    chartIsBig = true;\n\n                    // Double the size and make the chart.\n                    params.width *= 2;\n                    params.height *= 2;\n                    params.range = incoming.showlsradar ? 230 : params.range * 2;\n                    params.divId = div.id;\n\n                    var svg = makeRadar(data, features, params);\n                    svg.append('text')\n                        .text(data[0].studentName)\n                        .attr('x', (params.width / 2) - ((data[0].studentName.length / 2) * 8))\n                        .attr('y', params.height - 20);\n\n                    // Remove the bigger chart when clicked.\n                    svg.on('click', function() {\n                        params.width /= 2;\n                        params.height /= 2;\n                        params.range = incoming.showlsradar ? 100 : params.range / 2;\n                        delete params.divId;\n\n                        document.getElementById('lsradar').removeChild(div);\n                        chartIsBig = false;\n                    });\n                });\n\n            var radialScale = d3.scaleLinear()\n                .domain([0, domain])\n                .range([0, range]);\n\n            // The main chart circles.\n            var ticks = [];\n            var i;\n            var t;\n            for (i = 1; i <= domain; i++) {\n                ticks.push(i);\n            }\n\n            for (t in ticks) {\n                svg.append(\"circle\")\n                    .attr(\"cx\", width / 2)\n                    .attr(\"cy\", height / 2)\n                    .attr(\"fill\", \"none\")\n                    .attr(\"stroke\", \"gray\")\n                    .attr(\"r\", radialScale(ticks[t]));\n            }\n\n            // Returns the coordinates in the graph for the given angle and value.\n            var angleToCoordinate = function(angle, value) {\n\n                var x = Math.cos(angle) * radialScale(value);\n                var y = Math.sin(angle) * radialScale(value);\n\n                return {\"x\": width / 2 + x, \"y\": width / 2 - y};\n            };\n\n            // The axis lines for the dimensions.\n            var ftName;\n            var angle;\n\n            for (i = 0; i < features.length; i++) {\n                ftName = features[i];\n                angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);\n                var lineCoordinate = angleToCoordinate(angle, domain);\n\n                svg.append(\"line\")\n                    .attr(\"x1\", width / 2)\n                    .attr(\"y1\", width / 2)\n                    .attr(\"x2\", lineCoordinate.x)\n                    .attr(\"y2\", lineCoordinate.y)\n                    .attr(\"stroke\", \"black\");\n            }\n\n            var line = d3.line()\n                .x(function(d) {\n                    return d.x;\n                })\n                .y(function(d) {\n                    return d.y;\n                });\n\n            // Returns the path coordinates of a student line.\n            var getPathCoordinates = function(dataPoint) {\n\n                var coordinates = [];\n                var ftName = features[features.length - 1];\n                var angle = (Math.PI / 2) + (2 * Math.PI * (features.length - 1) / features.length);\n                coordinates.push(angleToCoordinate(angle, dataPoint[ftName]));\n\n                for (var i = 0; i < features.length; i++) {\n                    ftName = features[i];\n                    angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);\n                    coordinates.push(angleToCoordinate(angle, dataPoint[ftName]));\n                }\n\n                return coordinates;\n            };\n\n            var tooltip = d3.select('#lsradar')\n                .append('div')\n                .attr('class', 'tooltip')\n                .style('opacity', 0)\n                .style('background-color', 'white')\n                .style('border', 'solid')\n                .style('border-radius', '5px')\n                .style('padding', '5px');\n\n            // The student lines.\n            for (i = 0; i < data.length; i++) {\n                var d = data[i];\n                var coordinates = getPathCoordinates(d);\n\n                var pointData = '';\n                var v = 0;\n                for (var f in features) {\n                    v = Math.round((d[features[f]] + tOffset) * 100) / 100;\n                    pointData += features[f] + ' ' + v + ', ';\n                }\n                pointData = pointData.substring(0, pointData.length - 2);\n                svg.append(\"path\")\n                    .datum(coordinates)\n                    .attr('id', d.studentName + ': ' + pointData)\n                    .attr(\"d\", line)\n                    .attr(\"stroke-width\", 5)\n                    .attr(\"stroke\", d.colour)\n                    .attr(\"fill\", 'none')\n                    .on('mouseover', function() {\n                        tooltip.style('opacity', 1);\n                    })\n                    .on('mousemove', function() {\n                        var x = d3.event.pageX;\n                        if (d3.event.pageX - d3.event.layerX > 100) { // Nav drawer open.\n                            x -= 280;\n                        }\n                        tooltip\n                            .html(this.id)\n                            .style('left', x + 'px')\n                            .style('top', (d3.event.pageY - 170) + 'px');\n                    })\n                    .on('mouseout', function() {\n                        tooltip.style('opacity', 0);\n                    });\n            }\n\n            // Draw text on top of student lines.\n            for (t in ticks) {\n                svg.append(\"text\")\n                    .attr(\"x\", width / 2 + 5)\n                    .attr(\"y\", height / 2 - radialScale(ticks[t]))\n                    .style('pointer-events', 'none')\n                    .text(domain < 6 || (tOffset + ticks[t]) % 2 == 0 ? (tOffset + ticks[t]).toString() : '');\n            }\n\n            for (i = 0; i < features.length; i++) {\n                ftName = features[i];\n                angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);\n                var labelCoordinate = angleToCoordinate(angle, domain + 0.5);\n\n                svg.append(\"text\")\n                    .attr(\"x\", labelCoordinate.x - 40)\n                    .attr(\"y\", labelCoordinate.y)\n                    .style('pointer-events', 'none')\n                    .text(ftName);\n            }\n\n            return svg;\n        }\n\n        /**\n         * Called to get the data for the radar chart.\n         *\n         * @param {object} lsdata - LS data from the server\n         * @param {array} features - The radar dimensions\n         * @param {string} type - The type of data to return\n         * @param {object} nameMap - Map of student IDs to names\n         * @return {array}\n         */\n        function getRadarData(lsdata, features, type, nameMap) {\n\n            var data = [];\n            var point;\n            var f;\n            var sid;\n            var fs;\n            var fsc;\n            var d3 = window.dataDrivenDocs;\n            var colors = d3.scaleOrdinal(d3.schemeCategory10);\n            var c = 0;\n\n            if (type == 'all4dim') {\n\n                for (sid in lsdata) {\n                    point = {};\n\n                    for (f in features) {\n                        fs = features[f].split('/');\n\n                        if (lsdata[sid][fs[0]] > lsdata[sid][fs[1]]) {\n                            point[features[f]] = 11 + lsdata[sid][fs[0]];\n                        } else {\n                            point[features[f]] = 11 - lsdata[sid][fs[1]];\n                        }\n                    }\n                    point.studentName = nameMap[sid];\n                    point.colour = colors(c++);\n                    data.push(point);\n                }\n\n            } else if (type == 'avg4dim') {\n\n                point = {};\n                for (sid in lsdata) {\n                    for (f in features) {\n                        fs = features[f].split('/');\n\n                        if (lsdata[sid][fs[0]] > lsdata[sid][fs[1]]) {\n                            fsc = 11 + lsdata[sid][fs[0]];\n                        } else {\n                            fsc = 11 - lsdata[sid][fs[1]];\n                        }\n\n                        if (point[features[f]]) {\n                            point[features[f]] += fsc;\n                        } else {\n                            point[features[f]] = fsc;\n                        }\n                    }\n                }\n                for (f in features) {\n                    point[features[f]] = point[features[f]] / Object.keys(lsdata).length;\n                }\n                point.studentName = incoming.langstrings.courseaverage;\n                point.colour = colors(c++);\n                data.push(point);\n\n            } else if (type == 'avg8dim') {\n\n                point = {};\n                for (sid in lsdata) {\n                    for (f in features) {\n\n                        if (point[features[f]]) {\n                            point[features[f]] += lsdata[sid][features[f]];\n                        } else {\n                            point[features[f]] = lsdata[sid][features[f]];\n                        }\n                    }\n                }\n                for (f in features) {\n                    point[features[f]] = point[features[f]] / Object.keys(lsdata).length;\n                }\n                point.studentName = incoming.langstrings.courseaverage;\n                point.colour = colors(c++);\n                data.push(point);\n\n            } else {\n\n                for (sid in lsdata) {\n                    lsdata[sid].studentName = nameMap[sid];\n                    lsdata[sid].colour = colors(c++);\n                    data.push(lsdata[sid]);\n                }\n            }\n\n            return data;\n        }\n\n        /**\n         * Called to show the Big Five Inventory radar charts.\n         */\n        function showBFIRadar() {\n\n            var features = [\n                incoming.langstrings.extraversion,\n                incoming.langstrings.agreeable,\n                incoming.langstrings.conscientiousness,\n                incoming.langstrings.neuroticism,\n                incoming.langstrings.openness,\n            ];\n\n            // Course average chart.\n            var params = {\n                width: 500,\n                height: 500,\n                domain: 5,\n                range: 180,\n                tOffset: 0\n            };\n\n            var rd = getRadarData(incoming.lsdata, features, 'avg8dim', incoming.namemap);\n            var svg = makeRadar(rd, features, params);\n            svg.append('text')\n                .text(incoming.langstrings.courseaverage)\n                .attr('x', (params.width / 2) - ((incoming.langstrings.courseaverage.length / 2) * 8))\n                .attr('y', params.height - 20);\n\n            // Individual student charts.\n            params = {\n                width: 250,\n                height: 250,\n                domain: 5,\n                range: 90,\n                tOffset: 0\n            };\n\n            rd = getRadarData(incoming.lsdata, features, '', incoming.namemap);\n            for (var d in rd) {\n                svg = makeRadar([rd[d]], features, params);\n                svg.append('text')\n                    .text(rd[d].studentName)\n                    .attr('x', (params.width / 2) - ((rd[d].studentName.length / 2) * 8))\n                    .attr('y', params.height - 20);\n            }\n        }\n\n        // End of modular encapsulation, start the program.\n        init(incoming);\n    };\n    return behaviourAnalyticsDashboard;\n});\n"],"names":["factory","define","amd","window","behaviourAnalyticsDashboard","incoming","surveyId","questionList","questionOptions","edittingQuestion","chartIsBig","addPreviousQuestions","d","node","option","textbox","labels","qdiv","edit","div","document","createElement","id","doAddOption","questionId","opt","o","getElementById","addEditCheckboxOption","langstrings","key","questionIds","Object","keys","sort","a","b","ordering","type","value","qtext","appendChild","createTextNode","qtype","addEditRadioOption","addRadioOption","addOption","textContent","addoption","addEventListener","bind","this","parent","text","box","disabled","label","style","marginLeft","addCheckboxOption","l","split","number","up","src","uparrowurl","opacity","q","qid","out","courseid","minusqid","plusqid","callServer","changequestionurl","down","transform","length","dl","ed","survey","deleted","deletequrl","delete","cancel","oldQType","save","tb","v","i","surveyid","questionid","qorder","questionurl","printEditError","addopterr","addqerr","qtypeSelect","getQuestionTypeSelect","editSelectChange","alreadyedit","getQuestionHeader","oldList","replaceChild","radio","name","marginRight","optionId","asPlaceholder","placeholder","addRadioTextOption","addCheckboxTextOption","t","qtypes","qtypeNames","qt","changeqtype","hidden","selected","oldMenu","options","selectedIndex","oldText","qText","ll","n","likertscale","ynscale","tfscale","gapscale","andscale","lndscale","egaptscale","aossnscale","slndsscale","cs","customselect","m","r","removeChild","j","k","newMenu","oldQdiv","saveQuestion","printError","display","addQ","msg","p","color","setTimeout","url","outData","req","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","status","title","parseInt","responseText","replaced","JSON","stringify","replaceAll","send","M","cfg","sesskey","getBarDiffPercentage","sys","man","diff","ob","toFixed","makeGraph","data","gid","haveManualData","strings","d3","dataDrivenDocs","height","margin","colours","revdata","students","memberCount","colour","scaleOrdinal","domain","range","y","scaleBand","padding","x","scaleLinear","svg","select","append","attr","selectAll","enter","cluster","bandwidth","percent","members","on","call","g","axisBottom","axisLeft","tickFormat","system","manual","tickSizeOuter","doLSRadar","show8Dim","rd","features","params","point","remove","active","sensing","visual","sequential","reflective","intuitive","verbal","global","width","tOffset","makeRadar","getRadarData","lsdata","namemap","courseaverage","studentName","lsdata2","divId","showlsradar","position","left","innerWidth","top","event","pageY","border","backgroundColor","radialScale","ticks","push","angleToCoordinate","angle","Math","cos","sin","ftName","PI","lineCoordinate","line","tooltip","f","coordinates","dataPoint","getPathCoordinates","pointData","round","substring","datum","pageX","layerX","html","toString","labelCoordinate","nameMap","sid","fs","fsc","colors","schemeCategory10","c","newsurvey","managesurvey","serverData","surveytitle","questions","qoptions","addquestion","surveyurl","oldQText","s","br","doCustomQuestion","doMultipleQuestion","surveytitleerr","questionstitle","showSurvey","show8dim","show4dim","showLSRadar","showbfiradar","extraversion","agreeable","conscientiousness","neuroticism","openness","showBFIRadar","map","membermap","cid","uid","iteration","it","indexOf","showSummary"],"mappings":"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"}